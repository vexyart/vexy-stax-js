# <!-- this_file: .release-workflow.md -->
# Release Workflow for Vexy Stax JS

## Overview

This document outlines the complete release workflow for Vexy Stax JS, from version planning through deployment and post-release monitoring.

**Current Version**: v0.2.0 (deployed 2025-11-05)
**Release Cadence**: Feature-driven (no fixed schedule)
**Deployment Target**: GitHub Pages (https://vexyart.github.io/vexy-stax-js/)

---

## Table of Contents

1. [Version Numbering](#version-numbering)
2. [Pre-Release Checklist](#pre-release-checklist)
3. [Release Process](#release-process)
4. [Changelog Generation](#changelog-generation)
5. [Git Tag Management](#git-tag-management)
6. [Deployment](#deployment)
7. [Post-Release Tasks](#post-release-tasks)
8. [Rollback Procedures](#rollback-procedures)
9. [Release Templates](#release-templates)

---

## Version Numbering

### Semantic Versioning (SemVer)

Vexy Stax JS follows **Semantic Versioning 2.0.0**: `MAJOR.MINOR.PATCH`

**Format**: `vX.Y.Z` (e.g., `v0.2.0`, `v1.3.2`)

**Version Components**:
- **MAJOR** (X): Breaking changes, incompatible API changes
- **MINOR** (Y): New features, backward-compatible additions
- **PATCH** (Z): Bug fixes, backward-compatible improvements

### Examples

| Change Type | Old Version | New Version | Example |
|------------|-------------|-------------|---------|
| Bug fix | `v0.2.0` | `v0.2.1` | Fixed PNG export memory leak |
| New feature | `v0.2.1` | `v0.3.0` | Added video export (MP4/WebM) |
| Breaking change | `v0.3.5` | `v1.0.0` | Removed legacy JSON format support |
| Quality improvements | `v0.2.0` | `v0.2.1` | +50 tests, improved documentation |

### Pre-Release Versions

For unstable releases, append suffix:
- **Alpha**: `v0.3.0-alpha.1` (early development, incomplete features)
- **Beta**: `v0.3.0-beta.2` (feature-complete, testing phase)
- **RC**: `v0.3.0-rc.1` (release candidate, final testing)

### Current Release Strategy

**v0.x.x Series**: Pre-1.0 development
- MINOR bumps for quality improvements (v0.2.0 ‚Üí v0.3.0)
- PATCH bumps for hotfixes (v0.2.0 ‚Üí v0.2.1)
- Breaking changes allowed without MAJOR bump (pre-1.0 flexibility)

**v1.0.0 Milestone**: Stable API, production-ready
- Requires: Complete test coverage, E2E tests, performance benchmarks, comprehensive documentation

---

## Pre-Release Checklist

### 1. Code Quality Verification

Run complete test suite:
```bash
npm run test:unit              # All 223 unit tests must pass
npm run test:coverage:check    # 80/80/75% thresholds must pass
```

**Expected Output**:
```
‚úì 223 tests passing
‚úì Coverage: statements 80.5%, branches 82.3%, functions 85.2%, lines 80.8%
```

### 2. Build Verification

Test production build:
```bash
npm run build                  # Build to docs/ folder
npm run preview                # Test production build locally
```

**Expected Output**:
```
vite v7.1.12 building for production...
‚úì 1143.27 kB docs/assets/index-<hash>.js (stable size)
‚úì 3.7 kB docs/assets/index-<hash>.css
```

**Size Regression Check**:
- ‚úÖ Bundle size: ‚â§ 1,200 kB (warning threshold)
- ‚úÖ Bundle size: ‚â§ 1,300 kB (critical threshold)
- Current: 1,143.27 kB (stable for 40+ iterations)

### 3. Dependency Security Audit

Check for vulnerabilities:
```bash
npm run audit:deps             # npm outdated + npm audit
```

**Expected Output**:
```
‚úì 0 vulnerabilities found
‚úì All dependencies up-to-date
```

### 4. Documentation Synchronization

Verify all documentation files are current:
```bash
# Check iteration counts match across files
grep -n "iterations complete" TODO.md CHANGELOG.md PLAN.md WORK.md

# Verify test counts match
grep -n "223.*tests" README.md CHANGELOG.md package.json

# Check version references
grep -n "v0\.2\.0" README.md CHANGELOG.md package.json
```

**Files to Verify**:
- [ ] `README.md` - Version examples, test counts, badge
- [ ] `CHANGELOG.md` - Latest iteration documented
- [ ] `TODO.md` - Current status section accurate
- [ ] `PLAN.md` - Iteration count synchronized
- [ ] `WORK.md` - Current focus statement accurate
- [ ] `package.json` - Version, description, keywords

### 5. Git Status Clean

Ensure working tree is clean:
```bash
git status
# Expected: "nothing to commit, working tree clean"
```

If uncommitted changes exist:
```bash
git add .
git commit -m "Prepare for vX.Y.Z release"
```

---

## Release Process

### Step 1: Update Version in package.json

**Manual Edit**:
```json
{
  "name": "vexy-stax-js",
  "version": "0.3.0",  // ‚Üê Update this line
  "description": "...",
  ...
}
```

**Or use npm version** (recommended):
```bash
# For patch release (0.2.0 ‚Üí 0.2.1)
npm version patch --no-git-tag-version

# For minor release (0.2.0 ‚Üí 0.3.0)
npm version minor --no-git-tag-version

# For major release (0.2.0 ‚Üí 1.0.0)
npm version major --no-git-tag-version
```

**Note**: `--no-git-tag-version` prevents automatic commit/tag (we do this manually for better control).

### Step 2: Update CHANGELOG.md

Replace `[Unreleased]` with new version:

**Before**:
```markdown
## [Unreleased]

### Phase 4: Modularization & Quality
- ...
```

**After**:
```markdown
## [0.3.0] - 2025-11-15

### Phase 4: Modularization & Quality
- ...
```

Add summary of changes (see [Changelog Generation](#changelog-generation) section).

### Step 3: Commit Version Bump

Create dedicated commit for version change:
```bash
git add package.json CHANGELOG.md
git commit -m "Release v0.3.0

Version bump from v0.2.0 to v0.3.0

Changes:
- package.json: version field updated
- CHANGELOG.md: [Unreleased] ‚Üí [0.3.0] - 2025-11-15

See CHANGELOG.md for complete release notes."
```

### Step 4: Create Annotated Git Tag

Create release tag with notes:
```bash
git tag -a v0.3.0 -m "Release v0.3.0 - <One-line summary>

Highlights:
- <Key feature/improvement 1>
- <Key feature/improvement 2>
- <Key feature/improvement 3>

Full changelog: https://github.com/vexyart/vexy-stax-js/blob/main/CHANGELOG.md

Quality Metrics:
- Tests: 223/223 passing
- Coverage: 96%+ on core modules
- Build: 1,143 kB (stable)
- Documentation: <N> iterations complete

Breaking Changes: None
Upgrade Path: Drop-in replacement for v0.2.x"
```

**Example (from v0.2.0 release)**:
```bash
git tag -a v0.2.0 -m "Release v0.2.0 - Quality & Refinement

Highlights:
- +98 tests (89% increase to 208 total)
- 96%+ test coverage on core utilities
- 99.3% logging migration (19 module loggers)
- npm-ready package with proper entry points
- -119K documentation cleanup

Full changelog: https://github.com/vexyart/vexy-stax-js/blob/main/CHANGELOG.md

Quality Metrics:
- Tests: 208/208 passing
- Coverage: helpers.js 100%, core 96.41%, utils 97.22%
- Build: 1,143.27 kB (stable, -6 kB from v0.1.0)
- Documentation: 25 quality improvement iterations

Breaking Changes: None
Upgrade Path: Drop-in replacement for v0.1.0"
```

### Step 5: Push to GitHub

Push commits and tags:
```bash
git push origin main           # Push commits
git push origin v0.3.0         # Push specific tag

# Or push all tags at once:
git push origin main --tags    # Push commits + all tags
```

**‚ö†Ô∏è Important**: GitHub Pages deployment is triggered automatically by tag push (see [Deployment](#deployment) section).

### Step 6: Verify Deployment

Wait 2-5 minutes for GitHub Actions to complete:

1. Check Actions tab: https://github.com/vexyart/vexy-stax-js/actions
2. Verify "pages build and deployment" workflow succeeded
3. Test live site: https://vexyart.github.io/vexy-stax-js/
4. Verify version number in browser console:
   ```javascript
   console.log('Vexy Stax JS v0.3.0')
   ```

---

## Changelog Generation

### CHANGELOG.md Structure

Follow **Keep a Changelog** format:
- **Guiding Principles**: Changelogs are for humans, not machines
- **Format**: Markdown with hierarchical sections
- **Ordering**: Latest version at top

### Section Categories

Use these standard categories:

- **Added**: New features, enhancements
- **Changed**: Changes in existing functionality
- **Deprecated**: Soon-to-be removed features
- **Removed**: Removed features
- **Fixed**: Bug fixes
- **Security**: Security vulnerability fixes

### Example Entry (v0.2.0)

```markdown
## [0.2.0] - 2025-11-05

### Added
- RenderLoop module: 244 lines extracted (animation loop, FPS monitoring)
- +98 tests across 8 categories (validation, config, helpers, errors, etc.)
- Browser compatibility documentation (BROWSER_COMPATIBILITY.md, 227 lines)
- Performance guide (PERFORMANCE.md, 400+ lines)
- Comprehensive dependency documentation (DEPENDENCIES.md, all 8 packages)

### Changed
- README compressed from 888 ‚Üí 194 lines (-78%, now meets <200 line guideline)
- Console logging: 99.3% migrated to structured logger (19 module loggers)
- Main.js reduced from 3,455 ‚Üí 3,367 lines (-88 lines after RenderLoop extraction)

### Fixed
- LICENSE copyright notice added (was placeholder)
- package.json metadata: npm help command shows correct test count

### Removed
- 7 obsolete/duplicate documentation files (-119K total)
  - STATUS.md, REFACTOR_PLAN.md, QUICKSTART.md (-51K)
  - AGENTS.md, GEMINI.md, LLXPRT.md, QWEN.md (-68K)

### Security
- No vulnerabilities (npm audit: 0 vulnerabilities found)
```

### Changelog Tips

**DO**:
- ‚úÖ Write for users (focus on "why" and "what changed")
- ‚úÖ Group related changes under categories
- ‚úÖ Include version and date (`## [0.3.0] - 2025-11-15`)
- ‚úÖ Link to issues/PRs when relevant (`Fixed #123`)
- ‚úÖ Mention breaking changes prominently

**DON'T**:
- ‚ùå Include every commit message verbatim
- ‚ùå Use vague descriptions ("Improved performance")
- ‚ùå Skip version date
- ‚ùå Mix multiple releases in one entry

---

## Git Tag Management

### Listing Tags

View all existing tags:
```bash
git tag                        # List all tags
git tag -l "v0.2.*"            # List tags matching pattern
git show v0.2.0                # Show tag details + commit
```

### Deleting Tags

**Local tag deletion**:
```bash
git tag -d v0.3.0              # Delete local tag
```

**Remote tag deletion** (‚ö†Ô∏è use with caution):
```bash
git push origin :refs/tags/v0.3.0    # Delete remote tag
```

**Recreating a tag** (if mistake in tag message):
```bash
git tag -d v0.3.0                    # Delete local tag
git tag -a v0.3.0 -m "Corrected message"  # Recreate with new message
git push origin v0.3.0 --force       # Force push to remote (‚ö†Ô∏è destructive)
```

### Tag Best Practices

- **Always use annotated tags** (`-a` flag) for releases
- **Include release notes** in tag message
- **Test locally** before pushing tags (deployment is automatic)
- **Never delete tags** from remote unless absolutely necessary (breaks links)

---

## Deployment

### Automatic Deployment (GitHub Actions)

Deployment is **fully automated** via GitHub Actions workflow (`.github/workflows/deploy.yml`).

**Trigger**: Any git tag starting with `v` (e.g., `v0.3.0`, `v1.0.0-beta.1`)

**Workflow Steps**:
1. **Checkout code** at tag commit
2. **Setup Node.js** (version from `.nvmrc`)
3. **Update package.json** version from tag name
4. **Install dependencies** (`npm ci`)
5. **Run build** (`npm run build`)
6. **Deploy to GitHub Pages** (upload `docs/` folder)

**Monitoring Deployment**:
```bash
# View workflow status
open https://github.com/vexyart/vexy-stax-js/actions

# Check deployment logs
# Actions ‚Üí pages build and deployment ‚Üí View details
```

**Expected Duration**: 2-3 minutes from tag push to live deployment

### Manual Deployment (Emergency Override)

If GitHub Actions fails, deploy manually:

```bash
# 1. Build locally
npm run build

# 2. Commit build artifacts (usually ignored)
git add docs/
git commit -m "Manual deployment build"

# 3. Push to gh-pages branch (if using separate branch)
git subtree push --prefix docs origin gh-pages

# Or force push docs/ to GitHub (not recommended)
# (GitHub Pages should auto-deploy from main branch docs/ folder)
```

**Note**: Manual deployment is **rarely needed** - fix GitHub Actions workflow instead.

### Deployment Verification Checklist

After successful deployment:

- [ ] Visit https://vexyart.github.io/vexy-stax-js/
- [ ] Verify page loads without errors (check browser console)
- [ ] Test file loading (drag-and-drop an image)
- [ ] Test PNG export (Ctrl+E)
- [ ] Verify version number in browser console or help command
- [ ] Check bundle size in Network tab (should be ~1.1 MB JS)
- [ ] Test keyboard shortcuts (H for help)
- [ ] Verify no 404 errors for assets (check Network tab)

---

## Post-Release Tasks

### 1. Create GitHub Release

Navigate to GitHub Releases page and create new release:

**URL**: https://github.com/vexyart/vexy-stax-js/releases/new

**Form Fields**:
- **Tag**: `v0.3.0` (select from dropdown)
- **Release title**: `v0.3.0 - <One-line summary>`
- **Description**: Copy from CHANGELOG.md + add highlights
- **Attachments**: None (npm package not published yet)
- **Pre-release**: Check if alpha/beta/rc version
- **Set as latest release**: Check if stable release

**Example Release Notes** (v0.2.0):
```markdown
## Vexy Stax JS v0.2.0 - Quality & Refinement Release

This release focuses on code quality, testing, and developer experience through 25 systematic improvement iterations. No new features, but significant improvements to maintainability, reliability, and documentation.

### Highlights

- **+98 tests** (89% increase), 96%+ coverage on core utilities
- **99.3% logging migration** to structured logger (19 module loggers)
- **Complete dependency documentation**, npm package configuration
- **Cross-platform consistency** (.editorconfig + .gitattributes)
- **119K of obsolete/duplicate documentation removed**

### Quality Metrics

- Tests: 208/208 passing (+98 from v0.1.0)
- Coverage: helpers.js 100%, core 96.41%, utils 97.22%
- Build: 1,143.27 kB (stable, -6 kB from v0.1.0)
- Documentation: 9 essential files (was 16)

### Breaking Changes

**None** - This is a drop-in replacement for v0.1.0.

### Full Changelog

See [CHANGELOG.md](https://github.com/vexyart/vexy-stax-js/blob/main/CHANGELOG.md) for complete details.
```

### 2. Update README Badges

Verify badges reflect new version:
```markdown
[![Tests](https://img.shields.io/badge/tests-223%20passing-success)](tests/)
[![Demo](https://img.shields.io/badge/demo-live-success)](https://vexyart.github.io/vexy-stax-js/)
```

### 3. Announce Release (Optional)

Channels for release announcements:
- GitHub Discussions (if enabled)
- Project website blog
- Twitter/social media
- Email list (if applicable)

**Template Announcement**:
```
üöÄ Vexy Stax JS v0.3.0 is live!

New in this release:
- <Highlight 1>
- <Highlight 2>
- <Highlight 3>

Try it now: https://vexyart.github.io/vexy-stax-js/
Full changelog: https://github.com/vexyart/vexy-stax-js/releases/tag/v0.3.0
```

### 4. Monitor for Issues

Watch for bug reports after release:
- Check GitHub Issues: https://github.com/vexyart/vexy-stax-js/issues
- Monitor browser console errors in production
- Review user feedback (if any)

**Hotfix Criteria** (requires immediate patch release):
- Critical bug breaking core functionality
- Security vulnerability
- Data loss or corruption
- Build/deployment failure

### 5. Plan Next Release

Update TODO.md with next iteration focus:
```markdown
## Iteration 66: Post-Release Quality Improvements

### Priority Tasks
1. [ ] Address user-reported issues from v0.3.0
2. [ ] Add E2E tests with Playwright
3. [ ] Improve performance (target: 60fps with 20+ images)
```

---

## Rollback Procedures

### When to Rollback

**Immediate rollback required if**:
- Critical bug breaks core functionality (cannot load images, cannot export)
- Security vulnerability exposed in production
- Data corruption or loss reported by users
- Performance regression >50% slower than previous version

**Rollback NOT required for** (fix in next patch):
- Minor UI glitches
- Documentation errors
- Non-critical feature broken
- Performance regression <20%

### Rollback Process

#### Option 1: Revert to Previous Tag (Recommended)

1. **Identify last known good version**:
   ```bash
   git tag -l                  # List all tags
   # Assume v0.2.0 was stable, v0.3.0 has critical bug
   ```

2. **Create rollback tag pointing to previous version**:
   ```bash
   git tag -a v0.3.1 $(git rev-list -n 1 v0.2.0) -m "Rollback to v0.2.0 due to critical bug

   This release reverts to v0.2.0 codebase to address critical bug in v0.3.0.

   See issue #XXX for details.
   A proper fix will be released in v0.3.2."
   ```

3. **Push rollback tag** (triggers automatic deployment):
   ```bash
   git push origin v0.3.1
   ```

4. **Wait for deployment** (2-3 minutes)

5. **Verify rollback**:
   - Visit live site: https://vexyart.github.io/vexy-stax-js/
   - Confirm v0.2.0 behavior restored
   - Test critical functionality works

#### Option 2: Hotfix Release (If Quick Fix Available)

1. **Create hotfix branch** from last stable tag:
   ```bash
   git checkout -b hotfix/v0.3.1 v0.2.0
   ```

2. **Apply minimal fix** (cherry-pick or manual edit)

3. **Test thoroughly**:
   ```bash
   npm run test:unit
   npm run build
   npm run preview          # Manual testing
   ```

4. **Commit fix**:
   ```bash
   git commit -m "Hotfix: Fix critical bug in image loading"
   ```

5. **Bump version**:
   ```bash
   npm version patch --no-git-tag-version   # 0.3.0 ‚Üí 0.3.1
   ```

6. **Create tag and push**:
   ```bash
   git tag -a v0.3.1 -m "Hotfix v0.3.1 - Fix critical image loading bug"
   git push origin hotfix/v0.3.1
   git push origin v0.3.1
   ```

7. **Merge hotfix back to main**:
   ```bash
   git checkout main
   git merge hotfix/v0.3.1
   git push origin main
   ```

### Rollback Communication

**Announce rollback immediately**:
1. Create GitHub issue: "Critical bug in v0.3.0 - rolled back to v0.2.0"
2. Update GitHub Release page: Mark v0.3.0 as "Pre-release" (uncheck "Latest release")
3. Add warning banner to release notes: "‚ö†Ô∏è This release has been rolled back due to critical bug. Use v0.3.1 instead."

---

## Release Templates

### Commit Message Template

Use when committing version bump:
```
Release vX.Y.Z

Version bump from vA.B.C to vX.Y.Z

Changes:
- package.json: version field updated
- CHANGELOG.md: [Unreleased] ‚Üí [X.Y.Z] - YYYY-MM-DD

See CHANGELOG.md for complete release notes.
```

### Git Tag Message Template

Use when creating annotated tag:
```
Release vX.Y.Z - <One-line summary>

Highlights:
- <Key change 1>
- <Key change 2>
- <Key change 3>

Full changelog: https://github.com/vexyart/vexy-stax-js/blob/main/CHANGELOG.md

Quality Metrics:
- Tests: XXX/XXX passing
- Coverage: XX% on core modules
- Build: X,XXX kB
- Documentation: XX iterations complete

Breaking Changes: <None | See CHANGELOG.md>
Upgrade Path: <Drop-in replacement | Migration guide required>
```

### CHANGELOG.md Entry Template

Use when documenting changes:
```markdown
## [X.Y.Z] - YYYY-MM-DD

### Added
- New feature or enhancement

### Changed
- Modified behavior in existing feature

### Fixed
- Bug fix with brief description

### Removed
- Deprecated feature removal

### Security
- Security vulnerability fix (if applicable)

**Quality Metrics**:
- Tests: XXX/XXX passing (+XX from previous)
- Build: X,XXX kB (stable)
- Coverage: XX% on core modules

**Breaking Changes**: <None | See Migration Guide>
```

---

## Automation Opportunities

### Future Enhancements

**Potential automations to consider**:
1. **Changelog Generation from Git Commits**
   - Tool: `conventional-changelog` or `standard-version`
   - Requires: Conventional Commits format (`feat:`, `fix:`, etc.)

2. **Automated Version Bumping**
   - Tool: `semantic-release`
   - Triggers: Commit message analysis
   - Outputs: package.json update, CHANGELOG.md update, git tag creation

3. **Pre-Release Validation**
   - GitHub Action: Run tests + coverage before allowing tag push
   - Prevent bad releases from reaching production

4. **Release Notes Generation**
   - Tool: GitHub Actions workflow
   - Inputs: Git tag annotation
   - Outputs: Formatted GitHub Release page

**Current Status**: Manual process preferred for control and visibility (small team, infrequent releases)

---

## Resources

### Related Documentation
- [CONTRIBUTING.md](CONTRIBUTING.md) - Commit message standards
- [.cicd-workflow.md](.cicd-workflow.md) - GitHub Actions workflow details
- [CHANGELOG.md](CHANGELOG.md) - Historical release notes
- [package.json](package.json) - Current version and metadata

### External References
- **Semantic Versioning**: https://semver.org/
- **Keep a Changelog**: https://keepachangelog.com/
- **Conventional Commits**: https://www.conventionalcommits.org/
- **GitHub Releases Guide**: https://docs.github.com/en/repositories/releasing-projects-on-github

---

**Last Updated**: 2025-11-05
**Current Version**: v0.2.0
**Next Planned Release**: v0.3.0 (TBD - after Phase 5 module extractions)
