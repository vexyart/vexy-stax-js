# <!-- this_file: .keyboard-shortcuts-reference.md -->
# Keyboard Shortcuts Reference (Developer Documentation)

Complete technical reference for keyboard shortcuts implementation in Vexy Stax JS.

**Note**: As of v0.2.0, only 6 keyboard shortcuts are implemented. User-facing documentation is in `.ui-guide.md`.

---

## Implementation Location

All keyboard shortcuts are implemented in **main.js** in the `keydownHandler` function (lines 756-817).

```javascript
window.addEventListener('keydown', keydownHandler);
```

---

## Currently Implemented Shortcuts (6 total)

### 1. Show Help: `?` or `/`
**Implementation**: lines 759-763
```javascript
if (e.key === '?' || e.key === '/') {
    e.preventDefault();
    toggleHelp();
    return;
}
```

**Behavior**:
- Prevents default browser action (search in Firefox for `/`)
- Calls `toggleHelp()` to show/hide help overlay
- No modifier keys required

---

### 2. Close/Cancel: `Esc`
**Implementation**: lines 766-782
```javascript
if (e.key === 'Escape') {
    // Cancel animation first if one is playing
    if (cameraAnimator && cameraAnimator.isAnimating) {
        cameraAnimator.cancel();
        showToast('Animation cancelled', 'info');
        logCamera.info('Animation cancelled via ESC');
        return;
    }

    // Otherwise close help overlay
    if (helpOverlay && helpOverlay.style.display === 'block') {
        helpOverlay.style.display = 'none';
        logUI.info('Help closed');
    }
    return;
}
```

**Behavior**:
- **Priority 1**: If camera animation is playing, cancel it
- **Priority 2**: If help overlay is visible, close it
- No modifier keys required
- Shows toast notification when cancelling animation

---

### 3. Export PNG: `Ctrl+E` / `Cmd+E`
**Implementation**: lines 785-790
```javascript
if ((e.ctrlKey || e.metaKey) && e.key === 'e' && !e.shiftKey) {
    e.preventDefault();
    logUI.info('Keyboard shortcut: Export PNG (Ctrl/Cmd+E)');
    exportPNG(1);
    return;
}
```

**Behavior**:
- Exports PNG at 1x resolution (default scale)
- Prevents default browser action
- Cross-platform: `Ctrl` on Windows/Linux, `Cmd` on macOS
- Requires `!e.shiftKey` to differentiate from other shortcuts

---

### 4. Undo: `Ctrl+Z` / `Cmd+Z`
**Implementation**: lines 793-798
```javascript
if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
    e.preventDefault();
    logUI.info('Keyboard shortcut: Undo (Ctrl/Cmd+Z)');
    undo();
    return;
}
```

**Behavior**:
- Undoes last change from history stack (MAX_HISTORY = 10)
- Prevents default browser undo
- Requires `!e.shiftKey` to differentiate from Redo

---

### 5. Redo: `Ctrl+Shift+Z` / `Cmd+Shift+Z`
**Implementation**: lines 801-806
```javascript
if ((e.ctrlKey || e.metaKey) && e.key === 'z' && e.shiftKey) {
    e.preventDefault();
    logUI.info('Keyboard shortcut: Redo (Ctrl/Cmd+Shift+Z)');
    redo();
    return;
}
```

**Behavior**:
- Redoes last undone change
- Requires both modifier key AND Shift
- Prevents default browser redo

---

### 6. Clear All: `Ctrl+Delete` / `Cmd+Delete` or `Ctrl+Backspace` / `Cmd+Backspace`
**Implementation**: lines 809-817
```javascript
if ((e.ctrlKey || e.metaKey) && (e.key === 'Delete' || e.key === 'Backspace')) {
    e.preventDefault();
    if (imageStack.length > 0) {
        if (confirm('Clear all images? This cannot be undone.')) {
            logUI.info('Keyboard shortcut: Clear all (Ctrl/Cmd+Delete)');
            clearAll();
        }
    }
    return;
}
```

**Behavior**:
- Accepts both `Delete` and `Backspace` keys (cross-platform compatibility)
- Shows browser confirmation dialog
- Only executes if user confirms AND imageStack has images
- Calls `clearAll()` which clears history and resets state

---

## Event Registration

**Location**: main.js line 3448
```javascript
window.addEventListener('keydown', keydownHandler);
```

**Event Cleanup**: None currently implemented (event listener persists for app lifetime)

---

## Helper Functions Called by Shortcuts

### `toggleHelp()`
- Shows/hides help overlay
- Location: main.js lines 734-754

### `exportPNG(scale)`
- Exports current view as PNG
- Location: main.js lines 2103-2177
- Parameters: scale (1, 2, 4)

### `undo()`
- Restores previous state from history
- Location: main.js lines 2545-2574
- Uses `historyStack` and `historyIndex`

### `redo()`
- Restores next state from history
- Location: main.js lines 2577-2604

### `clearAll()`
- Removes all images and resets state
- Location: main.js lines 2432-2484
- Clears history after execution

---

## Testing Keyboard Shortcuts

**Manual Testing**:
1. Load the app in browser
2. Load sample images
3. Test each shortcut:
   - `?` → Help overlay should appear
   - `Esc` → Help should close
   - `Ctrl+E` → PNG download should trigger
   - `Ctrl+Z` → Last change should undo
   - `Ctrl+Shift+Z` → Undone change should redo
   - `Ctrl+Delete` → Confirmation dialog, then clear all

**Browser Compatibility**:
- ✅ Chrome/Edge: All shortcuts work
- ✅ Firefox: `?` and `/` work (search prevented)
- ✅ Safari: All shortcuts work
- ⚠️ macOS: Use `Cmd` instead of `Ctrl`

---

## Future Shortcuts (Planned but Not Implemented)

These shortcuts are documented in .ui-guide.md but NOT currently implemented:

### Viewpoint Presets (Number Keys)
- `1`-`7` for viewpoint presets (front, top, beauty, side, 3D stack, center, isometric)
- Would require implementing in keydownHandler with preset name mapping

### Z-Spacing Adjustment (Arrow Keys)
- `↑`/`↓` to increase/decrease Z-spacing
- Would conflict with scroll wheel behavior

### FOV Control (Bracket Keys)
- `[` / `]` to decrease/increase field of view
- Only applies in perspective camera mode

### Camera Mode Switching (Single Letters)
- `P` → Perspective
- `O` → Orthographic
- `I` → Isometric
- `T` → Telephoto

### Export Variants (E key variations)
- `E` → Export PNG 1x
- `Shift+E` → Export PNG 2x
- `Ctrl+E` → Export PNG 4x (currently implemented as 1x)

### Settings Shortcuts
- `S` → Show/hide settings panel
- `Shift+S` → Save settings
- `Shift+R` → Reset settings

---

## Implementation Notes

### Modifier Key Detection
```javascript
e.ctrlKey || e.metaKey  // Cross-platform: Ctrl (Windows/Linux) or Cmd (macOS)
e.shiftKey              // Shift key
e.altKey                // Alt/Option key (not currently used)
```

### Event Prevention
All shortcuts call `e.preventDefault()` to avoid browser default actions (e.g., Ctrl+S for save, Ctrl+Z for undo).

### Logging
All shortcuts use `logUI.info()` or `logCamera.info()` for debugging.

### Return Early Pattern
Each shortcut handler returns immediately after execution to prevent multiple shortcuts from triggering.

---

## Adding New Shortcuts

To add a new keyboard shortcut:

1. **Add to keydownHandler** (main.js lines 756-817)
   ```javascript
   if (e.key === 'n' && e.ctrlKey) {
       e.preventDefault();
       logUI.info('Keyboard shortcut: New action');
       yourFunction();
       return;
   }
   ```

2. **Update console help()** (main.js lines 1070-1103)
   ```javascript
   vexyStax.yourFunction() - Description
   ```

3. **Update .ui-guide.md** user documentation

4. **Update this file** (.keyboard-shortcuts-reference.md) with implementation details

5. **Add test** to verify shortcut works correctly

---

## Security Considerations

- All shortcuts are client-side only (no server interaction)
- Confirmation dialogs protect against accidental data loss (clearAll)
- No shortcuts execute sensitive operations without user confirmation
- preventDefault() prevents unintended browser actions

---

## Performance Impact

- Event listener is global (window-level)
- Negligible performance impact (single keydown handler)
- No keyboard polling or intervals
- Event handler completes in <1ms

---

## Related Files

- **main.js** (lines 756-817): keydownHandler implementation
- **.ui-guide.md**: User-facing keyboard shortcuts documentation
- **API.md**: Programmatic API reference (functions called by shortcuts)
- **tests/**: No keyboard shortcut tests currently (future enhancement)

---

**Last Updated**: 2025-11-05 (Iteration 85)
