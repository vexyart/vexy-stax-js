# <!-- this_file: .error-message-guide.md -->
# Error Message Style Guide

## Purpose

This guide documents error message standards for Vexy Stax JS to ensure consistency, clarity, and actionability across the codebase.

## Principles

1. **Be specific**: Include the exact value, parameter, or condition that failed
2. **Be actionable**: Suggest what the user should do to fix the problem
3. **Be consistent**: Follow naming and format conventions
4. **Include context**: Always prefix with function/class name

## Error Types

### TypeError
Use for type validation failures:
- Non-function where function expected
- Non-object where object expected
- Non-array where array expected
- Non-number where number expected
- Invalid types in general

### RangeError
Use for range/bounds violations:
- Index out of bounds
- Value outside acceptable range
- min > max violations

### Error
Use for general errors that don't fit TypeError/RangeError:
- Resource not found
- Operation failed
- State inconsistencies

## Message Format

### Format Template
```javascript
throw new TypeError(`{FunctionName}: {description of problem}, got {actual_value}`);
```

### Components
1. **Function/Class name prefix**: `FunctionName:` or `ClassName.methodName:`
2. **Problem description**: Clear statement of what's wrong
3. **Actual value**: Show what was received (when helpful)
4. **Expected value**: State what was expected (when applicable)

## Examples by Category

### Helper Functions

**calculateLuminance**:
```javascript
// ✅ Good
throw new TypeError(`calculateLuminance: expected valid hex color, got "${hexColor}"`);

// ❌ Bad
throw new Error('Invalid color');
```

**clamp**:
```javascript
// ✅ Good
throw new TypeError(`clamp: value must be a valid number, got ${typeof value}`);
throw new RangeError(`clamp: min must be <= max, got min=${min}, max=${max}`);

// ❌ Bad
throw new Error('Invalid range');
```

**lerp**:
```javascript
// ✅ Good
throw new TypeError(`lerp: a must be a valid number, got ${typeof a}`);
throw new TypeError(`lerp: b must be a valid number, got ${typeof b}`);

// ❌ Bad
throw new Error('lerp failed');
```

### Class Methods

**EventBus.on**:
```javascript
// ✅ Good
throw new TypeError('EventBus.on requires a function handler');

// ❌ Bad
throw new Error('Invalid handler');
```

**AppState.mergeInto**:
```javascript
// ✅ Good
throw new TypeError(`AppState.mergeInto expects a plain object patch, got ${typeof patch}`);
throw new TypeError(`AppState.mergeInto target "${key}" is not an object`);

// ❌ Bad
throw new Error('Merge failed');
```

**AppState.pushTo**:
```javascript
// ✅ Good
throw new TypeError(`AppState.pushTo target "${key}" is not an array`);

// ❌ Bad
throw new Error('Not an array');
```

**AppState.removeFrom**:
```javascript
// ✅ Good
throw new TypeError(`AppState.removeFrom target "${key}" is not an array`);
```

### Module Functions

**sharedState.storeSharedRef**:
```javascript
// ✅ Good
throw new Error(`Shared state key "${key}" is not registered in SHARED_STATE_KEYS`);

// ❌ Bad
throw new Error('Invalid key');
```

**ordering.reorderList**:
```javascript
// ✅ Good
throw new TypeError('reorderList expects an array to reorder');
throw new TypeError('reorderList indices must be integers');
throw new RangeError('reorderList indices must be within array bounds');

// ❌ Bad
throw new Error('Reorder failed');
```

### Manager Classes

**SceneManager.init**:
```javascript
// ✅ Good
throw new Error('[SceneManager] Canvas element not found');
throw new Error('[SceneManager] Missing params object');

// ❌ Bad
throw new Error('Init failed');
```

**LightingManager.setup**:
```javascript
// ✅ Good
throw new Error('[LightingManager] Missing scene object');
throw new Error('[LightingManager] Missing params object');
```

## Validation Examples

### Type Validation
```javascript
function validateType(value, name, expectedType) {
  if (typeof value !== expectedType) {
    throw new TypeError(
      `${functionName}: ${name} must be a ${expectedType}, got ${typeof value}`
    );
  }
}
```

### Range Validation
```javascript
function validateRange(value, name, min, max) {
  if (value < min || value > max) {
    throw new RangeError(
      `${functionName}: ${name} must be between ${min} and ${max}, got ${value}`
    );
  }
}
```

### Required Parameter
```javascript
function validateRequired(value, name) {
  if (value === null || value === undefined) {
    throw new TypeError(`${functionName}: ${name} is required`);
  }
}
```

## Testing Error Messages

All error messages should be tested:

```javascript
import { test } from 'node:test';
import { strictEqual, throws } from 'node:assert';

test('calculateLuminance throws TypeError for invalid hex', () => {
  throws(
    () => calculateLuminance('notahex'),
    {
      name: 'TypeError',
      message: /calculateLuminance: expected valid hex color/
    },
    'Should throw TypeError with function name prefix'
  );
});

test('clamp throws RangeError when min > max', () => {
  throws(
    () => clamp(5, 10, 1),
    {
      name: 'RangeError',
      message: /clamp: min must be <= max/
    },
    'Should throw RangeError with helpful message'
  );
});
```

## Current Status (Iteration 61)

**Total Error Throws**: 35 across codebase
- TypeError: 15 (type validation)
- Error: 18 (general errors)
- RangeError: 2 (bounds violations)

**Compliance**: 100% - All errors follow naming conventions (verified Iteration 6)

**Test Coverage**: 9 dedicated error message tests + 23 error recovery tests

## Best Practices

1. **Always include function/class name**: Helps with debugging and stack traces
2. **Show actual values**: Makes debugging easier (within reason - don't expose sensitive data)
3. **Be helpful**: Suggest valid values or point to documentation
4. **Test error messages**: Ensure they match expected patterns
5. **Update this guide**: When adding new error patterns, document them here

## Anti-Patterns

❌ **Generic errors without context**:
```javascript
throw new Error('Failed');
throw new Error('Invalid input');
```

❌ **Missing function/class name**:
```javascript
throw new TypeError('Expected object');
```

❌ **No actual value shown**:
```javascript
throw new TypeError(`Invalid type`);
```

❌ **Wrong error type**:
```javascript
throw new Error('Value out of range'); // Should be RangeError
throw new Error('Not a function'); // Should be TypeError
```

## References

- Iteration 6: Error message consistency validation (9 tests)
- Iteration 54: Error handling documentation review (35 errors verified)
- tests/error_message_consistency.test.js: Comprehensive error message tests

---

**Last Updated**: 2025-11-05 (Iteration 61)
**Next Review**: When adding new error types or patterns
