# <!-- this_file: .test-performance.md -->
# Test Performance Benchmarks

## Baseline Metrics (Iteration 60)

**Date**: 2025-11-05
**Node.js**: v24.10.0
**Test Runner**: Node.js built-in `node --test`
**Total Tests**: 223 tests across 10 suites
**Test Files**: 16 test files

### Overall Performance

| Metric | Value |
|--------|-------|
| **Mean Duration** | 627.0ms |
| **Std Deviation** | 3.2ms |
| **Min Duration** | 622.8ms |
| **Max Duration** | 631.1ms |
| **Coefficient of Variation** | 0.51% (highly stable) |

**5-Run Sample**:
- Run 1: 622.84ms
- Run 2: 631.13ms
- Run 3: 625.79ms
- Run 4: 625.84ms
- Run 5: 629.57ms

### Test Suite Performance (Descending by Duration)

| Suite | Duration | % of Total | Notes |
|-------|----------|------------|-------|
| Cross-Module Integration Tests | 81.2ms | 12.9% | Slowest suite - integration tests with async operations |
| LightingManager exports | 58.2ms | 9.3% | Scene manager instantiation overhead |
| RenderLoop | 24.2ms | 3.9% | 20 tests with lifecycle hooks |
| CameraAnimator | 8.3ms | 1.3% | 10 tests with mock objects |
| API Input Validation | 7.8ms | 1.2% | 10 tests with validation logic |
| Constants Immutability | 6.7ms | 1.1% | 17 freeze validation tests |
| SceneManager exports | 4.8ms | 0.8% | Scene manager class verification |
| FloorManager exports | 3.4ms | 0.5% | Floor manager class verification |
| Error Recovery - SceneManager | 5.3ms | 0.8% | 5 error handling tests |
| Error Recovery - LightingManager | 3.2ms | 0.5% | 5 error handling tests |

### Performance Characteristics

**Fastest Test Categories**:
- Individual function tests (helpers.js): <0.5ms per test
- Constant validation: <0.3ms per test
- Error message verification: <0.5ms per test

**Slowest Test Categories**:
- Integration tests with async operations: 5-80ms per test
- Tests requiring debounce delays: 100+ms per test (intentional setTimeout)
- Scene manager instantiation: 4-60ms (WebGL context creation overhead)

### Performance Regression Detection

**Thresholds for Investigation**:
- âš ï¸ **Warning**: Total duration >700ms (+11% from baseline)
- ðŸš¨ **Critical**: Total duration >800ms (+27% from baseline)
- âš ï¸ **Warning**: Any single suite >2x baseline
- ðŸš¨ **Critical**: Test failures or hangs

**Common Performance Issues**:
1. **Increased integration test time**: Check for async timeouts, network delays
2. **Scene manager overhead**: WebGL context creation, resource cleanup issues
3. **Debounce test delays**: Ensure setTimeout delays are minimal but sufficient
4. **Memory leaks**: Watch for cleanup failures causing GC pressure

### Best Practices for Test Performance

1. **Keep tests independent**: Avoid shared state that requires expensive setup/teardown
2. **Mock expensive operations**: Use mock objects for Three.js scenes, DOM operations
3. **Use minimal timeouts**: debounce tests use 50ms delay (100ms wait)
4. **Run tests in parallel**: Node.js test runner runs suites concurrently by default
5. **Avoid unnecessary imports**: Dynamic imports only where needed
6. **Cleanup properly**: Dispose WebGL contexts, clear event listeners

### Monitoring Commands

```bash
# Run tests with timing
npm run test:unit

# Run 5 times and check consistency
for i in 1 2 3 4 5; do npm run test:unit 2>&1 | tail -1; done

# Get per-suite breakdown (slowest first)
npm run test:unit 2>&1 | grep -E "^âœ” [A-Z]" | sed 's/âœ” //' | sort -t'(' -k2 -rn

# Check for performance regressions (compare to baseline)
npm run test:unit 2>&1 | tail -1 | awk '{if ($2 > 700) print "WARNING: Slow tests detected"}'
```

### Historical Performance Data

| Date | Tests | Duration | Notes |
|------|-------|----------|-------|
| 2025-11-05 | 223 | 627.0ms | Iteration 60 baseline established |
| 2025-11-05 | 218 | ~650ms | Iteration 30-59 (before integration tests) |
| 2025-11-05 | 208 | ~650ms | Iteration 20-29 |
| 2025-11-05 | 110 | ~500ms | Phase 3 baseline |

**Trend**: Test suite has grown from 110 to 223 tests (+103%) while execution time increased from 500ms to 627ms (+25%), indicating good test efficiency.

### Future Performance Improvements

1. **Parallelize integration tests**: Explore concurrent test execution
2. **Reduce debounce delays**: Optimize setTimeout durations in tests
3. **Mock WebGL contexts**: Reduce scene manager instantiation overhead
4. **Test categorization**: Separate fast unit tests from slow integration tests
5. **Performance CI checks**: Add automated regression detection to CI workflow

---

**Last Updated**: 2025-11-05 (Iteration 60)
**Next Review**: After significant test additions or performance changes
