# <!-- this_file: .onboarding-guide.md -->
# New Contributor Onboarding Guide

Welcome to **Vexy Stax JS**! This guide will help you get started contributing to the project.

---

## Quick Links

- **Live Demo**: https://vexyart.github.io/vexy-stax-js/
- **GitHub Repo**: https://github.com/vexyart/vexy-stax-js
- **Issues**: https://github.com/vexyart/vexy-stax-js/issues
- **API Documentation**: [API.md](API.md)
- **Contributing Guide**: [CONTRIBUTING.md](CONTRIBUTING.md)

---

## Prerequisites

### Required Software

- **Node.js**: â‰¥18.0.0 (we recommend using nvm)
- **npm**: â‰¥9.0.0 (included with Node.js)
- **Git**: Latest version

### Recommended Tools

- **VSCode** (with these extensions):
  - ESLint
  - Prettier
  - EditorConfig
- **Chrome/Firefox DevTools** (for WebGL debugging)

---

## First-Time Setup

### 1. Fork and Clone

```bash
# Fork the repo on GitHub, then:
git clone https://github.com/YOUR_USERNAME/vexy-stax-js.git
cd vexy-stax-js
```

### 2. Install Node.js Version

```bash
# Using nvm (recommended):
nvm install
nvm use

# Verify version:
node --version  # Should be â‰¥18.0.0
```

### 3. Install Dependencies

```bash
npm ci  # Use ci for reproducible builds
```

### 4. Verify Installation

```bash
# Run tests:
npm test

# Expected output:
# âœ“ 223 tests passing (~650ms)

# Start dev server:
npm run dev

# Open http://localhost:5173
```

---

## Project Structure

```
vexy-stax-js/
â”œâ”€â”€ src/                    # Source code
â”‚   â”œâ”€â”€ main.js            # Entry point (3,367 lines)
â”‚   â”œâ”€â”€ core/              # Core utilities (AppState, EventBus, RenderLoop, constants)
â”‚   â”œâ”€â”€ camera/            # Camera animation
â”‚   â”œâ”€â”€ managers/          # Scene/Lighting/Floor managers
â”‚   â”œâ”€â”€ utils/             # Helpers, logger
â”‚   â””â”€â”€ styles/            # Global CSS
â”œâ”€â”€ tests/                 # 16 test suites, 223 tests
â”œâ”€â”€ docs/                  # Production build output (GitHub Pages)
â”œâ”€â”€ .github/workflows/     # CI/CD pipelines
â”œâ”€â”€ .testing-guide.md      # Testing best practices
â”œâ”€â”€ .code-review-checklist.md  # PR review standards
â”œâ”€â”€ .troubleshooting.md    # Common issues and fixes
â””â”€â”€ CONTRIBUTING.md        # Detailed contribution guidelines
```

### Key Files to Know

- **src/main.js**: Entry point, orchestrates all modules
- **src/core/constants.js**: All configuration constants (36 exported)
- **src/core/AppState.js**: Reactive application state management
- **src/core/EventBus.js**: Pub/sub event system
- **src/managers/SceneManager.js**: Three.js scene setup and management
- **tests/*.test.js**: Unit tests using Node.js test runner

---

## Development Workflow

### 1. Create a Feature Branch

```bash
git checkout -b feature/your-feature-name
# Or for bug fixes:
git checkout -b fix/bug-description
```

### 2. Make Your Changes

- Edit code in `src/`
- Add tests in `tests/`
- Update documentation if needed

### 3. Run Tests Frequently

```bash
# Run all tests:
npm test

# Run unit tests only:
npm run test:unit

# Check coverage:
npm run test:coverage
```

### 4. Check Code Quality

```bash
# Verify tests pass:
npm run test:unit

# Check bundle size:
npm run build

# Security audit:
npm run audit:deps
```

### 5. Commit Your Changes

We use a structured commit message format:

```bash
git add .
git commit

# Your editor will open with template from .gitmessage
# Fill in:
# - Summary line (50 chars max)
# - Description
# - Tasks completed
# - Test results
# - Files changed
```

Example commit message:
```
Add floor color customization feature

Allow users to change floor color via UI controls.
Integrates with existing FloorManager.

Tasks:
- Added colorFloor parameter to AppState
- Updated Tweakpane UI with color picker
- Updated FloorManager.updateColor() method
- Added 3 unit tests for color validation

Test Results: 226/226 passing âœ…
Files Modified: 3 (main.js, FloorManager.js, floor.test.js)
Build Size: 1,145 kB (+1.73 kB)
```

### 6. Push and Create PR

```bash
git push origin feature/your-feature-name
```

Then create a Pull Request on GitHub with:
- Clear description of changes
- Link to related issue (if any)
- Screenshots/GIFs for UI changes
- Test results

---

## Testing Guidelines

### Writing Tests

All new code requires tests. See `.testing-guide.md` for detailed standards.

**Basic test structure:**
```javascript
// tests/example.test.js
import { describe, it } from 'node:test';
import assert from 'node:assert/strict';

describe('MyModule', () => {
  describe('myFunction()', () => {
    it('returns expected value for valid input', () => {
      const result = myFunction('valid');
      assert.strictEqual(result, 'expected');
    });

    it('throws TypeError for invalid input', () => {
      assert.throws(
        () => myFunction(null),
        { name: 'TypeError', message: /expected/ }
      );
    });
  });
});
```

### Coverage Requirements

- **Lines**: â‰¥80%
- **Functions**: â‰¥80%
- **Branches**: â‰¥75%

Check with:
```bash
npm run test:coverage:check
```

---

## Common Tasks

### Adding a New Feature

1. **Check existing code**: Search for similar functionality
2. **Write tests first**: Test-driven development (TDD)
3. **Implement feature**: Keep changes minimal
4. **Update docs**: README.md, API.md, JSDoc comments
5. **Test thoroughly**: Unit tests + manual testing in dev server
6. **Create PR**: Follow commit message format

### Fixing a Bug

1. **Reproduce bug**: Write a failing test case
2. **Fix the bug**: Minimal changes to fix root cause
3. **Verify fix**: Test passes, no regressions
4. **Document**: Add comment explaining the fix
5. **Create PR**: Reference issue number

### Adding Documentation

1. **Check existing docs**: Avoid duplication
2. **Write clearly**: Short sentences, code examples
3. **Use markdown**: Follow existing formatting
4. **Test examples**: Verify all code snippets work
5. **Create PR**: Documentation-only PRs welcome!

---

## Code Style

We use **EditorConfig** for consistent formatting:

- **Indentation**: 4 spaces (JavaScript)
- **Line endings**: LF (Unix-style)
- **Charset**: UTF-8
- **Trailing whitespace**: Removed

Your editor should auto-detect `.editorconfig`.

### Naming Conventions

- **Constants**: `UPPERCASE_SNAKE_CASE`
- **Functions**: `camelCase`
- **Classes**: `PascalCase`
- **Private vars**: `_prefixedCamelCase`

### File Headers

All source files must include:
```javascript
// SPDX-License-Identifier: Apache-2.0
// Copyright 2025 Adam Twardoch / VexyArt
// this_file: src/path/to/file.js
```

---

## Common Issues

### Tests Failing

**Issue**: `Cannot find module`
**Fix**: Use dynamic imports for ES modules:
```javascript
const { myFunction } = await import('../src/myModule.js');
```

**Issue**: Timeout errors
**Fix**: Use proper safety margins in async tests:
```javascript
// BAD: Flaky
await new Promise(resolve => setTimeout(resolve, 50));

// GOOD: Stable
await new Promise(resolve => setTimeout(resolve, 100));
```

### Build Issues

**Issue**: `Vite build failed`
**Fix**:
```bash
npm run clean
npm ci
npm run build
```

**Issue**: Bundle size too large (>1,300 kB)
**Fix**: Check what changed:
```bash
npm run audit:size
# Review added dependencies or large assets
```

### Git Issues

**Issue**: Push rejected
**Fix**: Rebase on latest main:
```bash
git fetch origin
git rebase origin/main
git push --force-with-lease
```

**Issue**: Merge conflicts
**Fix**: Resolve carefully:
```bash
git status  # See conflicted files
# Edit files to resolve conflicts
git add .
git rebase --continue
```

---

## Getting Help

### Resources

1. **Documentation** (check first):
   - [README.md](README.md) - Project overview
   - [CONTRIBUTING.md](CONTRIBUTING.md) - Detailed guidelines
   - [API.md](API.md) - Public API reference
   - [.testing-guide.md](.testing-guide.md) - Testing standards
   - [.troubleshooting.md](.troubleshooting.md) - Common issues

2. **Code Examples**:
   - Browse `tests/` for patterns
   - Check existing similar features

3. **Ask Questions**:
   - Open an issue with "Question:" prefix
   - Tag maintainers if urgent

### Community

- **GitHub Issues**: Bug reports, feature requests
- **Pull Requests**: Code contributions, documentation
- **Discussions**: General questions, ideas

---

## Next Steps

Now that you're set up:

1. **Browse issues**: Find "good first issue" labels
2. **Read code**: Explore `src/` to understand architecture
3. **Run tests**: See how existing code is tested
4. **Try the app**: Load images, test features
5. **Pick a task**: Start small, build confidence

**Welcome to the team!** ðŸŽ‰

We appreciate your contributions, whether it's:
- Fixing typos
- Writing tests
- Adding features
- Improving docs
- Reporting bugs

Every contribution makes this project better.

---

## Quick Reference

```bash
# Development
npm run dev          # Start dev server (localhost:5173)
npm run build        # Build for production (â†’ docs/)
npm run preview      # Preview production build

# Testing
npm test             # Run all tests (unit + E2E)
npm run test:unit    # Run unit tests (223 tests)
npm run test:coverage  # Generate coverage reports

# Quality
npm run clean        # Remove build artifacts
npm run audit:deps   # Check dependencies + security
npm run audit:size   # Analyze bundle size

# Documentation
npm run help         # Show all commands
```

---

**Ready to contribute?** Check out the [issues page](https://github.com/vexyart/vexy-stax-js/issues) and pick your first task!
