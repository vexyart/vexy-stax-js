(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const _0="181",qa={ROTATE:0,DOLLY:1,PAN:2},ja={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},VM=0,lg=1,UM=2,Ww=1,Kw=2,lr=3,Ji=0,$n=1,pi=2,ts=0,Ya=1,cg=2,hg=3,ug=4,BM=5,So=100,zM=101,$M=102,HM=103,GM=104,jM=200,WM=201,KM=202,XM=203,Ff=204,Vf=205,qM=206,YM=207,ZM=208,JM=209,QM=210,e2=211,t2=212,n2=213,i2=214,Uf=0,Bf=1,zf=2,dl=3,$f=4,Hf=5,Gf=6,jf=7,g0=0,r2=1,s2=2,Hs=0,o2=1,a2=2,l2=3,Xw=4,c2=5,h2=6,u2=7,qw=300,pl=301,fl=302,Wf=303,Kf=304,Ed=306,Xf=1e3,Yr=1001,qf=1002,xi=1003,d2=1004,Oh=1005,Oi=1006,ap=1007,Ao=1008,Cr=1009,Yw=1010,Zw=1011,Dc=1012,b0=1013,Bo=1014,fr=1015,Ll=1016,x0=1017,w0=1018,kc=1020,Jw=35902,Qw=35899,ey=1021,ty=1022,Yi=1023,Ic=1026,Oc=1027,y0=1028,E0=1029,C0=1030,S0=1031,M0=1033,_u=33776,gu=33777,bu=33778,xu=33779,Yf=35840,Zf=35841,Jf=35842,Qf=35843,em=36196,tm=37492,nm=37496,im=37808,rm=37809,sm=37810,om=37811,am=37812,lm=37813,cm=37814,hm=37815,um=37816,dm=37817,pm=37818,fm=37819,mm=37820,vm=37821,_m=36492,gm=36494,bm=36495,xm=36283,wm=36284,ym=36285,Em=36286,p2=3200,f2=3201,P0=0,m2=1,ks="",hi="srgb",ml="srgb-linear",zu="linear",mt="srgb",ma=7680,dg=519,v2=512,_2=513,g2=514,ny=515,b2=516,x2=517,w2=518,y2=519,pg=35044,fg="300 es",mr=2e3,$u=2001;function iy(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Nc(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function E2(){const n=Nc("canvas");return n.style.display="block",n}const mg={};function vg(...n){const e="THREE."+n.shift();console.log(e,...n)}function Ve(...n){const e="THREE."+n.shift();console.warn(e,...n)}function en(...n){const e="THREE."+n.shift();console.error(e,...n)}function Fc(...n){const e=n.join(" ");e in mg||(mg[e]=!0,Ve(...n))}function C2(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}class na{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const r=i[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Pn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],wu=Math.PI/180,Cm=180/Math.PI;function uh(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Pn[n&255]+Pn[n>>8&255]+Pn[n>>16&255]+Pn[n>>24&255]+"-"+Pn[e&255]+Pn[e>>8&255]+"-"+Pn[e>>16&15|64]+Pn[e>>24&255]+"-"+Pn[t&63|128]+Pn[t>>8&255]+"-"+Pn[t>>16&255]+Pn[t>>24&255]+Pn[i&255]+Pn[i>>8&255]+Pn[i>>16&255]+Pn[i>>24&255]).toLowerCase()}function Ye(n,e,t){return Math.max(e,Math.min(t,n))}function S2(n,e){return(n%e+e)%e}function lp(n,e,t){return(1-t)*n+t*e}function Wl(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Yn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const M2={DEG2RAD:wu};class Ne{constructor(e=0,t=0){Ne.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Ye(this.x,e.x,t.x),this.y=Ye(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Ye(this.x,e,t),this.y=Ye(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ye(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ye(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class zo{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],h=i[r+2],u=i[r+3],d=s[o+0],p=s[o+1],_=s[o+2],v=s[o+3];if(a<=0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u;return}if(a>=1){e[t+0]=d,e[t+1]=p,e[t+2]=_,e[t+3]=v;return}if(u!==v||l!==d||c!==p||h!==_){let m=l*d+c*p+h*_+u*v;m<0&&(d=-d,p=-p,_=-_,v=-v,m=-m);let f=1-a;if(m<.9995){const g=Math.acos(m),b=Math.sin(g);f=Math.sin(f*g)/b,a=Math.sin(a*g)/b,l=l*f+d*a,c=c*f+p*a,h=h*f+_*a,u=u*f+v*a}else{l=l*f+d*a,c=c*f+p*a,h=h*f+_*a,u=u*f+v*a;const g=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=g,c*=g,h*=g,u*=g}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],h=i[r+3],u=s[o],d=s[o+1],p=s[o+2],_=s[o+3];return e[t]=a*_+h*u+l*p-c*d,e[t+1]=l*_+h*d+c*u-a*p,e[t+2]=c*_+h*p+a*d-l*u,e[t+3]=h*_-a*u-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(r/2),u=a(s/2),d=l(i/2),p=l(r/2),_=l(s/2);switch(o){case"XYZ":this._x=d*h*u+c*p*_,this._y=c*p*u-d*h*_,this._z=c*h*_+d*p*u,this._w=c*h*u-d*p*_;break;case"YXZ":this._x=d*h*u+c*p*_,this._y=c*p*u-d*h*_,this._z=c*h*_-d*p*u,this._w=c*h*u+d*p*_;break;case"ZXY":this._x=d*h*u-c*p*_,this._y=c*p*u+d*h*_,this._z=c*h*_+d*p*u,this._w=c*h*u-d*p*_;break;case"ZYX":this._x=d*h*u-c*p*_,this._y=c*p*u+d*h*_,this._z=c*h*_-d*p*u,this._w=c*h*u+d*p*_;break;case"YZX":this._x=d*h*u+c*p*_,this._y=c*p*u+d*h*_,this._z=c*h*_-d*p*u,this._w=c*h*u-d*p*_;break;case"XZY":this._x=d*h*u-c*p*_,this._y=c*p*u-d*h*_,this._z=c*h*_+d*p*u,this._w=c*h*u+d*p*_;break;default:Ve("Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],u=t[10],d=i+a+u;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(h-l)*p,this._y=(s-c)*p,this._z=(o-r)*p}else if(i>a&&i>u){const p=2*Math.sqrt(1+i-a-u);this._w=(h-l)/p,this._x=.25*p,this._y=(r+o)/p,this._z=(s+c)/p}else if(a>u){const p=2*Math.sqrt(1+a-i-u);this._w=(s-c)/p,this._x=(r+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+u-i-a);this._w=(o-r)/p,this._x=(s+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ye(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+r*c-s*l,this._y=r*h+o*l+s*a-i*c,this._z=s*h+o*c+i*l-r*a,this._w=o*h-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let i=e._x,r=e._y,s=e._z,o=e._w,a=this.dot(e);a<0&&(i=-i,r=-r,s=-s,o=-o,a=-a);let l=1-t;if(a<.9995){const c=Math.acos(a),h=Math.sin(c);l=Math.sin(l*c)/h,t=Math.sin(t*c)/h,this._x=this._x*l+i*t,this._y=this._y*l+r*t,this._z=this._z*l+s*t,this._w=this._w*l+o*t,this._onChangeCallback()}else this._x=this._x*l+i*t,this._y=this._y*l+r*t,this._z=this._z*l+s*t,this._w=this._w*l+o*t,this.normalize();return this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class k{constructor(e=0,t=0,i=0){k.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_g.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_g.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*i),h=2*(a*t-s*r),u=2*(s*i-o*t);return this.x=t+l*c+o*u-a*h,this.y=i+l*h+a*c-s*u,this.z=r+l*u+s*h-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Ye(this.x,e.x,t.x),this.y=Ye(this.y,e.y,t.y),this.z=Ye(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Ye(this.x,e,t),this.y=Ye(this.y,e,t),this.z=Ye(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ye(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return cp.copy(this).projectOnVector(e),this.sub(cp)}reflect(e){return this.sub(cp.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ye(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const cp=new k,_g=new zo;class He{constructor(e,t,i,r,s,o,a,l,c){He.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c)}set(e,t,i,r,s,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=r,h[2]=a,h[3]=t,h[4]=s,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],u=i[7],d=i[2],p=i[5],_=i[8],v=r[0],m=r[3],f=r[6],g=r[1],b=r[4],y=r[7],M=r[2],S=r[5],P=r[8];return s[0]=o*v+a*g+l*M,s[3]=o*m+a*b+l*S,s[6]=o*f+a*y+l*P,s[1]=c*v+h*g+u*M,s[4]=c*m+h*b+u*S,s[7]=c*f+h*y+u*P,s[2]=d*v+p*g+_*M,s[5]=d*m+p*b+_*S,s[8]=d*f+p*y+_*P,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*s*h+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=h*o-a*c,d=a*l-h*s,p=c*s-o*l,_=t*u+i*d+r*p;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/_;return e[0]=u*v,e[1]=(r*c-h*i)*v,e[2]=(a*i-r*o)*v,e[3]=d*v,e[4]=(h*t-r*l)*v,e[5]=(r*s-a*t)*v,e[6]=p*v,e[7]=(i*l-c*t)*v,e[8]=(o*t-i*s)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(hp.makeScale(e,t)),this}rotate(e){return this.premultiply(hp.makeRotation(-e)),this}translate(e,t){return this.premultiply(hp.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const hp=new He,gg=new He().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),bg=new He().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function P2(){const n={enabled:!0,workingColorSpace:ml,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===mt&&(r.r=ns(r.r),r.g=ns(r.g),r.b=ns(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===mt&&(r.r=Za(r.r),r.g=Za(r.g),r.b=Za(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===ks?zu:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return Fc("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return Fc("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[ml]:{primaries:e,whitePoint:i,transfer:zu,toXYZ:gg,fromXYZ:bg,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:hi},outputColorSpaceConfig:{drawingBufferColorSpace:hi}},[hi]:{primaries:e,whitePoint:i,transfer:mt,toXYZ:gg,fromXYZ:bg,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:hi}}}),n}const at=P2();function ns(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Za(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let va;class T2{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{va===void 0&&(va=Nc("canvas")),va.width=e.width,va.height=e.height;const r=va.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=va}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Nc("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=ns(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(ns(t[i]/255)*255):t[i]=ns(t[i]);return{data:t,width:e.width,height:e.height}}else return Ve("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let A2=0;class T0{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:A2++}),this.uuid=uh(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(up(r[o].image)):s.push(up(r[o]))}else s=up(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function up(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?T2.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(Ve("Texture: Unable to serialize Texture."),{})}let R2=0;const dp=new k;class kn extends na{constructor(e=kn.DEFAULT_IMAGE,t=kn.DEFAULT_MAPPING,i=Yr,r=Yr,s=Oi,o=Ao,a=Yi,l=Cr,c=kn.DEFAULT_ANISOTROPY,h=ks){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:R2++}),this.uuid=uh(),this.name="",this.source=new T0(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Ne(0,0),this.repeat=new Ne(1,1),this.center=new Ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new He,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(dp).x}get height(){return this.source.getSize(dp).y}get depth(){return this.source.getSize(dp).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const i=e[t];if(i===void 0){Ve(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){Ve(`Texture.setValues(): property '${t}' does not exist.`);continue}r&&i&&r.isVector2&&i.isVector2||r&&i&&r.isVector3&&i.isVector3||r&&i&&r.isMatrix3&&i.isMatrix3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==qw)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Xf:e.x=e.x-Math.floor(e.x);break;case Yr:e.x=e.x<0?0:1;break;case qf:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Xf:e.y=e.y-Math.floor(e.y);break;case Yr:e.y=e.y<0?0:1;break;case qf:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}kn.DEFAULT_IMAGE=null;kn.DEFAULT_MAPPING=qw;kn.DEFAULT_ANISOTROPY=1;class bt{constructor(e=0,t=0,i=0,r=1){bt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],h=l[4],u=l[8],d=l[1],p=l[5],_=l[9],v=l[2],m=l[6],f=l[10];if(Math.abs(h-d)<.01&&Math.abs(u-v)<.01&&Math.abs(_-m)<.01){if(Math.abs(h+d)<.1&&Math.abs(u+v)<.1&&Math.abs(_+m)<.1&&Math.abs(c+p+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const b=(c+1)/2,y=(p+1)/2,M=(f+1)/2,S=(h+d)/4,P=(u+v)/4,A=(_+m)/4;return b>y&&b>M?b<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(b),r=S/i,s=P/i):y>M?y<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(y),i=S/r,s=A/r):M<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(M),i=P/s,r=A/s),this.set(i,r,s,t),this}let g=Math.sqrt((m-_)*(m-_)+(u-v)*(u-v)+(d-h)*(d-h));return Math.abs(g)<.001&&(g=1),this.x=(m-_)/g,this.y=(u-v)/g,this.z=(d-h)/g,this.w=Math.acos((c+p+f-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Ye(this.x,e.x,t.x),this.y=Ye(this.y,e.y,t.y),this.z=Ye(this.z,e.z,t.z),this.w=Ye(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Ye(this.x,e,t),this.y=Ye(this.y,e,t),this.z=Ye(this.z,e,t),this.w=Ye(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Ye(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class L2 extends na{constructor(e=1,t=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Oi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth,this.scissor=new bt(0,0,e,t),this.scissorTest=!1,this.viewport=new bt(0,0,e,t);const r={width:e,height:t,depth:i.depth},s=new kn(r);this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(e={}){const t={minFilter:Oi,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i,this.textures[r].isData3DTexture!==!0&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new T0(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class $o extends L2{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class ry extends kn{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=xi,this.minFilter=xi,this.wrapR=Yr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class D2 extends kn{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=xi,this.minFilter=xi,this.wrapR=Yr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Qn{constructor(e=new k(1/0,1/0,1/0),t=new k(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Wi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Wi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Wi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Wi):Wi.fromBufferAttribute(s,o),Wi.applyMatrix4(e.matrixWorld),this.expandByPoint(Wi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Nh.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Nh.copy(i.boundingBox)),Nh.applyMatrix4(e.matrixWorld),this.union(Nh)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Wi),Wi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Kl),Fh.subVectors(this.max,Kl),_a.subVectors(e.a,Kl),ga.subVectors(e.b,Kl),ba.subVectors(e.c,Kl),fs.subVectors(ga,_a),ms.subVectors(ba,ga),lo.subVectors(_a,ba);let t=[0,-fs.z,fs.y,0,-ms.z,ms.y,0,-lo.z,lo.y,fs.z,0,-fs.x,ms.z,0,-ms.x,lo.z,0,-lo.x,-fs.y,fs.x,0,-ms.y,ms.x,0,-lo.y,lo.x,0];return!pp(t,_a,ga,ba,Fh)||(t=[1,0,0,0,1,0,0,0,1],!pp(t,_a,ga,ba,Fh))?!1:(Vh.crossVectors(fs,ms),t=[Vh.x,Vh.y,Vh.z],pp(t,_a,ga,ba,Fh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Wi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Wi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Vr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Vr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Vr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Vr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Vr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Vr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Vr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Vr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Vr),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Vr=[new k,new k,new k,new k,new k,new k,new k,new k],Wi=new k,Nh=new Qn,_a=new k,ga=new k,ba=new k,fs=new k,ms=new k,lo=new k,Kl=new k,Fh=new k,Vh=new k,co=new k;function pp(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){co.fromArray(n,s);const a=r.x*Math.abs(co.x)+r.y*Math.abs(co.y)+r.z*Math.abs(co.z),l=e.dot(co),c=t.dot(co),h=i.dot(co);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const k2=new Qn,Xl=new k,fp=new k;class ia{constructor(e=new k,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):k2.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Xl.subVectors(e,this.center);const t=Xl.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Xl,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(fp.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Xl.copy(e.center).add(fp)),this.expandByPoint(Xl.copy(e.center).sub(fp))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Ur=new k,mp=new k,Uh=new k,vs=new k,vp=new k,Bh=new k,_p=new k;class sy{constructor(e=new k,t=new k(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ur)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ur.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ur.copy(this.origin).addScaledVector(this.direction,t),Ur.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){mp.copy(e).add(t).multiplyScalar(.5),Uh.copy(t).sub(e).normalize(),vs.copy(this.origin).sub(mp);const s=e.distanceTo(t)*.5,o=-this.direction.dot(Uh),a=vs.dot(this.direction),l=-vs.dot(Uh),c=vs.lengthSq(),h=Math.abs(1-o*o);let u,d,p,_;if(h>0)if(u=o*l-a,d=o*a-l,_=s*h,u>=0)if(d>=-_)if(d<=_){const v=1/h;u*=v,d*=v,p=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=s,u=Math.max(0,-(o*d+a)),p=-u*u+d*(d+2*l)+c;else d=-s,u=Math.max(0,-(o*d+a)),p=-u*u+d*(d+2*l)+c;else d<=-_?(u=Math.max(0,-(-o*s+a)),d=u>0?-s:Math.min(Math.max(-s,-l),s),p=-u*u+d*(d+2*l)+c):d<=_?(u=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+c):(u=Math.max(0,-(o*s+a)),d=u>0?s:Math.min(Math.max(-s,-l),s),p=-u*u+d*(d+2*l)+c);else d=o>0?-s:s,u=Math.max(0,-(o*d+a)),p=-u*u+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),r&&r.copy(mp).addScaledVector(Uh,d),p}intersectSphere(e,t){Ur.subVectors(e.center,this.origin);const i=Ur.dot(this.direction),r=Ur.dot(Ur)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(i=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(i=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),h>=0?(s=(e.min.y-d.y)*h,o=(e.max.y-d.y)*h):(s=(e.max.y-d.y)*h,o=(e.min.y-d.y)*h),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),u>=0?(a=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(a=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Ur)!==null}intersectTriangle(e,t,i,r,s){vp.subVectors(t,e),Bh.subVectors(i,e),_p.crossVectors(vp,Bh);let o=this.direction.dot(_p),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;vs.subVectors(this.origin,e);const l=a*this.direction.dot(Bh.crossVectors(vs,Bh));if(l<0)return null;const c=a*this.direction.dot(vp.cross(vs));if(c<0||l+c>o)return null;const h=-a*vs.dot(_p);return h<0?null:this.at(h/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class At{constructor(e,t,i,r,s,o,a,l,c,h,u,d,p,_,v,m){At.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c,h,u,d,p,_,v,m)}set(e,t,i,r,s,o,a,l,c,h,u,d,p,_,v,m){const f=this.elements;return f[0]=e,f[4]=t,f[8]=i,f[12]=r,f[1]=s,f[5]=o,f[9]=a,f[13]=l,f[2]=c,f[6]=h,f[10]=u,f[14]=d,f[3]=p,f[7]=_,f[11]=v,f[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new At().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/xa.setFromMatrixColumn(e,0).length(),s=1/xa.setFromMatrixColumn(e,1).length(),o=1/xa.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),h=Math.cos(s),u=Math.sin(s);if(e.order==="XYZ"){const d=o*h,p=o*u,_=a*h,v=a*u;t[0]=l*h,t[4]=-l*u,t[8]=c,t[1]=p+_*c,t[5]=d-v*c,t[9]=-a*l,t[2]=v-d*c,t[6]=_+p*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*h,p=l*u,_=c*h,v=c*u;t[0]=d+v*a,t[4]=_*a-p,t[8]=o*c,t[1]=o*u,t[5]=o*h,t[9]=-a,t[2]=p*a-_,t[6]=v+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*h,p=l*u,_=c*h,v=c*u;t[0]=d-v*a,t[4]=-o*u,t[8]=_+p*a,t[1]=p+_*a,t[5]=o*h,t[9]=v-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*h,p=o*u,_=a*h,v=a*u;t[0]=l*h,t[4]=_*c-p,t[8]=d*c+v,t[1]=l*u,t[5]=v*c+d,t[9]=p*c-_,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,p=o*c,_=a*l,v=a*c;t[0]=l*h,t[4]=v-d*u,t[8]=_*u+p,t[1]=u,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=p*u+_,t[10]=d-v*u}else if(e.order==="XZY"){const d=o*l,p=o*c,_=a*l,v=a*c;t[0]=l*h,t[4]=-u,t[8]=c*h,t[1]=d*u+v,t[5]=o*h,t[9]=p*u-_,t[2]=_*u-p,t[6]=a*h,t[10]=v*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(I2,e,O2)}lookAt(e,t,i){const r=this.elements;return li.subVectors(e,t),li.lengthSq()===0&&(li.z=1),li.normalize(),_s.crossVectors(i,li),_s.lengthSq()===0&&(Math.abs(i.z)===1?li.x+=1e-4:li.z+=1e-4,li.normalize(),_s.crossVectors(i,li)),_s.normalize(),zh.crossVectors(li,_s),r[0]=_s.x,r[4]=zh.x,r[8]=li.x,r[1]=_s.y,r[5]=zh.y,r[9]=li.y,r[2]=_s.z,r[6]=zh.z,r[10]=li.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],u=i[5],d=i[9],p=i[13],_=i[2],v=i[6],m=i[10],f=i[14],g=i[3],b=i[7],y=i[11],M=i[15],S=r[0],P=r[4],A=r[8],x=r[12],E=r[1],R=r[5],O=r[9],F=r[13],G=r[2],H=r[6],B=r[10],W=r[14],$=r[3],Q=r[7],ee=r[11],me=r[15];return s[0]=o*S+a*E+l*G+c*$,s[4]=o*P+a*R+l*H+c*Q,s[8]=o*A+a*O+l*B+c*ee,s[12]=o*x+a*F+l*W+c*me,s[1]=h*S+u*E+d*G+p*$,s[5]=h*P+u*R+d*H+p*Q,s[9]=h*A+u*O+d*B+p*ee,s[13]=h*x+u*F+d*W+p*me,s[2]=_*S+v*E+m*G+f*$,s[6]=_*P+v*R+m*H+f*Q,s[10]=_*A+v*O+m*B+f*ee,s[14]=_*x+v*F+m*W+f*me,s[3]=g*S+b*E+y*G+M*$,s[7]=g*P+b*R+y*H+M*Q,s[11]=g*A+b*O+y*B+M*ee,s[15]=g*x+b*F+y*W+M*me,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],u=e[6],d=e[10],p=e[14],_=e[3],v=e[7],m=e[11],f=e[15];return _*(+s*l*u-r*c*u-s*a*d+i*c*d+r*a*p-i*l*p)+v*(+t*l*p-t*c*d+s*o*d-r*o*p+r*c*h-s*l*h)+m*(+t*c*u-t*a*p-s*o*u+i*o*p+s*a*h-i*c*h)+f*(-r*a*h-t*l*u+t*a*d+r*o*u-i*o*d+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],_=e[12],v=e[13],m=e[14],f=e[15],g=u*m*c-v*d*c+v*l*p-a*m*p-u*l*f+a*d*f,b=_*d*c-h*m*c-_*l*p+o*m*p+h*l*f-o*d*f,y=h*v*c-_*u*c+_*a*p-o*v*p-h*a*f+o*u*f,M=_*u*l-h*v*l-_*a*d+o*v*d+h*a*m-o*u*m,S=t*g+i*b+r*y+s*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const P=1/S;return e[0]=g*P,e[1]=(v*d*s-u*m*s-v*r*p+i*m*p+u*r*f-i*d*f)*P,e[2]=(a*m*s-v*l*s+v*r*c-i*m*c-a*r*f+i*l*f)*P,e[3]=(u*l*s-a*d*s-u*r*c+i*d*c+a*r*p-i*l*p)*P,e[4]=b*P,e[5]=(h*m*s-_*d*s+_*r*p-t*m*p-h*r*f+t*d*f)*P,e[6]=(_*l*s-o*m*s-_*r*c+t*m*c+o*r*f-t*l*f)*P,e[7]=(o*d*s-h*l*s+h*r*c-t*d*c-o*r*p+t*l*p)*P,e[8]=y*P,e[9]=(_*u*s-h*v*s-_*i*p+t*v*p+h*i*f-t*u*f)*P,e[10]=(o*v*s-_*a*s+_*i*c-t*v*c-o*i*f+t*a*f)*P,e[11]=(h*a*s-o*u*s-h*i*c+t*u*c+o*i*p-t*a*p)*P,e[12]=M*P,e[13]=(h*v*r-_*u*r+_*i*d-t*v*d-h*i*m+t*u*m)*P,e[14]=(_*a*r-o*v*r-_*i*l+t*v*l+o*i*m-t*a*m)*P,e[15]=(o*u*r-h*a*r+h*i*l-t*u*l-o*i*d+t*a*d)*P,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,h=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,h*a+i,h*l-r*o,0,c*l-r*a,h*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,h=o+o,u=a+a,d=s*c,p=s*h,_=s*u,v=o*h,m=o*u,f=a*u,g=l*c,b=l*h,y=l*u,M=i.x,S=i.y,P=i.z;return r[0]=(1-(v+f))*M,r[1]=(p+y)*M,r[2]=(_-b)*M,r[3]=0,r[4]=(p-y)*S,r[5]=(1-(d+f))*S,r[6]=(m+g)*S,r[7]=0,r[8]=(_+b)*P,r[9]=(m-g)*P,r[10]=(1-(d+v))*P,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=xa.set(r[0],r[1],r[2]).length();const o=xa.set(r[4],r[5],r[6]).length(),a=xa.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Ki.copy(this);const c=1/s,h=1/o,u=1/a;return Ki.elements[0]*=c,Ki.elements[1]*=c,Ki.elements[2]*=c,Ki.elements[4]*=h,Ki.elements[5]*=h,Ki.elements[6]*=h,Ki.elements[8]*=u,Ki.elements[9]*=u,Ki.elements[10]*=u,t.setFromRotationMatrix(Ki),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=mr,l=!1){const c=this.elements,h=2*s/(t-e),u=2*s/(i-r),d=(t+e)/(t-e),p=(i+r)/(i-r);let _,v;if(l)_=s/(o-s),v=o*s/(o-s);else if(a===mr)_=-(o+s)/(o-s),v=-2*o*s/(o-s);else if(a===$u)_=-o/(o-s),v=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=h,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=p,c[13]=0,c[2]=0,c[6]=0,c[10]=_,c[14]=v,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=mr,l=!1){const c=this.elements,h=2/(t-e),u=2/(i-r),d=-(t+e)/(t-e),p=-(i+r)/(i-r);let _,v;if(l)_=1/(o-s),v=o/(o-s);else if(a===mr)_=-2/(o-s),v=-(o+s)/(o-s);else if(a===$u)_=-1/(o-s),v=-s/(o-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=h,c[4]=0,c[8]=0,c[12]=d,c[1]=0,c[5]=u,c[9]=0,c[13]=p,c[2]=0,c[6]=0,c[10]=_,c[14]=v,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const xa=new k,Ki=new At,I2=new k(0,0,0),O2=new k(1,1,1),_s=new k,zh=new k,li=new k,xg=new At,wg=new zo;class er{constructor(e=0,t=0,i=0,r=er.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],h=r[9],u=r[2],d=r[6],p=r[10];switch(t){case"XYZ":this._y=Math.asin(Ye(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ye(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ye(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Ye(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Ye(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Ye(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-h,p),this._y=0);break;default:Ve("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return xg.makeRotationFromQuaternion(e),this.setFromRotationMatrix(xg,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return wg.setFromEuler(this),this.setFromQuaternion(wg,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}er.DEFAULT_ORDER="XYZ";class oy{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let N2=0;const yg=new k,wa=new zo,Br=new At,$h=new k,ql=new k,F2=new k,V2=new zo,Eg=new k(1,0,0),Cg=new k(0,1,0),Sg=new k(0,0,1),Mg={type:"added"},U2={type:"removed"},ya={type:"childadded",child:null},gp={type:"childremoved",child:null};class xn extends na{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:N2++}),this.uuid=uh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=xn.DEFAULT_UP.clone();const e=new k,t=new er,i=new zo,r=new k(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new At},normalMatrix:{value:new He}}),this.matrix=new At,this.matrixWorld=new At,this.matrixAutoUpdate=xn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new oy,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return wa.setFromAxisAngle(e,t),this.quaternion.multiply(wa),this}rotateOnWorldAxis(e,t){return wa.setFromAxisAngle(e,t),this.quaternion.premultiply(wa),this}rotateX(e){return this.rotateOnAxis(Eg,e)}rotateY(e){return this.rotateOnAxis(Cg,e)}rotateZ(e){return this.rotateOnAxis(Sg,e)}translateOnAxis(e,t){return yg.copy(e).applyQuaternion(this.quaternion),this.position.add(yg.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Eg,e)}translateY(e){return this.translateOnAxis(Cg,e)}translateZ(e){return this.translateOnAxis(Sg,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Br.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?$h.copy(e):$h.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),ql.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Br.lookAt(ql,$h,this.up):Br.lookAt($h,ql,this.up),this.quaternion.setFromRotationMatrix(Br),r&&(Br.extractRotation(r.matrixWorld),wa.setFromRotationMatrix(Br),this.quaternion.premultiply(wa.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(en("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Mg),ya.child=e,this.dispatchEvent(ya),ya.child=null):en("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(U2),gp.child=e,this.dispatchEvent(gp),gp.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Br.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Br.multiply(e.parent.matrixWorld)),e.applyMatrix4(Br),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Mg),ya.child=e,this.dispatchEvent(ya),ya.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ql,e,F2),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ql,V2,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?a.boundingBox.toJSON():void 0,boundingSphere:a.boundingSphere?a.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(a=>({...a})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];s(e.shapes,u)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),u=o(e.shapes),d=o(e.skeletons),p=o(e.animations),_=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),u.length>0&&(i.shapes=u),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),_.length>0&&(i.nodes=_)}return i.object=r,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}xn.DEFAULT_UP=new k(0,1,0);xn.DEFAULT_MATRIX_AUTO_UPDATE=!0;xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Xi=new k,zr=new k,bp=new k,$r=new k,Ea=new k,Ca=new k,Pg=new k,xp=new k,wp=new k,yp=new k,Ep=new bt,Cp=new bt,Sp=new bt;class qi{constructor(e=new k,t=new k,i=new k){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Xi.subVectors(e,t),r.cross(Xi);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Xi.subVectors(r,t),zr.subVectors(i,t),bp.subVectors(e,t);const o=Xi.dot(Xi),a=Xi.dot(zr),l=Xi.dot(bp),c=zr.dot(zr),h=zr.dot(bp),u=o*c-a*a;if(u===0)return s.set(0,0,0),null;const d=1/u,p=(c*l-a*h)*d,_=(o*h-a*l)*d;return s.set(1-p-_,_,p)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,$r)===null?!1:$r.x>=0&&$r.y>=0&&$r.x+$r.y<=1}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,$r)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,$r.x),l.addScaledVector(o,$r.y),l.addScaledVector(a,$r.z),l)}static getInterpolatedAttribute(e,t,i,r,s,o){return Ep.setScalar(0),Cp.setScalar(0),Sp.setScalar(0),Ep.fromBufferAttribute(e,t),Cp.fromBufferAttribute(e,i),Sp.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(Ep,s.x),o.addScaledVector(Cp,s.y),o.addScaledVector(Sp,s.z),o}static isFrontFacing(e,t,i,r){return Xi.subVectors(i,t),zr.subVectors(e,t),Xi.cross(zr).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Xi.subVectors(this.c,this.b),zr.subVectors(this.a,this.b),Xi.cross(zr).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return qi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return qi.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return qi.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return qi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return qi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;Ea.subVectors(r,i),Ca.subVectors(s,i),xp.subVectors(e,i);const l=Ea.dot(xp),c=Ca.dot(xp);if(l<=0&&c<=0)return t.copy(i);wp.subVectors(e,r);const h=Ea.dot(wp),u=Ca.dot(wp);if(h>=0&&u<=h)return t.copy(r);const d=l*u-h*c;if(d<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(Ea,o);yp.subVectors(e,s);const p=Ea.dot(yp),_=Ca.dot(yp);if(_>=0&&p<=_)return t.copy(s);const v=p*c-l*_;if(v<=0&&c>=0&&_<=0)return a=c/(c-_),t.copy(i).addScaledVector(Ca,a);const m=h*_-p*u;if(m<=0&&u-h>=0&&p-_>=0)return Pg.subVectors(s,r),a=(u-h)/(u-h+(p-_)),t.copy(r).addScaledVector(Pg,a);const f=1/(m+v+d);return o=v*f,a=d*f,t.copy(i).addScaledVector(Ea,o).addScaledVector(Ca,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const ay={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gs={h:0,s:0,l:0},Hh={h:0,s:0,l:0};function Mp(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class $e{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=hi){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,at.colorSpaceToWorking(this,t),this}setRGB(e,t,i,r=at.workingColorSpace){return this.r=e,this.g=t,this.b=i,at.colorSpaceToWorking(this,r),this}setHSL(e,t,i,r=at.workingColorSpace){if(e=S2(e,1),t=Ye(t,0,1),i=Ye(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=Mp(o,s,e+1/3),this.g=Mp(o,s,e),this.b=Mp(o,s,e-1/3)}return at.colorSpaceToWorking(this,r),this}setStyle(e,t=hi){function i(s){s!==void 0&&parseFloat(s)<1&&Ve("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:Ve("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);Ve("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=hi){const i=ay[e.toLowerCase()];return i!==void 0?this.setHex(i,t):Ve("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ns(e.r),this.g=ns(e.g),this.b=ns(e.b),this}copyLinearToSRGB(e){return this.r=Za(e.r),this.g=Za(e.g),this.b=Za(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=hi){return at.workingToColorSpace(Tn.copy(this),e),Math.round(Ye(Tn.r*255,0,255))*65536+Math.round(Ye(Tn.g*255,0,255))*256+Math.round(Ye(Tn.b*255,0,255))}getHexString(e=hi){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=at.workingColorSpace){at.workingToColorSpace(Tn.copy(this),t);const i=Tn.r,r=Tn.g,s=Tn.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case i:l=(r-s)/u+(r<s?6:0);break;case r:l=(s-i)/u+2;break;case s:l=(i-r)/u+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=at.workingColorSpace){return at.workingToColorSpace(Tn.copy(this),t),e.r=Tn.r,e.g=Tn.g,e.b=Tn.b,e}getStyle(e=hi){at.workingToColorSpace(Tn.copy(this),e);const t=Tn.r,i=Tn.g,r=Tn.b;return e!==hi?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(gs),this.setHSL(gs.h+e,gs.s+t,gs.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(gs),e.getHSL(Hh);const i=lp(gs.h,Hh.h,t),r=lp(gs.s,Hh.s,t),s=lp(gs.l,Hh.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Tn=new $e;$e.NAMES=ay;let B2=0;class Dl extends na{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:B2++}),this.uuid=uh(),this.name="",this.type="Material",this.blending=Ya,this.side=Ji,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ff,this.blendDst=Vf,this.blendEquation=So,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new $e(0,0,0),this.blendAlpha=0,this.depthFunc=dl,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=dg,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ma,this.stencilZFail=ma,this.stencilZPass=ma,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){Ve(`Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){Ve(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Ya&&(i.blending=this.blending),this.side!==Ji&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Ff&&(i.blendSrc=this.blendSrc),this.blendDst!==Vf&&(i.blendDst=this.blendDst),this.blendEquation!==So&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==dl&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==dg&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ma&&(i.stencilFail=this.stencilFail),this.stencilZFail!==ma&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==ma&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class kl extends Dl{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new er,this.combine=g0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const rn=new k,Gh=new Ne;let z2=0;class Qi{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:z2++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=pg,this.updateRanges=[],this.gpuType=fr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Gh.fromBufferAttribute(this,t),Gh.applyMatrix3(e),this.setXY(t,Gh.x,Gh.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)rn.fromBufferAttribute(this,t),rn.applyMatrix3(e),this.setXYZ(t,rn.x,rn.y,rn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)rn.fromBufferAttribute(this,t),rn.applyMatrix4(e),this.setXYZ(t,rn.x,rn.y,rn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)rn.fromBufferAttribute(this,t),rn.applyNormalMatrix(e),this.setXYZ(t,rn.x,rn.y,rn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)rn.fromBufferAttribute(this,t),rn.transformDirection(e),this.setXYZ(t,rn.x,rn.y,rn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Wl(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Yn(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Wl(t,this.array)),t}setX(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Wl(t,this.array)),t}setY(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Wl(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Wl(t,this.array)),t}setW(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array),r=Yn(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array),r=Yn(r,this.array),s=Yn(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==pg&&(e.usage=this.usage),e}}class ly extends Qi{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class cy extends Qi{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Io extends Qi{constructor(e,t,i){super(new Float32Array(e),t,i)}}let $2=0;const Ai=new At,Pp=new xn,Sa=new k,ci=new Qn,Yl=new Qn,vn=new k;class to extends na{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:$2++}),this.uuid=uh(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(iy(e)?cy:ly)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new He().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ai.makeRotationFromQuaternion(e),this.applyMatrix4(Ai),this}rotateX(e){return Ai.makeRotationX(e),this.applyMatrix4(Ai),this}rotateY(e){return Ai.makeRotationY(e),this.applyMatrix4(Ai),this}rotateZ(e){return Ai.makeRotationZ(e),this.applyMatrix4(Ai),this}translate(e,t,i){return Ai.makeTranslation(e,t,i),this.applyMatrix4(Ai),this}scale(e,t,i){return Ai.makeScale(e,t,i),this.applyMatrix4(Ai),this}lookAt(e){return Pp.lookAt(e),Pp.updateMatrix(),this.applyMatrix4(Pp.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Sa).negate(),this.translate(Sa.x,Sa.y,Sa.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Io(i,3))}else{const i=Math.min(e.length,t.count);for(let r=0;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&Ve("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Qn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){en("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new k(-1/0,-1/0,-1/0),new k(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];ci.setFromBufferAttribute(s),this.morphTargetsRelative?(vn.addVectors(this.boundingBox.min,ci.min),this.boundingBox.expandByPoint(vn),vn.addVectors(this.boundingBox.max,ci.max),this.boundingBox.expandByPoint(vn)):(this.boundingBox.expandByPoint(ci.min),this.boundingBox.expandByPoint(ci.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&en('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ia);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){en("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new k,1/0);return}if(e){const i=this.boundingSphere.center;if(ci.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Yl.setFromBufferAttribute(a),this.morphTargetsRelative?(vn.addVectors(ci.min,Yl.min),ci.expandByPoint(vn),vn.addVectors(ci.max,Yl.max),ci.expandByPoint(vn)):(ci.expandByPoint(Yl.min),ci.expandByPoint(Yl.max))}ci.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)vn.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(vn));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)vn.fromBufferAttribute(a,c),l&&(Sa.fromBufferAttribute(e,c),vn.add(Sa)),r=Math.max(r,i.distanceToSquared(vn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&en('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){en("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Qi(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let A=0;A<i.count;A++)a[A]=new k,l[A]=new k;const c=new k,h=new k,u=new k,d=new Ne,p=new Ne,_=new Ne,v=new k,m=new k;function f(A,x,E){c.fromBufferAttribute(i,A),h.fromBufferAttribute(i,x),u.fromBufferAttribute(i,E),d.fromBufferAttribute(s,A),p.fromBufferAttribute(s,x),_.fromBufferAttribute(s,E),h.sub(c),u.sub(c),p.sub(d),_.sub(d);const R=1/(p.x*_.y-_.x*p.y);isFinite(R)&&(v.copy(h).multiplyScalar(_.y).addScaledVector(u,-p.y).multiplyScalar(R),m.copy(u).multiplyScalar(p.x).addScaledVector(h,-_.x).multiplyScalar(R),a[A].add(v),a[x].add(v),a[E].add(v),l[A].add(m),l[x].add(m),l[E].add(m))}let g=this.groups;g.length===0&&(g=[{start:0,count:e.count}]);for(let A=0,x=g.length;A<x;++A){const E=g[A],R=E.start,O=E.count;for(let F=R,G=R+O;F<G;F+=3)f(e.getX(F+0),e.getX(F+1),e.getX(F+2))}const b=new k,y=new k,M=new k,S=new k;function P(A){M.fromBufferAttribute(r,A),S.copy(M);const x=a[A];b.copy(x),b.sub(M.multiplyScalar(M.dot(x))).normalize(),y.crossVectors(S,x);const R=y.dot(l[A])<0?-1:1;o.setXYZW(A,b.x,b.y,b.z,R)}for(let A=0,x=g.length;A<x;++A){const E=g[A],R=E.start,O=E.count;for(let F=R,G=R+O;F<G;F+=3)P(e.getX(F+0)),P(e.getX(F+1)),P(e.getX(F+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Qi(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const r=new k,s=new k,o=new k,a=new k,l=new k,c=new k,h=new k,u=new k;if(e)for(let d=0,p=e.count;d<p;d+=3){const _=e.getX(d+0),v=e.getX(d+1),m=e.getX(d+2);r.fromBufferAttribute(t,_),s.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),h.subVectors(o,s),u.subVectors(r,s),h.cross(u),a.fromBufferAttribute(i,_),l.fromBufferAttribute(i,v),c.fromBufferAttribute(i,m),a.add(h),l.add(h),c.add(h),i.setXYZ(_,a.x,a.y,a.z),i.setXYZ(v,l.x,l.y,l.z),i.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,p=t.count;d<p;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),h.subVectors(o,s),u.subVectors(r,s),h.cross(u),i.setXYZ(d+0,h.x,h.y,h.z),i.setXYZ(d+1,h.x,h.y,h.z),i.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)vn.fromBufferAttribute(e,t),vn.normalize(),e.setXYZ(t,vn.x,vn.y,vn.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,u=a.normalized,d=new c.constructor(l.length*h);let p=0,_=0;for(let v=0,m=l.length;v<m;v++){a.isInterleavedBufferAttribute?p=l[v]*a.data.stride+a.offset:p=l[v]*h;for(let f=0;f<h;f++)d[_++]=c[p++]}return new Qi(d,h,u)}if(this.index===null)return Ve("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new to,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let h=0,u=c.length;h<u;h++){const d=c[h],p=e(d,i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,d=c.length;u<d;u++){const p=c[u];h.push(p.toJSON(e.data))}h.length>0&&(r[l]=h,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere=a.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const r=e.attributes;for(const c in r){const h=r[c];this.setAttribute(c,h.clone(t))}const s=e.morphAttributes;for(const c in s){const h=[],u=s[c];for(let d=0,p=u.length;d<p;d++)h.push(u[d].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Tg=new At,ho=new sy,jh=new ia,Ag=new k,Wh=new k,Kh=new k,Xh=new k,Tp=new k,qh=new k,Rg=new k,Yh=new k;class jt extends xn{constructor(e=new to,t=new kl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){qh.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const h=a[l],u=s[l];h!==0&&(Tp.fromBufferAttribute(u,e),o?qh.addScaledVector(Tp,h):qh.addScaledVector(Tp.sub(t),h))}t.add(qh)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),jh.copy(i.boundingSphere),jh.applyMatrix4(s),ho.copy(e.ray).recast(e.near),!(jh.containsPoint(ho.origin)===!1&&(ho.intersectSphere(jh,Ag)===null||ho.origin.distanceToSquared(Ag)>(e.far-e.near)**2))&&(Tg.copy(s).invert(),ho.copy(e.ray).applyMatrix4(Tg),!(i.boundingBox!==null&&ho.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,ho)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,u=s.attributes.normal,d=s.groups,p=s.drawRange;if(a!==null)if(Array.isArray(o))for(let _=0,v=d.length;_<v;_++){const m=d[_],f=o[m.materialIndex],g=Math.max(m.start,p.start),b=Math.min(a.count,Math.min(m.start+m.count,p.start+p.count));for(let y=g,M=b;y<M;y+=3){const S=a.getX(y),P=a.getX(y+1),A=a.getX(y+2);r=Zh(this,f,e,i,c,h,u,S,P,A),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=m.materialIndex,t.push(r))}}else{const _=Math.max(0,p.start),v=Math.min(a.count,p.start+p.count);for(let m=_,f=v;m<f;m+=3){const g=a.getX(m),b=a.getX(m+1),y=a.getX(m+2);r=Zh(this,o,e,i,c,h,u,g,b,y),r&&(r.faceIndex=Math.floor(m/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let _=0,v=d.length;_<v;_++){const m=d[_],f=o[m.materialIndex],g=Math.max(m.start,p.start),b=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));for(let y=g,M=b;y<M;y+=3){const S=y,P=y+1,A=y+2;r=Zh(this,f,e,i,c,h,u,S,P,A),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=m.materialIndex,t.push(r))}}else{const _=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let m=_,f=v;m<f;m+=3){const g=m,b=m+1,y=m+2;r=Zh(this,o,e,i,c,h,u,g,b,y),r&&(r.faceIndex=Math.floor(m/3),t.push(r))}}}}function H2(n,e,t,i,r,s,o,a){let l;if(e.side===$n?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===Ji,a),l===null)return null;Yh.copy(a),Yh.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Yh);return c<t.near||c>t.far?null:{distance:c,point:Yh.clone(),object:n}}function Zh(n,e,t,i,r,s,o,a,l,c){n.getVertexPosition(a,Wh),n.getVertexPosition(l,Kh),n.getVertexPosition(c,Xh);const h=H2(n,e,t,i,Wh,Kh,Xh,Rg);if(h){const u=new k;qi.getBarycoord(Rg,Wh,Kh,Xh,u),r&&(h.uv=qi.getInterpolatedAttribute(r,a,l,c,u,new Ne)),s&&(h.uv1=qi.getInterpolatedAttribute(s,a,l,c,u,new Ne)),o&&(h.normal=qi.getInterpolatedAttribute(o,a,l,c,u,new k),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new k,materialIndex:0};qi.getNormal(Wh,Kh,Xh,d.normal),h.face=d,h.barycoord=u}return h}class no extends to{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],h=[],u=[];let d=0,p=0;_("z","y","x",-1,-1,i,t,e,o,s,0),_("z","y","x",1,-1,i,t,-e,o,s,1),_("x","z","y",1,1,e,i,t,r,o,2),_("x","z","y",1,-1,e,i,-t,r,o,3),_("x","y","z",1,-1,e,t,i,r,s,4),_("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new Io(c,3)),this.setAttribute("normal",new Io(h,3)),this.setAttribute("uv",new Io(u,2));function _(v,m,f,g,b,y,M,S,P,A,x){const E=y/P,R=M/A,O=y/2,F=M/2,G=S/2,H=P+1,B=A+1;let W=0,$=0;const Q=new k;for(let ee=0;ee<B;ee++){const me=ee*R-F;for(let De=0;De<H;De++){const Je=De*E-O;Q[v]=Je*g,Q[m]=me*b,Q[f]=G,c.push(Q.x,Q.y,Q.z),Q[v]=0,Q[m]=0,Q[f]=S>0?1:-1,h.push(Q.x,Q.y,Q.z),u.push(De/P),u.push(1-ee/A),W+=1}}for(let ee=0;ee<A;ee++)for(let me=0;me<P;me++){const De=d+me+H*ee,Je=d+me+H*(ee+1),Be=d+(me+1)+H*(ee+1),ze=d+(me+1)+H*ee;l.push(De,Je,ze),l.push(Je,Be,ze),$+=6}a.addGroup(p,$,x),p+=$,d+=W}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new no(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function vl(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(Ve("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function Un(n){const e={};for(let t=0;t<n.length;t++){const i=vl(n[t]);for(const r in i)e[r]=i[r]}return e}function G2(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function hy(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:at.workingColorSpace}const j2={clone:vl,merge:Un};var W2=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,K2=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ss extends Dl{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=W2,this.fragmentShader=K2,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=vl(e.uniforms),this.uniformsGroups=G2(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class uy extends xn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new At,this.projectionMatrix=new At,this.projectionMatrixInverse=new At,this.coordinateSystem=mr,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const bs=new k,Lg=new Ne,Dg=new Ne;class di extends uy{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Cm*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(wu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Cm*2*Math.atan(Math.tan(wu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){bs.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(bs.x,bs.y).multiplyScalar(-e/bs.z),bs.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(bs.x,bs.y).multiplyScalar(-e/bs.z)}getViewSize(e,t){return this.getViewBounds(e,Lg,Dg),t.subVectors(Dg,Lg)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(wu*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ma=-90,Pa=1;class X2 extends xn{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new di(Ma,Pa,e,t);r.layers=this.layers,this.add(r);const s=new di(Ma,Pa,e,t);s.layers=this.layers,this.add(s);const o=new di(Ma,Pa,e,t);o.layers=this.layers,this.add(o);const a=new di(Ma,Pa,e,t);a.layers=this.layers,this.add(a);const l=new di(Ma,Pa,e,t);l.layers=this.layers,this.add(l);const c=new di(Ma,Pa,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===mr)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===$u)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,h]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),_=e.xr.enabled;e.xr.enabled=!1;const v=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,o),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,c),i.texture.generateMipmaps=v,e.setRenderTarget(i,5,r),e.render(t,h),e.setRenderTarget(u,d,p),e.xr.enabled=_,i.texture.needsPMREMUpdate=!0}}class dy extends kn{constructor(e=[],t=pl,i,r,s,o,a,l,c,h){super(e,t,i,r,s,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class q2 extends $o{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new dy(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new no(5,5,5),s=new ss({name:"CubemapFromEquirect",uniforms:vl(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:$n,blending:ts});s.uniforms.tEquirect.value=t;const o=new jt(r,s),a=t.minFilter;return t.minFilter===Ao&&(t.minFilter=Oi),new X2(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,i=!0,r=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}class Jh extends xn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Y2={type:"move"};class Ap{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Jh,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Jh,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new k,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new k),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Jh,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new k,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new k),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const v of e.hand.values()){const m=t.getJointPose(v,i),f=this._getHandJoint(c,v);m!==null&&(f.matrix.fromArray(m.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,f.jointRadius=m.radius),f.visible=m!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=h.position.distanceTo(u.position),p=.02,_=.005;c.inputState.pinching&&d>p+_?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-_&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Y2)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Jh;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class py extends xn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new er,this.environmentIntensity=1,this.environmentRotation=new er,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class fy extends kn{constructor(e=null,t=1,i=1,r,s,o,a,l,c=xi,h=xi,u,d){super(null,o,a,l,c,h,r,s,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class kg extends Qi{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ta=new At,Ig=new At,Qh=[],Og=new Qn,Z2=new At,Zl=new jt,Jl=new ia;class J2 extends jt{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new kg(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,Z2)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Qn),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Ta),Og.copy(e.boundingBox).applyMatrix4(Ta),this.boundingBox.union(Og)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new ia),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Ta),Jl.copy(e.boundingSphere).applyMatrix4(Ta),this.boundingSphere.union(Jl)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,o=e*s+1;for(let a=0;a<i.length;a++)i[a]=r[o+a]}raycast(e,t){const i=this.matrixWorld,r=this.count;if(Zl.geometry=this.geometry,Zl.material=this.material,Zl.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Jl.copy(this.boundingSphere),Jl.applyMatrix4(i),e.ray.intersectsSphere(Jl)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Ta),Ig.multiplyMatrices(i,Ta),Zl.matrixWorld=Ig,Zl.raycast(e,Qh);for(let o=0,a=Qh.length;o<a;o++){const l=Qh[o];l.instanceId=s,l.object=this,t.push(l)}Qh.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new kg(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new fy(new Float32Array(r*this.count),r,this.count,y0,fr));const s=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=r*e;s[l]=a,s.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Rp=new k,Q2=new k,eP=new He;class Ds{constructor(e=new k(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Rp.subVectors(i,t).cross(Q2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Rp),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||eP.getNormalMatrix(e),r=this.coplanarPoint(Rp).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const uo=new ia,tP=new Ne(.5,.5),eu=new k;class A0{constructor(e=new Ds,t=new Ds,i=new Ds,r=new Ds,s=new Ds,o=new Ds){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=mr,i=!1){const r=this.planes,s=e.elements,o=s[0],a=s[1],l=s[2],c=s[3],h=s[4],u=s[5],d=s[6],p=s[7],_=s[8],v=s[9],m=s[10],f=s[11],g=s[12],b=s[13],y=s[14],M=s[15];if(r[0].setComponents(c-o,p-h,f-_,M-g).normalize(),r[1].setComponents(c+o,p+h,f+_,M+g).normalize(),r[2].setComponents(c+a,p+u,f+v,M+b).normalize(),r[3].setComponents(c-a,p-u,f-v,M-b).normalize(),i)r[4].setComponents(l,d,m,y).normalize(),r[5].setComponents(c-l,p-d,f-m,M-y).normalize();else if(r[4].setComponents(c-l,p-d,f-m,M-y).normalize(),t===mr)r[5].setComponents(c+l,p+d,f+m,M+y).normalize();else if(t===$u)r[5].setComponents(l,d,m,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),uo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),uo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(uo)}intersectsSprite(e){uo.center.set(0,0,0);const t=tP.distanceTo(e.center);return uo.radius=.7071067811865476+t,uo.applyMatrix4(e.matrixWorld),this.intersectsSphere(uo)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(eu.x=r.normal.x>0?e.max.x:e.min.x,eu.y=r.normal.y>0?e.max.y:e.min.y,eu.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(eu)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class my extends kn{constructor(e,t,i=Bo,r,s,o,a=xi,l=xi,c,h=Ic,u=1){if(h!==Ic&&h!==Oc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const d={width:e,height:t,depth:u};super(d,r,s,o,a,l,h,i,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new T0(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class vy extends kn{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class os extends to{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,h=l+1,u=e/a,d=t/l,p=[],_=[],v=[],m=[];for(let f=0;f<h;f++){const g=f*d-o;for(let b=0;b<c;b++){const y=b*u-s;_.push(y,-g,0),v.push(0,0,1),m.push(b/a),m.push(1-f/l)}}for(let f=0;f<l;f++)for(let g=0;g<a;g++){const b=g+c*f,y=g+c*(f+1),M=g+1+c*(f+1),S=g+1+c*f;p.push(b,y,S),p.push(y,M,S)}this.setIndex(p),this.setAttribute("position",new Io(_,3)),this.setAttribute("normal",new Io(v,3)),this.setAttribute("uv",new Io(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new os(e.width,e.height,e.widthSegments,e.heightSegments)}}class Ja extends Dl{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new $e(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=P0,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new er,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nP extends Dl{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new $e(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $e(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=P0,this.normalScale=new Ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new er,this.combine=g0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class iP extends Dl{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=p2,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class rP extends Dl{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Lp={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class sP{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this._abortController=null,this.itemStart=function(h){a++,s===!1&&r.onStart!==void 0&&r.onStart(h,o,a),s=!0},this.itemEnd=function(h){o++,r.onProgress!==void 0&&r.onProgress(h,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(h){r.onError!==void 0&&r.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const p=c[u],_=c[u+1];if(p.global&&(p.lastIndex=0),p.test(h))return _}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const oP=new sP;class R0{constructor(e){this.manager=e!==void 0?e:oP,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}R0.DEFAULT_MATERIAL_NAME="__DEFAULT";const Aa=new WeakMap;class aP extends R0{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Lp.get(`image:${e}`);if(o!==void 0){if(o.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0);else{let u=Aa.get(o);u===void 0&&(u=[],Aa.set(o,u)),u.push({onLoad:t,onError:r})}return o}const a=Nc("img");function l(){h(),t&&t(this);const u=Aa.get(this)||[];for(let d=0;d<u.length;d++){const p=u[d];p.onLoad&&p.onLoad(this)}Aa.delete(this),s.manager.itemEnd(e)}function c(u){h(),r&&r(u),Lp.remove(`image:${e}`);const d=Aa.get(this)||[];for(let p=0;p<d.length;p++){const _=d[p];_.onError&&_.onError(u)}Aa.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),Lp.add(`image:${e}`,a),s.manager.itemStart(e),a.src=e,a}}class L0 extends R0{constructor(e){super(e)}load(e,t,i,r){const s=new kn,o=new aP(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class Cd extends xn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new $e(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class lP extends Cd{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(xn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new $e(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Dp=new At,Ng=new k,Fg=new k;class _y{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ne(512,512),this.mapType=Cr,this.map=null,this.mapPass=null,this.matrix=new At,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new A0,this._frameExtents=new Ne(1,1),this._viewportCount=1,this._viewports=[new bt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Ng.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ng),Fg.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Fg),t.updateMatrixWorld(),Dp.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dp,t.coordinateSystem,t.reversedDepth),t.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Dp)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}const Vg=new At,Ql=new k,kp=new k;class cP extends _y{constructor(){super(new di(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ne(4,2),this._viewportCount=6,this._viewports=[new bt(2,1,1,1),new bt(0,1,1,1),new bt(3,1,1,1),new bt(1,1,1,1),new bt(3,0,1,1),new bt(1,0,1,1)],this._cubeDirections=[new k(1,0,0),new k(-1,0,0),new k(0,0,1),new k(0,0,-1),new k(0,1,0),new k(0,-1,0)],this._cubeUps=[new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,0,1),new k(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Ql.setFromMatrixPosition(e.matrixWorld),i.position.copy(Ql),kp.copy(i.position),kp.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(kp),i.updateMatrixWorld(),r.makeTranslation(-Ql.x,-Ql.y,-Ql.z),Vg.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Vg,i.coordinateSystem,i.reversedDepth)}}class hP extends Cd{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new cP}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class D0 extends uy{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class uP extends _y{constructor(){super(new D0(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Ug extends Cd{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(xn.DEFAULT_UP),this.updateMatrix(),this.target=new xn,this.shadow=new uP}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class dP extends Cd{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class pP extends di{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class Bg{constructor(e=1,t=0,i=0){this.radius=e,this.phi=t,this.theta=i}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Ye(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Ye(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class fP extends na{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Ve("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function zg(n,e,t,i){const r=mP(i);switch(t){case ey:return n*e;case y0:return n*e/r.components*r.byteLength;case E0:return n*e/r.components*r.byteLength;case C0:return n*e*2/r.components*r.byteLength;case S0:return n*e*2/r.components*r.byteLength;case ty:return n*e*3/r.components*r.byteLength;case Yi:return n*e*4/r.components*r.byteLength;case M0:return n*e*4/r.components*r.byteLength;case _u:case gu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case bu:case xu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Zf:case Qf:return Math.max(n,16)*Math.max(e,8)/4;case Yf:case Jf:return Math.max(n,8)*Math.max(e,8)/2;case em:case tm:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case nm:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case im:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case rm:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case sm:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case om:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case am:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case lm:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case cm:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case hm:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case um:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case dm:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case pm:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case fm:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case mm:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case vm:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case _m:case gm:case bm:return Math.ceil(n/4)*Math.ceil(e/4)*16;case xm:case wm:return Math.ceil(n/4)*Math.ceil(e/4)*8;case ym:case Em:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function mP(n){switch(n){case Cr:case Yw:return{byteLength:1,components:1};case Dc:case Zw:case Ll:return{byteLength:2,components:1};case x0:case w0:return{byteLength:2,components:4};case Bo:case b0:case fr:return{byteLength:4,components:1};case Jw:case Qw:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:_0}}));typeof window<"u"&&(window.__THREE__?Ve("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=_0);function gy(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function vP(n){const e=new WeakMap;function t(a,l){const c=a.array,h=a.usage,u=c.byteLength,d=n.createBuffer();n.bindBuffer(l,d),n.bufferData(l,c,h),a.onUploadCallback();let p;if(c instanceof Float32Array)p=n.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)p=n.HALF_FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?p=n.HALF_FLOAT:p=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)p=n.SHORT;else if(c instanceof Uint32Array)p=n.UNSIGNED_INT;else if(c instanceof Int32Array)p=n.INT;else if(c instanceof Int8Array)p=n.BYTE;else if(c instanceof Uint8Array)p=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)p=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:u}}function i(a,l,c){const h=l.array,u=l.updateRanges;if(n.bindBuffer(c,a),u.length===0)n.bufferSubData(c,0,h);else{u.sort((p,_)=>p.start-_.start);let d=0;for(let p=1;p<u.length;p++){const _=u[d],v=u[p];v.start<=_.start+_.count+1?_.count=Math.max(_.count,v.start+v.count-_.start):(++d,u[d]=v)}u.length=d+1;for(let p=0,_=u.length;p<_;p++){const v=u[p];n.bufferSubData(c,v.start*h.BYTES_PER_ELEMENT,h,v.start,v.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const h=e.get(a);(!h||h.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:r,remove:s,update:o}}var _P=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,gP=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,bP=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,xP=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wP=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,yP=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,EP=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,CP=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,SP=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,MP=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,PP=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,TP=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,AP=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,RP=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,LP=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,DP=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,kP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,IP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,OP=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,NP=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,FP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,VP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,UP=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,BP=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,zP=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,$P=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,HP=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,GP=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,jP=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,WP=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,KP="gl_FragColor = linearToOutputTexel( gl_FragColor );",XP=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,qP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,YP=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,ZP=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,JP=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,QP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,eT=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,tT=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,nT=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,iT=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,rT=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,sT=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,oT=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,aT=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lT=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,cT=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,hT=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,uT=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,dT=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,pT=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,fT=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,mT=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 uv = vec2( roughness, dotNV );
	return texture2D( dfgLUT, uv ).rg;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNV * dotNV), 0.0, dotNV), material.roughness );
	vec2 dfgL = DFGApprox( vec3(0.0, 0.0, 1.0), vec3(sqrt(1.0 - dotNL * dotNL), 0.0, dotNL), material.roughness );
	vec3 FssEss_V = material.specularColor * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColor * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColor + ( 1.0 - material.specularColor ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,vT=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,_T=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,gT=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,bT=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,xT=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wT=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,yT=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,ET=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,CT=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,ST=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,MT=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,PT=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,TT=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,AT=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,RT=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,LT=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,DT=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,kT=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,IT=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,OT=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,NT=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,FT=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,VT=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,UT=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,BT=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,zT=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,$T=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,HT=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,GT=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,jT=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,WT=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,KT=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,XT=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,qT=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,YT=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,ZT=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,JT=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,QT=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,e3=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,t3=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,n3=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,i3=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,r3=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,s3=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,o3=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,a3=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,l3=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,c3=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,h3=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,u3=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,d3=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,p3=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,f3=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,m3=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const v3=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,_3=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,g3=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,b3=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,x3=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,w3=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,y3=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,E3=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,C3=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,S3=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,M3=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,P3=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,T3=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,A3=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,R3=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,L3=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,D3=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,k3=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,I3=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,O3=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,N3=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,F3=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,V3=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,U3=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,B3=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,z3=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$3=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,H3=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,G3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,j3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,W3=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,K3=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,X3=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,q3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ge={alphahash_fragment:_P,alphahash_pars_fragment:gP,alphamap_fragment:bP,alphamap_pars_fragment:xP,alphatest_fragment:wP,alphatest_pars_fragment:yP,aomap_fragment:EP,aomap_pars_fragment:CP,batching_pars_vertex:SP,batching_vertex:MP,begin_vertex:PP,beginnormal_vertex:TP,bsdfs:AP,iridescence_fragment:RP,bumpmap_pars_fragment:LP,clipping_planes_fragment:DP,clipping_planes_pars_fragment:kP,clipping_planes_pars_vertex:IP,clipping_planes_vertex:OP,color_fragment:NP,color_pars_fragment:FP,color_pars_vertex:VP,color_vertex:UP,common:BP,cube_uv_reflection_fragment:zP,defaultnormal_vertex:$P,displacementmap_pars_vertex:HP,displacementmap_vertex:GP,emissivemap_fragment:jP,emissivemap_pars_fragment:WP,colorspace_fragment:KP,colorspace_pars_fragment:XP,envmap_fragment:qP,envmap_common_pars_fragment:YP,envmap_pars_fragment:ZP,envmap_pars_vertex:JP,envmap_physical_pars_fragment:cT,envmap_vertex:QP,fog_vertex:eT,fog_pars_vertex:tT,fog_fragment:nT,fog_pars_fragment:iT,gradientmap_pars_fragment:rT,lightmap_pars_fragment:sT,lights_lambert_fragment:oT,lights_lambert_pars_fragment:aT,lights_pars_begin:lT,lights_toon_fragment:hT,lights_toon_pars_fragment:uT,lights_phong_fragment:dT,lights_phong_pars_fragment:pT,lights_physical_fragment:fT,lights_physical_pars_fragment:mT,lights_fragment_begin:vT,lights_fragment_maps:_T,lights_fragment_end:gT,logdepthbuf_fragment:bT,logdepthbuf_pars_fragment:xT,logdepthbuf_pars_vertex:wT,logdepthbuf_vertex:yT,map_fragment:ET,map_pars_fragment:CT,map_particle_fragment:ST,map_particle_pars_fragment:MT,metalnessmap_fragment:PT,metalnessmap_pars_fragment:TT,morphinstance_vertex:AT,morphcolor_vertex:RT,morphnormal_vertex:LT,morphtarget_pars_vertex:DT,morphtarget_vertex:kT,normal_fragment_begin:IT,normal_fragment_maps:OT,normal_pars_fragment:NT,normal_pars_vertex:FT,normal_vertex:VT,normalmap_pars_fragment:UT,clearcoat_normal_fragment_begin:BT,clearcoat_normal_fragment_maps:zT,clearcoat_pars_fragment:$T,iridescence_pars_fragment:HT,opaque_fragment:GT,packing:jT,premultiplied_alpha_fragment:WT,project_vertex:KT,dithering_fragment:XT,dithering_pars_fragment:qT,roughnessmap_fragment:YT,roughnessmap_pars_fragment:ZT,shadowmap_pars_fragment:JT,shadowmap_pars_vertex:QT,shadowmap_vertex:e3,shadowmask_pars_fragment:t3,skinbase_vertex:n3,skinning_pars_vertex:i3,skinning_vertex:r3,skinnormal_vertex:s3,specularmap_fragment:o3,specularmap_pars_fragment:a3,tonemapping_fragment:l3,tonemapping_pars_fragment:c3,transmission_fragment:h3,transmission_pars_fragment:u3,uv_pars_fragment:d3,uv_pars_vertex:p3,uv_vertex:f3,worldpos_vertex:m3,background_vert:v3,background_frag:_3,backgroundCube_vert:g3,backgroundCube_frag:b3,cube_vert:x3,cube_frag:w3,depth_vert:y3,depth_frag:E3,distanceRGBA_vert:C3,distanceRGBA_frag:S3,equirect_vert:M3,equirect_frag:P3,linedashed_vert:T3,linedashed_frag:A3,meshbasic_vert:R3,meshbasic_frag:L3,meshlambert_vert:D3,meshlambert_frag:k3,meshmatcap_vert:I3,meshmatcap_frag:O3,meshnormal_vert:N3,meshnormal_frag:F3,meshphong_vert:V3,meshphong_frag:U3,meshphysical_vert:B3,meshphysical_frag:z3,meshtoon_vert:$3,meshtoon_frag:H3,points_vert:G3,points_frag:j3,shadow_vert:W3,shadow_frag:K3,sprite_vert:X3,sprite_frag:q3},oe={common:{diffuse:{value:new $e(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new He},alphaMap:{value:null},alphaMapTransform:{value:new He},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new He}},envmap:{envMap:{value:null},envMapRotation:{value:new He},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new He}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new He}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new He},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new He},normalScale:{value:new Ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new He},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new He}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new He}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new He}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $e(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $e(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new He},alphaTest:{value:0},uvTransform:{value:new He}},sprite:{diffuse:{value:new $e(16777215)},opacity:{value:1},center:{value:new Ne(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new He},alphaMap:{value:null},alphaMapTransform:{value:new He},alphaTest:{value:0}}},hr={basic:{uniforms:Un([oe.common,oe.specularmap,oe.envmap,oe.aomap,oe.lightmap,oe.fog]),vertexShader:Ge.meshbasic_vert,fragmentShader:Ge.meshbasic_frag},lambert:{uniforms:Un([oe.common,oe.specularmap,oe.envmap,oe.aomap,oe.lightmap,oe.emissivemap,oe.bumpmap,oe.normalmap,oe.displacementmap,oe.fog,oe.lights,{emissive:{value:new $e(0)}}]),vertexShader:Ge.meshlambert_vert,fragmentShader:Ge.meshlambert_frag},phong:{uniforms:Un([oe.common,oe.specularmap,oe.envmap,oe.aomap,oe.lightmap,oe.emissivemap,oe.bumpmap,oe.normalmap,oe.displacementmap,oe.fog,oe.lights,{emissive:{value:new $e(0)},specular:{value:new $e(1118481)},shininess:{value:30}}]),vertexShader:Ge.meshphong_vert,fragmentShader:Ge.meshphong_frag},standard:{uniforms:Un([oe.common,oe.envmap,oe.aomap,oe.lightmap,oe.emissivemap,oe.bumpmap,oe.normalmap,oe.displacementmap,oe.roughnessmap,oe.metalnessmap,oe.fog,oe.lights,{emissive:{value:new $e(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ge.meshphysical_vert,fragmentShader:Ge.meshphysical_frag},toon:{uniforms:Un([oe.common,oe.aomap,oe.lightmap,oe.emissivemap,oe.bumpmap,oe.normalmap,oe.displacementmap,oe.gradientmap,oe.fog,oe.lights,{emissive:{value:new $e(0)}}]),vertexShader:Ge.meshtoon_vert,fragmentShader:Ge.meshtoon_frag},matcap:{uniforms:Un([oe.common,oe.bumpmap,oe.normalmap,oe.displacementmap,oe.fog,{matcap:{value:null}}]),vertexShader:Ge.meshmatcap_vert,fragmentShader:Ge.meshmatcap_frag},points:{uniforms:Un([oe.points,oe.fog]),vertexShader:Ge.points_vert,fragmentShader:Ge.points_frag},dashed:{uniforms:Un([oe.common,oe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ge.linedashed_vert,fragmentShader:Ge.linedashed_frag},depth:{uniforms:Un([oe.common,oe.displacementmap]),vertexShader:Ge.depth_vert,fragmentShader:Ge.depth_frag},normal:{uniforms:Un([oe.common,oe.bumpmap,oe.normalmap,oe.displacementmap,{opacity:{value:1}}]),vertexShader:Ge.meshnormal_vert,fragmentShader:Ge.meshnormal_frag},sprite:{uniforms:Un([oe.sprite,oe.fog]),vertexShader:Ge.sprite_vert,fragmentShader:Ge.sprite_frag},background:{uniforms:{uvTransform:{value:new He},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ge.background_vert,fragmentShader:Ge.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new He}},vertexShader:Ge.backgroundCube_vert,fragmentShader:Ge.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ge.cube_vert,fragmentShader:Ge.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ge.equirect_vert,fragmentShader:Ge.equirect_frag},distanceRGBA:{uniforms:Un([oe.common,oe.displacementmap,{referencePosition:{value:new k},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ge.distanceRGBA_vert,fragmentShader:Ge.distanceRGBA_frag},shadow:{uniforms:Un([oe.lights,oe.fog,{color:{value:new $e(0)},opacity:{value:1}}]),vertexShader:Ge.shadow_vert,fragmentShader:Ge.shadow_frag}};hr.physical={uniforms:Un([hr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new He},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new He},clearcoatNormalScale:{value:new Ne(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new He},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new He},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new He},sheen:{value:0},sheenColor:{value:new $e(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new He},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new He},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new He},transmissionSamplerSize:{value:new Ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new He},attenuationDistance:{value:0},attenuationColor:{value:new $e(0)},specularColor:{value:new $e(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new He},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new He},anisotropyVector:{value:new Ne},anisotropyMap:{value:null},anisotropyMapTransform:{value:new He}}]),vertexShader:Ge.meshphysical_vert,fragmentShader:Ge.meshphysical_frag};const tu={r:0,b:0,g:0},po=new er,Y3=new At;function Z3(n,e,t,i,r,s,o){const a=new $e(0);let l=s===!0?0:1,c,h,u=null,d=0,p=null;function _(b){let y=b.isScene===!0?b.background:null;return y&&y.isTexture&&(y=(b.backgroundBlurriness>0?t:e).get(y)),y}function v(b){let y=!1;const M=_(b);M===null?f(a,l):M&&M.isColor&&(f(M,1),y=!0);const S=n.xr.getEnvironmentBlendMode();S==="additive"?i.buffers.color.setClear(0,0,0,1,o):S==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||y)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function m(b,y){const M=_(y);M&&(M.isCubeTexture||M.mapping===Ed)?(h===void 0&&(h=new jt(new no(1,1,1),new ss({name:"BackgroundCubeMaterial",uniforms:vl(hr.backgroundCube.uniforms),vertexShader:hr.backgroundCube.vertexShader,fragmentShader:hr.backgroundCube.fragmentShader,side:$n,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(S,P,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(h)),po.copy(y.backgroundRotation),po.x*=-1,po.y*=-1,po.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(po.y*=-1,po.z*=-1),h.material.uniforms.envMap.value=M,h.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(Y3.makeRotationFromEuler(po)),h.material.toneMapped=at.getTransfer(M.colorSpace)!==mt,(u!==M||d!==M.version||p!==n.toneMapping)&&(h.material.needsUpdate=!0,u=M,d=M.version,p=n.toneMapping),h.layers.enableAll(),b.unshift(h,h.geometry,h.material,0,0,null)):M&&M.isTexture&&(c===void 0&&(c=new jt(new os(2,2),new ss({name:"BackgroundMaterial",uniforms:vl(hr.background.uniforms),vertexShader:hr.background.vertexShader,fragmentShader:hr.background.fragmentShader,side:Ji,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=M,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,c.material.toneMapped=at.getTransfer(M.colorSpace)!==mt,M.matrixAutoUpdate===!0&&M.updateMatrix(),c.material.uniforms.uvTransform.value.copy(M.matrix),(u!==M||d!==M.version||p!==n.toneMapping)&&(c.material.needsUpdate=!0,u=M,d=M.version,p=n.toneMapping),c.layers.enableAll(),b.unshift(c,c.geometry,c.material,0,0,null))}function f(b,y){b.getRGB(tu,hy(n)),i.buffers.color.setClear(tu.r,tu.g,tu.b,y,o)}function g(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return a},setClearColor:function(b,y=1){a.set(b),l=y,f(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(b){l=b,f(a,l)},render:v,addToRenderList:m,dispose:g}}function J3(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=d(null);let s=r,o=!1;function a(E,R,O,F,G){let H=!1;const B=u(F,O,R);s!==B&&(s=B,c(s.object)),H=p(E,F,O,G),H&&_(E,F,O,G),G!==null&&e.update(G,n.ELEMENT_ARRAY_BUFFER),(H||o)&&(o=!1,y(E,R,O,F),G!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(G).buffer))}function l(){return n.createVertexArray()}function c(E){return n.bindVertexArray(E)}function h(E){return n.deleteVertexArray(E)}function u(E,R,O){const F=O.wireframe===!0;let G=i[E.id];G===void 0&&(G={},i[E.id]=G);let H=G[R.id];H===void 0&&(H={},G[R.id]=H);let B=H[F];return B===void 0&&(B=d(l()),H[F]=B),B}function d(E){const R=[],O=[],F=[];for(let G=0;G<t;G++)R[G]=0,O[G]=0,F[G]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:O,attributeDivisors:F,object:E,attributes:{},index:null}}function p(E,R,O,F){const G=s.attributes,H=R.attributes;let B=0;const W=O.getAttributes();for(const $ in W)if(W[$].location>=0){const ee=G[$];let me=H[$];if(me===void 0&&($==="instanceMatrix"&&E.instanceMatrix&&(me=E.instanceMatrix),$==="instanceColor"&&E.instanceColor&&(me=E.instanceColor)),ee===void 0||ee.attribute!==me||me&&ee.data!==me.data)return!0;B++}return s.attributesNum!==B||s.index!==F}function _(E,R,O,F){const G={},H=R.attributes;let B=0;const W=O.getAttributes();for(const $ in W)if(W[$].location>=0){let ee=H[$];ee===void 0&&($==="instanceMatrix"&&E.instanceMatrix&&(ee=E.instanceMatrix),$==="instanceColor"&&E.instanceColor&&(ee=E.instanceColor));const me={};me.attribute=ee,ee&&ee.data&&(me.data=ee.data),G[$]=me,B++}s.attributes=G,s.attributesNum=B,s.index=F}function v(){const E=s.newAttributes;for(let R=0,O=E.length;R<O;R++)E[R]=0}function m(E){f(E,0)}function f(E,R){const O=s.newAttributes,F=s.enabledAttributes,G=s.attributeDivisors;O[E]=1,F[E]===0&&(n.enableVertexAttribArray(E),F[E]=1),G[E]!==R&&(n.vertexAttribDivisor(E,R),G[E]=R)}function g(){const E=s.newAttributes,R=s.enabledAttributes;for(let O=0,F=R.length;O<F;O++)R[O]!==E[O]&&(n.disableVertexAttribArray(O),R[O]=0)}function b(E,R,O,F,G,H,B){B===!0?n.vertexAttribIPointer(E,R,O,G,H):n.vertexAttribPointer(E,R,O,F,G,H)}function y(E,R,O,F){v();const G=F.attributes,H=O.getAttributes(),B=R.defaultAttributeValues;for(const W in H){const $=H[W];if($.location>=0){let Q=G[W];if(Q===void 0&&(W==="instanceMatrix"&&E.instanceMatrix&&(Q=E.instanceMatrix),W==="instanceColor"&&E.instanceColor&&(Q=E.instanceColor)),Q!==void 0){const ee=Q.normalized,me=Q.itemSize,De=e.get(Q);if(De===void 0)continue;const Je=De.buffer,Be=De.type,ze=De.bytesPerElement,K=Be===n.INT||Be===n.UNSIGNED_INT||Q.gpuType===b0;if(Q.isInterleavedBufferAttribute){const Y=Q.data,pe=Y.stride,ke=Q.offset;if(Y.isInstancedInterleavedBuffer){for(let we=0;we<$.locationSize;we++)f($.location+we,Y.meshPerAttribute);E.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Y.meshPerAttribute*Y.count)}else for(let we=0;we<$.locationSize;we++)m($.location+we);n.bindBuffer(n.ARRAY_BUFFER,Je);for(let we=0;we<$.locationSize;we++)b($.location+we,me/$.locationSize,Be,ee,pe*ze,(ke+me/$.locationSize*we)*ze,K)}else{if(Q.isInstancedBufferAttribute){for(let Y=0;Y<$.locationSize;Y++)f($.location+Y,Q.meshPerAttribute);E.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let Y=0;Y<$.locationSize;Y++)m($.location+Y);n.bindBuffer(n.ARRAY_BUFFER,Je);for(let Y=0;Y<$.locationSize;Y++)b($.location+Y,me/$.locationSize,Be,ee,me*ze,me/$.locationSize*Y*ze,K)}}else if(B!==void 0){const ee=B[W];if(ee!==void 0)switch(ee.length){case 2:n.vertexAttrib2fv($.location,ee);break;case 3:n.vertexAttrib3fv($.location,ee);break;case 4:n.vertexAttrib4fv($.location,ee);break;default:n.vertexAttrib1fv($.location,ee)}}}}g()}function M(){A();for(const E in i){const R=i[E];for(const O in R){const F=R[O];for(const G in F)h(F[G].object),delete F[G];delete R[O]}delete i[E]}}function S(E){if(i[E.id]===void 0)return;const R=i[E.id];for(const O in R){const F=R[O];for(const G in F)h(F[G].object),delete F[G];delete R[O]}delete i[E.id]}function P(E){for(const R in i){const O=i[R];if(O[E.id]===void 0)continue;const F=O[E.id];for(const G in F)h(F[G].object),delete F[G];delete O[E.id]}}function A(){x(),o=!0,s!==r&&(s=r,c(s.object))}function x(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:A,resetDefaultState:x,dispose:M,releaseStatesOfGeometry:S,releaseStatesOfProgram:P,initAttributes:v,enableAttribute:m,disableUnusedAttributes:g}}function Q3(n,e,t){let i;function r(c){i=c}function s(c,h){n.drawArrays(i,c,h),t.update(h,i,1)}function o(c,h,u){u!==0&&(n.drawArraysInstanced(i,c,h,u),t.update(h,i,u))}function a(c,h,u){if(u===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,h,0,u);let p=0;for(let _=0;_<u;_++)p+=h[_];t.update(p,i,1)}function l(c,h,u,d){if(u===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let _=0;_<c.length;_++)o(c[_],h[_],d[_]);else{p.multiDrawArraysInstancedWEBGL(i,c,0,h,0,d,0,u);let _=0;for(let v=0;v<u;v++)_+=h[v]*d[v];t.update(_,i,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function eA(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const P=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(P){return!(P!==Yi&&i.convert(P)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(P){const A=P===Ll&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(P!==Cr&&i.convert(P)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&P!==fr&&!A)}function l(P){if(P==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";P="mediump"}return P==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const h=l(c);h!==c&&(Ve("WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const u=t.logarithmicDepthBuffer===!0,d=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),p=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=n.getParameter(n.MAX_TEXTURE_SIZE),m=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),f=n.getParameter(n.MAX_VERTEX_ATTRIBS),g=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),b=n.getParameter(n.MAX_VARYING_VECTORS),y=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),M=_>0,S=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:u,reversedDepthBuffer:d,maxTextures:p,maxVertexTextures:_,maxTextureSize:v,maxCubemapSize:m,maxAttributes:f,maxVertexUniforms:g,maxVaryings:b,maxFragmentUniforms:y,vertexTextures:M,maxSamples:S}}function tA(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new Ds,a=new He,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){const p=u.length!==0||d||i!==0||r;return r=d,i=u.length,p},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(u,d){t=h(u,d,0)},this.setState=function(u,d,p){const _=u.clippingPlanes,v=u.clipIntersection,m=u.clipShadows,f=n.get(u);if(!r||_===null||_.length===0||s&&!m)s?h(null):c();else{const g=s?0:i,b=g*4;let y=f.clippingState||null;l.value=y,y=h(_,d,b,p);for(let M=0;M!==b;++M)y[M]=t[M];f.clippingState=y,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=g}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(u,d,p,_){const v=u!==null?u.length:0;let m=null;if(v!==0){if(m=l.value,_!==!0||m===null){const f=p+v*4,g=d.matrixWorldInverse;a.getNormalMatrix(g),(m===null||m.length<f)&&(m=new Float32Array(f));for(let b=0,y=p;b!==v;++b,y+=4)o.copy(u[b]).applyMatrix4(g,a),o.normal.toArray(m,y),m[y+3]=o.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,m}}function nA(n){let e=new WeakMap;function t(o,a){return a===Wf?o.mapping=pl:a===Kf&&(o.mapping=fl),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===Wf||a===Kf)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new q2(l.height);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}const Is=4,$g=[.125,.215,.35,.446,.526,.582],Mo=20,iA=512,ec=new D0,Hg=new $e;let Ip=null,Op=0,Np=0,Fp=!1;const rA=new k;class Sm{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,i=.1,r=100,s={}){const{size:o=256,position:a=rA}=s;Ip=this._renderer.getRenderTarget(),Op=this._renderer.getActiveCubeFace(),Np=this._renderer.getActiveMipmapLevel(),Fp=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,r,l,a),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Wg(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=jg(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(Ip,Op,Np),this._renderer.xr.enabled=Fp,e.scissorTest=!1,Ra(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===pl||e.mapping===fl?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ip=this._renderer.getRenderTarget(),Op=this._renderer.getActiveCubeFace(),Np=this._renderer.getActiveMipmapLevel(),Fp=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Oi,minFilter:Oi,generateMipmaps:!1,type:Ll,format:Yi,colorSpace:ml,depthBuffer:!1},r=Gg(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Gg(e,t,i);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=sA(s)),this._blurMaterial=aA(s,e,t)}return r}_compileMaterial(e){const t=new jt(new to,e);this._renderer.compile(t,ec)}_sceneToCubeUV(e,t,i,r,s){const l=new di(90,1,t,i),c=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,p=u.toneMapping;u.getClearColor(Hg),u.toneMapping=Hs,u.autoClear=!1,u.state.buffers.depth.getReversed()&&(u.setRenderTarget(r),u.clearDepth(),u.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new jt(new no,new kl({name:"PMREM.Background",side:$n,depthWrite:!1,depthTest:!1})));const v=this._backgroundBox,m=v.material;let f=!1;const g=e.background;g?g.isColor&&(m.color.copy(g),e.background=null,f=!0):(m.color.copy(Hg),f=!0);for(let b=0;b<6;b++){const y=b%3;y===0?(l.up.set(0,c[b],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+h[b],s.y,s.z)):y===1?(l.up.set(0,0,c[b]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+h[b],s.z)):(l.up.set(0,c[b],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+h[b]));const M=this._cubeSize;Ra(r,y*M,b>2?M:0,M,M),u.setRenderTarget(r),f&&u.render(v,l),u.render(e,l)}u.toneMapping=p,u.autoClear=d,e.background=g}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===pl||e.mapping===fl;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Wg()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=jg());const s=r?this._cubemapMaterial:this._equirectMaterial,o=this._lodMeshes[0];o.material=s;const a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Ra(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,ec)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let s=1;s<r;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=i}_applyGGXFilter(e,t,i){const r=this._renderer,s=this._pingPongRenderTarget;if(this._ggxMaterial===null){const g=3*Math.max(this._cubeSize,16),b=4*this._cubeSize;this._ggxMaterial=oA(this._lodMax,g,b)}const o=this._ggxMaterial,a=this._lodMeshes[i];a.material=o;const l=o.uniforms,c=i/(this._lodMeshes.length-1),h=t/(this._lodMeshes.length-1),u=Math.sqrt(c*c-h*h),d=.05+c*.95,p=u*d,{_lodMax:_}=this,v=this._sizeLods[i],m=3*v*(i>_-Is?i-_+Is:0),f=4*(this._cubeSize-v);l.envMap.value=e.texture,l.roughness.value=p,l.mipInt.value=_-t,Ra(s,m,f,3*v,2*v),r.setRenderTarget(s),r.render(a,ec),l.envMap.value=s.texture,l.roughness.value=0,l.mipInt.value=_-i,Ra(e,m,f,3*v,2*v),r.setRenderTarget(e),r.render(a,ec)}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&en("blur direction must be either latitudinal or longitudinal!");const h=3,u=this._lodMeshes[r];u.material=c;const d=c.uniforms,p=this._sizeLods[i]-1,_=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*Mo-1),v=s/_,m=isFinite(s)?1+Math.floor(h*v):Mo;m>Mo&&Ve(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Mo}`);const f=[];let g=0;for(let P=0;P<Mo;++P){const A=P/v,x=Math.exp(-A*A/2);f.push(x),P===0?g+=x:P<m&&(g+=2*x)}for(let P=0;P<f.length;P++)f[P]=f[P]/g;d.envMap.value=e.texture,d.samples.value=m,d.weights.value=f,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:b}=this;d.dTheta.value=_,d.mipInt.value=b-i;const y=this._sizeLods[r],M=3*y*(r>b-Is?r-b+Is:0),S=4*(this._cubeSize-y);Ra(t,M,S,3*y,2*y),l.setRenderTarget(t),l.render(u,ec)}}function sA(n){const e=[],t=[],i=[];let r=n;const s=n-Is+1+$g.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);e.push(a);let l=1/a;o>n-Is?l=$g[o-n+Is-1]:o===0&&(l=0),t.push(l);const c=1/(a-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],p=6,_=6,v=3,m=2,f=1,g=new Float32Array(v*_*p),b=new Float32Array(m*_*p),y=new Float32Array(f*_*p);for(let S=0;S<p;S++){const P=S%3*2/3-1,A=S>2?0:-1,x=[P,A,0,P+2/3,A,0,P+2/3,A+1,0,P,A,0,P+2/3,A+1,0,P,A+1,0];g.set(x,v*_*S),b.set(d,m*_*S);const E=[S,S,S,S,S,S];y.set(E,f*_*S)}const M=new to;M.setAttribute("position",new Qi(g,v)),M.setAttribute("uv",new Qi(b,m)),M.setAttribute("faceIndex",new Qi(y,f)),i.push(new jt(M,null)),r>Is&&r--}return{lodMeshes:i,sizeLods:e,sigmas:t}}function Gg(n,e,t){const i=new $o(n,e,t);return i.texture.mapping=Ed,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Ra(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function oA(n,e,t){return new ss({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:iA,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:Sd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:ts,depthTest:!1,depthWrite:!1})}function aA(n,e,t){const i=new Float32Array(Mo),r=new k(0,1,0);return new ss({name:"SphericalGaussianBlur",defines:{n:Mo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Sd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ts,depthTest:!1,depthWrite:!1})}function jg(){return new ss({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Sd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ts,depthTest:!1,depthWrite:!1})}function Wg(){return new ss({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Sd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ts,depthTest:!1,depthWrite:!1})}function Sd(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function lA(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===Wf||l===Kf,h=l===pl||l===fl;if(c||h){let u=e.get(a);const d=u!==void 0?u.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return t===null&&(t=new Sm(n)),u=c?t.fromEquirectangular(a,u):t.fromCubemap(a,u),u.texture.pmremVersion=a.pmremVersion,e.set(a,u),u.texture;if(u!==void 0)return u.texture;{const p=a.image;return c&&p&&p.height>0||h&&p&&r(p)?(t===null&&(t=new Sm(n)),u=c?t.fromEquirectangular(a):t.fromCubemap(a),u.texture.pmremVersion=a.pmremVersion,e.set(a,u),a.addEventListener("dispose",s),u.texture):null}}}return a}function r(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function cA(n){const e={};function t(i){if(e[i]!==void 0)return e[i];const r=n.getExtension(i);return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&Fc("WebGLRenderer: "+i+" extension not supported."),r}}}function hA(n,e,t,i){const r={},s=new WeakMap;function o(u){const d=u.target;d.index!==null&&e.remove(d.index);for(const _ in d.attributes)e.remove(d.attributes[_]);d.removeEventListener("dispose",o),delete r[d.id];const p=s.get(d);p&&(e.remove(p),s.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(u,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,t.memory.geometries++),d}function l(u){const d=u.attributes;for(const p in d)e.update(d[p],n.ARRAY_BUFFER)}function c(u){const d=[],p=u.index,_=u.attributes.position;let v=0;if(p!==null){const g=p.array;v=p.version;for(let b=0,y=g.length;b<y;b+=3){const M=g[b+0],S=g[b+1],P=g[b+2];d.push(M,S,S,P,P,M)}}else if(_!==void 0){const g=_.array;v=_.version;for(let b=0,y=g.length/3-1;b<y;b+=3){const M=b+0,S=b+1,P=b+2;d.push(M,S,S,P,P,M)}}else return;const m=new(iy(d)?cy:ly)(d,1);m.version=v;const f=s.get(u);f&&e.remove(f),s.set(u,m)}function h(u){const d=s.get(u);if(d){const p=u.index;p!==null&&d.version<p.version&&c(u)}else c(u);return s.get(u)}return{get:a,update:l,getWireframeAttribute:h}}function uA(n,e,t){let i;function r(d){i=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function l(d,p){n.drawElements(i,p,s,d*o),t.update(p,i,1)}function c(d,p,_){_!==0&&(n.drawElementsInstanced(i,p,s,d*o,_),t.update(p,i,_))}function h(d,p,_){if(_===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,p,0,s,d,0,_);let m=0;for(let f=0;f<_;f++)m+=p[f];t.update(m,i,1)}function u(d,p,_,v){if(_===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let f=0;f<d.length;f++)c(d[f]/o,p[f],v[f]);else{m.multiDrawElementsInstancedWEBGL(i,p,0,s,d,0,v,0,_);let f=0;for(let g=0;g<_;g++)f+=p[g]*v[g];t.update(f,i,1)}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=u}function dA(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:en("WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function pA(n,e,t){const i=new WeakMap,r=new bt;function s(o,a,l){const c=o.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=h!==void 0?h.length:0;let d=i.get(a);if(d===void 0||d.count!==u){let E=function(){A.dispose(),i.delete(a),a.removeEventListener("dispose",E)};var p=E;d!==void 0&&d.texture.dispose();const _=a.morphAttributes.position!==void 0,v=a.morphAttributes.normal!==void 0,m=a.morphAttributes.color!==void 0,f=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],b=a.morphAttributes.color||[];let y=0;_===!0&&(y=1),v===!0&&(y=2),m===!0&&(y=3);let M=a.attributes.position.count*y,S=1;M>e.maxTextureSize&&(S=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const P=new Float32Array(M*S*4*u),A=new ry(P,M,S,u);A.type=fr,A.needsUpdate=!0;const x=y*4;for(let R=0;R<u;R++){const O=f[R],F=g[R],G=b[R],H=M*S*4*R;for(let B=0;B<O.count;B++){const W=B*x;_===!0&&(r.fromBufferAttribute(O,B),P[H+W+0]=r.x,P[H+W+1]=r.y,P[H+W+2]=r.z,P[H+W+3]=0),v===!0&&(r.fromBufferAttribute(F,B),P[H+W+4]=r.x,P[H+W+5]=r.y,P[H+W+6]=r.z,P[H+W+7]=0),m===!0&&(r.fromBufferAttribute(G,B),P[H+W+8]=r.x,P[H+W+9]=r.y,P[H+W+10]=r.z,P[H+W+11]=G.itemSize===4?r.w:1)}}d={count:u,texture:A,size:new Ne(M,S)},i.set(a,d),a.addEventListener("dispose",E)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let _=0;for(let m=0;m<c.length;m++)_+=c[m];const v=a.morphTargetsRelative?1:1-_;l.getUniforms().setValue(n,"morphTargetBaseInfluence",v),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:s}}function fA(n,e,t,i){let r=new WeakMap;function s(l){const c=i.render.frame,h=l.geometry,u=e.get(l,h);if(r.get(u)!==c&&(e.update(u),r.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==c&&(d.update(),r.set(d,c))}return u}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}const by=new kn,Kg=new my(1,1),xy=new ry,wy=new D2,yy=new dy,Xg=[],qg=[],Yg=new Float32Array(16),Zg=new Float32Array(9),Jg=new Float32Array(4);function Il(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=Xg[r];if(s===void 0&&(s=new Float32Array(r),Xg[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function dn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function pn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Md(n,e){let t=qg[e];t===void 0&&(t=new Int32Array(e),qg[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function mA(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function vA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dn(t,e))return;n.uniform2fv(this.addr,e),pn(t,e)}}function _A(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(dn(t,e))return;n.uniform3fv(this.addr,e),pn(t,e)}}function gA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dn(t,e))return;n.uniform4fv(this.addr,e),pn(t,e)}}function bA(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(dn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),pn(t,e)}else{if(dn(t,i))return;Jg.set(i),n.uniformMatrix2fv(this.addr,!1,Jg),pn(t,i)}}function xA(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(dn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),pn(t,e)}else{if(dn(t,i))return;Zg.set(i),n.uniformMatrix3fv(this.addr,!1,Zg),pn(t,i)}}function wA(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(dn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),pn(t,e)}else{if(dn(t,i))return;Yg.set(i),n.uniformMatrix4fv(this.addr,!1,Yg),pn(t,i)}}function yA(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function EA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dn(t,e))return;n.uniform2iv(this.addr,e),pn(t,e)}}function CA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(dn(t,e))return;n.uniform3iv(this.addr,e),pn(t,e)}}function SA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dn(t,e))return;n.uniform4iv(this.addr,e),pn(t,e)}}function MA(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function PA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dn(t,e))return;n.uniform2uiv(this.addr,e),pn(t,e)}}function TA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(dn(t,e))return;n.uniform3uiv(this.addr,e),pn(t,e)}}function AA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dn(t,e))return;n.uniform4uiv(this.addr,e),pn(t,e)}}function RA(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(Kg.compareFunction=ny,s=Kg):s=by,t.setTexture2D(e||s,r)}function LA(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||wy,r)}function DA(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||yy,r)}function kA(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||xy,r)}function IA(n){switch(n){case 5126:return mA;case 35664:return vA;case 35665:return _A;case 35666:return gA;case 35674:return bA;case 35675:return xA;case 35676:return wA;case 5124:case 35670:return yA;case 35667:case 35671:return EA;case 35668:case 35672:return CA;case 35669:case 35673:return SA;case 5125:return MA;case 36294:return PA;case 36295:return TA;case 36296:return AA;case 35678:case 36198:case 36298:case 36306:case 35682:return RA;case 35679:case 36299:case 36307:return LA;case 35680:case 36300:case 36308:case 36293:return DA;case 36289:case 36303:case 36311:case 36292:return kA}}function OA(n,e){n.uniform1fv(this.addr,e)}function NA(n,e){const t=Il(e,this.size,2);n.uniform2fv(this.addr,t)}function FA(n,e){const t=Il(e,this.size,3);n.uniform3fv(this.addr,t)}function VA(n,e){const t=Il(e,this.size,4);n.uniform4fv(this.addr,t)}function UA(n,e){const t=Il(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function BA(n,e){const t=Il(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function zA(n,e){const t=Il(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function $A(n,e){n.uniform1iv(this.addr,e)}function HA(n,e){n.uniform2iv(this.addr,e)}function GA(n,e){n.uniform3iv(this.addr,e)}function jA(n,e){n.uniform4iv(this.addr,e)}function WA(n,e){n.uniform1uiv(this.addr,e)}function KA(n,e){n.uniform2uiv(this.addr,e)}function XA(n,e){n.uniform3uiv(this.addr,e)}function qA(n,e){n.uniform4uiv(this.addr,e)}function YA(n,e,t){const i=this.cache,r=e.length,s=Md(t,r);dn(i,s)||(n.uniform1iv(this.addr,s),pn(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||by,s[o])}function ZA(n,e,t){const i=this.cache,r=e.length,s=Md(t,r);dn(i,s)||(n.uniform1iv(this.addr,s),pn(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||wy,s[o])}function JA(n,e,t){const i=this.cache,r=e.length,s=Md(t,r);dn(i,s)||(n.uniform1iv(this.addr,s),pn(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||yy,s[o])}function QA(n,e,t){const i=this.cache,r=e.length,s=Md(t,r);dn(i,s)||(n.uniform1iv(this.addr,s),pn(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||xy,s[o])}function eR(n){switch(n){case 5126:return OA;case 35664:return NA;case 35665:return FA;case 35666:return VA;case 35674:return UA;case 35675:return BA;case 35676:return zA;case 5124:case 35670:return $A;case 35667:case 35671:return HA;case 35668:case 35672:return GA;case 35669:case 35673:return jA;case 5125:return WA;case 36294:return KA;case 36295:return XA;case 36296:return qA;case 35678:case 36198:case 36298:case 36306:case 35682:return YA;case 35679:case 36299:case 36307:return ZA;case 35680:case 36300:case 36308:case 36293:return JA;case 36289:case 36303:case 36311:case 36292:return QA}}class tR{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=IA(t.type)}}class nR{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=eR(t.type)}}class iR{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const Vp=/(\w+)(\])?(\[|\.)?/g;function Qg(n,e){n.seq.push(e),n.map[e.id]=e}function rR(n,e,t){const i=n.name,r=i.length;for(Vp.lastIndex=0;;){const s=Vp.exec(i),o=Vp.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){Qg(t,c===void 0?new tR(a,n,e):new nR(a,n,e));break}else{let u=t.map[a];u===void 0&&(u=new iR(a),Qg(t,u)),t=u}}}class yu{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);rR(s,o,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function eb(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const sR=37297;let oR=0;function aR(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}const tb=new He;function lR(n){at._getMatrix(tb,at.workingColorSpace,n);const e=`mat3( ${tb.elements.map(t=>t.toFixed(4))} )`;switch(at.getTransfer(n)){case zu:return[e,"LinearTransferOETF"];case mt:return[e,"sRGBTransferOETF"];default:return Ve("WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function nb(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=(n.getShaderInfoLog(e)||"").trim();if(i&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const a=parseInt(o[1]);return t.toUpperCase()+`

`+s+`

`+aR(n.getShaderSource(e),a)}else return s}function cR(n,e){const t=lR(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function hR(n,e){let t;switch(e){case o2:t="Linear";break;case a2:t="Reinhard";break;case l2:t="Cineon";break;case Xw:t="ACESFilmic";break;case h2:t="AgX";break;case u2:t="Neutral";break;case c2:t="Custom";break;default:Ve("WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const nu=new k;function uR(){at.getLuminanceCoefficients(nu);const n=nu.x.toFixed(4),e=nu.y.toFixed(4),t=nu.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function dR(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(xc).join(`
`)}function pR(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function fR(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function xc(n){return n!==""}function ib(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function rb(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const mR=/^[ \t]*#include +<([\w\d./]+)>/gm;function Mm(n){return n.replace(mR,_R)}const vR=new Map;function _R(n,e){let t=Ge[e];if(t===void 0){const i=vR.get(e);if(i!==void 0)t=Ge[i],Ve('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return Mm(t)}const gR=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function sb(n){return n.replace(gR,bR)}function bR(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function ob(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function xR(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Ww?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===Kw?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===lr&&(e="SHADOWMAP_TYPE_VSM"),e}function wR(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case pl:case fl:e="ENVMAP_TYPE_CUBE";break;case Ed:e="ENVMAP_TYPE_CUBE_UV";break}return e}function yR(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case fl:e="ENVMAP_MODE_REFRACTION";break}return e}function ER(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case g0:e="ENVMAP_BLENDING_MULTIPLY";break;case r2:e="ENVMAP_BLENDING_MIX";break;case s2:e="ENVMAP_BLENDING_ADD";break}return e}function CR(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}function SR(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=xR(t),c=wR(t),h=yR(t),u=ER(t),d=CR(t),p=dR(t),_=pR(s),v=r.createProgram();let m,f,g=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(xc).join(`
`),m.length>0&&(m+=`
`),f=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(xc).join(`
`),f.length>0&&(f+=`
`)):(m=[ob(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(xc).join(`
`),f=[ob(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Hs?"#define TONE_MAPPING":"",t.toneMapping!==Hs?Ge.tonemapping_pars_fragment:"",t.toneMapping!==Hs?hR("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ge.colorspace_pars_fragment,cR("linearToOutputTexel",t.outputColorSpace),uR(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(xc).join(`
`)),o=Mm(o),o=ib(o,t),o=rb(o,t),a=Mm(a),a=ib(a,t),a=rb(a,t),o=sb(o),a=sb(a),t.isRawShaderMaterial!==!0&&(g=`#version 300 es
`,m=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,f=["#define varying in",t.glslVersion===fg?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===fg?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+f);const b=g+m+o,y=g+f+a,M=eb(r,r.VERTEX_SHADER,b),S=eb(r,r.FRAGMENT_SHADER,y);r.attachShader(v,M),r.attachShader(v,S),t.index0AttributeName!==void 0?r.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v);function P(R){if(n.debug.checkShaderErrors){const O=r.getProgramInfoLog(v)||"",F=r.getShaderInfoLog(M)||"",G=r.getShaderInfoLog(S)||"",H=O.trim(),B=F.trim(),W=G.trim();let $=!0,Q=!0;if(r.getProgramParameter(v,r.LINK_STATUS)===!1)if($=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,v,M,S);else{const ee=nb(r,M,"vertex"),me=nb(r,S,"fragment");en("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+`

Material Name: `+R.name+`
Material Type: `+R.type+`

Program Info Log: `+H+`
`+ee+`
`+me)}else H!==""?Ve("WebGLProgram: Program Info Log:",H):(B===""||W==="")&&(Q=!1);Q&&(R.diagnostics={runnable:$,programLog:H,vertexShader:{log:B,prefix:m},fragmentShader:{log:W,prefix:f}})}r.deleteShader(M),r.deleteShader(S),A=new yu(r,v),x=fR(r,v)}let A;this.getUniforms=function(){return A===void 0&&P(this),A};let x;this.getAttributes=function(){return x===void 0&&P(this),x};let E=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return E===!1&&(E=r.getProgramParameter(v,sR)),E},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=oR++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=S,this}let MR=0;class PR{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new TR(e),t.set(e,i)),i}}class TR{constructor(e){this.id=MR++,this.code=e,this.usedTimes=0}}function AR(n,e,t,i,r,s,o){const a=new oy,l=new PR,c=new Set,h=[],u=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(x){return c.add(x),x===0?"uv":`uv${x}`}function m(x,E,R,O,F){const G=O.fog,H=F.geometry,B=x.isMeshStandardMaterial?O.environment:null,W=(x.isMeshStandardMaterial?t:e).get(x.envMap||B),$=W&&W.mapping===Ed?W.image.height:null,Q=_[x.type];x.precision!==null&&(p=r.getMaxPrecision(x.precision),p!==x.precision&&Ve("WebGLProgram.getParameters:",x.precision,"not supported, using",p,"instead."));const ee=H.morphAttributes.position||H.morphAttributes.normal||H.morphAttributes.color,me=ee!==void 0?ee.length:0;let De=0;H.morphAttributes.position!==void 0&&(De=1),H.morphAttributes.normal!==void 0&&(De=2),H.morphAttributes.color!==void 0&&(De=3);let Je,Be,ze,K;if(Q){const pt=hr[Q];Je=pt.vertexShader,Be=pt.fragmentShader}else Je=x.vertexShader,Be=x.fragmentShader,l.update(x),ze=l.getVertexShaderID(x),K=l.getFragmentShaderID(x);const Y=n.getRenderTarget(),pe=n.state.buffers.depth.getReversed(),ke=F.isInstancedMesh===!0,we=F.isBatchedMesh===!0,Qe=!!x.map,yn=!!x.matcap,qe=!!W,Rt=!!x.aoMap,L=!!x.lightMap,et=!!x.bumpMap,tt=!!x.normalMap,Ct=!!x.displacementMap,ge=!!x.emissiveMap,Ot=!!x.metalnessMap,Ee=!!x.roughnessMap,Fe=x.anisotropy>0,T=x.clearcoat>0,w=x.dispersion>0,V=x.iridescence>0,X=x.sheen>0,Z=x.transmission>0,j=Fe&&!!x.anisotropyMap,xe=T&&!!x.clearcoatMap,ae=T&&!!x.clearcoatNormalMap,Ce=T&&!!x.clearcoatRoughnessMap,be=V&&!!x.iridescenceMap,J=V&&!!x.iridescenceThicknessMap,ie=X&&!!x.sheenColorMap,Te=X&&!!x.sheenRoughnessMap,Me=!!x.specularMap,de=!!x.specularColorMap,Ie=!!x.specularIntensityMap,D=Z&&!!x.transmissionMap,le=Z&&!!x.thicknessMap,re=!!x.gradientMap,se=!!x.alphaMap,te=x.alphaTest>0,q=!!x.alphaHash,ve=!!x.extensions;let Oe=Hs;x.toneMapped&&(Y===null||Y.isXRRenderTarget===!0)&&(Oe=n.toneMapping);const Mt={shaderID:Q,shaderType:x.type,shaderName:x.name,vertexShader:Je,fragmentShader:Be,defines:x.defines,customVertexShaderID:ze,customFragmentShaderID:K,isRawShaderMaterial:x.isRawShaderMaterial===!0,glslVersion:x.glslVersion,precision:p,batching:we,batchingColor:we&&F._colorsTexture!==null,instancing:ke,instancingColor:ke&&F.instanceColor!==null,instancingMorph:ke&&F.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:Y===null?n.outputColorSpace:Y.isXRRenderTarget===!0?Y.texture.colorSpace:ml,alphaToCoverage:!!x.alphaToCoverage,map:Qe,matcap:yn,envMap:qe,envMapMode:qe&&W.mapping,envMapCubeUVHeight:$,aoMap:Rt,lightMap:L,bumpMap:et,normalMap:tt,displacementMap:d&&Ct,emissiveMap:ge,normalMapObjectSpace:tt&&x.normalMapType===m2,normalMapTangentSpace:tt&&x.normalMapType===P0,metalnessMap:Ot,roughnessMap:Ee,anisotropy:Fe,anisotropyMap:j,clearcoat:T,clearcoatMap:xe,clearcoatNormalMap:ae,clearcoatRoughnessMap:Ce,dispersion:w,iridescence:V,iridescenceMap:be,iridescenceThicknessMap:J,sheen:X,sheenColorMap:ie,sheenRoughnessMap:Te,specularMap:Me,specularColorMap:de,specularIntensityMap:Ie,transmission:Z,transmissionMap:D,thicknessMap:le,gradientMap:re,opaque:x.transparent===!1&&x.blending===Ya&&x.alphaToCoverage===!1,alphaMap:se,alphaTest:te,alphaHash:q,combine:x.combine,mapUv:Qe&&v(x.map.channel),aoMapUv:Rt&&v(x.aoMap.channel),lightMapUv:L&&v(x.lightMap.channel),bumpMapUv:et&&v(x.bumpMap.channel),normalMapUv:tt&&v(x.normalMap.channel),displacementMapUv:Ct&&v(x.displacementMap.channel),emissiveMapUv:ge&&v(x.emissiveMap.channel),metalnessMapUv:Ot&&v(x.metalnessMap.channel),roughnessMapUv:Ee&&v(x.roughnessMap.channel),anisotropyMapUv:j&&v(x.anisotropyMap.channel),clearcoatMapUv:xe&&v(x.clearcoatMap.channel),clearcoatNormalMapUv:ae&&v(x.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ce&&v(x.clearcoatRoughnessMap.channel),iridescenceMapUv:be&&v(x.iridescenceMap.channel),iridescenceThicknessMapUv:J&&v(x.iridescenceThicknessMap.channel),sheenColorMapUv:ie&&v(x.sheenColorMap.channel),sheenRoughnessMapUv:Te&&v(x.sheenRoughnessMap.channel),specularMapUv:Me&&v(x.specularMap.channel),specularColorMapUv:de&&v(x.specularColorMap.channel),specularIntensityMapUv:Ie&&v(x.specularIntensityMap.channel),transmissionMapUv:D&&v(x.transmissionMap.channel),thicknessMapUv:le&&v(x.thicknessMap.channel),alphaMapUv:se&&v(x.alphaMap.channel),vertexTangents:!!H.attributes.tangent&&(tt||Fe),vertexColors:x.vertexColors,vertexAlphas:x.vertexColors===!0&&!!H.attributes.color&&H.attributes.color.itemSize===4,pointsUvs:F.isPoints===!0&&!!H.attributes.uv&&(Qe||se),fog:!!G,useFog:x.fog===!0,fogExp2:!!G&&G.isFogExp2,flatShading:x.flatShading===!0&&x.wireframe===!1,sizeAttenuation:x.sizeAttenuation===!0,logarithmicDepthBuffer:u,reversedDepthBuffer:pe,skinning:F.isSkinnedMesh===!0,morphTargets:H.morphAttributes.position!==void 0,morphNormals:H.morphAttributes.normal!==void 0,morphColors:H.morphAttributes.color!==void 0,morphTargetsCount:me,morphTextureStride:De,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numSpotLightMaps:E.spotLightMap.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numSpotLightShadowsWithMaps:E.numSpotLightShadowsWithMaps,numLightProbes:E.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:x.dithering,shadowMapEnabled:n.shadowMap.enabled&&R.length>0,shadowMapType:n.shadowMap.type,toneMapping:Oe,decodeVideoTexture:Qe&&x.map.isVideoTexture===!0&&at.getTransfer(x.map.colorSpace)===mt,decodeVideoTextureEmissive:ge&&x.emissiveMap.isVideoTexture===!0&&at.getTransfer(x.emissiveMap.colorSpace)===mt,premultipliedAlpha:x.premultipliedAlpha,doubleSided:x.side===pi,flipSided:x.side===$n,useDepthPacking:x.depthPacking>=0,depthPacking:x.depthPacking||0,index0AttributeName:x.index0AttributeName,extensionClipCullDistance:ve&&x.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ve&&x.extensions.multiDraw===!0||we)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:x.customProgramCacheKey()};return Mt.vertexUv1s=c.has(1),Mt.vertexUv2s=c.has(2),Mt.vertexUv3s=c.has(3),c.clear(),Mt}function f(x){const E=[];if(x.shaderID?E.push(x.shaderID):(E.push(x.customVertexShaderID),E.push(x.customFragmentShaderID)),x.defines!==void 0)for(const R in x.defines)E.push(R),E.push(x.defines[R]);return x.isRawShaderMaterial===!1&&(g(E,x),b(E,x),E.push(n.outputColorSpace)),E.push(x.customProgramCacheKey),E.join()}function g(x,E){x.push(E.precision),x.push(E.outputColorSpace),x.push(E.envMapMode),x.push(E.envMapCubeUVHeight),x.push(E.mapUv),x.push(E.alphaMapUv),x.push(E.lightMapUv),x.push(E.aoMapUv),x.push(E.bumpMapUv),x.push(E.normalMapUv),x.push(E.displacementMapUv),x.push(E.emissiveMapUv),x.push(E.metalnessMapUv),x.push(E.roughnessMapUv),x.push(E.anisotropyMapUv),x.push(E.clearcoatMapUv),x.push(E.clearcoatNormalMapUv),x.push(E.clearcoatRoughnessMapUv),x.push(E.iridescenceMapUv),x.push(E.iridescenceThicknessMapUv),x.push(E.sheenColorMapUv),x.push(E.sheenRoughnessMapUv),x.push(E.specularMapUv),x.push(E.specularColorMapUv),x.push(E.specularIntensityMapUv),x.push(E.transmissionMapUv),x.push(E.thicknessMapUv),x.push(E.combine),x.push(E.fogExp2),x.push(E.sizeAttenuation),x.push(E.morphTargetsCount),x.push(E.morphAttributeCount),x.push(E.numDirLights),x.push(E.numPointLights),x.push(E.numSpotLights),x.push(E.numSpotLightMaps),x.push(E.numHemiLights),x.push(E.numRectAreaLights),x.push(E.numDirLightShadows),x.push(E.numPointLightShadows),x.push(E.numSpotLightShadows),x.push(E.numSpotLightShadowsWithMaps),x.push(E.numLightProbes),x.push(E.shadowMapType),x.push(E.toneMapping),x.push(E.numClippingPlanes),x.push(E.numClipIntersection),x.push(E.depthPacking)}function b(x,E){a.disableAll(),E.supportsVertexTextures&&a.enable(0),E.instancing&&a.enable(1),E.instancingColor&&a.enable(2),E.instancingMorph&&a.enable(3),E.matcap&&a.enable(4),E.envMap&&a.enable(5),E.normalMapObjectSpace&&a.enable(6),E.normalMapTangentSpace&&a.enable(7),E.clearcoat&&a.enable(8),E.iridescence&&a.enable(9),E.alphaTest&&a.enable(10),E.vertexColors&&a.enable(11),E.vertexAlphas&&a.enable(12),E.vertexUv1s&&a.enable(13),E.vertexUv2s&&a.enable(14),E.vertexUv3s&&a.enable(15),E.vertexTangents&&a.enable(16),E.anisotropy&&a.enable(17),E.alphaHash&&a.enable(18),E.batching&&a.enable(19),E.dispersion&&a.enable(20),E.batchingColor&&a.enable(21),E.gradientMap&&a.enable(22),x.push(a.mask),a.disableAll(),E.fog&&a.enable(0),E.useFog&&a.enable(1),E.flatShading&&a.enable(2),E.logarithmicDepthBuffer&&a.enable(3),E.reversedDepthBuffer&&a.enable(4),E.skinning&&a.enable(5),E.morphTargets&&a.enable(6),E.morphNormals&&a.enable(7),E.morphColors&&a.enable(8),E.premultipliedAlpha&&a.enable(9),E.shadowMapEnabled&&a.enable(10),E.doubleSided&&a.enable(11),E.flipSided&&a.enable(12),E.useDepthPacking&&a.enable(13),E.dithering&&a.enable(14),E.transmission&&a.enable(15),E.sheen&&a.enable(16),E.opaque&&a.enable(17),E.pointsUvs&&a.enable(18),E.decodeVideoTexture&&a.enable(19),E.decodeVideoTextureEmissive&&a.enable(20),E.alphaToCoverage&&a.enable(21),x.push(a.mask)}function y(x){const E=_[x.type];let R;if(E){const O=hr[E];R=j2.clone(O.uniforms)}else R=x.uniforms;return R}function M(x,E){let R;for(let O=0,F=h.length;O<F;O++){const G=h[O];if(G.cacheKey===E){R=G,++R.usedTimes;break}}return R===void 0&&(R=new SR(n,E,x,s),h.push(R)),R}function S(x){if(--x.usedTimes===0){const E=h.indexOf(x);h[E]=h[h.length-1],h.pop(),x.destroy()}}function P(x){l.remove(x)}function A(){l.dispose()}return{getParameters:m,getProgramCacheKey:f,getUniforms:y,acquireProgram:M,releaseProgram:S,releaseShaderCache:P,programs:h,dispose:A}}function RR(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function r(o,a,l){n.get(o)[a]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:i,update:r,dispose:s}}function LR(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function ab(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function lb(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function o(u,d,p,_,v,m){let f=n[e];return f===void 0?(f={id:u.id,object:u,geometry:d,material:p,groupOrder:_,renderOrder:u.renderOrder,z:v,group:m},n[e]=f):(f.id=u.id,f.object=u,f.geometry=d,f.material=p,f.groupOrder=_,f.renderOrder=u.renderOrder,f.z=v,f.group=m),e++,f}function a(u,d,p,_,v,m){const f=o(u,d,p,_,v,m);p.transmission>0?i.push(f):p.transparent===!0?r.push(f):t.push(f)}function l(u,d,p,_,v,m){const f=o(u,d,p,_,v,m);p.transmission>0?i.unshift(f):p.transparent===!0?r.unshift(f):t.unshift(f)}function c(u,d){t.length>1&&t.sort(u||LR),i.length>1&&i.sort(d||ab),r.length>1&&r.sort(d||ab)}function h(){for(let u=e,d=n.length;u<d;u++){const p=n[u];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:h,sort:c}}function DR(){let n=new WeakMap;function e(i,r){const s=n.get(i);let o;return s===void 0?(o=new lb,n.set(i,[o])):r>=s.length?(o=new lb,s.push(o)):o=s[r],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function kR(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new k,color:new $e};break;case"SpotLight":t={position:new k,direction:new k,color:new $e,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new k,color:new $e,distance:0,decay:0};break;case"HemisphereLight":t={direction:new k,skyColor:new $e,groundColor:new $e};break;case"RectAreaLight":t={color:new $e,position:new k,halfWidth:new k,halfHeight:new k};break}return n[e.id]=t,t}}}function IR(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ne,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let OR=0;function NR(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function FR(n){const e=new kR,t=IR(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new k);const r=new k,s=new At,o=new At;function a(c){let h=0,u=0,d=0;for(let x=0;x<9;x++)i.probe[x].set(0,0,0);let p=0,_=0,v=0,m=0,f=0,g=0,b=0,y=0,M=0,S=0,P=0;c.sort(NR);for(let x=0,E=c.length;x<E;x++){const R=c[x],O=R.color,F=R.intensity,G=R.distance,H=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)h+=O.r*F,u+=O.g*F,d+=O.b*F;else if(R.isLightProbe){for(let B=0;B<9;B++)i.probe[B].addScaledVector(R.sh.coefficients[B],F);P++}else if(R.isDirectionalLight){const B=e.get(R);if(B.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const W=R.shadow,$=t.get(R);$.shadowIntensity=W.intensity,$.shadowBias=W.bias,$.shadowNormalBias=W.normalBias,$.shadowRadius=W.radius,$.shadowMapSize=W.mapSize,i.directionalShadow[p]=$,i.directionalShadowMap[p]=H,i.directionalShadowMatrix[p]=R.shadow.matrix,g++}i.directional[p]=B,p++}else if(R.isSpotLight){const B=e.get(R);B.position.setFromMatrixPosition(R.matrixWorld),B.color.copy(O).multiplyScalar(F),B.distance=G,B.coneCos=Math.cos(R.angle),B.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),B.decay=R.decay,i.spot[v]=B;const W=R.shadow;if(R.map&&(i.spotLightMap[M]=R.map,M++,W.updateMatrices(R),R.castShadow&&S++),i.spotLightMatrix[v]=W.matrix,R.castShadow){const $=t.get(R);$.shadowIntensity=W.intensity,$.shadowBias=W.bias,$.shadowNormalBias=W.normalBias,$.shadowRadius=W.radius,$.shadowMapSize=W.mapSize,i.spotShadow[v]=$,i.spotShadowMap[v]=H,y++}v++}else if(R.isRectAreaLight){const B=e.get(R);B.color.copy(O).multiplyScalar(F),B.halfWidth.set(R.width*.5,0,0),B.halfHeight.set(0,R.height*.5,0),i.rectArea[m]=B,m++}else if(R.isPointLight){const B=e.get(R);if(B.color.copy(R.color).multiplyScalar(R.intensity),B.distance=R.distance,B.decay=R.decay,R.castShadow){const W=R.shadow,$=t.get(R);$.shadowIntensity=W.intensity,$.shadowBias=W.bias,$.shadowNormalBias=W.normalBias,$.shadowRadius=W.radius,$.shadowMapSize=W.mapSize,$.shadowCameraNear=W.camera.near,$.shadowCameraFar=W.camera.far,i.pointShadow[_]=$,i.pointShadowMap[_]=H,i.pointShadowMatrix[_]=R.shadow.matrix,b++}i.point[_]=B,_++}else if(R.isHemisphereLight){const B=e.get(R);B.skyColor.copy(R.color).multiplyScalar(F),B.groundColor.copy(R.groundColor).multiplyScalar(F),i.hemi[f]=B,f++}}m>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=oe.LTC_FLOAT_1,i.rectAreaLTC2=oe.LTC_FLOAT_2):(i.rectAreaLTC1=oe.LTC_HALF_1,i.rectAreaLTC2=oe.LTC_HALF_2)),i.ambient[0]=h,i.ambient[1]=u,i.ambient[2]=d;const A=i.hash;(A.directionalLength!==p||A.pointLength!==_||A.spotLength!==v||A.rectAreaLength!==m||A.hemiLength!==f||A.numDirectionalShadows!==g||A.numPointShadows!==b||A.numSpotShadows!==y||A.numSpotMaps!==M||A.numLightProbes!==P)&&(i.directional.length=p,i.spot.length=v,i.rectArea.length=m,i.point.length=_,i.hemi.length=f,i.directionalShadow.length=g,i.directionalShadowMap.length=g,i.pointShadow.length=b,i.pointShadowMap.length=b,i.spotShadow.length=y,i.spotShadowMap.length=y,i.directionalShadowMatrix.length=g,i.pointShadowMatrix.length=b,i.spotLightMatrix.length=y+M-S,i.spotLightMap.length=M,i.numSpotLightShadowsWithMaps=S,i.numLightProbes=P,A.directionalLength=p,A.pointLength=_,A.spotLength=v,A.rectAreaLength=m,A.hemiLength=f,A.numDirectionalShadows=g,A.numPointShadows=b,A.numSpotShadows=y,A.numSpotMaps=M,A.numLightProbes=P,i.version=OR++)}function l(c,h){let u=0,d=0,p=0,_=0,v=0;const m=h.matrixWorldInverse;for(let f=0,g=c.length;f<g;f++){const b=c[f];if(b.isDirectionalLight){const y=i.directional[u];y.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),y.direction.sub(r),y.direction.transformDirection(m),u++}else if(b.isSpotLight){const y=i.spot[p];y.position.setFromMatrixPosition(b.matrixWorld),y.position.applyMatrix4(m),y.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),y.direction.sub(r),y.direction.transformDirection(m),p++}else if(b.isRectAreaLight){const y=i.rectArea[_];y.position.setFromMatrixPosition(b.matrixWorld),y.position.applyMatrix4(m),o.identity(),s.copy(b.matrixWorld),s.premultiply(m),o.extractRotation(s),y.halfWidth.set(b.width*.5,0,0),y.halfHeight.set(0,b.height*.5,0),y.halfWidth.applyMatrix4(o),y.halfHeight.applyMatrix4(o),_++}else if(b.isPointLight){const y=i.point[d];y.position.setFromMatrixPosition(b.matrixWorld),y.position.applyMatrix4(m),d++}else if(b.isHemisphereLight){const y=i.hemi[v];y.direction.setFromMatrixPosition(b.matrixWorld),y.direction.transformDirection(m),v++}}}return{setup:a,setupView:l,state:i}}function cb(n){const e=new FR(n),t=[],i=[];function r(h){c.camera=h,t.length=0,i.length=0}function s(h){t.push(h)}function o(h){i.push(h)}function a(){e.setup(t)}function l(h){e.setupView(t,h)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:c,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:o}}function VR(n){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new cb(n),e.set(r,[a])):s>=o.length?(a=new cb(n),o.push(a)):a=o[s],a}function i(){e=new WeakMap}return{get:t,dispose:i}}const UR=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,BR=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function zR(n,e,t){let i=new A0;const r=new Ne,s=new Ne,o=new bt,a=new iP({depthPacking:f2}),l=new rP,c={},h=t.maxTextureSize,u={[Ji]:$n,[$n]:Ji,[pi]:pi},d=new ss({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ne},radius:{value:4}},vertexShader:UR,fragmentShader:BR}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const _=new to;_.setAttribute("position",new Qi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new jt(_,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ww;let f=this.type;this.render=function(S,P,A){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||S.length===0)return;const x=n.getRenderTarget(),E=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),O=n.state;O.setBlending(ts),O.buffers.depth.getReversed()===!0?O.buffers.color.setClear(0,0,0,0):O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const F=f!==lr&&this.type===lr,G=f===lr&&this.type!==lr;for(let H=0,B=S.length;H<B;H++){const W=S[H],$=W.shadow;if($===void 0){Ve("WebGLShadowMap:",W,"has no shadow.");continue}if($.autoUpdate===!1&&$.needsUpdate===!1)continue;r.copy($.mapSize);const Q=$.getFrameExtents();if(r.multiply(Q),s.copy($.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/Q.x),r.x=s.x*Q.x,$.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/Q.y),r.y=s.y*Q.y,$.mapSize.y=s.y)),$.map===null||F===!0||G===!0){const me=this.type!==lr?{minFilter:xi,magFilter:xi}:{};$.map!==null&&$.map.dispose(),$.map=new $o(r.x,r.y,me),$.map.texture.name=W.name+".shadowMap",$.camera.updateProjectionMatrix()}n.setRenderTarget($.map),n.clear();const ee=$.getViewportCount();for(let me=0;me<ee;me++){const De=$.getViewport(me);o.set(s.x*De.x,s.y*De.y,s.x*De.z,s.y*De.w),O.viewport(o),$.updateMatrices(W,me),i=$.getFrustum(),y(P,A,$.camera,W,this.type)}$.isPointLightShadow!==!0&&this.type===lr&&g($,A),$.needsUpdate=!1}f=this.type,m.needsUpdate=!1,n.setRenderTarget(x,E,R)};function g(S,P){const A=e.update(v);d.defines.VSM_SAMPLES!==S.blurSamples&&(d.defines.VSM_SAMPLES=S.blurSamples,p.defines.VSM_SAMPLES=S.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new $o(r.x,r.y)),d.uniforms.shadow_pass.value=S.map.texture,d.uniforms.resolution.value=S.mapSize,d.uniforms.radius.value=S.radius,n.setRenderTarget(S.mapPass),n.clear(),n.renderBufferDirect(P,null,A,d,v,null),p.uniforms.shadow_pass.value=S.mapPass.texture,p.uniforms.resolution.value=S.mapSize,p.uniforms.radius.value=S.radius,n.setRenderTarget(S.map),n.clear(),n.renderBufferDirect(P,null,A,p,v,null)}function b(S,P,A,x){let E=null;const R=A.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(R!==void 0)E=R;else if(E=A.isPointLight===!0?l:a,n.localClippingEnabled&&P.clipShadows===!0&&Array.isArray(P.clippingPlanes)&&P.clippingPlanes.length!==0||P.displacementMap&&P.displacementScale!==0||P.alphaMap&&P.alphaTest>0||P.map&&P.alphaTest>0||P.alphaToCoverage===!0){const O=E.uuid,F=P.uuid;let G=c[O];G===void 0&&(G={},c[O]=G);let H=G[F];H===void 0&&(H=E.clone(),G[F]=H,P.addEventListener("dispose",M)),E=H}if(E.visible=P.visible,E.wireframe=P.wireframe,x===lr?E.side=P.shadowSide!==null?P.shadowSide:P.side:E.side=P.shadowSide!==null?P.shadowSide:u[P.side],E.alphaMap=P.alphaMap,E.alphaTest=P.alphaToCoverage===!0?.5:P.alphaTest,E.map=P.map,E.clipShadows=P.clipShadows,E.clippingPlanes=P.clippingPlanes,E.clipIntersection=P.clipIntersection,E.displacementMap=P.displacementMap,E.displacementScale=P.displacementScale,E.displacementBias=P.displacementBias,E.wireframeLinewidth=P.wireframeLinewidth,E.linewidth=P.linewidth,A.isPointLight===!0&&E.isMeshDistanceMaterial===!0){const O=n.properties.get(E);O.light=A}return E}function y(S,P,A,x,E){if(S.visible===!1)return;if(S.layers.test(P.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&E===lr)&&(!S.frustumCulled||i.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,S.matrixWorld);const F=e.update(S),G=S.material;if(Array.isArray(G)){const H=F.groups;for(let B=0,W=H.length;B<W;B++){const $=H[B],Q=G[$.materialIndex];if(Q&&Q.visible){const ee=b(S,Q,x,E);S.onBeforeShadow(n,S,P,A,F,ee,$),n.renderBufferDirect(A,null,F,ee,S,$),S.onAfterShadow(n,S,P,A,F,ee,$)}}}else if(G.visible){const H=b(S,G,x,E);S.onBeforeShadow(n,S,P,A,F,H,null),n.renderBufferDirect(A,null,F,H,S,null),S.onAfterShadow(n,S,P,A,F,H,null)}}const O=S.children;for(let F=0,G=O.length;F<G;F++)y(O[F],P,A,x,E)}function M(S){S.target.removeEventListener("dispose",M);for(const A in c){const x=c[A],E=S.target.uuid;E in x&&(x[E].dispose(),delete x[E])}}}const $R={[Uf]:Bf,[zf]:Gf,[$f]:jf,[dl]:Hf,[Bf]:Uf,[Gf]:zf,[jf]:$f,[Hf]:dl};function HR(n,e){function t(){let D=!1;const le=new bt;let re=null;const se=new bt(0,0,0,0);return{setMask:function(te){re!==te&&!D&&(n.colorMask(te,te,te,te),re=te)},setLocked:function(te){D=te},setClear:function(te,q,ve,Oe,Mt){Mt===!0&&(te*=Oe,q*=Oe,ve*=Oe),le.set(te,q,ve,Oe),se.equals(le)===!1&&(n.clearColor(te,q,ve,Oe),se.copy(le))},reset:function(){D=!1,re=null,se.set(-1,0,0,0)}}}function i(){let D=!1,le=!1,re=null,se=null,te=null;return{setReversed:function(q){if(le!==q){const ve=e.get("EXT_clip_control");q?ve.clipControlEXT(ve.LOWER_LEFT_EXT,ve.ZERO_TO_ONE_EXT):ve.clipControlEXT(ve.LOWER_LEFT_EXT,ve.NEGATIVE_ONE_TO_ONE_EXT),le=q;const Oe=te;te=null,this.setClear(Oe)}},getReversed:function(){return le},setTest:function(q){q?Y(n.DEPTH_TEST):pe(n.DEPTH_TEST)},setMask:function(q){re!==q&&!D&&(n.depthMask(q),re=q)},setFunc:function(q){if(le&&(q=$R[q]),se!==q){switch(q){case Uf:n.depthFunc(n.NEVER);break;case Bf:n.depthFunc(n.ALWAYS);break;case zf:n.depthFunc(n.LESS);break;case dl:n.depthFunc(n.LEQUAL);break;case $f:n.depthFunc(n.EQUAL);break;case Hf:n.depthFunc(n.GEQUAL);break;case Gf:n.depthFunc(n.GREATER);break;case jf:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}se=q}},setLocked:function(q){D=q},setClear:function(q){te!==q&&(le&&(q=1-q),n.clearDepth(q),te=q)},reset:function(){D=!1,re=null,se=null,te=null,le=!1}}}function r(){let D=!1,le=null,re=null,se=null,te=null,q=null,ve=null,Oe=null,Mt=null;return{setTest:function(pt){D||(pt?Y(n.STENCIL_TEST):pe(n.STENCIL_TEST))},setMask:function(pt){le!==pt&&!D&&(n.stencilMask(pt),le=pt)},setFunc:function(pt,ar,ji){(re!==pt||se!==ar||te!==ji)&&(n.stencilFunc(pt,ar,ji),re=pt,se=ar,te=ji)},setOp:function(pt,ar,ji){(q!==pt||ve!==ar||Oe!==ji)&&(n.stencilOp(pt,ar,ji),q=pt,ve=ar,Oe=ji)},setLocked:function(pt){D=pt},setClear:function(pt){Mt!==pt&&(n.clearStencil(pt),Mt=pt)},reset:function(){D=!1,le=null,re=null,se=null,te=null,q=null,ve=null,Oe=null,Mt=null}}}const s=new t,o=new i,a=new r,l=new WeakMap,c=new WeakMap;let h={},u={},d=new WeakMap,p=[],_=null,v=!1,m=null,f=null,g=null,b=null,y=null,M=null,S=null,P=new $e(0,0,0),A=0,x=!1,E=null,R=null,O=null,F=null,G=null;const H=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let B=!1,W=0;const $=n.getParameter(n.VERSION);$.indexOf("WebGL")!==-1?(W=parseFloat(/^WebGL (\d)/.exec($)[1]),B=W>=1):$.indexOf("OpenGL ES")!==-1&&(W=parseFloat(/^OpenGL ES (\d)/.exec($)[1]),B=W>=2);let Q=null,ee={};const me=n.getParameter(n.SCISSOR_BOX),De=n.getParameter(n.VIEWPORT),Je=new bt().fromArray(me),Be=new bt().fromArray(De);function ze(D,le,re,se){const te=new Uint8Array(4),q=n.createTexture();n.bindTexture(D,q),n.texParameteri(D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(D,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let ve=0;ve<re;ve++)D===n.TEXTURE_3D||D===n.TEXTURE_2D_ARRAY?n.texImage3D(le,0,n.RGBA,1,1,se,0,n.RGBA,n.UNSIGNED_BYTE,te):n.texImage2D(le+ve,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,te);return q}const K={};K[n.TEXTURE_2D]=ze(n.TEXTURE_2D,n.TEXTURE_2D,1),K[n.TEXTURE_CUBE_MAP]=ze(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),K[n.TEXTURE_2D_ARRAY]=ze(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),K[n.TEXTURE_3D]=ze(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Y(n.DEPTH_TEST),o.setFunc(dl),et(!1),tt(lg),Y(n.CULL_FACE),Rt(ts);function Y(D){h[D]!==!0&&(n.enable(D),h[D]=!0)}function pe(D){h[D]!==!1&&(n.disable(D),h[D]=!1)}function ke(D,le){return u[D]!==le?(n.bindFramebuffer(D,le),u[D]=le,D===n.DRAW_FRAMEBUFFER&&(u[n.FRAMEBUFFER]=le),D===n.FRAMEBUFFER&&(u[n.DRAW_FRAMEBUFFER]=le),!0):!1}function we(D,le){let re=p,se=!1;if(D){re=d.get(le),re===void 0&&(re=[],d.set(le,re));const te=D.textures;if(re.length!==te.length||re[0]!==n.COLOR_ATTACHMENT0){for(let q=0,ve=te.length;q<ve;q++)re[q]=n.COLOR_ATTACHMENT0+q;re.length=te.length,se=!0}}else re[0]!==n.BACK&&(re[0]=n.BACK,se=!0);se&&n.drawBuffers(re)}function Qe(D){return _!==D?(n.useProgram(D),_=D,!0):!1}const yn={[So]:n.FUNC_ADD,[zM]:n.FUNC_SUBTRACT,[$M]:n.FUNC_REVERSE_SUBTRACT};yn[HM]=n.MIN,yn[GM]=n.MAX;const qe={[jM]:n.ZERO,[WM]:n.ONE,[KM]:n.SRC_COLOR,[Ff]:n.SRC_ALPHA,[QM]:n.SRC_ALPHA_SATURATE,[ZM]:n.DST_COLOR,[qM]:n.DST_ALPHA,[XM]:n.ONE_MINUS_SRC_COLOR,[Vf]:n.ONE_MINUS_SRC_ALPHA,[JM]:n.ONE_MINUS_DST_COLOR,[YM]:n.ONE_MINUS_DST_ALPHA,[e2]:n.CONSTANT_COLOR,[t2]:n.ONE_MINUS_CONSTANT_COLOR,[n2]:n.CONSTANT_ALPHA,[i2]:n.ONE_MINUS_CONSTANT_ALPHA};function Rt(D,le,re,se,te,q,ve,Oe,Mt,pt){if(D===ts){v===!0&&(pe(n.BLEND),v=!1);return}if(v===!1&&(Y(n.BLEND),v=!0),D!==BM){if(D!==m||pt!==x){if((f!==So||y!==So)&&(n.blendEquation(n.FUNC_ADD),f=So,y=So),pt)switch(D){case Ya:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case cg:n.blendFunc(n.ONE,n.ONE);break;case hg:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case ug:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:en("WebGLState: Invalid blending: ",D);break}else switch(D){case Ya:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case cg:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case hg:en("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case ug:en("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:en("WebGLState: Invalid blending: ",D);break}g=null,b=null,M=null,S=null,P.set(0,0,0),A=0,m=D,x=pt}return}te=te||le,q=q||re,ve=ve||se,(le!==f||te!==y)&&(n.blendEquationSeparate(yn[le],yn[te]),f=le,y=te),(re!==g||se!==b||q!==M||ve!==S)&&(n.blendFuncSeparate(qe[re],qe[se],qe[q],qe[ve]),g=re,b=se,M=q,S=ve),(Oe.equals(P)===!1||Mt!==A)&&(n.blendColor(Oe.r,Oe.g,Oe.b,Mt),P.copy(Oe),A=Mt),m=D,x=!1}function L(D,le){D.side===pi?pe(n.CULL_FACE):Y(n.CULL_FACE);let re=D.side===$n;le&&(re=!re),et(re),D.blending===Ya&&D.transparent===!1?Rt(ts):Rt(D.blending,D.blendEquation,D.blendSrc,D.blendDst,D.blendEquationAlpha,D.blendSrcAlpha,D.blendDstAlpha,D.blendColor,D.blendAlpha,D.premultipliedAlpha),o.setFunc(D.depthFunc),o.setTest(D.depthTest),o.setMask(D.depthWrite),s.setMask(D.colorWrite);const se=D.stencilWrite;a.setTest(se),se&&(a.setMask(D.stencilWriteMask),a.setFunc(D.stencilFunc,D.stencilRef,D.stencilFuncMask),a.setOp(D.stencilFail,D.stencilZFail,D.stencilZPass)),ge(D.polygonOffset,D.polygonOffsetFactor,D.polygonOffsetUnits),D.alphaToCoverage===!0?Y(n.SAMPLE_ALPHA_TO_COVERAGE):pe(n.SAMPLE_ALPHA_TO_COVERAGE)}function et(D){E!==D&&(D?n.frontFace(n.CW):n.frontFace(n.CCW),E=D)}function tt(D){D!==VM?(Y(n.CULL_FACE),D!==R&&(D===lg?n.cullFace(n.BACK):D===UM?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):pe(n.CULL_FACE),R=D}function Ct(D){D!==O&&(B&&n.lineWidth(D),O=D)}function ge(D,le,re){D?(Y(n.POLYGON_OFFSET_FILL),(F!==le||G!==re)&&(n.polygonOffset(le,re),F=le,G=re)):pe(n.POLYGON_OFFSET_FILL)}function Ot(D){D?Y(n.SCISSOR_TEST):pe(n.SCISSOR_TEST)}function Ee(D){D===void 0&&(D=n.TEXTURE0+H-1),Q!==D&&(n.activeTexture(D),Q=D)}function Fe(D,le,re){re===void 0&&(Q===null?re=n.TEXTURE0+H-1:re=Q);let se=ee[re];se===void 0&&(se={type:void 0,texture:void 0},ee[re]=se),(se.type!==D||se.texture!==le)&&(Q!==re&&(n.activeTexture(re),Q=re),n.bindTexture(D,le||K[D]),se.type=D,se.texture=le)}function T(){const D=ee[Q];D!==void 0&&D.type!==void 0&&(n.bindTexture(D.type,null),D.type=void 0,D.texture=void 0)}function w(){try{n.compressedTexImage2D(...arguments)}catch(D){D("WebGLState:",D)}}function V(){try{n.compressedTexImage3D(...arguments)}catch(D){D("WebGLState:",D)}}function X(){try{n.texSubImage2D(...arguments)}catch(D){D("WebGLState:",D)}}function Z(){try{n.texSubImage3D(...arguments)}catch(D){D("WebGLState:",D)}}function j(){try{n.compressedTexSubImage2D(...arguments)}catch(D){D("WebGLState:",D)}}function xe(){try{n.compressedTexSubImage3D(...arguments)}catch(D){D("WebGLState:",D)}}function ae(){try{n.texStorage2D(...arguments)}catch(D){D("WebGLState:",D)}}function Ce(){try{n.texStorage3D(...arguments)}catch(D){D("WebGLState:",D)}}function be(){try{n.texImage2D(...arguments)}catch(D){D("WebGLState:",D)}}function J(){try{n.texImage3D(...arguments)}catch(D){D("WebGLState:",D)}}function ie(D){Je.equals(D)===!1&&(n.scissor(D.x,D.y,D.z,D.w),Je.copy(D))}function Te(D){Be.equals(D)===!1&&(n.viewport(D.x,D.y,D.z,D.w),Be.copy(D))}function Me(D,le){let re=c.get(le);re===void 0&&(re=new WeakMap,c.set(le,re));let se=re.get(D);se===void 0&&(se=n.getUniformBlockIndex(le,D.name),re.set(D,se))}function de(D,le){const se=c.get(le).get(D);l.get(le)!==se&&(n.uniformBlockBinding(le,se,D.__bindingPointIndex),l.set(le,se))}function Ie(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},Q=null,ee={},u={},d=new WeakMap,p=[],_=null,v=!1,m=null,f=null,g=null,b=null,y=null,M=null,S=null,P=new $e(0,0,0),A=0,x=!1,E=null,R=null,O=null,F=null,G=null,Je.set(0,0,n.canvas.width,n.canvas.height),Be.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Y,disable:pe,bindFramebuffer:ke,drawBuffers:we,useProgram:Qe,setBlending:Rt,setMaterial:L,setFlipSided:et,setCullFace:tt,setLineWidth:Ct,setPolygonOffset:ge,setScissorTest:Ot,activeTexture:Ee,bindTexture:Fe,unbindTexture:T,compressedTexImage2D:w,compressedTexImage3D:V,texImage2D:be,texImage3D:J,updateUBOMapping:Me,uniformBlockBinding:de,texStorage2D:ae,texStorage3D:Ce,texSubImage2D:X,texSubImage3D:Z,compressedTexSubImage2D:j,compressedTexSubImage3D:xe,scissor:ie,viewport:Te,reset:Ie}}function GR(n,e,t,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Ne,h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _(T,w){return p?new OffscreenCanvas(T,w):Nc("canvas")}function v(T,w,V){let X=1;const Z=Fe(T);if((Z.width>V||Z.height>V)&&(X=V/Math.max(Z.width,Z.height)),X<1)if(typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&T instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&T instanceof ImageBitmap||typeof VideoFrame<"u"&&T instanceof VideoFrame){const j=Math.floor(X*Z.width),xe=Math.floor(X*Z.height);u===void 0&&(u=_(j,xe));const ae=w?_(j,xe):u;return ae.width=j,ae.height=xe,ae.getContext("2d").drawImage(T,0,0,j,xe),Ve("WebGLRenderer: Texture has been resized from ("+Z.width+"x"+Z.height+") to ("+j+"x"+xe+")."),ae}else return"data"in T&&Ve("WebGLRenderer: Image in DataTexture is too big ("+Z.width+"x"+Z.height+")."),T;return T}function m(T){return T.generateMipmaps}function f(T){n.generateMipmap(T)}function g(T){return T.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:T.isWebGL3DRenderTarget?n.TEXTURE_3D:T.isWebGLArrayRenderTarget||T.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function b(T,w,V,X,Z=!1){if(T!==null){if(n[T]!==void 0)return n[T];Ve("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+T+"'")}let j=w;if(w===n.RED&&(V===n.FLOAT&&(j=n.R32F),V===n.HALF_FLOAT&&(j=n.R16F),V===n.UNSIGNED_BYTE&&(j=n.R8)),w===n.RED_INTEGER&&(V===n.UNSIGNED_BYTE&&(j=n.R8UI),V===n.UNSIGNED_SHORT&&(j=n.R16UI),V===n.UNSIGNED_INT&&(j=n.R32UI),V===n.BYTE&&(j=n.R8I),V===n.SHORT&&(j=n.R16I),V===n.INT&&(j=n.R32I)),w===n.RG&&(V===n.FLOAT&&(j=n.RG32F),V===n.HALF_FLOAT&&(j=n.RG16F),V===n.UNSIGNED_BYTE&&(j=n.RG8)),w===n.RG_INTEGER&&(V===n.UNSIGNED_BYTE&&(j=n.RG8UI),V===n.UNSIGNED_SHORT&&(j=n.RG16UI),V===n.UNSIGNED_INT&&(j=n.RG32UI),V===n.BYTE&&(j=n.RG8I),V===n.SHORT&&(j=n.RG16I),V===n.INT&&(j=n.RG32I)),w===n.RGB_INTEGER&&(V===n.UNSIGNED_BYTE&&(j=n.RGB8UI),V===n.UNSIGNED_SHORT&&(j=n.RGB16UI),V===n.UNSIGNED_INT&&(j=n.RGB32UI),V===n.BYTE&&(j=n.RGB8I),V===n.SHORT&&(j=n.RGB16I),V===n.INT&&(j=n.RGB32I)),w===n.RGBA_INTEGER&&(V===n.UNSIGNED_BYTE&&(j=n.RGBA8UI),V===n.UNSIGNED_SHORT&&(j=n.RGBA16UI),V===n.UNSIGNED_INT&&(j=n.RGBA32UI),V===n.BYTE&&(j=n.RGBA8I),V===n.SHORT&&(j=n.RGBA16I),V===n.INT&&(j=n.RGBA32I)),w===n.RGB&&(V===n.UNSIGNED_INT_5_9_9_9_REV&&(j=n.RGB9_E5),V===n.UNSIGNED_INT_10F_11F_11F_REV&&(j=n.R11F_G11F_B10F)),w===n.RGBA){const xe=Z?zu:at.getTransfer(X);V===n.FLOAT&&(j=n.RGBA32F),V===n.HALF_FLOAT&&(j=n.RGBA16F),V===n.UNSIGNED_BYTE&&(j=xe===mt?n.SRGB8_ALPHA8:n.RGBA8),V===n.UNSIGNED_SHORT_4_4_4_4&&(j=n.RGBA4),V===n.UNSIGNED_SHORT_5_5_5_1&&(j=n.RGB5_A1)}return(j===n.R16F||j===n.R32F||j===n.RG16F||j===n.RG32F||j===n.RGBA16F||j===n.RGBA32F)&&e.get("EXT_color_buffer_float"),j}function y(T,w){let V;return T?w===null||w===Bo||w===kc?V=n.DEPTH24_STENCIL8:w===fr?V=n.DEPTH32F_STENCIL8:w===Dc&&(V=n.DEPTH24_STENCIL8,Ve("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):w===null||w===Bo||w===kc?V=n.DEPTH_COMPONENT24:w===fr?V=n.DEPTH_COMPONENT32F:w===Dc&&(V=n.DEPTH_COMPONENT16),V}function M(T,w){return m(T)===!0||T.isFramebufferTexture&&T.minFilter!==xi&&T.minFilter!==Oi?Math.log2(Math.max(w.width,w.height))+1:T.mipmaps!==void 0&&T.mipmaps.length>0?T.mipmaps.length:T.isCompressedTexture&&Array.isArray(T.image)?w.mipmaps.length:1}function S(T){const w=T.target;w.removeEventListener("dispose",S),A(w),w.isVideoTexture&&h.delete(w)}function P(T){const w=T.target;w.removeEventListener("dispose",P),E(w)}function A(T){const w=i.get(T);if(w.__webglInit===void 0)return;const V=T.source,X=d.get(V);if(X){const Z=X[w.__cacheKey];Z.usedTimes--,Z.usedTimes===0&&x(T),Object.keys(X).length===0&&d.delete(V)}i.remove(T)}function x(T){const w=i.get(T);n.deleteTexture(w.__webglTexture);const V=T.source,X=d.get(V);delete X[w.__cacheKey],o.memory.textures--}function E(T){const w=i.get(T);if(T.depthTexture&&(T.depthTexture.dispose(),i.remove(T.depthTexture)),T.isWebGLCubeRenderTarget)for(let X=0;X<6;X++){if(Array.isArray(w.__webglFramebuffer[X]))for(let Z=0;Z<w.__webglFramebuffer[X].length;Z++)n.deleteFramebuffer(w.__webglFramebuffer[X][Z]);else n.deleteFramebuffer(w.__webglFramebuffer[X]);w.__webglDepthbuffer&&n.deleteRenderbuffer(w.__webglDepthbuffer[X])}else{if(Array.isArray(w.__webglFramebuffer))for(let X=0;X<w.__webglFramebuffer.length;X++)n.deleteFramebuffer(w.__webglFramebuffer[X]);else n.deleteFramebuffer(w.__webglFramebuffer);if(w.__webglDepthbuffer&&n.deleteRenderbuffer(w.__webglDepthbuffer),w.__webglMultisampledFramebuffer&&n.deleteFramebuffer(w.__webglMultisampledFramebuffer),w.__webglColorRenderbuffer)for(let X=0;X<w.__webglColorRenderbuffer.length;X++)w.__webglColorRenderbuffer[X]&&n.deleteRenderbuffer(w.__webglColorRenderbuffer[X]);w.__webglDepthRenderbuffer&&n.deleteRenderbuffer(w.__webglDepthRenderbuffer)}const V=T.textures;for(let X=0,Z=V.length;X<Z;X++){const j=i.get(V[X]);j.__webglTexture&&(n.deleteTexture(j.__webglTexture),o.memory.textures--),i.remove(V[X])}i.remove(T)}let R=0;function O(){R=0}function F(){const T=R;return T>=r.maxTextures&&Ve("WebGLTextures: Trying to use "+T+" texture units while this GPU supports only "+r.maxTextures),R+=1,T}function G(T){const w=[];return w.push(T.wrapS),w.push(T.wrapT),w.push(T.wrapR||0),w.push(T.magFilter),w.push(T.minFilter),w.push(T.anisotropy),w.push(T.internalFormat),w.push(T.format),w.push(T.type),w.push(T.generateMipmaps),w.push(T.premultiplyAlpha),w.push(T.flipY),w.push(T.unpackAlignment),w.push(T.colorSpace),w.join()}function H(T,w){const V=i.get(T);if(T.isVideoTexture&&Ot(T),T.isRenderTargetTexture===!1&&T.isExternalTexture!==!0&&T.version>0&&V.__version!==T.version){const X=T.image;if(X===null)Ve("WebGLRenderer: Texture marked for update but no image data found.");else if(X.complete===!1)Ve("WebGLRenderer: Texture marked for update but image is incomplete");else{K(V,T,w);return}}else T.isExternalTexture&&(V.__webglTexture=T.sourceTexture?T.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,V.__webglTexture,n.TEXTURE0+w)}function B(T,w){const V=i.get(T);if(T.isRenderTargetTexture===!1&&T.version>0&&V.__version!==T.version){K(V,T,w);return}else T.isExternalTexture&&(V.__webglTexture=T.sourceTexture?T.sourceTexture:null);t.bindTexture(n.TEXTURE_2D_ARRAY,V.__webglTexture,n.TEXTURE0+w)}function W(T,w){const V=i.get(T);if(T.isRenderTargetTexture===!1&&T.version>0&&V.__version!==T.version){K(V,T,w);return}t.bindTexture(n.TEXTURE_3D,V.__webglTexture,n.TEXTURE0+w)}function $(T,w){const V=i.get(T);if(T.version>0&&V.__version!==T.version){Y(V,T,w);return}t.bindTexture(n.TEXTURE_CUBE_MAP,V.__webglTexture,n.TEXTURE0+w)}const Q={[Xf]:n.REPEAT,[Yr]:n.CLAMP_TO_EDGE,[qf]:n.MIRRORED_REPEAT},ee={[xi]:n.NEAREST,[d2]:n.NEAREST_MIPMAP_NEAREST,[Oh]:n.NEAREST_MIPMAP_LINEAR,[Oi]:n.LINEAR,[ap]:n.LINEAR_MIPMAP_NEAREST,[Ao]:n.LINEAR_MIPMAP_LINEAR},me={[v2]:n.NEVER,[y2]:n.ALWAYS,[_2]:n.LESS,[ny]:n.LEQUAL,[g2]:n.EQUAL,[w2]:n.GEQUAL,[b2]:n.GREATER,[x2]:n.NOTEQUAL};function De(T,w){if(w.type===fr&&e.has("OES_texture_float_linear")===!1&&(w.magFilter===Oi||w.magFilter===ap||w.magFilter===Oh||w.magFilter===Ao||w.minFilter===Oi||w.minFilter===ap||w.minFilter===Oh||w.minFilter===Ao)&&Ve("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(T,n.TEXTURE_WRAP_S,Q[w.wrapS]),n.texParameteri(T,n.TEXTURE_WRAP_T,Q[w.wrapT]),(T===n.TEXTURE_3D||T===n.TEXTURE_2D_ARRAY)&&n.texParameteri(T,n.TEXTURE_WRAP_R,Q[w.wrapR]),n.texParameteri(T,n.TEXTURE_MAG_FILTER,ee[w.magFilter]),n.texParameteri(T,n.TEXTURE_MIN_FILTER,ee[w.minFilter]),w.compareFunction&&(n.texParameteri(T,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(T,n.TEXTURE_COMPARE_FUNC,me[w.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(w.magFilter===xi||w.minFilter!==Oh&&w.minFilter!==Ao||w.type===fr&&e.has("OES_texture_float_linear")===!1)return;if(w.anisotropy>1||i.get(w).__currentAnisotropy){const V=e.get("EXT_texture_filter_anisotropic");n.texParameterf(T,V.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(w.anisotropy,r.getMaxAnisotropy())),i.get(w).__currentAnisotropy=w.anisotropy}}}function Je(T,w){let V=!1;T.__webglInit===void 0&&(T.__webglInit=!0,w.addEventListener("dispose",S));const X=w.source;let Z=d.get(X);Z===void 0&&(Z={},d.set(X,Z));const j=G(w);if(j!==T.__cacheKey){Z[j]===void 0&&(Z[j]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,V=!0),Z[j].usedTimes++;const xe=Z[T.__cacheKey];xe!==void 0&&(Z[T.__cacheKey].usedTimes--,xe.usedTimes===0&&x(w)),T.__cacheKey=j,T.__webglTexture=Z[j].texture}return V}function Be(T,w,V){return Math.floor(Math.floor(T/V)/w)}function ze(T,w,V,X){const j=T.updateRanges;if(j.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,w.width,w.height,V,X,w.data);else{j.sort((J,ie)=>J.start-ie.start);let xe=0;for(let J=1;J<j.length;J++){const ie=j[xe],Te=j[J],Me=ie.start+ie.count,de=Be(Te.start,w.width,4),Ie=Be(ie.start,w.width,4);Te.start<=Me+1&&de===Ie&&Be(Te.start+Te.count-1,w.width,4)===de?ie.count=Math.max(ie.count,Te.start+Te.count-ie.start):(++xe,j[xe]=Te)}j.length=xe+1;const ae=n.getParameter(n.UNPACK_ROW_LENGTH),Ce=n.getParameter(n.UNPACK_SKIP_PIXELS),be=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,w.width);for(let J=0,ie=j.length;J<ie;J++){const Te=j[J],Me=Math.floor(Te.start/4),de=Math.ceil(Te.count/4),Ie=Me%w.width,D=Math.floor(Me/w.width),le=de,re=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,Ie),n.pixelStorei(n.UNPACK_SKIP_ROWS,D),t.texSubImage2D(n.TEXTURE_2D,0,Ie,D,le,re,V,X,w.data)}T.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,ae),n.pixelStorei(n.UNPACK_SKIP_PIXELS,Ce),n.pixelStorei(n.UNPACK_SKIP_ROWS,be)}}function K(T,w,V){let X=n.TEXTURE_2D;(w.isDataArrayTexture||w.isCompressedArrayTexture)&&(X=n.TEXTURE_2D_ARRAY),w.isData3DTexture&&(X=n.TEXTURE_3D);const Z=Je(T,w),j=w.source;t.bindTexture(X,T.__webglTexture,n.TEXTURE0+V);const xe=i.get(j);if(j.version!==xe.__version||Z===!0){t.activeTexture(n.TEXTURE0+V);const ae=at.getPrimaries(at.workingColorSpace),Ce=w.colorSpace===ks?null:at.getPrimaries(w.colorSpace),be=w.colorSpace===ks||ae===Ce?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,w.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,w.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,be);let J=v(w.image,!1,r.maxTextureSize);J=Ee(w,J);const ie=s.convert(w.format,w.colorSpace),Te=s.convert(w.type);let Me=b(w.internalFormat,ie,Te,w.colorSpace,w.isVideoTexture);De(X,w);let de;const Ie=w.mipmaps,D=w.isVideoTexture!==!0,le=xe.__version===void 0||Z===!0,re=j.dataReady,se=M(w,J);if(w.isDepthTexture)Me=y(w.format===Oc,w.type),le&&(D?t.texStorage2D(n.TEXTURE_2D,1,Me,J.width,J.height):t.texImage2D(n.TEXTURE_2D,0,Me,J.width,J.height,0,ie,Te,null));else if(w.isDataTexture)if(Ie.length>0){D&&le&&t.texStorage2D(n.TEXTURE_2D,se,Me,Ie[0].width,Ie[0].height);for(let te=0,q=Ie.length;te<q;te++)de=Ie[te],D?re&&t.texSubImage2D(n.TEXTURE_2D,te,0,0,de.width,de.height,ie,Te,de.data):t.texImage2D(n.TEXTURE_2D,te,Me,de.width,de.height,0,ie,Te,de.data);w.generateMipmaps=!1}else D?(le&&t.texStorage2D(n.TEXTURE_2D,se,Me,J.width,J.height),re&&ze(w,J,ie,Te)):t.texImage2D(n.TEXTURE_2D,0,Me,J.width,J.height,0,ie,Te,J.data);else if(w.isCompressedTexture)if(w.isCompressedArrayTexture){D&&le&&t.texStorage3D(n.TEXTURE_2D_ARRAY,se,Me,Ie[0].width,Ie[0].height,J.depth);for(let te=0,q=Ie.length;te<q;te++)if(de=Ie[te],w.format!==Yi)if(ie!==null)if(D){if(re)if(w.layerUpdates.size>0){const ve=zg(de.width,de.height,w.format,w.type);for(const Oe of w.layerUpdates){const Mt=de.data.subarray(Oe*ve/de.data.BYTES_PER_ELEMENT,(Oe+1)*ve/de.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,te,0,0,Oe,de.width,de.height,1,ie,Mt)}w.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,te,0,0,0,de.width,de.height,J.depth,ie,de.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,te,Me,de.width,de.height,J.depth,0,de.data,0,0);else Ve("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else D?re&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,te,0,0,0,de.width,de.height,J.depth,ie,Te,de.data):t.texImage3D(n.TEXTURE_2D_ARRAY,te,Me,de.width,de.height,J.depth,0,ie,Te,de.data)}else{D&&le&&t.texStorage2D(n.TEXTURE_2D,se,Me,Ie[0].width,Ie[0].height);for(let te=0,q=Ie.length;te<q;te++)de=Ie[te],w.format!==Yi?ie!==null?D?re&&t.compressedTexSubImage2D(n.TEXTURE_2D,te,0,0,de.width,de.height,ie,de.data):t.compressedTexImage2D(n.TEXTURE_2D,te,Me,de.width,de.height,0,de.data):Ve("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):D?re&&t.texSubImage2D(n.TEXTURE_2D,te,0,0,de.width,de.height,ie,Te,de.data):t.texImage2D(n.TEXTURE_2D,te,Me,de.width,de.height,0,ie,Te,de.data)}else if(w.isDataArrayTexture)if(D){if(le&&t.texStorage3D(n.TEXTURE_2D_ARRAY,se,Me,J.width,J.height,J.depth),re)if(w.layerUpdates.size>0){const te=zg(J.width,J.height,w.format,w.type);for(const q of w.layerUpdates){const ve=J.data.subarray(q*te/J.data.BYTES_PER_ELEMENT,(q+1)*te/J.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,q,J.width,J.height,1,ie,Te,ve)}w.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,J.width,J.height,J.depth,ie,Te,J.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Me,J.width,J.height,J.depth,0,ie,Te,J.data);else if(w.isData3DTexture)D?(le&&t.texStorage3D(n.TEXTURE_3D,se,Me,J.width,J.height,J.depth),re&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,J.width,J.height,J.depth,ie,Te,J.data)):t.texImage3D(n.TEXTURE_3D,0,Me,J.width,J.height,J.depth,0,ie,Te,J.data);else if(w.isFramebufferTexture){if(le)if(D)t.texStorage2D(n.TEXTURE_2D,se,Me,J.width,J.height);else{let te=J.width,q=J.height;for(let ve=0;ve<se;ve++)t.texImage2D(n.TEXTURE_2D,ve,Me,te,q,0,ie,Te,null),te>>=1,q>>=1}}else if(Ie.length>0){if(D&&le){const te=Fe(Ie[0]);t.texStorage2D(n.TEXTURE_2D,se,Me,te.width,te.height)}for(let te=0,q=Ie.length;te<q;te++)de=Ie[te],D?re&&t.texSubImage2D(n.TEXTURE_2D,te,0,0,ie,Te,de):t.texImage2D(n.TEXTURE_2D,te,Me,ie,Te,de);w.generateMipmaps=!1}else if(D){if(le){const te=Fe(J);t.texStorage2D(n.TEXTURE_2D,se,Me,te.width,te.height)}re&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,ie,Te,J)}else t.texImage2D(n.TEXTURE_2D,0,Me,ie,Te,J);m(w)&&f(X),xe.__version=j.version,w.onUpdate&&w.onUpdate(w)}T.__version=w.version}function Y(T,w,V){if(w.image.length!==6)return;const X=Je(T,w),Z=w.source;t.bindTexture(n.TEXTURE_CUBE_MAP,T.__webglTexture,n.TEXTURE0+V);const j=i.get(Z);if(Z.version!==j.__version||X===!0){t.activeTexture(n.TEXTURE0+V);const xe=at.getPrimaries(at.workingColorSpace),ae=w.colorSpace===ks?null:at.getPrimaries(w.colorSpace),Ce=w.colorSpace===ks||xe===ae?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,w.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,w.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ce);const be=w.isCompressedTexture||w.image[0].isCompressedTexture,J=w.image[0]&&w.image[0].isDataTexture,ie=[];for(let q=0;q<6;q++)!be&&!J?ie[q]=v(w.image[q],!0,r.maxCubemapSize):ie[q]=J?w.image[q].image:w.image[q],ie[q]=Ee(w,ie[q]);const Te=ie[0],Me=s.convert(w.format,w.colorSpace),de=s.convert(w.type),Ie=b(w.internalFormat,Me,de,w.colorSpace),D=w.isVideoTexture!==!0,le=j.__version===void 0||X===!0,re=Z.dataReady;let se=M(w,Te);De(n.TEXTURE_CUBE_MAP,w);let te;if(be){D&&le&&t.texStorage2D(n.TEXTURE_CUBE_MAP,se,Ie,Te.width,Te.height);for(let q=0;q<6;q++){te=ie[q].mipmaps;for(let ve=0;ve<te.length;ve++){const Oe=te[ve];w.format!==Yi?Me!==null?D?re&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,ve,0,0,Oe.width,Oe.height,Me,Oe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,ve,Ie,Oe.width,Oe.height,0,Oe.data):Ve("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):D?re&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,ve,0,0,Oe.width,Oe.height,Me,de,Oe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,ve,Ie,Oe.width,Oe.height,0,Me,de,Oe.data)}}}else{if(te=w.mipmaps,D&&le){te.length>0&&se++;const q=Fe(ie[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,se,Ie,q.width,q.height)}for(let q=0;q<6;q++)if(J){D?re&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,0,0,0,ie[q].width,ie[q].height,Me,de,ie[q].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,0,Ie,ie[q].width,ie[q].height,0,Me,de,ie[q].data);for(let ve=0;ve<te.length;ve++){const Mt=te[ve].image[q].image;D?re&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,ve+1,0,0,Mt.width,Mt.height,Me,de,Mt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,ve+1,Ie,Mt.width,Mt.height,0,Me,de,Mt.data)}}else{D?re&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,0,0,0,Me,de,ie[q]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,0,Ie,Me,de,ie[q]);for(let ve=0;ve<te.length;ve++){const Oe=te[ve];D?re&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,ve+1,0,0,Me,de,Oe.image[q]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+q,ve+1,Ie,Me,de,Oe.image[q])}}}m(w)&&f(n.TEXTURE_CUBE_MAP),j.__version=Z.version,w.onUpdate&&w.onUpdate(w)}T.__version=w.version}function pe(T,w,V,X,Z,j){const xe=s.convert(V.format,V.colorSpace),ae=s.convert(V.type),Ce=b(V.internalFormat,xe,ae,V.colorSpace),be=i.get(w),J=i.get(V);if(J.__renderTarget=w,!be.__hasExternalTextures){const ie=Math.max(1,w.width>>j),Te=Math.max(1,w.height>>j);Z===n.TEXTURE_3D||Z===n.TEXTURE_2D_ARRAY?t.texImage3D(Z,j,Ce,ie,Te,w.depth,0,xe,ae,null):t.texImage2D(Z,j,Ce,ie,Te,0,xe,ae,null)}t.bindFramebuffer(n.FRAMEBUFFER,T),ge(w)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,X,Z,J.__webglTexture,0,Ct(w)):(Z===n.TEXTURE_2D||Z>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Z<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,X,Z,J.__webglTexture,j),t.bindFramebuffer(n.FRAMEBUFFER,null)}function ke(T,w,V){if(n.bindRenderbuffer(n.RENDERBUFFER,T),w.depthBuffer){const X=w.depthTexture,Z=X&&X.isDepthTexture?X.type:null,j=y(w.stencilBuffer,Z),xe=w.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ae=Ct(w);ge(w)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ae,j,w.width,w.height):V?n.renderbufferStorageMultisample(n.RENDERBUFFER,ae,j,w.width,w.height):n.renderbufferStorage(n.RENDERBUFFER,j,w.width,w.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,xe,n.RENDERBUFFER,T)}else{const X=w.textures;for(let Z=0;Z<X.length;Z++){const j=X[Z],xe=s.convert(j.format,j.colorSpace),ae=s.convert(j.type),Ce=b(j.internalFormat,xe,ae,j.colorSpace),be=Ct(w);V&&ge(w)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,be,Ce,w.width,w.height):ge(w)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,be,Ce,w.width,w.height):n.renderbufferStorage(n.RENDERBUFFER,Ce,w.width,w.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function we(T,w){if(w&&w.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,T),!(w.depthTexture&&w.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const X=i.get(w.depthTexture);X.__renderTarget=w,(!X.__webglTexture||w.depthTexture.image.width!==w.width||w.depthTexture.image.height!==w.height)&&(w.depthTexture.image.width=w.width,w.depthTexture.image.height=w.height,w.depthTexture.needsUpdate=!0),H(w.depthTexture,0);const Z=X.__webglTexture,j=Ct(w);if(w.depthTexture.format===Ic)ge(w)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Z,0,j):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Z,0);else if(w.depthTexture.format===Oc)ge(w)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Z,0,j):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Z,0);else throw new Error("Unknown depthTexture format")}function Qe(T){const w=i.get(T),V=T.isWebGLCubeRenderTarget===!0;if(w.__boundDepthTexture!==T.depthTexture){const X=T.depthTexture;if(w.__depthDisposeCallback&&w.__depthDisposeCallback(),X){const Z=()=>{delete w.__boundDepthTexture,delete w.__depthDisposeCallback,X.removeEventListener("dispose",Z)};X.addEventListener("dispose",Z),w.__depthDisposeCallback=Z}w.__boundDepthTexture=X}if(T.depthTexture&&!w.__autoAllocateDepthBuffer){if(V)throw new Error("target.depthTexture not supported in Cube render targets");const X=T.texture.mipmaps;X&&X.length>0?we(w.__webglFramebuffer[0],T):we(w.__webglFramebuffer,T)}else if(V){w.__webglDepthbuffer=[];for(let X=0;X<6;X++)if(t.bindFramebuffer(n.FRAMEBUFFER,w.__webglFramebuffer[X]),w.__webglDepthbuffer[X]===void 0)w.__webglDepthbuffer[X]=n.createRenderbuffer(),ke(w.__webglDepthbuffer[X],T,!1);else{const Z=T.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,j=w.__webglDepthbuffer[X];n.bindRenderbuffer(n.RENDERBUFFER,j),n.framebufferRenderbuffer(n.FRAMEBUFFER,Z,n.RENDERBUFFER,j)}}else{const X=T.texture.mipmaps;if(X&&X.length>0?t.bindFramebuffer(n.FRAMEBUFFER,w.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,w.__webglFramebuffer),w.__webglDepthbuffer===void 0)w.__webglDepthbuffer=n.createRenderbuffer(),ke(w.__webglDepthbuffer,T,!1);else{const Z=T.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,j=w.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,j),n.framebufferRenderbuffer(n.FRAMEBUFFER,Z,n.RENDERBUFFER,j)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function yn(T,w,V){const X=i.get(T);w!==void 0&&pe(X.__webglFramebuffer,T,T.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),V!==void 0&&Qe(T)}function qe(T){const w=T.texture,V=i.get(T),X=i.get(w);T.addEventListener("dispose",P);const Z=T.textures,j=T.isWebGLCubeRenderTarget===!0,xe=Z.length>1;if(xe||(X.__webglTexture===void 0&&(X.__webglTexture=n.createTexture()),X.__version=w.version,o.memory.textures++),j){V.__webglFramebuffer=[];for(let ae=0;ae<6;ae++)if(w.mipmaps&&w.mipmaps.length>0){V.__webglFramebuffer[ae]=[];for(let Ce=0;Ce<w.mipmaps.length;Ce++)V.__webglFramebuffer[ae][Ce]=n.createFramebuffer()}else V.__webglFramebuffer[ae]=n.createFramebuffer()}else{if(w.mipmaps&&w.mipmaps.length>0){V.__webglFramebuffer=[];for(let ae=0;ae<w.mipmaps.length;ae++)V.__webglFramebuffer[ae]=n.createFramebuffer()}else V.__webglFramebuffer=n.createFramebuffer();if(xe)for(let ae=0,Ce=Z.length;ae<Ce;ae++){const be=i.get(Z[ae]);be.__webglTexture===void 0&&(be.__webglTexture=n.createTexture(),o.memory.textures++)}if(T.samples>0&&ge(T)===!1){V.__webglMultisampledFramebuffer=n.createFramebuffer(),V.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,V.__webglMultisampledFramebuffer);for(let ae=0;ae<Z.length;ae++){const Ce=Z[ae];V.__webglColorRenderbuffer[ae]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,V.__webglColorRenderbuffer[ae]);const be=s.convert(Ce.format,Ce.colorSpace),J=s.convert(Ce.type),ie=b(Ce.internalFormat,be,J,Ce.colorSpace,T.isXRRenderTarget===!0),Te=Ct(T);n.renderbufferStorageMultisample(n.RENDERBUFFER,Te,ie,T.width,T.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ae,n.RENDERBUFFER,V.__webglColorRenderbuffer[ae])}n.bindRenderbuffer(n.RENDERBUFFER,null),T.depthBuffer&&(V.__webglDepthRenderbuffer=n.createRenderbuffer(),ke(V.__webglDepthRenderbuffer,T,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(j){t.bindTexture(n.TEXTURE_CUBE_MAP,X.__webglTexture),De(n.TEXTURE_CUBE_MAP,w);for(let ae=0;ae<6;ae++)if(w.mipmaps&&w.mipmaps.length>0)for(let Ce=0;Ce<w.mipmaps.length;Ce++)pe(V.__webglFramebuffer[ae][Ce],T,w,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,Ce);else pe(V.__webglFramebuffer[ae],T,w,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0);m(w)&&f(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(xe){for(let ae=0,Ce=Z.length;ae<Ce;ae++){const be=Z[ae],J=i.get(be);let ie=n.TEXTURE_2D;(T.isWebGL3DRenderTarget||T.isWebGLArrayRenderTarget)&&(ie=T.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(ie,J.__webglTexture),De(ie,be),pe(V.__webglFramebuffer,T,be,n.COLOR_ATTACHMENT0+ae,ie,0),m(be)&&f(ie)}t.unbindTexture()}else{let ae=n.TEXTURE_2D;if((T.isWebGL3DRenderTarget||T.isWebGLArrayRenderTarget)&&(ae=T.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(ae,X.__webglTexture),De(ae,w),w.mipmaps&&w.mipmaps.length>0)for(let Ce=0;Ce<w.mipmaps.length;Ce++)pe(V.__webglFramebuffer[Ce],T,w,n.COLOR_ATTACHMENT0,ae,Ce);else pe(V.__webglFramebuffer,T,w,n.COLOR_ATTACHMENT0,ae,0);m(w)&&f(ae),t.unbindTexture()}T.depthBuffer&&Qe(T)}function Rt(T){const w=T.textures;for(let V=0,X=w.length;V<X;V++){const Z=w[V];if(m(Z)){const j=g(T),xe=i.get(Z).__webglTexture;t.bindTexture(j,xe),f(j),t.unbindTexture()}}}const L=[],et=[];function tt(T){if(T.samples>0){if(ge(T)===!1){const w=T.textures,V=T.width,X=T.height;let Z=n.COLOR_BUFFER_BIT;const j=T.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,xe=i.get(T),ae=w.length>1;if(ae)for(let be=0;be<w.length;be++)t.bindFramebuffer(n.FRAMEBUFFER,xe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+be,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,xe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+be,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,xe.__webglMultisampledFramebuffer);const Ce=T.texture.mipmaps;Ce&&Ce.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,xe.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,xe.__webglFramebuffer);for(let be=0;be<w.length;be++){if(T.resolveDepthBuffer&&(T.depthBuffer&&(Z|=n.DEPTH_BUFFER_BIT),T.stencilBuffer&&T.resolveStencilBuffer&&(Z|=n.STENCIL_BUFFER_BIT)),ae){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,xe.__webglColorRenderbuffer[be]);const J=i.get(w[be]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,J,0)}n.blitFramebuffer(0,0,V,X,0,0,V,X,Z,n.NEAREST),l===!0&&(L.length=0,et.length=0,L.push(n.COLOR_ATTACHMENT0+be),T.depthBuffer&&T.resolveDepthBuffer===!1&&(L.push(j),et.push(j),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,et)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,L))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),ae)for(let be=0;be<w.length;be++){t.bindFramebuffer(n.FRAMEBUFFER,xe.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+be,n.RENDERBUFFER,xe.__webglColorRenderbuffer[be]);const J=i.get(w[be]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,xe.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+be,n.TEXTURE_2D,J,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,xe.__webglMultisampledFramebuffer)}else if(T.depthBuffer&&T.resolveDepthBuffer===!1&&l){const w=T.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[w])}}}function Ct(T){return Math.min(r.maxSamples,T.samples)}function ge(T){const w=i.get(T);return T.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&w.__useRenderToTexture!==!1}function Ot(T){const w=o.render.frame;h.get(T)!==w&&(h.set(T,w),T.update())}function Ee(T,w){const V=T.colorSpace,X=T.format,Z=T.type;return T.isCompressedTexture===!0||T.isVideoTexture===!0||V!==ml&&V!==ks&&(at.getTransfer(V)===mt?(X!==Yi||Z!==Cr)&&Ve("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):en("WebGLTextures: Unsupported texture color space:",V)),w}function Fe(T){return typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement?(c.width=T.naturalWidth||T.width,c.height=T.naturalHeight||T.height):typeof VideoFrame<"u"&&T instanceof VideoFrame?(c.width=T.displayWidth,c.height=T.displayHeight):(c.width=T.width,c.height=T.height),c}this.allocateTextureUnit=F,this.resetTextureUnits=O,this.setTexture2D=H,this.setTexture2DArray=B,this.setTexture3D=W,this.setTextureCube=$,this.rebindTextures=yn,this.setupRenderTarget=qe,this.updateRenderTargetMipmap=Rt,this.updateMultisampleRenderTarget=tt,this.setupDepthRenderbuffer=Qe,this.setupFrameBufferTexture=pe,this.useMultisampledRTT=ge}function jR(n,e){function t(i,r=ks){let s;const o=at.getTransfer(r);if(i===Cr)return n.UNSIGNED_BYTE;if(i===x0)return n.UNSIGNED_SHORT_4_4_4_4;if(i===w0)return n.UNSIGNED_SHORT_5_5_5_1;if(i===Jw)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===Qw)return n.UNSIGNED_INT_10F_11F_11F_REV;if(i===Yw)return n.BYTE;if(i===Zw)return n.SHORT;if(i===Dc)return n.UNSIGNED_SHORT;if(i===b0)return n.INT;if(i===Bo)return n.UNSIGNED_INT;if(i===fr)return n.FLOAT;if(i===Ll)return n.HALF_FLOAT;if(i===ey)return n.ALPHA;if(i===ty)return n.RGB;if(i===Yi)return n.RGBA;if(i===Ic)return n.DEPTH_COMPONENT;if(i===Oc)return n.DEPTH_STENCIL;if(i===y0)return n.RED;if(i===E0)return n.RED_INTEGER;if(i===C0)return n.RG;if(i===S0)return n.RG_INTEGER;if(i===M0)return n.RGBA_INTEGER;if(i===_u||i===gu||i===bu||i===xu)if(o===mt)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===_u)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===gu)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===bu)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===xu)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===_u)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===gu)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===bu)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===xu)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Yf||i===Zf||i===Jf||i===Qf)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===Yf)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Zf)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Jf)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Qf)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===em||i===tm||i===nm)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===em||i===tm)return o===mt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===nm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===im||i===rm||i===sm||i===om||i===am||i===lm||i===cm||i===hm||i===um||i===dm||i===pm||i===fm||i===mm||i===vm)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===im)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===rm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===sm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===om)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===am)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===lm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===cm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===hm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===um)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===dm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===pm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===fm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===mm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===vm)return o===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===_m||i===gm||i===bm)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===_m)return o===mt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===gm)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===bm)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===xm||i===wm||i===ym||i===Em)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===xm)return s.COMPRESSED_RED_RGTC1_EXT;if(i===wm)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===ym)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===Em)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===kc?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const WR=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,KR=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class XR{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const i=new vy(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new ss({vertexShader:WR,fragmentShader:KR,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new jt(new os(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class qR extends na{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,h=null,u=null,d=null,p=null,_=null;const v=typeof XRWebGLBinding<"u",m=new XR,f={},g=t.getContextAttributes();let b=null,y=null;const M=[],S=[],P=new Ne;let A=null;const x=new di;x.viewport=new bt;const E=new di;E.viewport=new bt;const R=[x,E],O=new pP;let F=null,G=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let Y=M[K];return Y===void 0&&(Y=new Ap,M[K]=Y),Y.getTargetRaySpace()},this.getControllerGrip=function(K){let Y=M[K];return Y===void 0&&(Y=new Ap,M[K]=Y),Y.getGripSpace()},this.getHand=function(K){let Y=M[K];return Y===void 0&&(Y=new Ap,M[K]=Y),Y.getHandSpace()};function H(K){const Y=S.indexOf(K.inputSource);if(Y===-1)return;const pe=M[Y];pe!==void 0&&(pe.update(K.inputSource,K.frame,c||o),pe.dispatchEvent({type:K.type,data:K.inputSource}))}function B(){r.removeEventListener("select",H),r.removeEventListener("selectstart",H),r.removeEventListener("selectend",H),r.removeEventListener("squeeze",H),r.removeEventListener("squeezestart",H),r.removeEventListener("squeezeend",H),r.removeEventListener("end",B),r.removeEventListener("inputsourceschange",W);for(let K=0;K<M.length;K++){const Y=S[K];Y!==null&&(S[K]=null,M[K].disconnect(Y))}F=null,G=null,m.reset();for(const K in f)delete f[K];e.setRenderTarget(b),p=null,d=null,u=null,r=null,y=null,ze.stop(),i.isPresenting=!1,e.setPixelRatio(A),e.setSize(P.width,P.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(K){s=K,i.isPresenting===!0&&Ve("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){a=K,i.isPresenting===!0&&Ve("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(K){c=K},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return u===null&&v&&(u=new XRWebGLBinding(r,t)),u},this.getFrame=function(){return _},this.getSession=function(){return r},this.setSession=async function(K){if(r=K,r!==null){if(b=e.getRenderTarget(),r.addEventListener("select",H),r.addEventListener("selectstart",H),r.addEventListener("selectend",H),r.addEventListener("squeeze",H),r.addEventListener("squeezestart",H),r.addEventListener("squeezeend",H),r.addEventListener("end",B),r.addEventListener("inputsourceschange",W),g.xrCompatible!==!0&&await t.makeXRCompatible(),A=e.getPixelRatio(),e.getSize(P),v&&"createProjectionLayer"in XRWebGLBinding.prototype){let pe=null,ke=null,we=null;g.depth&&(we=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,pe=g.stencil?Oc:Ic,ke=g.stencil?kc:Bo);const Qe={colorFormat:t.RGBA8,depthFormat:we,scaleFactor:s};u=this.getBinding(),d=u.createProjectionLayer(Qe),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),y=new $o(d.textureWidth,d.textureHeight,{format:Yi,type:Cr,depthTexture:new my(d.textureWidth,d.textureHeight,ke,void 0,void 0,void 0,void 0,void 0,void 0,pe),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const pe={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(r,t,pe),r.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),y=new $o(p.framebufferWidth,p.framebufferHeight,{format:Yi,type:Cr,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),ze.setContext(r),ze.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};function W(K){for(let Y=0;Y<K.removed.length;Y++){const pe=K.removed[Y],ke=S.indexOf(pe);ke>=0&&(S[ke]=null,M[ke].disconnect(pe))}for(let Y=0;Y<K.added.length;Y++){const pe=K.added[Y];let ke=S.indexOf(pe);if(ke===-1){for(let Qe=0;Qe<M.length;Qe++)if(Qe>=S.length){S.push(pe),ke=Qe;break}else if(S[Qe]===null){S[Qe]=pe,ke=Qe;break}if(ke===-1)break}const we=M[ke];we&&we.connect(pe)}}const $=new k,Q=new k;function ee(K,Y,pe){$.setFromMatrixPosition(Y.matrixWorld),Q.setFromMatrixPosition(pe.matrixWorld);const ke=$.distanceTo(Q),we=Y.projectionMatrix.elements,Qe=pe.projectionMatrix.elements,yn=we[14]/(we[10]-1),qe=we[14]/(we[10]+1),Rt=(we[9]+1)/we[5],L=(we[9]-1)/we[5],et=(we[8]-1)/we[0],tt=(Qe[8]+1)/Qe[0],Ct=yn*et,ge=yn*tt,Ot=ke/(-et+tt),Ee=Ot*-et;if(Y.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(Ee),K.translateZ(Ot),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert(),we[10]===-1)K.projectionMatrix.copy(Y.projectionMatrix),K.projectionMatrixInverse.copy(Y.projectionMatrixInverse);else{const Fe=yn+Ot,T=qe+Ot,w=Ct-Ee,V=ge+(ke-Ee),X=Rt*qe/T*Fe,Z=L*qe/T*Fe;K.projectionMatrix.makePerspective(w,V,X,Z,Fe,T),K.projectionMatrixInverse.copy(K.projectionMatrix).invert()}}function me(K,Y){Y===null?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices(Y.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(r===null)return;let Y=K.near,pe=K.far;m.texture!==null&&(m.depthNear>0&&(Y=m.depthNear),m.depthFar>0&&(pe=m.depthFar)),O.near=E.near=x.near=Y,O.far=E.far=x.far=pe,(F!==O.near||G!==O.far)&&(r.updateRenderState({depthNear:O.near,depthFar:O.far}),F=O.near,G=O.far),O.layers.mask=K.layers.mask|6,x.layers.mask=O.layers.mask&3,E.layers.mask=O.layers.mask&5;const ke=K.parent,we=O.cameras;me(O,ke);for(let Qe=0;Qe<we.length;Qe++)me(we[Qe],ke);we.length===2?ee(O,x,E):O.projectionMatrix.copy(x.projectionMatrix),De(K,O,ke)};function De(K,Y,pe){pe===null?K.matrix.copy(Y.matrixWorld):(K.matrix.copy(pe.matrixWorld),K.matrix.invert(),K.matrix.multiply(Y.matrixWorld)),K.matrix.decompose(K.position,K.quaternion,K.scale),K.updateMatrixWorld(!0),K.projectionMatrix.copy(Y.projectionMatrix),K.projectionMatrixInverse.copy(Y.projectionMatrixInverse),K.isPerspectiveCamera&&(K.fov=Cm*2*Math.atan(1/K.projectionMatrix.elements[5]),K.zoom=1)}this.getCamera=function(){return O},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(K){l=K,d!==null&&(d.fixedFoveation=K),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=K)},this.hasDepthSensing=function(){return m.texture!==null},this.getDepthSensingMesh=function(){return m.getMesh(O)},this.getCameraTexture=function(K){return f[K]};let Je=null;function Be(K,Y){if(h=Y.getViewerPose(c||o),_=Y,h!==null){const pe=h.views;p!==null&&(e.setRenderTargetFramebuffer(y,p.framebuffer),e.setRenderTarget(y));let ke=!1;pe.length!==O.cameras.length&&(O.cameras.length=0,ke=!0);for(let qe=0;qe<pe.length;qe++){const Rt=pe[qe];let L=null;if(p!==null)L=p.getViewport(Rt);else{const tt=u.getViewSubImage(d,Rt);L=tt.viewport,qe===0&&(e.setRenderTargetTextures(y,tt.colorTexture,tt.depthStencilTexture),e.setRenderTarget(y))}let et=R[qe];et===void 0&&(et=new di,et.layers.enable(qe),et.viewport=new bt,R[qe]=et),et.matrix.fromArray(Rt.transform.matrix),et.matrix.decompose(et.position,et.quaternion,et.scale),et.projectionMatrix.fromArray(Rt.projectionMatrix),et.projectionMatrixInverse.copy(et.projectionMatrix).invert(),et.viewport.set(L.x,L.y,L.width,L.height),qe===0&&(O.matrix.copy(et.matrix),O.matrix.decompose(O.position,O.quaternion,O.scale)),ke===!0&&O.cameras.push(et)}const we=r.enabledFeatures;if(we&&we.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&v){u=i.getBinding();const qe=u.getDepthInformation(pe[0]);qe&&qe.isValid&&qe.texture&&m.init(qe,r.renderState)}if(we&&we.includes("camera-access")&&v){e.state.unbindTexture(),u=i.getBinding();for(let qe=0;qe<pe.length;qe++){const Rt=pe[qe].camera;if(Rt){let L=f[Rt];L||(L=new vy,f[Rt]=L);const et=u.getCameraImage(Rt);L.sourceTexture=et}}}}for(let pe=0;pe<M.length;pe++){const ke=S[pe],we=M[pe];ke!==null&&we!==void 0&&we.update(ke,Y,c||o)}Je&&Je(K,Y),Y.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Y}),_=null}const ze=new gy;ze.setAnimationLoop(Be),this.setAnimationLoop=function(K){Je=K},this.dispose=function(){}}}const fo=new er,YR=new At;function ZR(n,e){function t(m,f){m.matrixAutoUpdate===!0&&m.updateMatrix(),f.value.copy(m.matrix)}function i(m,f){f.color.getRGB(m.fogColor.value,hy(n)),f.isFog?(m.fogNear.value=f.near,m.fogFar.value=f.far):f.isFogExp2&&(m.fogDensity.value=f.density)}function r(m,f,g,b,y){f.isMeshBasicMaterial||f.isMeshLambertMaterial?s(m,f):f.isMeshToonMaterial?(s(m,f),u(m,f)):f.isMeshPhongMaterial?(s(m,f),h(m,f)):f.isMeshStandardMaterial?(s(m,f),d(m,f),f.isMeshPhysicalMaterial&&p(m,f,y)):f.isMeshMatcapMaterial?(s(m,f),_(m,f)):f.isMeshDepthMaterial?s(m,f):f.isMeshDistanceMaterial?(s(m,f),v(m,f)):f.isMeshNormalMaterial?s(m,f):f.isLineBasicMaterial?(o(m,f),f.isLineDashedMaterial&&a(m,f)):f.isPointsMaterial?l(m,f,g,b):f.isSpriteMaterial?c(m,f):f.isShadowMaterial?(m.color.value.copy(f.color),m.opacity.value=f.opacity):f.isShaderMaterial&&(f.uniformsNeedUpdate=!1)}function s(m,f){m.opacity.value=f.opacity,f.color&&m.diffuse.value.copy(f.color),f.emissive&&m.emissive.value.copy(f.emissive).multiplyScalar(f.emissiveIntensity),f.map&&(m.map.value=f.map,t(f.map,m.mapTransform)),f.alphaMap&&(m.alphaMap.value=f.alphaMap,t(f.alphaMap,m.alphaMapTransform)),f.bumpMap&&(m.bumpMap.value=f.bumpMap,t(f.bumpMap,m.bumpMapTransform),m.bumpScale.value=f.bumpScale,f.side===$n&&(m.bumpScale.value*=-1)),f.normalMap&&(m.normalMap.value=f.normalMap,t(f.normalMap,m.normalMapTransform),m.normalScale.value.copy(f.normalScale),f.side===$n&&m.normalScale.value.negate()),f.displacementMap&&(m.displacementMap.value=f.displacementMap,t(f.displacementMap,m.displacementMapTransform),m.displacementScale.value=f.displacementScale,m.displacementBias.value=f.displacementBias),f.emissiveMap&&(m.emissiveMap.value=f.emissiveMap,t(f.emissiveMap,m.emissiveMapTransform)),f.specularMap&&(m.specularMap.value=f.specularMap,t(f.specularMap,m.specularMapTransform)),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest);const g=e.get(f),b=g.envMap,y=g.envMapRotation;b&&(m.envMap.value=b,fo.copy(y),fo.x*=-1,fo.y*=-1,fo.z*=-1,b.isCubeTexture&&b.isRenderTargetTexture===!1&&(fo.y*=-1,fo.z*=-1),m.envMapRotation.value.setFromMatrix4(YR.makeRotationFromEuler(fo)),m.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=f.reflectivity,m.ior.value=f.ior,m.refractionRatio.value=f.refractionRatio),f.lightMap&&(m.lightMap.value=f.lightMap,m.lightMapIntensity.value=f.lightMapIntensity,t(f.lightMap,m.lightMapTransform)),f.aoMap&&(m.aoMap.value=f.aoMap,m.aoMapIntensity.value=f.aoMapIntensity,t(f.aoMap,m.aoMapTransform))}function o(m,f){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,f.map&&(m.map.value=f.map,t(f.map,m.mapTransform))}function a(m,f){m.dashSize.value=f.dashSize,m.totalSize.value=f.dashSize+f.gapSize,m.scale.value=f.scale}function l(m,f,g,b){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,m.size.value=f.size*g,m.scale.value=b*.5,f.map&&(m.map.value=f.map,t(f.map,m.uvTransform)),f.alphaMap&&(m.alphaMap.value=f.alphaMap,t(f.alphaMap,m.alphaMapTransform)),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest)}function c(m,f){m.diffuse.value.copy(f.color),m.opacity.value=f.opacity,m.rotation.value=f.rotation,f.map&&(m.map.value=f.map,t(f.map,m.mapTransform)),f.alphaMap&&(m.alphaMap.value=f.alphaMap,t(f.alphaMap,m.alphaMapTransform)),f.alphaTest>0&&(m.alphaTest.value=f.alphaTest)}function h(m,f){m.specular.value.copy(f.specular),m.shininess.value=Math.max(f.shininess,1e-4)}function u(m,f){f.gradientMap&&(m.gradientMap.value=f.gradientMap)}function d(m,f){m.metalness.value=f.metalness,f.metalnessMap&&(m.metalnessMap.value=f.metalnessMap,t(f.metalnessMap,m.metalnessMapTransform)),m.roughness.value=f.roughness,f.roughnessMap&&(m.roughnessMap.value=f.roughnessMap,t(f.roughnessMap,m.roughnessMapTransform)),f.envMap&&(m.envMapIntensity.value=f.envMapIntensity)}function p(m,f,g){m.ior.value=f.ior,f.sheen>0&&(m.sheenColor.value.copy(f.sheenColor).multiplyScalar(f.sheen),m.sheenRoughness.value=f.sheenRoughness,f.sheenColorMap&&(m.sheenColorMap.value=f.sheenColorMap,t(f.sheenColorMap,m.sheenColorMapTransform)),f.sheenRoughnessMap&&(m.sheenRoughnessMap.value=f.sheenRoughnessMap,t(f.sheenRoughnessMap,m.sheenRoughnessMapTransform))),f.clearcoat>0&&(m.clearcoat.value=f.clearcoat,m.clearcoatRoughness.value=f.clearcoatRoughness,f.clearcoatMap&&(m.clearcoatMap.value=f.clearcoatMap,t(f.clearcoatMap,m.clearcoatMapTransform)),f.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=f.clearcoatRoughnessMap,t(f.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),f.clearcoatNormalMap&&(m.clearcoatNormalMap.value=f.clearcoatNormalMap,t(f.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(f.clearcoatNormalScale),f.side===$n&&m.clearcoatNormalScale.value.negate())),f.dispersion>0&&(m.dispersion.value=f.dispersion),f.iridescence>0&&(m.iridescence.value=f.iridescence,m.iridescenceIOR.value=f.iridescenceIOR,m.iridescenceThicknessMinimum.value=f.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=f.iridescenceThicknessRange[1],f.iridescenceMap&&(m.iridescenceMap.value=f.iridescenceMap,t(f.iridescenceMap,m.iridescenceMapTransform)),f.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=f.iridescenceThicknessMap,t(f.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),f.transmission>0&&(m.transmission.value=f.transmission,m.transmissionSamplerMap.value=g.texture,m.transmissionSamplerSize.value.set(g.width,g.height),f.transmissionMap&&(m.transmissionMap.value=f.transmissionMap,t(f.transmissionMap,m.transmissionMapTransform)),m.thickness.value=f.thickness,f.thicknessMap&&(m.thicknessMap.value=f.thicknessMap,t(f.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=f.attenuationDistance,m.attenuationColor.value.copy(f.attenuationColor)),f.anisotropy>0&&(m.anisotropyVector.value.set(f.anisotropy*Math.cos(f.anisotropyRotation),f.anisotropy*Math.sin(f.anisotropyRotation)),f.anisotropyMap&&(m.anisotropyMap.value=f.anisotropyMap,t(f.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=f.specularIntensity,m.specularColor.value.copy(f.specularColor),f.specularColorMap&&(m.specularColorMap.value=f.specularColorMap,t(f.specularColorMap,m.specularColorMapTransform)),f.specularIntensityMap&&(m.specularIntensityMap.value=f.specularIntensityMap,t(f.specularIntensityMap,m.specularIntensityMapTransform))}function _(m,f){f.matcap&&(m.matcap.value=f.matcap)}function v(m,f){const g=e.get(f).light;m.referencePosition.value.setFromMatrixPosition(g.matrixWorld),m.nearDistance.value=g.shadow.camera.near,m.farDistance.value=g.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function JR(n,e,t,i){let r={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(g,b){const y=b.program;i.uniformBlockBinding(g,y)}function c(g,b){let y=r[g.id];y===void 0&&(_(g),y=h(g),r[g.id]=y,g.addEventListener("dispose",m));const M=b.program;i.updateUBOMapping(g,M);const S=e.render.frame;s[g.id]!==S&&(d(g),s[g.id]=S)}function h(g){const b=u();g.__bindingPointIndex=b;const y=n.createBuffer(),M=g.__size,S=g.usage;return n.bindBuffer(n.UNIFORM_BUFFER,y),n.bufferData(n.UNIFORM_BUFFER,M,S),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,b,y),y}function u(){for(let g=0;g<a;g++)if(o.indexOf(g)===-1)return o.push(g),g;return en("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(g){const b=r[g.id],y=g.uniforms,M=g.__cache;n.bindBuffer(n.UNIFORM_BUFFER,b);for(let S=0,P=y.length;S<P;S++){const A=Array.isArray(y[S])?y[S]:[y[S]];for(let x=0,E=A.length;x<E;x++){const R=A[x];if(p(R,S,x,M)===!0){const O=R.__offset,F=Array.isArray(R.value)?R.value:[R.value];let G=0;for(let H=0;H<F.length;H++){const B=F[H],W=v(B);typeof B=="number"||typeof B=="boolean"?(R.__data[0]=B,n.bufferSubData(n.UNIFORM_BUFFER,O+G,R.__data)):B.isMatrix3?(R.__data[0]=B.elements[0],R.__data[1]=B.elements[1],R.__data[2]=B.elements[2],R.__data[3]=0,R.__data[4]=B.elements[3],R.__data[5]=B.elements[4],R.__data[6]=B.elements[5],R.__data[7]=0,R.__data[8]=B.elements[6],R.__data[9]=B.elements[7],R.__data[10]=B.elements[8],R.__data[11]=0):(B.toArray(R.__data,G),G+=W.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,O,R.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function p(g,b,y,M){const S=g.value,P=b+"_"+y;if(M[P]===void 0)return typeof S=="number"||typeof S=="boolean"?M[P]=S:M[P]=S.clone(),!0;{const A=M[P];if(typeof S=="number"||typeof S=="boolean"){if(A!==S)return M[P]=S,!0}else if(A.equals(S)===!1)return A.copy(S),!0}return!1}function _(g){const b=g.uniforms;let y=0;const M=16;for(let P=0,A=b.length;P<A;P++){const x=Array.isArray(b[P])?b[P]:[b[P]];for(let E=0,R=x.length;E<R;E++){const O=x[E],F=Array.isArray(O.value)?O.value:[O.value];for(let G=0,H=F.length;G<H;G++){const B=F[G],W=v(B),$=y%M,Q=$%W.boundary,ee=$+Q;y+=Q,ee!==0&&M-ee<W.storage&&(y+=M-ee),O.__data=new Float32Array(W.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=y,y+=W.storage}}}const S=y%M;return S>0&&(y+=M-S),g.__size=y,g.__cache={},this}function v(g){const b={boundary:0,storage:0};return typeof g=="number"||typeof g=="boolean"?(b.boundary=4,b.storage=4):g.isVector2?(b.boundary=8,b.storage=8):g.isVector3||g.isColor?(b.boundary=16,b.storage=12):g.isVector4?(b.boundary=16,b.storage=16):g.isMatrix3?(b.boundary=48,b.storage=48):g.isMatrix4?(b.boundary=64,b.storage=64):g.isTexture?Ve("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Ve("WebGLRenderer: Unsupported uniform value type.",g),b}function m(g){const b=g.target;b.removeEventListener("dispose",m);const y=o.indexOf(b.__bindingPointIndex);o.splice(y,1),n.deleteBuffer(r[b.id]),delete r[b.id],delete s[b.id]}function f(){for(const g in r)n.deleteBuffer(r[g]);o=[],r={},s={}}return{bind:l,update:c,dispose:f}}const QR=new Uint16Array([11481,15204,11534,15171,11808,15015,12385,14843,12894,14716,13396,14600,13693,14483,13976,14366,14237,14171,14405,13961,14511,13770,14605,13598,14687,13444,14760,13305,14822,13066,14876,12857,14923,12675,14963,12517,14997,12379,15025,12230,15049,12023,15070,11843,15086,11687,15100,11551,15111,11433,15120,11330,15127,11217,15132,11060,15135,10922,15138,10801,15139,10695,15139,10600,13012,14923,13020,14917,13064,14886,13176,14800,13349,14666,13513,14526,13724,14398,13960,14230,14200,14020,14383,13827,14488,13651,14583,13491,14667,13348,14740,13132,14803,12908,14856,12713,14901,12542,14938,12394,14968,12241,14992,12017,15010,11822,15024,11654,15034,11507,15041,11380,15044,11269,15044,11081,15042,10913,15037,10764,15031,10635,15023,10520,15014,10419,15003,10330,13657,14676,13658,14673,13670,14660,13698,14622,13750,14547,13834,14442,13956,14317,14112,14093,14291,13889,14407,13704,14499,13538,14586,13389,14664,13201,14733,12966,14792,12758,14842,12577,14882,12418,14915,12272,14940,12033,14959,11826,14972,11646,14980,11490,14983,11355,14983,11212,14979,11008,14971,10830,14961,10675,14950,10540,14936,10420,14923,10315,14909,10204,14894,10041,14089,14460,14090,14459,14096,14452,14112,14431,14141,14388,14186,14305,14252,14130,14341,13941,14399,13756,14467,13585,14539,13430,14610,13272,14677,13026,14737,12808,14790,12617,14833,12449,14869,12303,14896,12065,14916,11845,14929,11655,14937,11490,14939,11347,14936,11184,14930,10970,14921,10783,14912,10621,14900,10480,14885,10356,14867,10247,14848,10062,14827,9894,14805,9745,14400,14208,14400,14206,14402,14198,14406,14174,14415,14122,14427,14035,14444,13913,14469,13767,14504,13613,14548,13463,14598,13324,14651,13082,14704,12858,14752,12658,14795,12483,14831,12330,14860,12106,14881,11875,14895,11675,14903,11501,14905,11351,14903,11178,14900,10953,14892,10757,14880,10589,14865,10442,14847,10313,14827,10162,14805,9965,14782,9792,14757,9642,14731,9507,14562,13883,14562,13883,14563,13877,14566,13862,14570,13830,14576,13773,14584,13689,14595,13582,14613,13461,14637,13336,14668,13120,14704,12897,14741,12695,14776,12516,14808,12358,14835,12150,14856,11910,14870,11701,14878,11519,14882,11361,14884,11187,14880,10951,14871,10748,14858,10572,14842,10418,14823,10286,14801,10099,14777,9897,14751,9722,14725,9567,14696,9430,14666,9309,14702,13604,14702,13604,14702,13600,14703,13591,14705,13570,14707,13533,14709,13477,14712,13400,14718,13305,14727,13106,14743,12907,14762,12716,14784,12539,14807,12380,14827,12190,14844,11943,14855,11727,14863,11539,14870,11376,14871,11204,14868,10960,14858,10748,14845,10565,14829,10406,14809,10269,14786,10058,14761,9852,14734,9671,14705,9512,14674,9374,14641,9253,14608,9076,14821,13366,14821,13365,14821,13364,14821,13358,14821,13344,14821,13320,14819,13252,14817,13145,14815,13011,14814,12858,14817,12698,14823,12539,14832,12389,14841,12214,14850,11968,14856,11750,14861,11558,14866,11390,14867,11226,14862,10972,14853,10754,14840,10565,14823,10401,14803,10259,14780,10032,14754,9820,14725,9635,14694,9473,14661,9333,14627,9203,14593,8988,14557,8798,14923,13014,14922,13014,14922,13012,14922,13004,14920,12987,14919,12957,14915,12907,14909,12834,14902,12738,14894,12623,14888,12498,14883,12370,14880,12203,14878,11970,14875,11759,14873,11569,14874,11401,14872,11243,14865,10986,14855,10762,14842,10568,14825,10401,14804,10255,14781,10017,14754,9799,14725,9611,14692,9445,14658,9301,14623,9139,14587,8920,14548,8729,14509,8562,15008,12672,15008,12672,15008,12671,15007,12667,15005,12656,15001,12637,14997,12605,14989,12556,14978,12490,14966,12407,14953,12313,14940,12136,14927,11934,14914,11742,14903,11563,14896,11401,14889,11247,14879,10992,14866,10767,14851,10570,14833,10400,14812,10252,14789,10007,14761,9784,14731,9592,14698,9424,14663,9279,14627,9088,14588,8868,14548,8676,14508,8508,14467,8360,15080,12386,15080,12386,15079,12385,15078,12383,15076,12378,15072,12367,15066,12347,15057,12315,15045,12253,15030,12138,15012,11998,14993,11845,14972,11685,14951,11530,14935,11383,14920,11228,14904,10981,14887,10762,14870,10567,14850,10397,14827,10248,14803,9997,14774,9771,14743,9578,14710,9407,14674,9259,14637,9048,14596,8826,14555,8632,14514,8464,14471,8317,14427,8182,15139,12008,15139,12008,15138,12008,15137,12007,15135,12003,15130,11990,15124,11969,15115,11929,15102,11872,15086,11794,15064,11693,15041,11581,15013,11459,14987,11336,14966,11170,14944,10944,14921,10738,14898,10552,14875,10387,14850,10239,14824,9983,14794,9758,14762,9563,14728,9392,14692,9244,14653,9014,14611,8791,14569,8597,14526,8427,14481,8281,14436,8110,14391,7885,15188,11617,15188,11617,15187,11617,15186,11618,15183,11617,15179,11612,15173,11601,15163,11581,15150,11546,15133,11495,15110,11427,15083,11346,15051,11246,15024,11057,14996,10868,14967,10687,14938,10517,14911,10362,14882,10206,14853,9956,14821,9737,14787,9543,14752,9375,14715,9228,14675,8980,14632,8760,14589,8565,14544,8395,14498,8248,14451,8049,14404,7824,14357,7630,15228,11298,15228,11298,15227,11299,15226,11301,15223,11303,15219,11302,15213,11299,15204,11290,15191,11271,15174,11217,15150,11129,15119,11015,15087,10886,15057,10744,15024,10599,14990,10455,14957,10318,14924,10143,14891,9911,14856,9701,14820,9516,14782,9352,14744,9200,14703,8946,14659,8725,14615,8533,14568,8366,14521,8220,14472,7992,14423,7770,14374,7578,14315,7408,15260,10819,15260,10819,15259,10822,15258,10826,15256,10832,15251,10836,15246,10841,15237,10838,15225,10821,15207,10788,15183,10734,15151,10660,15120,10571,15087,10469,15049,10359,15012,10249,14974,10041,14937,9837,14900,9647,14860,9475,14820,9320,14779,9147,14736,8902,14691,8688,14646,8499,14598,8335,14549,8189,14499,7940,14448,7720,14397,7529,14347,7363,14256,7218,15285,10410,15285,10411,15285,10413,15284,10418,15282,10425,15278,10434,15272,10442,15264,10449,15252,10445,15235,10433,15210,10403,15179,10358,15149,10301,15113,10218,15073,10059,15033,9894,14991,9726,14951,9565,14909,9413,14865,9273,14822,9073,14777,8845,14730,8641,14682,8459,14633,8300,14583,8129,14531,7883,14479,7670,14426,7482,14373,7321,14305,7176,14201,6939,15305,9939,15305,9940,15305,9945,15304,9955,15302,9967,15298,9989,15293,10010,15286,10033,15274,10044,15258,10045,15233,10022,15205,9975,15174,9903,15136,9808,15095,9697,15053,9578,15009,9451,14965,9327,14918,9198,14871,8973,14825,8766,14775,8579,14725,8408,14675,8259,14622,8058,14569,7821,14515,7615,14460,7435,14405,7276,14350,7108,14256,6866,14149,6653,15321,9444,15321,9445,15321,9448,15320,9458,15317,9470,15314,9490,15310,9515,15302,9540,15292,9562,15276,9579,15251,9577,15226,9559,15195,9519,15156,9463,15116,9389,15071,9304,15025,9208,14978,9023,14927,8838,14878,8661,14827,8496,14774,8344,14722,8206,14667,7973,14612,7749,14556,7555,14499,7382,14443,7229,14385,7025,14322,6791,14210,6588,14100,6409,15333,8920,15333,8921,15332,8927,15332,8943,15329,8965,15326,9002,15322,9048,15316,9106,15307,9162,15291,9204,15267,9221,15244,9221,15212,9196,15175,9134,15133,9043,15088,8930,15040,8801,14990,8665,14938,8526,14886,8391,14830,8261,14775,8087,14719,7866,14661,7664,14603,7482,14544,7322,14485,7178,14426,6936,14367,6713,14281,6517,14166,6348,14054,6198,15341,8360,15341,8361,15341,8366,15341,8379,15339,8399,15336,8431,15332,8473,15326,8527,15318,8585,15302,8632,15281,8670,15258,8690,15227,8690,15191,8664,15149,8612,15104,8543,15055,8456,15001,8360,14948,8259,14892,8122,14834,7923,14776,7734,14716,7558,14656,7397,14595,7250,14534,7070,14472,6835,14410,6628,14350,6443,14243,6283,14125,6135,14010,5889,15348,7715,15348,7717,15348,7725,15347,7745,15345,7780,15343,7836,15339,7905,15334,8e3,15326,8103,15310,8193,15293,8239,15270,8270,15240,8287,15204,8283,15163,8260,15118,8223,15067,8143,15014,8014,14958,7873,14899,7723,14839,7573,14778,7430,14715,7293,14652,7164,14588,6931,14524,6720,14460,6531,14396,6362,14330,6210,14207,6015,14086,5781,13969,5576,15352,7114,15352,7116,15352,7128,15352,7159,15350,7195,15348,7237,15345,7299,15340,7374,15332,7457,15317,7544,15301,7633,15280,7703,15251,7754,15216,7775,15176,7767,15131,7733,15079,7670,15026,7588,14967,7492,14906,7387,14844,7278,14779,7171,14714,6965,14648,6770,14581,6587,14515,6420,14448,6269,14382,6123,14299,5881,14172,5665,14049,5477,13929,5310,15355,6329,15355,6330,15355,6339,15355,6362,15353,6410,15351,6472,15349,6572,15344,6688,15337,6835,15323,6985,15309,7142,15287,7220,15260,7277,15226,7310,15188,7326,15142,7318,15090,7285,15036,7239,14976,7177,14914,7045,14849,6892,14782,6736,14714,6581,14645,6433,14576,6293,14506,6164,14438,5946,14369,5733,14270,5540,14140,5369,14014,5216,13892,5043,15357,5483,15357,5484,15357,5496,15357,5528,15356,5597,15354,5692,15351,5835,15347,6011,15339,6195,15328,6317,15314,6446,15293,6566,15268,6668,15235,6746,15197,6796,15152,6811,15101,6790,15046,6748,14985,6673,14921,6583,14854,6479,14785,6371,14714,6259,14643,6149,14571,5946,14499,5750,14428,5567,14358,5401,14242,5250,14109,5111,13980,4870,13856,4657,15359,4555,15359,4557,15358,4573,15358,4633,15357,4715,15355,4841,15353,5061,15349,5216,15342,5391,15331,5577,15318,5770,15299,5967,15274,6150,15243,6223,15206,6280,15161,6310,15111,6317,15055,6300,14994,6262,14928,6208,14860,6141,14788,5994,14715,5838,14641,5684,14566,5529,14492,5384,14418,5247,14346,5121,14216,4892,14079,4682,13948,4496,13822,4330,15359,3498,15359,3501,15359,3520,15359,3598,15358,3719,15356,3860,15355,4137,15351,4305,15344,4563,15334,4809,15321,5116,15303,5273,15280,5418,15250,5547,15214,5653,15170,5722,15120,5761,15064,5763,15002,5733,14935,5673,14865,5597,14792,5504,14716,5400,14640,5294,14563,5185,14486,5041,14410,4841,14335,4655,14191,4482,14051,4325,13918,4183,13790,4012,15360,2282,15360,2285,15360,2306,15360,2401,15359,2547,15357,2748,15355,3103,15352,3349,15345,3675,15336,4020,15324,4272,15307,4496,15285,4716,15255,4908,15220,5086,15178,5170,15128,5214,15072,5234,15010,5231,14943,5206,14871,5166,14796,5102,14718,4971,14639,4833,14559,4687,14480,4541,14402,4401,14315,4268,14167,4142,14025,3958,13888,3747,13759,3556,15360,923,15360,925,15360,946,15360,1052,15359,1214,15357,1494,15356,1892,15352,2274,15346,2663,15338,3099,15326,3393,15309,3679,15288,3980,15260,4183,15226,4325,15185,4437,15136,4517,15080,4570,15018,4591,14950,4581,14877,4545,14800,4485,14720,4411,14638,4325,14556,4231,14475,4136,14395,3988,14297,3803,14145,3628,13999,3465,13861,3314,13729,3177,15360,263,15360,264,15360,272,15360,325,15359,407,15358,548,15356,780,15352,1144,15347,1580,15339,2099,15328,2425,15312,2795,15292,3133,15264,3329,15232,3517,15191,3689,15143,3819,15088,3923,15025,3978,14956,3999,14882,3979,14804,3931,14722,3855,14639,3756,14554,3645,14470,3529,14388,3409,14279,3289,14124,3173,13975,3055,13834,2848,13701,2658,15360,49,15360,49,15360,52,15360,75,15359,111,15358,201,15356,283,15353,519,15348,726,15340,1045,15329,1415,15314,1795,15295,2173,15269,2410,15237,2649,15197,2866,15150,3054,15095,3140,15032,3196,14963,3228,14888,3236,14808,3224,14725,3191,14639,3146,14553,3088,14466,2976,14382,2836,14262,2692,14103,2549,13952,2409,13808,2278,13674,2154,15360,4,15360,4,15360,4,15360,13,15359,33,15358,59,15357,112,15353,199,15348,302,15341,456,15331,628,15316,827,15297,1082,15272,1332,15241,1601,15202,1851,15156,2069,15101,2172,15039,2256,14970,2314,14894,2348,14813,2358,14728,2344,14640,2311,14551,2263,14463,2203,14376,2133,14247,2059,14084,1915,13930,1761,13784,1609,13648,1464,15360,0,15360,0,15360,0,15360,3,15359,18,15358,26,15357,53,15354,80,15348,97,15341,165,15332,238,15318,326,15299,427,15275,529,15245,654,15207,771,15161,885,15108,994,15046,1089,14976,1170,14900,1229,14817,1266,14731,1284,14641,1282,14550,1260,14460,1223,14370,1174,14232,1116,14066,1050,13909,981,13761,910,13623,839]);let Hr=null;function eL(){return Hr===null&&(Hr=new fy(QR,32,32,C0,Ll),Hr.minFilter=Oi,Hr.magFilter=Oi,Hr.wrapS=Yr,Hr.wrapT=Yr,Hr.generateMipmaps=!1,Hr.needsUpdate=!0),Hr}class tL{constructor(e={}){const{canvas:t=E2(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1,reversedDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let p;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=i.getContextAttributes().alpha}else p=o;const _=new Set([M0,S0,E0]),v=new Set([Cr,Bo,Dc,kc,x0,w0]),m=new Uint32Array(4),f=new Int32Array(4);let g=null,b=null;const y=[],M=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Hs,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const S=this;let P=!1;this._outputColorSpace=hi;let A=0,x=0,E=null,R=-1,O=null;const F=new bt,G=new bt;let H=null;const B=new $e(0);let W=0,$=t.width,Q=t.height,ee=1,me=null,De=null;const Je=new bt(0,0,$,Q),Be=new bt(0,0,$,Q);let ze=!1;const K=new A0;let Y=!1,pe=!1;const ke=new At,we=new k,Qe=new bt,yn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let qe=!1;function Rt(){return E===null?ee:1}let L=i;function et(C,I){return t.getContext(C,I)}try{const C={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${_0}`),t.addEventListener("webglcontextlost",te,!1),t.addEventListener("webglcontextrestored",q,!1),t.addEventListener("webglcontextcreationerror",ve,!1),L===null){const I="webgl2";if(L=et(I,C),L===null)throw et(I)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(C){throw C("WebGLRenderer: "+C.message),C}let tt,Ct,ge,Ot,Ee,Fe,T,w,V,X,Z,j,xe,ae,Ce,be,J,ie,Te,Me,de,Ie,D,le;function re(){tt=new cA(L),tt.init(),Ie=new jR(L,tt),Ct=new eA(L,tt,e,Ie),ge=new HR(L,tt),Ct.reversedDepthBuffer&&d&&ge.buffers.depth.setReversed(!0),Ot=new dA(L),Ee=new RR,Fe=new GR(L,tt,ge,Ee,Ct,Ie,Ot),T=new nA(S),w=new lA(S),V=new vP(L),D=new J3(L,V),X=new hA(L,V,Ot,D),Z=new fA(L,X,V,Ot),Te=new pA(L,Ct,Fe),be=new tA(Ee),j=new AR(S,T,w,tt,Ct,D,be),xe=new ZR(S,Ee),ae=new DR,Ce=new VR(tt),ie=new Z3(S,T,w,ge,Z,p,l),J=new zR(S,Z,Ct),le=new JR(L,Ot,Ct,ge),Me=new Q3(L,tt,Ot),de=new uA(L,tt,Ot),Ot.programs=j.programs,S.capabilities=Ct,S.extensions=tt,S.properties=Ee,S.renderLists=ae,S.shadowMap=J,S.state=ge,S.info=Ot}re();const se=new qR(S,L);this.xr=se,this.getContext=function(){return L},this.getContextAttributes=function(){return L.getContextAttributes()},this.forceContextLoss=function(){const C=tt.get("WEBGL_lose_context");C&&C.loseContext()},this.forceContextRestore=function(){const C=tt.get("WEBGL_lose_context");C&&C.restoreContext()},this.getPixelRatio=function(){return ee},this.setPixelRatio=function(C){C!==void 0&&(ee=C,this.setSize($,Q,!1))},this.getSize=function(C){return C.set($,Q)},this.setSize=function(C,I,U=!0){if(se.isPresenting){Ve("WebGLRenderer: Can't change size while VR device is presenting.");return}$=C,Q=I,t.width=Math.floor(C*ee),t.height=Math.floor(I*ee),U===!0&&(t.style.width=C+"px",t.style.height=I+"px"),this.setViewport(0,0,C,I)},this.getDrawingBufferSize=function(C){return C.set($*ee,Q*ee).floor()},this.setDrawingBufferSize=function(C,I,U){$=C,Q=I,ee=U,t.width=Math.floor(C*U),t.height=Math.floor(I*U),this.setViewport(0,0,C,I)},this.getCurrentViewport=function(C){return C.copy(F)},this.getViewport=function(C){return C.copy(Je)},this.setViewport=function(C,I,U,z){C.isVector4?Je.set(C.x,C.y,C.z,C.w):Je.set(C,I,U,z),ge.viewport(F.copy(Je).multiplyScalar(ee).round())},this.getScissor=function(C){return C.copy(Be)},this.setScissor=function(C,I,U,z){C.isVector4?Be.set(C.x,C.y,C.z,C.w):Be.set(C,I,U,z),ge.scissor(G.copy(Be).multiplyScalar(ee).round())},this.getScissorTest=function(){return ze},this.setScissorTest=function(C){ge.setScissorTest(ze=C)},this.setOpaqueSort=function(C){me=C},this.setTransparentSort=function(C){De=C},this.getClearColor=function(C){return C.copy(ie.getClearColor())},this.setClearColor=function(){ie.setClearColor(...arguments)},this.getClearAlpha=function(){return ie.getClearAlpha()},this.setClearAlpha=function(){ie.setClearAlpha(...arguments)},this.clear=function(C=!0,I=!0,U=!0){let z=0;if(C){let N=!1;if(E!==null){const ne=E.texture.format;N=_.has(ne)}if(N){const ne=E.texture.type,he=v.has(ne),_e=ie.getClearColor(),fe=ie.getClearAlpha(),Pe=_e.r,Ae=_e.g,ye=_e.b;he?(m[0]=Pe,m[1]=Ae,m[2]=ye,m[3]=fe,L.clearBufferuiv(L.COLOR,0,m)):(f[0]=Pe,f[1]=Ae,f[2]=ye,f[3]=fe,L.clearBufferiv(L.COLOR,0,f))}else z|=L.COLOR_BUFFER_BIT}I&&(z|=L.DEPTH_BUFFER_BIT),U&&(z|=L.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),L.clear(z)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",te,!1),t.removeEventListener("webglcontextrestored",q,!1),t.removeEventListener("webglcontextcreationerror",ve,!1),ie.dispose(),ae.dispose(),Ce.dispose(),Ee.dispose(),T.dispose(),w.dispose(),Z.dispose(),D.dispose(),le.dispose(),j.dispose(),se.dispose(),se.removeEventListener("sessionstart",tg),se.removeEventListener("sessionend",ng),oo.stop()};function te(C){C.preventDefault(),vg("WebGLRenderer: Context Lost."),P=!0}function q(){vg("WebGLRenderer: Context Restored."),P=!1;const C=Ot.autoReset,I=J.enabled,U=J.autoUpdate,z=J.needsUpdate,N=J.type;re(),Ot.autoReset=C,J.enabled=I,J.autoUpdate=U,J.needsUpdate=z,J.type=N}function ve(C){en("WebGLRenderer: A WebGL context could not be created. Reason: ",C.statusMessage)}function Oe(C){const I=C.target;I.removeEventListener("dispose",Oe),Mt(I)}function Mt(C){pt(C),Ee.remove(C)}function pt(C){const I=Ee.get(C).programs;I!==void 0&&(I.forEach(function(U){j.releaseProgram(U)}),C.isShaderMaterial&&j.releaseShaderCache(C))}this.renderBufferDirect=function(C,I,U,z,N,ne){I===null&&(I=yn);const he=N.isMesh&&N.matrixWorld.determinant()<0,_e=DM(C,I,U,z,N);ge.setMaterial(z,he);let fe=U.index,Pe=1;if(z.wireframe===!0){if(fe=X.getWireframeAttribute(U),fe===void 0)return;Pe=2}const Ae=U.drawRange,ye=U.attributes.position;let nt=Ae.start*Pe,ft=(Ae.start+Ae.count)*Pe;ne!==null&&(nt=Math.max(nt,ne.start*Pe),ft=Math.min(ft,(ne.start+ne.count)*Pe)),fe!==null?(nt=Math.max(nt,0),ft=Math.min(ft,fe.count)):ye!=null&&(nt=Math.max(nt,0),ft=Math.min(ft,ye.count));const Ht=ft-nt;if(Ht<0||Ht===1/0)return;D.setup(N,z,_e,U,fe);let Gt,xt=Me;if(fe!==null&&(Gt=V.get(fe),xt=de,xt.setIndex(Gt)),N.isMesh)z.wireframe===!0?(ge.setLineWidth(z.wireframeLinewidth*Rt()),xt.setMode(L.LINES)):xt.setMode(L.TRIANGLES);else if(N.isLine){let Se=z.linewidth;Se===void 0&&(Se=1),ge.setLineWidth(Se*Rt()),N.isLineSegments?xt.setMode(L.LINES):N.isLineLoop?xt.setMode(L.LINE_LOOP):xt.setMode(L.LINE_STRIP)}else N.isPoints?xt.setMode(L.POINTS):N.isSprite&&xt.setMode(L.TRIANGLES);if(N.isBatchedMesh)if(N._multiDrawInstances!==null)Fc("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),xt.renderMultiDrawInstances(N._multiDrawStarts,N._multiDrawCounts,N._multiDrawCount,N._multiDrawInstances);else if(tt.get("WEBGL_multi_draw"))xt.renderMultiDraw(N._multiDrawStarts,N._multiDrawCounts,N._multiDrawCount);else{const Se=N._multiDrawStarts,Nt=N._multiDrawCounts,ot=N._multiDrawCount,oi=fe?V.get(fe).bytesPerElement:1,fa=Ee.get(z).currentProgram.getUniforms();for(let ai=0;ai<ot;ai++)fa.setValue(L,"_gl_DrawID",ai),xt.render(Se[ai]/oi,Nt[ai])}else if(N.isInstancedMesh)xt.renderInstances(nt,Ht,N.count);else if(U.isInstancedBufferGeometry){const Se=U._maxInstanceCount!==void 0?U._maxInstanceCount:1/0,Nt=Math.min(U.instanceCount,Se);xt.renderInstances(nt,Ht,Nt)}else xt.render(nt,Ht)};function ar(C,I,U){C.transparent===!0&&C.side===pi&&C.forceSinglePass===!1?(C.side=$n,C.needsUpdate=!0,Ih(C,I,U),C.side=Ji,C.needsUpdate=!0,Ih(C,I,U),C.side=pi):Ih(C,I,U)}this.compile=function(C,I,U=null){U===null&&(U=C),b=Ce.get(U),b.init(I),M.push(b),U.traverseVisible(function(N){N.isLight&&N.layers.test(I.layers)&&(b.pushLight(N),N.castShadow&&b.pushShadow(N))}),C!==U&&C.traverseVisible(function(N){N.isLight&&N.layers.test(I.layers)&&(b.pushLight(N),N.castShadow&&b.pushShadow(N))}),b.setupLights();const z=new Set;return C.traverse(function(N){if(!(N.isMesh||N.isPoints||N.isLine||N.isSprite))return;const ne=N.material;if(ne)if(Array.isArray(ne))for(let he=0;he<ne.length;he++){const _e=ne[he];ar(_e,U,N),z.add(_e)}else ar(ne,U,N),z.add(ne)}),b=M.pop(),z},this.compileAsync=function(C,I,U=null){const z=this.compile(C,I,U);return new Promise(N=>{function ne(){if(z.forEach(function(he){Ee.get(he).currentProgram.isReady()&&z.delete(he)}),z.size===0){N(C);return}setTimeout(ne,10)}tt.get("KHR_parallel_shader_compile")!==null?ne():setTimeout(ne,10)})};let ji=null;function LM(C){ji&&ji(C)}function tg(){oo.stop()}function ng(){oo.start()}const oo=new gy;oo.setAnimationLoop(LM),typeof self<"u"&&oo.setContext(self),this.setAnimationLoop=function(C){ji=C,se.setAnimationLoop(C),C===null?oo.stop():oo.start()},se.addEventListener("sessionstart",tg),se.addEventListener("sessionend",ng),this.render=function(C,I){if(I!==void 0&&I.isCamera!==!0){en("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(P===!0)return;if(C.matrixWorldAutoUpdate===!0&&C.updateMatrixWorld(),I.parent===null&&I.matrixWorldAutoUpdate===!0&&I.updateMatrixWorld(),se.enabled===!0&&se.isPresenting===!0&&(se.cameraAutoUpdate===!0&&se.updateCamera(I),I=se.getCamera()),C.isScene===!0&&C.onBeforeRender(S,C,I,E),b=Ce.get(C,M.length),b.init(I),M.push(b),ke.multiplyMatrices(I.projectionMatrix,I.matrixWorldInverse),K.setFromProjectionMatrix(ke,mr,I.reversedDepth),pe=this.localClippingEnabled,Y=be.init(this.clippingPlanes,pe),g=ae.get(C,y.length),g.init(),y.push(g),se.enabled===!0&&se.isPresenting===!0){const ne=S.xr.getDepthSensingMesh();ne!==null&&sp(ne,I,-1/0,S.sortObjects)}sp(C,I,0,S.sortObjects),g.finish(),S.sortObjects===!0&&g.sort(me,De),qe=se.enabled===!1||se.isPresenting===!1||se.hasDepthSensing()===!1,qe&&ie.addToRenderList(g,C),this.info.render.frame++,Y===!0&&be.beginShadows();const U=b.state.shadowsArray;J.render(U,C,I),Y===!0&&be.endShadows(),this.info.autoReset===!0&&this.info.reset();const z=g.opaque,N=g.transmissive;if(b.setupLights(),I.isArrayCamera){const ne=I.cameras;if(N.length>0)for(let he=0,_e=ne.length;he<_e;he++){const fe=ne[he];rg(z,N,C,fe)}qe&&ie.render(C);for(let he=0,_e=ne.length;he<_e;he++){const fe=ne[he];ig(g,C,fe,fe.viewport)}}else N.length>0&&rg(z,N,C,I),qe&&ie.render(C),ig(g,C,I);E!==null&&x===0&&(Fe.updateMultisampleRenderTarget(E),Fe.updateRenderTargetMipmap(E)),C.isScene===!0&&C.onAfterRender(S,C,I),D.resetDefaultState(),R=-1,O=null,M.pop(),M.length>0?(b=M[M.length-1],Y===!0&&be.setGlobalState(S.clippingPlanes,b.state.camera)):b=null,y.pop(),y.length>0?g=y[y.length-1]:g=null};function sp(C,I,U,z){if(C.visible===!1)return;if(C.layers.test(I.layers)){if(C.isGroup)U=C.renderOrder;else if(C.isLOD)C.autoUpdate===!0&&C.update(I);else if(C.isLight)b.pushLight(C),C.castShadow&&b.pushShadow(C);else if(C.isSprite){if(!C.frustumCulled||K.intersectsSprite(C)){z&&Qe.setFromMatrixPosition(C.matrixWorld).applyMatrix4(ke);const he=Z.update(C),_e=C.material;_e.visible&&g.push(C,he,_e,U,Qe.z,null)}}else if((C.isMesh||C.isLine||C.isPoints)&&(!C.frustumCulled||K.intersectsObject(C))){const he=Z.update(C),_e=C.material;if(z&&(C.boundingSphere!==void 0?(C.boundingSphere===null&&C.computeBoundingSphere(),Qe.copy(C.boundingSphere.center)):(he.boundingSphere===null&&he.computeBoundingSphere(),Qe.copy(he.boundingSphere.center)),Qe.applyMatrix4(C.matrixWorld).applyMatrix4(ke)),Array.isArray(_e)){const fe=he.groups;for(let Pe=0,Ae=fe.length;Pe<Ae;Pe++){const ye=fe[Pe],nt=_e[ye.materialIndex];nt&&nt.visible&&g.push(C,he,nt,U,Qe.z,ye)}}else _e.visible&&g.push(C,he,_e,U,Qe.z,null)}}const ne=C.children;for(let he=0,_e=ne.length;he<_e;he++)sp(ne[he],I,U,z)}function ig(C,I,U,z){const{opaque:N,transmissive:ne,transparent:he}=C;b.setupLightsView(U),Y===!0&&be.setGlobalState(S.clippingPlanes,U),z&&ge.viewport(F.copy(z)),N.length>0&&kh(N,I,U),ne.length>0&&kh(ne,I,U),he.length>0&&kh(he,I,U),ge.buffers.depth.setTest(!0),ge.buffers.depth.setMask(!0),ge.buffers.color.setMask(!0),ge.setPolygonOffset(!1)}function rg(C,I,U,z){if((U.isScene===!0?U.overrideMaterial:null)!==null)return;b.state.transmissionRenderTarget[z.id]===void 0&&(b.state.transmissionRenderTarget[z.id]=new $o(1,1,{generateMipmaps:!0,type:tt.has("EXT_color_buffer_half_float")||tt.has("EXT_color_buffer_float")?Ll:Cr,minFilter:Ao,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:at.workingColorSpace}));const ne=b.state.transmissionRenderTarget[z.id],he=z.viewport||F;ne.setSize(he.z*S.transmissionResolutionScale,he.w*S.transmissionResolutionScale);const _e=S.getRenderTarget(),fe=S.getActiveCubeFace(),Pe=S.getActiveMipmapLevel();S.setRenderTarget(ne),S.getClearColor(B),W=S.getClearAlpha(),W<1&&S.setClearColor(16777215,.5),S.clear(),qe&&ie.render(U);const Ae=S.toneMapping;S.toneMapping=Hs;const ye=z.viewport;if(z.viewport!==void 0&&(z.viewport=void 0),b.setupLightsView(z),Y===!0&&be.setGlobalState(S.clippingPlanes,z),kh(C,U,z),Fe.updateMultisampleRenderTarget(ne),Fe.updateRenderTargetMipmap(ne),tt.has("WEBGL_multisampled_render_to_texture")===!1){let nt=!1;for(let ft=0,Ht=I.length;ft<Ht;ft++){const Gt=I[ft],{object:xt,geometry:Se,material:Nt,group:ot}=Gt;if(Nt.side===pi&&xt.layers.test(z.layers)){const oi=Nt.side;Nt.side=$n,Nt.needsUpdate=!0,sg(xt,U,z,Se,Nt,ot),Nt.side=oi,Nt.needsUpdate=!0,nt=!0}}nt===!0&&(Fe.updateMultisampleRenderTarget(ne),Fe.updateRenderTargetMipmap(ne))}S.setRenderTarget(_e,fe,Pe),S.setClearColor(B,W),ye!==void 0&&(z.viewport=ye),S.toneMapping=Ae}function kh(C,I,U){const z=I.isScene===!0?I.overrideMaterial:null;for(let N=0,ne=C.length;N<ne;N++){const he=C[N],{object:_e,geometry:fe,group:Pe}=he;let Ae=he.material;Ae.allowOverride===!0&&z!==null&&(Ae=z),_e.layers.test(U.layers)&&sg(_e,I,U,fe,Ae,Pe)}}function sg(C,I,U,z,N,ne){C.onBeforeRender(S,I,U,z,N,ne),C.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,C.matrixWorld),C.normalMatrix.getNormalMatrix(C.modelViewMatrix),N.onBeforeRender(S,I,U,z,C,ne),N.transparent===!0&&N.side===pi&&N.forceSinglePass===!1?(N.side=$n,N.needsUpdate=!0,S.renderBufferDirect(U,I,z,N,C,ne),N.side=Ji,N.needsUpdate=!0,S.renderBufferDirect(U,I,z,N,C,ne),N.side=pi):S.renderBufferDirect(U,I,z,N,C,ne),C.onAfterRender(S,I,U,z,N,ne)}function Ih(C,I,U){I.isScene!==!0&&(I=yn);const z=Ee.get(C),N=b.state.lights,ne=b.state.shadowsArray,he=N.state.version,_e=j.getParameters(C,N.state,ne,I,U),fe=j.getProgramCacheKey(_e);let Pe=z.programs;z.environment=C.isMeshStandardMaterial?I.environment:null,z.fog=I.fog,z.envMap=(C.isMeshStandardMaterial?w:T).get(C.envMap||z.environment),z.envMapRotation=z.environment!==null&&C.envMap===null?I.environmentRotation:C.envMapRotation,Pe===void 0&&(C.addEventListener("dispose",Oe),Pe=new Map,z.programs=Pe);let Ae=Pe.get(fe);if(Ae!==void 0){if(z.currentProgram===Ae&&z.lightsStateVersion===he)return ag(C,_e),Ae}else _e.uniforms=j.getUniforms(C),C.onBeforeCompile(_e,S),Ae=j.acquireProgram(_e,fe),Pe.set(fe,Ae),z.uniforms=_e.uniforms;const ye=z.uniforms;return(!C.isShaderMaterial&&!C.isRawShaderMaterial||C.clipping===!0)&&(ye.clippingPlanes=be.uniform),ag(C,_e),z.needsLights=IM(C),z.lightsStateVersion=he,z.needsLights&&(ye.ambientLightColor.value=N.state.ambient,ye.lightProbe.value=N.state.probe,ye.directionalLights.value=N.state.directional,ye.directionalLightShadows.value=N.state.directionalShadow,ye.spotLights.value=N.state.spot,ye.spotLightShadows.value=N.state.spotShadow,ye.rectAreaLights.value=N.state.rectArea,ye.ltc_1.value=N.state.rectAreaLTC1,ye.ltc_2.value=N.state.rectAreaLTC2,ye.pointLights.value=N.state.point,ye.pointLightShadows.value=N.state.pointShadow,ye.hemisphereLights.value=N.state.hemi,ye.directionalShadowMap.value=N.state.directionalShadowMap,ye.directionalShadowMatrix.value=N.state.directionalShadowMatrix,ye.spotShadowMap.value=N.state.spotShadowMap,ye.spotLightMatrix.value=N.state.spotLightMatrix,ye.spotLightMap.value=N.state.spotLightMap,ye.pointShadowMap.value=N.state.pointShadowMap,ye.pointShadowMatrix.value=N.state.pointShadowMatrix),z.currentProgram=Ae,z.uniformsList=null,Ae}function og(C){if(C.uniformsList===null){const I=C.currentProgram.getUniforms();C.uniformsList=yu.seqWithValue(I.seq,C.uniforms)}return C.uniformsList}function ag(C,I){const U=Ee.get(C);U.outputColorSpace=I.outputColorSpace,U.batching=I.batching,U.batchingColor=I.batchingColor,U.instancing=I.instancing,U.instancingColor=I.instancingColor,U.instancingMorph=I.instancingMorph,U.skinning=I.skinning,U.morphTargets=I.morphTargets,U.morphNormals=I.morphNormals,U.morphColors=I.morphColors,U.morphTargetsCount=I.morphTargetsCount,U.numClippingPlanes=I.numClippingPlanes,U.numIntersection=I.numClipIntersection,U.vertexAlphas=I.vertexAlphas,U.vertexTangents=I.vertexTangents,U.toneMapping=I.toneMapping}function DM(C,I,U,z,N){I.isScene!==!0&&(I=yn),Fe.resetTextureUnits();const ne=I.fog,he=z.isMeshStandardMaterial?I.environment:null,_e=E===null?S.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:ml,fe=(z.isMeshStandardMaterial?w:T).get(z.envMap||he),Pe=z.vertexColors===!0&&!!U.attributes.color&&U.attributes.color.itemSize===4,Ae=!!U.attributes.tangent&&(!!z.normalMap||z.anisotropy>0),ye=!!U.morphAttributes.position,nt=!!U.morphAttributes.normal,ft=!!U.morphAttributes.color;let Ht=Hs;z.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(Ht=S.toneMapping);const Gt=U.morphAttributes.position||U.morphAttributes.normal||U.morphAttributes.color,xt=Gt!==void 0?Gt.length:0,Se=Ee.get(z),Nt=b.state.lights;if(Y===!0&&(pe===!0||C!==O)){const Vn=C===O&&z.id===R;be.setState(z,C,Vn)}let ot=!1;z.version===Se.__version?(Se.needsLights&&Se.lightsStateVersion!==Nt.state.version||Se.outputColorSpace!==_e||N.isBatchedMesh&&Se.batching===!1||!N.isBatchedMesh&&Se.batching===!0||N.isBatchedMesh&&Se.batchingColor===!0&&N.colorTexture===null||N.isBatchedMesh&&Se.batchingColor===!1&&N.colorTexture!==null||N.isInstancedMesh&&Se.instancing===!1||!N.isInstancedMesh&&Se.instancing===!0||N.isSkinnedMesh&&Se.skinning===!1||!N.isSkinnedMesh&&Se.skinning===!0||N.isInstancedMesh&&Se.instancingColor===!0&&N.instanceColor===null||N.isInstancedMesh&&Se.instancingColor===!1&&N.instanceColor!==null||N.isInstancedMesh&&Se.instancingMorph===!0&&N.morphTexture===null||N.isInstancedMesh&&Se.instancingMorph===!1&&N.morphTexture!==null||Se.envMap!==fe||z.fog===!0&&Se.fog!==ne||Se.numClippingPlanes!==void 0&&(Se.numClippingPlanes!==be.numPlanes||Se.numIntersection!==be.numIntersection)||Se.vertexAlphas!==Pe||Se.vertexTangents!==Ae||Se.morphTargets!==ye||Se.morphNormals!==nt||Se.morphColors!==ft||Se.toneMapping!==Ht||Se.morphTargetsCount!==xt)&&(ot=!0):(ot=!0,Se.__version=z.version);let oi=Se.currentProgram;ot===!0&&(oi=Ih(z,I,N));let fa=!1,ai=!1,jl=!1;const Ft=oi.getUniforms(),Xn=Se.uniforms;if(ge.useProgram(oi.program)&&(fa=!0,ai=!0,jl=!0),z.id!==R&&(R=z.id,ai=!0),fa||O!==C){ge.buffers.depth.getReversed()&&C.reversedDepth!==!0&&(C._reversedDepth=!0,C.updateProjectionMatrix()),Ft.setValue(L,"projectionMatrix",C.projectionMatrix),Ft.setValue(L,"viewMatrix",C.matrixWorldInverse);const qn=Ft.map.cameraPosition;qn!==void 0&&qn.setValue(L,we.setFromMatrixPosition(C.matrixWorld)),Ct.logarithmicDepthBuffer&&Ft.setValue(L,"logDepthBufFC",2/(Math.log(C.far+1)/Math.LN2)),(z.isMeshPhongMaterial||z.isMeshToonMaterial||z.isMeshLambertMaterial||z.isMeshBasicMaterial||z.isMeshStandardMaterial||z.isShaderMaterial)&&Ft.setValue(L,"isOrthographic",C.isOrthographicCamera===!0),O!==C&&(O=C,ai=!0,jl=!0)}if(N.isSkinnedMesh){Ft.setOptional(L,N,"bindMatrix"),Ft.setOptional(L,N,"bindMatrixInverse");const Vn=N.skeleton;Vn&&(Vn.boneTexture===null&&Vn.computeBoneTexture(),Ft.setValue(L,"boneTexture",Vn.boneTexture,Fe))}N.isBatchedMesh&&(Ft.setOptional(L,N,"batchingTexture"),Ft.setValue(L,"batchingTexture",N._matricesTexture,Fe),Ft.setOptional(L,N,"batchingIdTexture"),Ft.setValue(L,"batchingIdTexture",N._indirectTexture,Fe),Ft.setOptional(L,N,"batchingColorTexture"),N._colorsTexture!==null&&Ft.setValue(L,"batchingColorTexture",N._colorsTexture,Fe));const Ti=U.morphAttributes;if((Ti.position!==void 0||Ti.normal!==void 0||Ti.color!==void 0)&&Te.update(N,U,oi),(ai||Se.receiveShadow!==N.receiveShadow)&&(Se.receiveShadow=N.receiveShadow,Ft.setValue(L,"receiveShadow",N.receiveShadow)),z.isMeshGouraudMaterial&&z.envMap!==null&&(Xn.envMap.value=fe,Xn.flipEnvMap.value=fe.isCubeTexture&&fe.isRenderTargetTexture===!1?-1:1),z.isMeshStandardMaterial&&z.envMap===null&&I.environment!==null&&(Xn.envMapIntensity.value=I.environmentIntensity),Xn.dfgLUT!==void 0&&(Xn.dfgLUT.value=eL()),ai&&(Ft.setValue(L,"toneMappingExposure",S.toneMappingExposure),Se.needsLights&&kM(Xn,jl),ne&&z.fog===!0&&xe.refreshFogUniforms(Xn,ne),xe.refreshMaterialUniforms(Xn,z,ee,Q,b.state.transmissionRenderTarget[C.id]),yu.upload(L,og(Se),Xn,Fe)),z.isShaderMaterial&&z.uniformsNeedUpdate===!0&&(yu.upload(L,og(Se),Xn,Fe),z.uniformsNeedUpdate=!1),z.isSpriteMaterial&&Ft.setValue(L,"center",N.center),Ft.setValue(L,"modelViewMatrix",N.modelViewMatrix),Ft.setValue(L,"normalMatrix",N.normalMatrix),Ft.setValue(L,"modelMatrix",N.matrixWorld),z.isShaderMaterial||z.isRawShaderMaterial){const Vn=z.uniformsGroups;for(let qn=0,op=Vn.length;qn<op;qn++){const ao=Vn[qn];le.update(ao,oi),le.bind(ao,oi)}}return oi}function kM(C,I){C.ambientLightColor.needsUpdate=I,C.lightProbe.needsUpdate=I,C.directionalLights.needsUpdate=I,C.directionalLightShadows.needsUpdate=I,C.pointLights.needsUpdate=I,C.pointLightShadows.needsUpdate=I,C.spotLights.needsUpdate=I,C.spotLightShadows.needsUpdate=I,C.rectAreaLights.needsUpdate=I,C.hemisphereLights.needsUpdate=I}function IM(C){return C.isMeshLambertMaterial||C.isMeshToonMaterial||C.isMeshPhongMaterial||C.isMeshStandardMaterial||C.isShadowMaterial||C.isShaderMaterial&&C.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(C,I,U){const z=Ee.get(C);z.__autoAllocateDepthBuffer=C.resolveDepthBuffer===!1,z.__autoAllocateDepthBuffer===!1&&(z.__useRenderToTexture=!1),Ee.get(C.texture).__webglTexture=I,Ee.get(C.depthTexture).__webglTexture=z.__autoAllocateDepthBuffer?void 0:U,z.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(C,I){const U=Ee.get(C);U.__webglFramebuffer=I,U.__useDefaultFramebuffer=I===void 0};const OM=L.createFramebuffer();this.setRenderTarget=function(C,I=0,U=0){E=C,A=I,x=U;let z=!0,N=null,ne=!1,he=!1;if(C){const fe=Ee.get(C);if(fe.__useDefaultFramebuffer!==void 0)ge.bindFramebuffer(L.FRAMEBUFFER,null),z=!1;else if(fe.__webglFramebuffer===void 0)Fe.setupRenderTarget(C);else if(fe.__hasExternalTextures)Fe.rebindTextures(C,Ee.get(C.texture).__webglTexture,Ee.get(C.depthTexture).__webglTexture);else if(C.depthBuffer){const ye=C.depthTexture;if(fe.__boundDepthTexture!==ye){if(ye!==null&&Ee.has(ye)&&(C.width!==ye.image.width||C.height!==ye.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Fe.setupDepthRenderbuffer(C)}}const Pe=C.texture;(Pe.isData3DTexture||Pe.isDataArrayTexture||Pe.isCompressedArrayTexture)&&(he=!0);const Ae=Ee.get(C).__webglFramebuffer;C.isWebGLCubeRenderTarget?(Array.isArray(Ae[I])?N=Ae[I][U]:N=Ae[I],ne=!0):C.samples>0&&Fe.useMultisampledRTT(C)===!1?N=Ee.get(C).__webglMultisampledFramebuffer:Array.isArray(Ae)?N=Ae[U]:N=Ae,F.copy(C.viewport),G.copy(C.scissor),H=C.scissorTest}else F.copy(Je).multiplyScalar(ee).floor(),G.copy(Be).multiplyScalar(ee).floor(),H=ze;if(U!==0&&(N=OM),ge.bindFramebuffer(L.FRAMEBUFFER,N)&&z&&ge.drawBuffers(C,N),ge.viewport(F),ge.scissor(G),ge.setScissorTest(H),ne){const fe=Ee.get(C.texture);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_CUBE_MAP_POSITIVE_X+I,fe.__webglTexture,U)}else if(he){const fe=I;for(let Pe=0;Pe<C.textures.length;Pe++){const Ae=Ee.get(C.textures[Pe]);L.framebufferTextureLayer(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0+Pe,Ae.__webglTexture,U,fe)}}else if(C!==null&&U!==0){const fe=Ee.get(C.texture);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,fe.__webglTexture,U)}R=-1},this.readRenderTargetPixels=function(C,I,U,z,N,ne,he,_e=0){if(!(C&&C.isWebGLRenderTarget)){en("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let fe=Ee.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&he!==void 0&&(fe=fe[he]),fe){ge.bindFramebuffer(L.FRAMEBUFFER,fe);try{const Pe=C.textures[_e],Ae=Pe.format,ye=Pe.type;if(!Ct.textureFormatReadable(Ae)){en("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ct.textureTypeReadable(ye)){en("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}I>=0&&I<=C.width-z&&U>=0&&U<=C.height-N&&(C.textures.length>1&&L.readBuffer(L.COLOR_ATTACHMENT0+_e),L.readPixels(I,U,z,N,Ie.convert(Ae),Ie.convert(ye),ne))}finally{const Pe=E!==null?Ee.get(E).__webglFramebuffer:null;ge.bindFramebuffer(L.FRAMEBUFFER,Pe)}}},this.readRenderTargetPixelsAsync=async function(C,I,U,z,N,ne,he,_e=0){if(!(C&&C.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let fe=Ee.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&he!==void 0&&(fe=fe[he]),fe)if(I>=0&&I<=C.width-z&&U>=0&&U<=C.height-N){ge.bindFramebuffer(L.FRAMEBUFFER,fe);const Pe=C.textures[_e],Ae=Pe.format,ye=Pe.type;if(!Ct.textureFormatReadable(Ae))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ct.textureTypeReadable(ye))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const nt=L.createBuffer();L.bindBuffer(L.PIXEL_PACK_BUFFER,nt),L.bufferData(L.PIXEL_PACK_BUFFER,ne.byteLength,L.STREAM_READ),C.textures.length>1&&L.readBuffer(L.COLOR_ATTACHMENT0+_e),L.readPixels(I,U,z,N,Ie.convert(Ae),Ie.convert(ye),0);const ft=E!==null?Ee.get(E).__webglFramebuffer:null;ge.bindFramebuffer(L.FRAMEBUFFER,ft);const Ht=L.fenceSync(L.SYNC_GPU_COMMANDS_COMPLETE,0);return L.flush(),await C2(L,Ht,4),L.bindBuffer(L.PIXEL_PACK_BUFFER,nt),L.getBufferSubData(L.PIXEL_PACK_BUFFER,0,ne),L.deleteBuffer(nt),L.deleteSync(Ht),ne}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(C,I=null,U=0){const z=Math.pow(2,-U),N=Math.floor(C.image.width*z),ne=Math.floor(C.image.height*z),he=I!==null?I.x:0,_e=I!==null?I.y:0;Fe.setTexture2D(C,0),L.copyTexSubImage2D(L.TEXTURE_2D,U,0,0,he,_e,N,ne),ge.unbindTexture()};const NM=L.createFramebuffer(),FM=L.createFramebuffer();this.copyTextureToTexture=function(C,I,U=null,z=null,N=0,ne=null){ne===null&&(N!==0?(Fc("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ne=N,N=0):ne=0);let he,_e,fe,Pe,Ae,ye,nt,ft,Ht;const Gt=C.isCompressedTexture?C.mipmaps[ne]:C.image;if(U!==null)he=U.max.x-U.min.x,_e=U.max.y-U.min.y,fe=U.isBox3?U.max.z-U.min.z:1,Pe=U.min.x,Ae=U.min.y,ye=U.isBox3?U.min.z:0;else{const Ti=Math.pow(2,-N);he=Math.floor(Gt.width*Ti),_e=Math.floor(Gt.height*Ti),C.isDataArrayTexture?fe=Gt.depth:C.isData3DTexture?fe=Math.floor(Gt.depth*Ti):fe=1,Pe=0,Ae=0,ye=0}z!==null?(nt=z.x,ft=z.y,Ht=z.z):(nt=0,ft=0,Ht=0);const xt=Ie.convert(I.format),Se=Ie.convert(I.type);let Nt;I.isData3DTexture?(Fe.setTexture3D(I,0),Nt=L.TEXTURE_3D):I.isDataArrayTexture||I.isCompressedArrayTexture?(Fe.setTexture2DArray(I,0),Nt=L.TEXTURE_2D_ARRAY):(Fe.setTexture2D(I,0),Nt=L.TEXTURE_2D),L.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,I.flipY),L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,I.premultiplyAlpha),L.pixelStorei(L.UNPACK_ALIGNMENT,I.unpackAlignment);const ot=L.getParameter(L.UNPACK_ROW_LENGTH),oi=L.getParameter(L.UNPACK_IMAGE_HEIGHT),fa=L.getParameter(L.UNPACK_SKIP_PIXELS),ai=L.getParameter(L.UNPACK_SKIP_ROWS),jl=L.getParameter(L.UNPACK_SKIP_IMAGES);L.pixelStorei(L.UNPACK_ROW_LENGTH,Gt.width),L.pixelStorei(L.UNPACK_IMAGE_HEIGHT,Gt.height),L.pixelStorei(L.UNPACK_SKIP_PIXELS,Pe),L.pixelStorei(L.UNPACK_SKIP_ROWS,Ae),L.pixelStorei(L.UNPACK_SKIP_IMAGES,ye);const Ft=C.isDataArrayTexture||C.isData3DTexture,Xn=I.isDataArrayTexture||I.isData3DTexture;if(C.isDepthTexture){const Ti=Ee.get(C),Vn=Ee.get(I),qn=Ee.get(Ti.__renderTarget),op=Ee.get(Vn.__renderTarget);ge.bindFramebuffer(L.READ_FRAMEBUFFER,qn.__webglFramebuffer),ge.bindFramebuffer(L.DRAW_FRAMEBUFFER,op.__webglFramebuffer);for(let ao=0;ao<fe;ao++)Ft&&(L.framebufferTextureLayer(L.READ_FRAMEBUFFER,L.COLOR_ATTACHMENT0,Ee.get(C).__webglTexture,N,ye+ao),L.framebufferTextureLayer(L.DRAW_FRAMEBUFFER,L.COLOR_ATTACHMENT0,Ee.get(I).__webglTexture,ne,Ht+ao)),L.blitFramebuffer(Pe,Ae,he,_e,nt,ft,he,_e,L.DEPTH_BUFFER_BIT,L.NEAREST);ge.bindFramebuffer(L.READ_FRAMEBUFFER,null),ge.bindFramebuffer(L.DRAW_FRAMEBUFFER,null)}else if(N!==0||C.isRenderTargetTexture||Ee.has(C)){const Ti=Ee.get(C),Vn=Ee.get(I);ge.bindFramebuffer(L.READ_FRAMEBUFFER,NM),ge.bindFramebuffer(L.DRAW_FRAMEBUFFER,FM);for(let qn=0;qn<fe;qn++)Ft?L.framebufferTextureLayer(L.READ_FRAMEBUFFER,L.COLOR_ATTACHMENT0,Ti.__webglTexture,N,ye+qn):L.framebufferTexture2D(L.READ_FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,Ti.__webglTexture,N),Xn?L.framebufferTextureLayer(L.DRAW_FRAMEBUFFER,L.COLOR_ATTACHMENT0,Vn.__webglTexture,ne,Ht+qn):L.framebufferTexture2D(L.DRAW_FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,Vn.__webglTexture,ne),N!==0?L.blitFramebuffer(Pe,Ae,he,_e,nt,ft,he,_e,L.COLOR_BUFFER_BIT,L.NEAREST):Xn?L.copyTexSubImage3D(Nt,ne,nt,ft,Ht+qn,Pe,Ae,he,_e):L.copyTexSubImage2D(Nt,ne,nt,ft,Pe,Ae,he,_e);ge.bindFramebuffer(L.READ_FRAMEBUFFER,null),ge.bindFramebuffer(L.DRAW_FRAMEBUFFER,null)}else Xn?C.isDataTexture||C.isData3DTexture?L.texSubImage3D(Nt,ne,nt,ft,Ht,he,_e,fe,xt,Se,Gt.data):I.isCompressedArrayTexture?L.compressedTexSubImage3D(Nt,ne,nt,ft,Ht,he,_e,fe,xt,Gt.data):L.texSubImage3D(Nt,ne,nt,ft,Ht,he,_e,fe,xt,Se,Gt):C.isDataTexture?L.texSubImage2D(L.TEXTURE_2D,ne,nt,ft,he,_e,xt,Se,Gt.data):C.isCompressedTexture?L.compressedTexSubImage2D(L.TEXTURE_2D,ne,nt,ft,Gt.width,Gt.height,xt,Gt.data):L.texSubImage2D(L.TEXTURE_2D,ne,nt,ft,he,_e,xt,Se,Gt);L.pixelStorei(L.UNPACK_ROW_LENGTH,ot),L.pixelStorei(L.UNPACK_IMAGE_HEIGHT,oi),L.pixelStorei(L.UNPACK_SKIP_PIXELS,fa),L.pixelStorei(L.UNPACK_SKIP_ROWS,ai),L.pixelStorei(L.UNPACK_SKIP_IMAGES,jl),ne===0&&I.generateMipmaps&&L.generateMipmap(Nt),ge.unbindTexture()},this.initRenderTarget=function(C){Ee.get(C).__webglFramebuffer===void 0&&Fe.setupRenderTarget(C)},this.initTexture=function(C){C.isCubeTexture?Fe.setTextureCube(C,0):C.isData3DTexture?Fe.setTexture3D(C,0):C.isDataArrayTexture||C.isCompressedArrayTexture?Fe.setTexture2DArray(C,0):Fe.setTexture2D(C,0),ge.unbindTexture()},this.resetState=function(){A=0,x=0,E=null,ge.reset(),D.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return mr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=at._getDrawingBufferColorSpace(e),t.unpackColorSpace=at._getUnpackColorSpace()}}const hb={type:"change"},k0={type:"start"},Ey={type:"end"},iu=new sy,ub=new Ds,nL=Math.cos(70*M2.DEG2RAD),ln=new k,Zn=2*Math.PI,gt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Up=1e-6;class iL extends fP{constructor(e,t=null){super(e,t),this.state=gt.NONE,this.target=new k,this.cursor=new k,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:qa.ROTATE,MIDDLE:qa.DOLLY,RIGHT:qa.PAN},this.touches={ONE:ja.ROTATE,TWO:ja.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new k,this._lastQuaternion=new zo,this._lastTargetPosition=new k,this._quat=new zo().setFromUnitVectors(e.up,new k(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Bg,this._sphericalDelta=new Bg,this._scale=1,this._panOffset=new k,this._rotateStart=new Ne,this._rotateEnd=new Ne,this._rotateDelta=new Ne,this._panStart=new Ne,this._panEnd=new Ne,this._panDelta=new Ne,this._dollyStart=new Ne,this._dollyEnd=new Ne,this._dollyDelta=new Ne,this._dollyDirection=new k,this._mouse=new Ne,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=sL.bind(this),this._onPointerDown=rL.bind(this),this._onPointerUp=oL.bind(this),this._onContextMenu=pL.bind(this),this._onMouseWheel=cL.bind(this),this._onKeyDown=hL.bind(this),this._onTouchStart=uL.bind(this),this._onTouchMove=dL.bind(this),this._onMouseDown=aL.bind(this),this._onMouseMove=lL.bind(this),this._interceptControlDown=fL.bind(this),this._interceptControlUp=mL.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(hb),this.update(),this.state=gt.NONE}update(e=null){const t=this.object.position;ln.copy(t).sub(this.target),ln.applyQuaternion(this._quat),this._spherical.setFromVector3(ln),this.autoRotate&&this.state===gt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(i)&&isFinite(r)&&(i<-Math.PI?i+=Zn:i>Math.PI&&(i-=Zn),r<-Math.PI?r+=Zn:r>Math.PI&&(r-=Zn),i<=r?this._spherical.theta=Math.max(i,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+r)/2?Math.max(i,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(ln.setFromSpherical(this._spherical),ln.applyQuaternion(this._quatInverse),t.copy(this.target).add(ln),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=ln.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const a=new k(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const c=new k(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=ln.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(iu.origin.copy(this.object.position),iu.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(iu.direction))<nL?this.object.lookAt(this.target):(ub.setFromNormalAndCoplanarPoint(this.object.up,this.target),iu.intersectPlane(ub,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>Up||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Up||this._lastTargetPosition.distanceToSquared(this.target)>Up?(this.dispatchEvent(hb),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Zn/60*this.autoRotateSpeed*e:Zn/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){ln.setFromMatrixColumn(t,0),ln.multiplyScalar(-e),this._panOffset.add(ln)}_panUp(e,t){this.screenSpacePanning===!0?ln.setFromMatrixColumn(t,1):(ln.setFromMatrixColumn(t,0),ln.crossVectors(this.object.up,ln)),ln.multiplyScalar(e),this._panOffset.add(ln)}_pan(e,t){const i=this.domElement;if(this.object.isPerspectiveCamera){const r=this.object.position;ln.copy(r).sub(this.target);let s=ln.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/i.clientHeight,this.object.matrix),this._panUp(2*t*s/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),r=e-i.left,s=t-i.top,o=i.width,a=i.height;this._mouse.x=r/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Zn*this._rotateDelta.x/t.clientHeight),this._rotateUp(Zn*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Zn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Zn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Zn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Zn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._rotateStart.set(i,r)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panStart.set(i,r)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const i=this._getSecondPointerPosition(e),r=.5*(e.pageX+i.x),s=.5*(e.pageY+i.y);this._rotateEnd.set(r,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Zn*this._rotateDelta.x/t.clientHeight),this._rotateUp(Zn*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this._panEnd.set(i,r)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,r=e.pageY-t.y,s=Math.sqrt(i*i+r*r);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Ne,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function rL(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function sL(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function oL(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Ey),this.state=gt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function aL(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case qa.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=gt.DOLLY;break;case qa.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=gt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=gt.ROTATE}break;case qa.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=gt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=gt.PAN}break;default:this.state=gt.NONE}this.state!==gt.NONE&&this.dispatchEvent(k0)}function lL(n){switch(this.state){case gt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case gt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case gt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function cL(n){this.enabled===!1||this.enableZoom===!1||this.state!==gt.NONE||(n.preventDefault(),this.dispatchEvent(k0),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(Ey))}function hL(n){this.enabled!==!1&&this._handleKeyDown(n)}function uL(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case ja.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=gt.TOUCH_ROTATE;break;case ja.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=gt.TOUCH_PAN;break;default:this.state=gt.NONE}break;case 2:switch(this.touches.TWO){case ja.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=gt.TOUCH_DOLLY_PAN;break;case ja.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=gt.TOUCH_DOLLY_ROTATE;break;default:this.state=gt.NONE}break;default:this.state=gt.NONE}this.state!==gt.NONE&&this.dispatchEvent(k0)}function dL(n){switch(this._trackPointer(n),this.state){case gt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case gt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case gt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case gt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=gt.NONE}}function pL(n){this.enabled!==!1&&n.preventDefault()}function fL(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function mL(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class vL extends py{constructor(){super();const e=new no;e.deleteAttribute("uv");const t=new Ja({side:$n}),i=new Ja,r=new hP(16777215,900,28,2);r.position.set(.418,16.199,.3),this.add(r);const s=new jt(e,t);s.position.set(-.757,13.219,.717),s.scale.set(31.713,28.305,28.591),this.add(s);const o=new J2(e,i,6),a=new xn;a.position.set(-10.906,2.009,1.846),a.rotation.set(0,-.195,0),a.scale.set(2.328,7.905,4.651),a.updateMatrix(),o.setMatrixAt(0,a.matrix),a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),a.updateMatrix(),o.setMatrixAt(1,a.matrix),a.position.set(6.167,.857,7.803),a.rotation.set(0,.561,0),a.scale.set(3.927,6.285,3.687),a.updateMatrix(),o.setMatrixAt(2,a.matrix),a.position.set(-2.017,.018,6.124),a.rotation.set(0,.333,0),a.scale.set(2.002,4.566,2.064),a.updateMatrix(),o.setMatrixAt(3,a.matrix),a.position.set(2.291,-.756,-2.621),a.rotation.set(0,-.286,0),a.scale.set(1.546,1.552,1.496),a.updateMatrix(),o.setMatrixAt(4,a.matrix),a.position.set(-2.193,-.369,-5.547),a.rotation.set(0,.516,0),a.scale.set(3.875,3.487,2.986),a.updateMatrix(),o.setMatrixAt(5,a.matrix),this.add(o);const l=new jt(e,La(50));l.position.set(-16.116,14.37,8.208),l.scale.set(.1,2.428,2.739),this.add(l);const c=new jt(e,La(50));c.position.set(-16.109,18.021,-8.207),c.scale.set(.1,2.425,2.751),this.add(c);const h=new jt(e,La(17));h.position.set(14.904,12.198,-1.832),h.scale.set(.15,4.265,6.331),this.add(h);const u=new jt(e,La(43));u.position.set(-.462,8.89,14.52),u.scale.set(4.38,5.441,.088),this.add(u);const d=new jt(e,La(20));d.position.set(3.235,11.486,-12.541),d.scale.set(2.5,2,.1),this.add(d);const p=new jt(e,La(100));p.position.set(0,20,0),p.scale.set(1,.1,1),this.add(p)}dispose(){const e=new Set;this.traverse(t=>{t.isMesh&&(e.add(t.geometry),e.add(t.material))});for(const t of e)t.dispose()}}function La(n){return new nP({color:0,emissive:16777215,emissiveIntensity:n})}function St(n){return n==null}function I0(n){return n!==null&&typeof n=="object"}function Pm(n){return n!==null&&typeof n=="object"}function _L(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ho(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,r)=>{const s=n[r],o=e[r];return Pm(s)&&Pm(o)?Object.assign(Object.assign({},i),{[r]:Ho(s,o)}):Object.assign(Object.assign({},i),{[r]:r in e?o:s})},{})}function O0(n){return I0(n)?"target"in n:!1}const gL={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let Ln=class Ha{static alreadyDisposed(){return new Ha({type:"alreadydisposed"})}static notBindable(){return new Ha({type:"notbindable"})}static notCompatible(e,t){return new Ha({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Ha({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Ha({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=gL[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},db=class Cy{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!Cy.isBindable(i))throw Ln.notBindable();if(!(e in i))throw Ln.propertyNotFound(e);i[e]=t}},an=class{constructor(){this.observers_={}}on(e,t,i){var r;let s=this.observers_[e];return s||(s=this.observers_[e]=[]),s.push({handler:t,key:(r=i?.key)!==null&&r!==void 0?r:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(r=>r.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(r=>{r.handler(t)})}},bL=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:((r,s)=>r===s),this.emitter=new an,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(e):e,s=this.rawValue_;this.equals_(s,r)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:r,sender:this}))}},xL=class{constructor(e){this.emitter=new an,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},r=this.value_;r===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:this.value_,sender:this}))}},wL=class{constructor(e){this.emitter=new an,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function It(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new xL(n):new bL(n,e)}function yL(n){return[new wL(n),(e,t)=>{n.setRawValue(e,t)}]}let Ze=class Sy{constructor(e){this.emitter=new an,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,r)=>Object.assign(i,{[r]:It(e[r])}),{})}static fromObject(e){const t=this.createCore(e);return new Sy(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},dh=class{constructor(e){this.values=Ze.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},EL=class{constructor(e){this.values=Ze.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let r=e;return St(i)||(r=Math.max(r,i)),St(t)||(r=Math.min(r,t)),r}},CL=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},SL=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const ML={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let PL=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=ML[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const TL={"+":n=>n,"-":n=>-n,"~":n=>~n};let AL=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=TL[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function N0(n){return(e,t)=>{for(let i=0;i<n.length;i++){const r=n[i](e,t);if(r!=="")return r}return""}}function Vc(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function RL(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Uc(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function LL(n,e){const t=Uc(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const r=Uc(n,e);return r===""?"":i+r}function F0(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=LL(n,e);return i===""?"":t+i}function My(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=RL(n,e);return e+=i.length,i===""?"":i+Uc(n,e)}function DL(n,e){const t=My(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const r=Uc(n,e);return e+=r.length,t+i+r+F0(n,e)}function kL(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Uc(n,e);return e+=i.length,i===""?"":t+i+F0(n,e)}function IL(n,e){const t=My(n,e);return e+=t.length,t===""?"":t+F0(n,e)}const OL=N0([DL,kL,IL]);function NL(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function FL(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=NL(n,e);return i===""?"":t+i}function VL(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function UL(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=VL(n,e);return i===""?"":t+i}function BL(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function zL(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=BL(n,e);return i===""?"":t+i}const $L=N0([FL,UL,zL]),HL=N0([$L,OL]);function GL(n,e){const t=HL(n,e);return e+=t.length,t===""?null:{evaluable:new SL(t),cursor:e}}function jL(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=Ty(n,e);if(!i)return null;e=i.cursor,e+=Vc(n,e).length;const r=n.substr(e,1);return e+=r.length,r!==")"?null:{evaluable:i.evaluable,cursor:e}}function WL(n,e){var t;return(t=GL(n,e))!==null&&t!==void 0?t:jL(n,e)}function Py(n,e){const t=WL(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const r=Py(n,e);return r?(e=r.cursor,{cursor:e,evaluable:new AL(i,r.evaluable)}):null}function KL(n,e,t){t+=Vc(e,t).length;const i=n.filter(r=>e.startsWith(r,t))[0];return i?(t+=i.length,t+=Vc(e,t).length,{cursor:t,operator:i}):null}function XL(n,e){return(t,i)=>{const r=n(t,i);if(!r)return null;i=r.cursor;let s=r.evaluable;for(;;){const o=KL(e,t,i);if(!o)break;i=o.cursor;const a=n(t,i);if(!a)return null;i=a.cursor,s=new PL(o.operator,s,a.evaluable)}return s?{cursor:i,evaluable:s}:null}}const qL=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>XL(n,e),Py);function Ty(n,e){return e+=Vc(n,e).length,qL(n,e)}function YL(n){const e=Ty(n,0);return!e||e.cursor+Vc(n,e.cursor).length!==n.length?null:e.evaluable}function as(n){var e;const t=YL(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function Ay(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=as(n);if(!St(e))return e}return 0}function ZL(n){return String(n)}function ri(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function ht(n,e,t,i,r){const s=(n-e)/(t-e);return i+s*(r-i)}function pb(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function hn(n,e,t){return Math.min(Math.max(n,e),t)}function Ry(n,e){return(n%e+e)%e}function JL(n,e){return St(n.step)?Math.max(pb(e),2):pb(n.step)}function Ly(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function Dy(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function ky(n,e){return St(n.step)?null:new CL(n.step,e)}function Iy(n){return!St(n.max)&&!St(n.min)?new dh({max:n.max,min:n.min}):!St(n.max)||!St(n.min)?new EL({max:n.max,min:n.min}):null}function Oy(n,e){var t,i,r;return{formatter:(t=n.format)!==null&&t!==void 0?t:ri(JL(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:Ly(n),pointerScale:(r=n.pointerScale)!==null&&r!==void 0?r:Dy(n,e)}}function Ny(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function V0(n){return{constraint:n.constraint,textProps:Ze.fromObject(Oy(n.params,n.initialValue))}}let ra=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Pd=class{constructor(e){this.target=e}},ph=class extends Pd{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},QL=class extends Pd{constructor(e,t){super(e),this.expanded=t}},eD=class extends Pd{constructor(e,t){super(e),this.index=t}},tD=class extends Pd{constructor(e,t){super(e),this.native=t}},Bc=class extends ra{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new an,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new ph(this,t.binding.target.read(),e.options.last))}};class nD{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new an}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function iD(n){if(!("binding"in n))return!1;const e=n.binding;return O0(e)&&"read"in e&&"write"in e}function rD(n,e){const i=Object.keys(e).reduce((r,s)=>{if(r===void 0)return;const o=e[s],a=o(n[s]);return a.succeeded?Object.assign(Object.assign({},r),{[s]:a.value}):void 0},{});return i}function sD(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const r=e(i);if(!(!r.succeeded||r.value===void 0))return[...t,r.value]},[])}function oD(n){return n===null?!1:typeof n=="object"}function Gr(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function fb(n){return{custom:e=>Gr(e)(n),boolean:Gr(e=>typeof e=="boolean"?e:void 0)(n),number:Gr(e=>typeof e=="number"?e:void 0)(n),string:Gr(e=>typeof e=="string"?e:void 0)(n),function:Gr(e=>typeof e=="function"?e:void 0)(n),constant:e=>Gr(t=>t===e?e:void 0)(n),raw:Gr(e=>e)(n),object:e=>Gr(t=>{if(oD(t))return rD(t,e)})(n),array:e=>Gr(t=>{if(Array.isArray(t))return sD(t,e)})(n)}}const Tm={optional:fb(!0),required:fb(!1)};function $t(n,e){const t=e(Tm),i=Tm.required.object(t)(n);return i.succeeded?i.value:void 0}function Si(n,e,t,i){if(e&&!e(n))return!1;const r=$t(n,t);return r?i(r):!1}function Mi(n,e){var t;return Ho((t=n?.())!==null&&t!==void 0?t:{},e)}function Oo(n){return"value"in n}function Fy(n){if(!I0(n)||!("binding"in n))return!1;const e=n.binding;return O0(e)}const vr="http://www.w3.org/2000/svg";function Hu(n){n.offsetHeight}function aD(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function U0(n){return n.ontouchstart!==void 0}function lD(){return globalThis}function cD(){return lD().document}function hD(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const uD={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Td(n,e){const t=n.createElementNS(vr,"svg");return t.innerHTML=uD[e],t}function Vy(n,e,t){n.insertBefore(e,n.children[t])}function B0(n){n.parentElement&&n.parentElement.removeChild(n)}function Uy(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function dD(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function By(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function is(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Sr(n,e,t){is(n.value(e),t)}const pD="tp";function st(n){return(t,i)=>[pD,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const tc=st("lbl");function fD(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(r=>n.createTextNode(r)).forEach((r,s)=>{s>0&&t.appendChild(n.createElement("br")),t.appendChild(r)}),t}let zy=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(tc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(tc("l")),Sr(t.props,"label",s=>{St(s)?this.element.classList.add(tc(void 0,"nol")):(this.element.classList.remove(tc(void 0,"nol")),dD(i),i.appendChild(fD(e,s)))}),this.element.appendChild(i),this.labelElement=i;const r=e.createElement("div");r.classList.add(tc("v")),this.element.appendChild(r),this.valueElement=r}},$y=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new zy(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Si(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Mi(null,{label:this.props.get("label")})}};function mD(){return["veryfirst","first","last","verylast"]}const mb=st(""),vb={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let Ad=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{mD().forEach(i=>{t.classList.remove(mb(void 0,vb[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(mb(void 0,vb[i]))})}),this.viewProps.handleDispose(()=>{B0(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Si(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Mi(null,Object.assign({},this.viewProps.exportState()))}},Go=class extends Ad{constructor(e,t){if(t.value!==t.valueController.value)throw Ln.shouldNeverHappen();const i=t.valueController.viewProps,r=new $y(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new zy(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=r,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return Si(e,t=>{var i,r,s;return super.importState(t)&&this.labelController.importProps(t)&&((s=(r=(i=this.valueController).importProps)===null||r===void 0?void 0:r.call(i,e))!==null&&s!==void 0?s:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return Mi(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}};function _b(n){const e=Object.assign({},n);return delete e.value,e}class Hy extends Go{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return Si(e,t=>super.importState(_b(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return Mi(()=>_b(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function vD(n){return Oo(n)&&Fy(n.value)}class _D extends Hy{importState(e){return Si(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function gD(n){return Oo(n)&&iD(n.value)}function Gy(n,e){for(;n.length<e;)n.push(void 0)}function bD(n){const e=[];return Gy(e,n),e}function xD(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function wD(n,e){const t=[...xD(n),e];return t.length>n.length?t.splice(0,t.length-n.length):Gy(t,n.length),t}class yD{constructor(e){this.emitter=new an,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=It(bD(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=wD(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function ED(n){if(!("binding"in n))return!1;const e=n.binding;return O0(e)&&"read"in e&&!("write"in e)}class CD extends Hy{exportState(){return Mi(()=>super.exportState(),{binding:{readonly:!0}})}}function SD(n){return Oo(n)&&ED(n.value)}let MD=class extends ra{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,s=>{i(new tD(this,s.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}};function PD(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function Ol(n,e){return t=>{PD(n,e,t)}}function z0(n,e){is(n,t=>{e.textContent=t??""})}const Bp=st("btn");let TD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Bp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Bp("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const r=e.createElement("div");r.classList.add(Bp("t")),z0(t.props.value("title"),r),this.buttonElement.appendChild(r)}},AD=class{constructor(e,t){this.emitter=new an,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new TD(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Si(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Mi(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}},gb=class extends Ad{constructor(e,t){const i=new AD(e,{props:t.buttonProps,viewProps:t.viewProps}),r=new $y(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:r.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=r}importState(e){return Si(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Mi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},jy=class{constructor(e){const[t,i]=e.split("-"),r=t.split(".");this.major=parseInt(r[0],10),this.minor=parseInt(r[1],10),this.patch=parseInt(r[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const Nl=new jy("2.0.5");function Kn(n){return Object.assign({core:Nl},n)}const RD=Kn({id:"button",type:"blade",accept(n){const e=$t(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new gb(n.document,{blade:n.blade,buttonProps:Ze.fromObject({title:n.params.title}),labelProps:Ze.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof gb?new MD(n.controller):null}});function LD(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function DD(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function kD(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function ID(n){return I0(n)?"refresh"in n&&typeof n.refresh=="function":!1}function OD(n,e){if(!db.isBindable(n))throw Ln.notBindable();return new db(n,e)}let ND=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new an,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const r=i??{},s=this.controller_.element.ownerDocument,o=this.pool_.createBinding(s,OD(e,t),r),a=this.pool_.createBindingApi(o);return this.add(a,r.index)}addFolder(e){return DD(this,e)}addButton(e){return LD(this,e)}addTab(e){return kD(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),r=this.pool_.createApi(i);return this.add(r,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{ID(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),r=Fy(t.value)?t.value.binding:null;this.emitter_.emit("change",new ph(i,r?r.target.read():t.value.rawValue,e.options.last))}},$0=class extends ra{constructor(e,t){super(e),this.rackApi_=new ND(e.rackController,t)}refresh(){this.rackApi_.refresh()}},H0=class extends Ad{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Si(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,r)=>i.importState(t.children[r])))}exportState(){return Mi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Am(n){return"rackController"in n}let FD=class{constructor(e){this.emitter=new an,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Ln.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const r=this.extract_(e);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach(s=>{this.cache_.add(s)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(r=>{this.cache_.delete(r)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function VD(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Oo(i)&&i.value===e)return i}return null}function UD(n){return Am(n)?n.rackController.rack.bcSet_:null}let BD=class{constructor(e){var t,i;this.emitter=new an,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new FD(UD),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Oo(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Am(i)){const r=i.rackController.rack;if(r){const s=r.emitter;s.on("layout",this.onRackLayout_),s.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Oo(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Am(i)){const r=i.rackController.rack;if(r){const s=r.emitter;s.off("layout",this.onRackLayout_),s.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(r=>!r.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(r=>{const s=[];r===t&&(s.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&s.push("veryfirst")),r===i&&(s.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&s.push("verylast")),r.blade.set("positions",s)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=VD(this.find(Oo),e.sender);if(!t)throw Ln.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},G0=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new BD({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&Vy(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&B0(e.bladeController.view.element)}};function Fl(){return new Ze({positions:It([],{equals:_L})})}let j0=class Wy extends Ze{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=Ze.createCore(t);return new Wy(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!St(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Sr(this,"expanded",i),Sr(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function zD(n,e){let t=0;return aD(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),Hu(e),t=e.clientHeight,n.set("temporaryExpanded",null),Hu(e)}),t}function bb(n,e){e.style.height=n.styleHeight}function W0(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),St(n.get("expandedHeight"))){const t=zD(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),Hu(e)}),n.emitter.on("change",()=>{bb(n,e)}),bb(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let Ky=class extends $0{constructor(e,t){super(e,t),this.emitter_=new an,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new QL(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}};const Xy=st("cnt");let $D=class{constructor(e,t){var i;this.className_=st((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Xy()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Sr(this.foldable_,"completed",Ol(this.element,this.className_(void 0,"cpl")));const r=e.createElement("button");r.classList.add(this.className_("b")),Sr(t.props,"title",c=>{St(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const o=e.createElement("div");o.classList.add(this.className_("t")),z0(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const l=e.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}},Rm=class extends H0{constructor(e,t){var i;const r=j0.create((i=t.expanded)!==null&&i!==void 0?i:!0),s=new $D(e,{foldable:r,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new G0({blade:t.blade,element:s.containerElement,root:t.root,viewProps:t.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=r,W0(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Si(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Mi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};const HD=Kn({id:"folder",type:"blade",accept(n){const e=$t(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new Rm(n.document,{blade:n.blade,expanded:n.params.expanded,props:Ze.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Rm?new Ky(n.controller,n.pool):null}}),GD=st("");function xb(n,e){return Ol(n,GD(void 0,e))}let sa=class qy extends Ze{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=yL(It(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,r;const s=e??{};return new qy(Ze.createCore({disabled:(t=s.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=s.hidden)!==null&&i!==void 0?i:!1,parent:(r=s.parent)!==null&&r!==void 0?r:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){is(this.globalDisabled_,xb(e,"disabled")),Sr(this,"hidden",xb(e,"hidden"))}bindDisabled(e){is(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){is(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const wb=st("tbp");let jD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wb()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(wb("c")),this.element.appendChild(i),this.containerElement=i}};const nc=st("tbi");let WD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nc()),t.viewProps.bindClassModifiers(this.element),Sr(t.props,"selected",s=>{s?this.element.classList.add(nc(void 0,"sel")):this.element.classList.remove(nc(void 0,"sel"))});const i=e.createElement("button");i.classList.add(nc("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const r=e.createElement("div");r.classList.add(nc("t")),z0(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r}},KD=class{constructor(e,t){this.emitter=new an,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new WD(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Lm=class extends H0{constructor(e,t){const i=new jD(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new G0({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new KD(e,{props:t.itemProps,viewProps:sa.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Sr(this.props,"selected",r=>{this.itemController.props.set("selected",r),this.viewProps.set("hidden",!r)})}get itemController(){return this.ic_}importState(e){return Si(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Mi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},XD=class extends $0{constructor(e,t){super(e,t),this.emitter_=new an,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Lm(t,{blade:Fl(),itemProps:Ze.fromObject({selected:!1,title:e.title}),props:Ze.fromObject({selected:!1}),viewProps:sa.create()}),r=this.pool_.createApi(i);return this.rackApi_.add(r,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new eD(this,e.rawValue))}},qD=class extends $0{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const yb=-1;let YD=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=It(!0),this.selectedIndex=It(yb),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=yb,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,r)=>{i.rawValue=r===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const ic=st("tab");let ZD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ic(),Xy()),t.viewProps.bindClassModifiers(this.element),is(t.empty,Ol(this.element,ic(void 0,"nop")));const i=e.createElement("div");i.classList.add(ic("t")),this.element.appendChild(i),this.itemsElement=i;const r=e.createElement("div");r.classList.add(ic("i")),this.element.appendChild(r);const s=e.createElement("div");s.classList.add(ic("c")),this.element.appendChild(s),this.contentsElement=s}},Eb=class extends H0{constructor(e,t){const i=new YD,r=new ZD(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new G0({blade:t.blade,element:r.contentsElement,viewProps:t.viewProps}),view:r}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;Vy(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;B0(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};const Yy=Kn({id:"tab",type:"blade",accept(n){const e=$t(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new Eb(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Lm(n.document,{blade:Fl(),itemProps:Ze.fromObject({selected:!1,title:t.title}),props:Ze.fromObject({selected:!1}),viewProps:sa.create()});e.add(i)}),e},api(n){return n.controller instanceof Eb?new XD(n.controller,n.pool):n.controller instanceof Lm?new qD(n.controller,n.pool):null}});function JD(n,e){const t=n.accept(e.params);if(!t)return null;const i=$t(e.params,r=>({disabled:r.optional.boolean,hidden:r.optional.boolean}));return n.controller({blade:Fl(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:i?.disabled,hidden:i?.hidden}),viewProps:sa.create({disabled:i?.disabled,hidden:i?.hidden})})}let K0=class extends Bc{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},QD=class{constructor(){this.disabled=!1,this.emitter=new an}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}},e5=class{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new an,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}},fh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function Gu(n,e){if(n instanceof e)return n;if(n instanceof fh){const t=n.constraints.reduce((i,r)=>i||(r instanceof e?r:null),null);if(t)return t}return null}let mh=class{constructor(e){this.values=Ze.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(r=>r.value===e).length>0?e:t[0].value}};function vh(n){var e;const t=Tm;if(Array.isArray(n))return(e=$t({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function X0(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function q0(n){return St(n)?null:new mh(X0(n))}const zp=st("lst");let t5=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(zp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(zp("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const r=e.createElement("div");r.classList.add(zp("m")),r.appendChild(Td(e,"dropdown")),this.element.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Sr(this.props_,"options",s=>{Uy(this.selectElement),s.forEach(o=>{const a=e.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Zs=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new t5(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Si(e,null,t=>({options:t.required.custom(vh)}),t=>(this.props.set("options",X0(t.options)),!0))}exportProps(){return Mi(null,{options:this.props.get("options")})}};const Cb=st("pop");let n5=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Cb()),t.viewProps.bindClassModifiers(this.element),is(t.shows,Ol(this.element,Cb(void 0,"v")))}},Zy=class{constructor(e,t){this.shows=It(!1),this.viewProps=t.viewProps,this.view=new n5(e,{shows:this.shows,viewProps:this.viewProps})}};const Sb=st("txt");let i5=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Sb()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(Sb("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},zc=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new i5(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,r=this.parser_(i);St(r)||(this.value.rawValue=r),this.view.refresh()}};function r5(n){return String(n)}function Jy(n){return n==="false"?!1:!!n}function Mb(n){return r5(n)}function s5(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const o5=ri(0);function ju(n){return o5(n)+"%"}function Qy(n){return String(n)}function Dm(n){return n}function Vl({primary:n,secondary:e,forward:t,backward:i}){let r=!1;function s(o){r||(r=!0,o(),r=!1)}n.emitter.on("change",o=>{s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{s(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Jn(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function $c(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function ls(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function a5(n){return n==="ArrowUp"||n==="ArrowDown"}function e1(n){return a5(n)||n==="ArrowLeft"||n==="ArrowRight"}function $p(n,e){var t,i;const r=e.ownerDocument.defaultView,s=e.getBoundingClientRect();return{x:n.pageX-(((t=r&&r.scrollX)!==null&&t!==void 0?t:0)+s.left),y:n.pageY-(((i=r&&r.scrollY)!==null&&i!==void 0?i:0)+s.top)}}let oa=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new an,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_($p(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_($p(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_($p(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-r.left,y:i.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Ri=st("txt");let l5=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Ri(),Ri(void 0,"num")),t.arrayPosition&&this.element.classList.add(Ri(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Ri("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ri()),this.inputElement.classList.add(Ri("i"));const r=e.createElement("div");r.classList.add(Ri("k")),this.element.appendChild(r),this.knobElement=r;const s=e.createElementNS(vr,"svg");s.classList.add(Ri("g")),this.knobElement.appendChild(s);const o=e.createElementNS(vr,"path");o.classList.add(Ri("gb")),s.appendChild(o),this.guideBodyElem_=o;const a=e.createElementNS(vr,"path");a.classList.add(Ri("gh")),s.appendChild(a),this.guideHeadElem_=a;const l=e.createElement("div");l.classList.add(st("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Ri(void 0,"drg"));return}this.element.classList.add(Ri(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),r=hn(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+r},0 L${i},4 L${i+r},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},_h=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=It(null),this.view=new l5(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new oa(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const r=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),s=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return r!==void 0&&(o=Math.max(o,r)),s!==void 0&&(o=Math.min(o,s)),o}onInputChange_(e){const i=e.currentTarget.value,r=this.parser_(i);St(r)||(this.value.rawValue=this.constrainValue_(r)),this.view.refresh()}onInputKeyDown_(e){const t=Jn(this.props.get("keyScale"),$c(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Jn(this.props.get("keyScale"),$c(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const Hp=st("sld");let c5=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Hp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Hp("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const r=e.createElement("div");r.classList.add(Hp("k")),this.trackElement.appendChild(r),this.knobElement=r,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=hn(ht(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},h5=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new c5(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oa(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(ht(hn(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jn(this.props.get("keyScale"),ls(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Jn(this.props.get("keyScale"),ls(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Gp=st("sldtxt");let u5=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Gp());const i=e.createElement("div");i.classList.add(Gp("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(Gp("t")),this.textView_=t.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}},Wu=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new h5(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new _h(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new u5(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Si(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Mi(null,{max:e.get("max"),min:e.get("min")})}};function t1(n){return{sliderProps:new Ze({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new Ze({formatter:It(n.formatter),keyScale:n.keyScale,pointerScale:It(n.pointerScale)})}}const d5={containerUnitSize:"cnt-usz"};function n1(n){return`--${d5[n]}`}function Hc(n){return Ny(n)}function Os(n){if(Pm(n))return $t(n,Hc)}function Zr(n,e){if(!n)return;const t=[],i=ky(n,e);i&&t.push(i);const r=Iy(n);return r&&t.push(r),new fh(t)}function p5(n){return n?n.major===Nl.major:!1}function i1(n){if(n==="inline"||n==="popup")return n}function gh(n,e){n.write(e)}const ru=st("ckb");let f5=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ru()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(ru("l")),this.element.appendChild(i),this.labelElement=i;const r=e.createElement("input");r.classList.add(ru("i")),r.type="checkbox",this.labelElement.appendChild(r),this.inputElement=r,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(ru("w")),this.labelElement.appendChild(s);const o=Td(e,"check");s.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},m5=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new f5(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}};function v5(n){const e=[],t=q0(n.options);return t&&e.push(t),new fh(e)}const _5=Kn({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=$t(e,i=>({options:i.optional.custom(vh),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Jy,constraint:n=>v5(n.params),writer:n=>gh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,r=i&&Gu(i,mh);return r?new Zs(e,{props:new Ze({options:r.values.value("options")}),value:t,viewProps:n.viewProps}):new m5(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Zs?new K0(n.controller):null}}),mo=st("col");let g5=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mo()),t.foldable.bindExpandedClass(this.element,mo(void 0,"expanded")),Sr(t.foldable,"completed",Ol(this.element,mo(void 0,"cpl")));const i=e.createElement("div");i.classList.add(mo("h")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(mo("s")),i.appendChild(r),this.swatchElement=r;const s=e.createElement("div");if(s.classList.add(mo("t")),i.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(mo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function b5(n,e,t){const i=hn(n/255,0,1),r=hn(e/255,0,1),s=hn(t/255,0,1),o=Math.max(i,r,s),a=Math.min(i,r,s),l=o-a;let c=0,h=0;const u=(a+o)/2;return l!==0&&(h=l/(1-Math.abs(o+a-1)),i===o?c=(r-s)/l:r===o?c=2+(s-i)/l:c=4+(i-r)/l,c=c/6+(c<0?1:0)),[c*360,h*100,u*100]}function x5(n,e,t){const i=(n%360+360)%360,r=hn(e/100,0,1),s=hn(t/100,0,1),o=(1-Math.abs(2*s-1))*r,a=o*(1-Math.abs(i/60%2-1)),l=s-o/2;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function w5(n,e,t){const i=hn(n/255,0,1),r=hn(e/255,0,1),s=hn(t/255,0,1),o=Math.max(i,r,s),a=Math.min(i,r,s),l=o-a;let c;l===0?c=0:o===i?c=60*(((r-s)/l%6+6)%6):o===r?c=60*((s-i)/l+2):c=60*((i-r)/l+4);const h=o===0?0:l/o,u=o;return[c,h*100,u*100]}function r1(n,e,t){const i=Ry(n,360),r=hn(e/100,0,1),s=hn(t/100,0,1),o=s*r,a=o*(1-Math.abs(i/60%2-1)),l=s-o;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function y5(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/200]}function E5(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/200]}function Mr(n){return[n[0],n[1],n[2]]}function Rd(n,e){return[n[0],n[1],n[2],e]}const C5={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:y5,rgb:x5},hsv:{hsl:E5,hsv:(n,e,t)=>[n,e,t],rgb:r1},rgb:{hsl:b5,hsv:w5,rgb:(n,e,t)=>[n,e,t]}};function _l(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function S5(n,e){return n===e?e:Ry(n,e)}function s1(n,e,t){var i;const r=_l(e,t);return[e==="rgb"?hn(n[0],0,r[0]):S5(n[0],r[0]),hn(n[1],0,r[1]),hn(n[2],0,r[2]),hn((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function Pb(n,e,t,i){const r=_l(e,t),s=_l(e,i);return n.map((o,a)=>o/r[a]*s[a])}function o1(n,e,t){const i=Pb(n,e.mode,e.type,"int"),r=C5[e.mode][t.mode](...i);return Pb(r,t.mode,"int",t.type)}let ut=class a1{static black(){return new a1([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=s1(e,t,this.type)}getComponents(e){return Rd(o1(Mr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const xs=st("colp");let M5=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(xs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(xs("hsv"));const r=e.createElement("div");r.classList.add(xs("sv")),this.svPaletteView_=t.svPaletteView,r.appendChild(this.svPaletteView_.element),i.appendChild(r);const s=e.createElement("div");s.classList.add(xs("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),i.appendChild(s),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(xs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(xs("a"));const l=e.createElement("div");l.classList.add(xs("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);const c=e.createElement("div");c.classList.add(xs("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function P5(n){return n==="int"?"int":n==="float"?"float":void 0}function Y0(n){return $t(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(P5)}),expanded:e.optional.boolean,picker:e.optional.custom(i1),readonly:e.optional.constant(!1)}))}function jo(n){return n?.1:1}function l1(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Z0=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=s1(e,t,this.type)}getComponents(e){return Rd(o1(Mr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const T5={int:(n,e)=>new ut(n,e),float:(n,e)=>new Z0(n,e)};function J0(n,e,t){return T5[t](n,e)}function A5(n){return n.type==="float"}function R5(n){return n.type==="int"}function L5(n){const e=n.getComponents(),t=_l(n.mode,"int");return new ut([Math.round(ht(e[0],0,1,0,t[0])),Math.round(ht(e[1],0,1,0,t[1])),Math.round(ht(e[2],0,1,0,t[2])),e[3]],n.mode)}function D5(n){const e=n.getComponents(),t=_l(n.mode,"int");return new Z0([ht(e[0],0,t[0],0,1),ht(e[1],0,t[1],0,1),ht(e[2],0,t[2],0,1),e[3]],n.mode)}function Hn(n,e){if(n.type===e)return n;if(R5(n)&&e==="float")return D5(n);if(A5(n)&&e==="int")return L5(n);throw Ln.shouldNeverHappen()}function k5(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Ni(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const I5={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function c1(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return I5[i](t)}function h1(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Ni(e[1],255),Ni(e[2],255),Ni(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function O5(n){const e=h1(n);return e?new ut(e,"rgb"):null}function u1(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Ni(e[1],255),Ni(e[2],255),Ni(e[3],255),Ni(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function N5(n){const e=u1(n);return e?new ut(e,"rgb"):null}function d1(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[c1(e[1]),Ni(e[2],100),Ni(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function F5(n){const e=d1(n);return e?new ut(e,"hsl"):null}function p1(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[c1(e[1]),Ni(e[2],100),Ni(e[3],100),Ni(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function V5(n){const e=p1(n);return e?new ut(e,"hsl"):null}function f1(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function U5(n){const e=f1(n);return e?new ut(e,"rgb"):null}function m1(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),ht(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),ht(parseInt(t[4],16),0,255,0,1)]:null}function B5(n){const e=m1(n);return e?new ut(e,"rgb"):null}function v1(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function z5(n){return e=>{const t=v1(e);return t?J0(t,"rgb",n):null}}function _1(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function $5(n){return e=>{const t=_1(e);return t?J0(t,"rgb",n):null}}const H5=[{parser:f1,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:m1,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:h1,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:u1,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:d1,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:p1,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:v1,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:_1,result:{alpha:!0,mode:"rgb",notation:"object"}}];function G5(n){return H5.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function j5(n,e="int"){const t=G5(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function bh(n){const e=[U5,B5,O5,N5,F5,V5];e.push(z5("int"),$5("int"));const t=s5(e);return i=>{const r=t(i);return r?Hn(r,n):null}}function W5(n){const e=bh("int");if(typeof n!="string")return ut.black();const t=e(n);return t??ut.black()}function g1(n){const e=hn(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Q0(n,e="#"){const t=Mr(n.getComponents("rgb")).map(g1).join("");return`${e}${t}`}function ev(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(g1).join("");return`${e}${i}`}function b1(n){const e=ri(0),t=Hn(n,"int");return`rgb(${Mr(t.getComponents("rgb")).map(r=>e(r)).join(", ")})`}function Eu(n){const e=ri(2),t=ri(0);return`rgba(${Hn(n,"int").getComponents("rgb").map((s,o)=>(o===3?e:t)(s)).join(", ")})`}function K5(n){const e=[ri(0),ju,ju],t=Hn(n,"int");return`hsl(${Mr(t.getComponents("hsl")).map((r,s)=>e[s](r)).join(", ")})`}function X5(n){const e=[ri(0),ju,ju,ri(2)];return`hsla(${Hn(n,"int").getComponents("hsl").map((r,s)=>e[s](r)).join(", ")})`}function x1(n,e){const t=ri(e==="float"?2:0),i=["r","g","b"],r=Hn(n,e);return`{${Mr(r.getComponents("rgb")).map((o,a)=>`${i[a]}: ${t(o)}`).join(", ")}}`}function q5(n){return e=>x1(e,n)}function w1(n,e){const t=ri(2),i=ri(e==="float"?2:0),r=["r","g","b","a"];return`{${Hn(n,e).getComponents("rgb").map((a,l)=>{const c=l===3?t:i;return`${r[l]}: ${c(a)}`}).join(", ")}}`}function Y5(n){return e=>w1(e,n)}const Z5=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Q0},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ev},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:b1},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Eu},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:K5},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:X5},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:q5(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Y5(e)}],[])];function y1(n){return Z5.reduce((e,t)=>e||(k5(t.format,n)?t.stringifier:null),null)}const rc=st("apl");let J5=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(rc()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(rc("b")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(rc("c")),i.appendChild(r),this.colorElem_=r;const s=e.createElement("div");s.classList.add(rc("m")),this.element.appendChild(s),this.markerElem_=s;const o=e.createElement("div");o.classList.add(rc("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new ut([t[0],t[1],t[2],0],"rgb"),r=new ut([t[0],t[1],t[2],255],"rgb"),s=["to right",Eu(i),Eu(r)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=Eu(e);const o=ht(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},Q5=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new J5(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oa(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,r=this.value.rawValue,[s,o,a]=r.getComponents("hsv");this.value.setRawValue(new ut([s,o,a,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jn(jo(!0),ls(e));if(t===0)return;const i=this.value.rawValue,[r,s,o,a]=i.getComponents("hsv");this.value.setRawValue(new ut([r,s,o,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Jn(jo(!0),ls(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Da=st("coltxt");function ek(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,r)=>{const s=n.createElement("option");return s.textContent=r.text,s.value=r.value,i.appendChild(s),i},n.createDocumentFragment())),e}let tk=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Da()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Da("m")),this.modeElem_=ek(e),this.modeElem_.classList.add(Da("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const r=e.createElement("div");r.classList.add(Da("mm")),r.appendChild(Td(e,"dropdown")),i.appendChild(r),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Da("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=t.inputViews,this.applyInputViews_(),is(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){Uy(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Da("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function nk(n){return ri(n==="float"?2:0)}function ik(n,e,t){const i=_l(n,e)[t];return new dh({min:0,max:i})}function rk(n,e,t){return new _h(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:Ze.fromObject({formatter:nk(e.colorType),keyScale:jo(!1),pointerScale:e.colorType==="float"?.01:1}),value:It(0,{constraint:ik(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function sk(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:as,viewProps:e.viewProps};return[0,1,2].map(i=>{const r=rk(n,t,i);return Vl({primary:e.value,secondary:r.value,forward(s){return Hn(s,e.colorType).getComponents(e.colorMode)[i]},backward(s,o){const a=e.colorMode,c=Hn(s,e.colorType).getComponents(a);c[i]=o;const h=J0(Rd(Mr(c),c[3]),a,e.colorType);return Hn(h,"int")}}),r})}function ok(n,e){const t=new zc(n,{parser:bh("int"),props:Ze.fromObject({formatter:Q0}),value:It(ut.black()),viewProps:e.viewProps});return Vl({primary:e.value,secondary:t.value,forward:i=>new ut(Mr(i.getComponents()),i.mode),backward:(i,r)=>new ut(Rd(Mr(r.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function ak(n){return n!=="hex"}let lk=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=It(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new tk(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return ak(t)?sk(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):ok(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const jp=st("hpl");let ck=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(jp()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(jp("c")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(jp("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=b1(new ut([t,100,100],"hsv"));const i=ht(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},hk=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new ck(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oa(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ht(hn(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),r=this.value.rawValue,[,s,o,a]=r.getComponents("hsv");this.value.setRawValue(new ut([i,s,o,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jn(jo(!1),ls(e));if(t===0)return;const i=this.value.rawValue,[r,s,o,a]=i.getComponents("hsv");this.value.setRawValue(new ut([r+t,s,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Jn(jo(!1),ls(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Wp=st("svp"),Tb=64;let uk=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Wp()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=Tb,i.width=Tb,i.classList.add(Wp("c")),this.element.appendChild(i),this.canvasElement=i;const r=e.createElement("div");r.classList.add(Wp("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=hD(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),r=this.canvasElement.width,s=this.canvasElement.height,o=e.getImageData(0,0,r,s),a=o.data;for(let h=0;h<s;h++)for(let u=0;u<r;u++){const d=ht(u,0,r,0,100),p=ht(h,0,s,100,0),_=r1(i[0],d,p),v=(h*r+u)*4;a[v]=_[0],a[v+1]=_[1],a[v+2]=_[2],a[v+3]=255}e.putImageData(o,0,0);const l=ht(i[1],0,100,0,100);this.markerElem_.style.left=`${l}%`;const c=ht(i[2],0,100,100,0);this.markerElem_.style.top=`${c}%`}onValueChange_(){this.update_()}},dk=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new uk(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oa(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ht(e.point.x,0,e.bounds.width,0,100),r=ht(e.point.y,0,e.bounds.height,100,0),[s,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ut([s,i,r,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){e1(e.key)&&e.preventDefault();const[t,i,r,s]=this.value.rawValue.getComponents("hsv"),o=jo(!1),a=Jn(o,ls(e)),l=Jn(o,$c(e));a===0&&l===0||this.value.setRawValue(new ut([t,i+a,r+l,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=jo(!1),i=Jn(t,ls(e)),r=Jn(t,$c(e));i===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},pk=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new hk(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new dk(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new Q5(e,{value:this.value,viewProps:this.viewProps}),text:new _h(e,{parser:as,props:Ze.fromObject({pointerScale:.01,keyScale:.1,formatter:ri(2)}),value:It(0,{constraint:new dh({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Vl({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,r)=>{const s=i.getComponents();return s[3]=r,new ut(s,i.mode)}}),this.textsC_=new lk(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new M5(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Kp=st("colsw");let fk=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Kp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Kp("sw")),this.element.appendChild(i),this.swatchElem_=i;const r=e.createElement("button");r.classList.add(Kp("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=ev(e)}onValueChange_(){this.update_()}},mk=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new fk(e,{value:this.value,viewProps:this.viewProps})}},tv=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=j0.create(t.expanded),this.swatchC_=new mk(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new zc(e,{parser:t.parser,props:Ze.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new g5(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Zy(e,{viewProps:this.viewProps}):null;const r=new pk(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(r.view.element),Vl({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),W0(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=By(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!U0(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function vk(n){return Mr(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function _k(n){return n.getComponents("rgb").reduce((e,t,i)=>{const r=Math.floor(i===3?t*255:t)&255;return e<<8|r},0)>>>0}function gk(n){return new ut([n>>16&255,n>>8&255,n&255],"rgb")}function bk(n){return new ut([n>>24&255,n>>16&255,n>>8&255,ht(n&255,0,255,0,1)],"rgb")}function xk(n){return typeof n!="number"?ut.black():gk(n)}function wk(n){return typeof n!="number"?ut.black():bk(n)}function Cu(n,e){return typeof n!="object"||St(n)?!1:e in n&&typeof n[e]=="number"}function E1(n){return Cu(n,"r")&&Cu(n,"g")&&Cu(n,"b")}function C1(n){return E1(n)&&Cu(n,"a")}function S1(n){return E1(n)}function nv(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let r=0;r<t.length;r++)if(t[r]!==i[r])return!1;return!0}function Ab(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function yk(n){const e=y1(n);return e?(t,i)=>{gh(t,e(i))}:null}function Ek(n){const e=n?_k:vk;return(t,i)=>{gh(t,e(i))}}function Ck(n,e,t){const r=Hn(e,t).toRgbaObject();n.writeProperty("r",r.r),n.writeProperty("g",r.g),n.writeProperty("b",r.b),n.writeProperty("a",r.a)}function Sk(n,e,t){const r=Hn(e,t).toRgbaObject();n.writeProperty("r",r.r),n.writeProperty("g",r.g),n.writeProperty("b",r.b)}function Mk(n,e){return(t,i)=>{n?Ck(t,i,e):Sk(t,i,e)}}function Pk(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function Tk(n){return n?e=>ev(e,"0x"):e=>Q0(e,"0x")}function Ak(n){return"color"in n||n.view==="color"}const Rk=Kn({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!Ak(e))return null;const t=Y0(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:Pk(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?wk:xk,equals:nv,writer:n=>Ek(n.params.supportsAlpha)},controller:n=>{var e,t;return new tv(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:Tk(n.params.supportsAlpha),parser:bh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function Lk(n,e){if(!S1(n))return Hn(ut.black(),e);if(e==="int"){const t=Ab(n);return new ut(t,"rgb")}if(e==="float"){const t=Ab(n);return new Z0(t,"rgb")}return Hn(ut.black(),"int")}function Dk(n){return C1(n)}function kk(n){return e=>{const t=Lk(e,n);return Hn(t,"int")}}function Ik(n,e){return t=>n?w1(t,e):x1(t,e)}const Ok=Kn({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!S1(n))return null;const i=Y0(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=l1(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>kk(n.params.colorType),equals:nv,writer:n=>Mk(Dk(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=C1(n.initialValue);return new tv(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:Ik(i,n.params.colorType),parser:bh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}}),Nk=Kn({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=j5(n,l1(e));if(!t)return null;const i=y1(t);if(!i)return null;const r=Y0(e);return r?{initialValue:n,params:Object.assign(Object.assign({},r),{format:t,stringifier:i})}:null},binding:{reader:()=>W5,equals:nv,writer:n=>{const e=yk(n.params.format);if(!e)throw Ln.notBindable();return e}},controller:n=>{var e,t;return new tv(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:bh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let iv=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,r)=>{var s,o;return(o=(s=this.components[r])===null||s===void 0?void 0:s.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const Rb=st("pndtxt");let Fk=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Rb()),this.textViews.forEach(i=>{const r=e.createElement("div");r.classList.add(Rb("a")),r.appendChild(i.element),this.element.appendChild(r)})}};function Vk(n,e,t){return new _h(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:It(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let rv=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,r)=>Vk(e,t,r)),this.acs_.forEach((i,r)=>{Vl({primary:this.value,secondary:i.value,forward:s=>t.assembly.toComponents(s)[r],backward:(s,o)=>{const a=t.assembly.toComponents(s);return a[r]=o,t.assembly.fromComponents(a)}})}),this.view=new Fk(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},Uk=class extends Bc{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function Bk(n,e){const t=[],i=ky(n,e);i&&t.push(i);const r=Iy(n);r&&t.push(r);const s=q0(n.options);return s&&t.push(s),new fh(t)}const zk=Kn({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=$t(e,i=>Object.assign(Object.assign({},Ny(i)),{options:i.optional.custom(vh),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Ay,constraint:n=>Bk(n.params,n.initialValue),writer:n=>gh},controller:n=>{const e=n.value,t=n.constraint,i=t&&Gu(t,mh);if(i)return new Zs(n.document,{props:new Ze({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const r=Oy(n.params,e.rawValue),s=t&&Gu(t,dh);return s?new Wu(n.document,Object.assign(Object.assign({},t1(Object.assign(Object.assign({},r),{keyScale:It(r.keyScale),max:s.values.value("max"),min:s.values.value("min")}))),{parser:as,value:e,viewProps:n.viewProps})):new _h(n.document,{parser:as,props:Ze.fromObject(r),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Wu?new Uk(n.controller):n.controller.valueController instanceof Zs?new K0(n.controller):null}});let Gs=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(St(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const M1={toComponents:n=>n.getComponents(),fromComponents:n=>new Gs(...n)},ka=st("p2d");let $k=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ka()),t.viewProps.bindClassModifiers(this.element),is(t.expanded,Ol(this.element,ka(void 0,"expanded")));const i=e.createElement("div");i.classList.add(ka("h")),this.element.appendChild(i);const r=e.createElement("button");r.classList.add(ka("b")),r.appendChild(Td(e,"p2dpad")),t.viewProps.bindDisabled(r),i.appendChild(r),this.buttonElement=r;const s=e.createElement("div");if(s.classList.add(ka("t")),i.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(ka("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const ws=st("p2dp");let Hk=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(ws()),t.layout==="popup"&&this.element.classList.add(ws(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ws("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const r=e.createElementNS(vr,"svg");r.classList.add(ws("g")),this.padElement.appendChild(r),this.svgElem_=r;const s=e.createElementNS(vr,"line");s.classList.add(ws("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const o=e.createElementNS(vr,"line");o.classList.add(ws("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const a=e.createElementNS(vr,"line");a.classList.add(ws("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const l=e.createElement("div");l.classList.add(ws("m")),this.padElement.appendChild(l),this.markerElem_=l,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),r=ht(e,-i,+i,0,100),s=ht(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${r}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${r}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function Lb(n,e,t){return[Jn(e[0],ls(n)),Jn(e[1],$c(n))*(t?1:-1)]}let Gk=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Hk(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new oa(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),r=ht(e.point.x,0,e.bounds.width,-i,+i),s=ht(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Gs(r,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){e1(e.key)&&e.preventDefault();const[t,i]=Lb(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Gs(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=Lb(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},jk=class{constructor(e,t){var i,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=j0.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new Zy(e,{viewProps:this.viewProps}):null;const s=new Gk(e,{layout:t.pickerLayout,props:new Ze({invertsY:It(t.invertsY),max:It(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.textC_=new rv(e,{assembly:M1,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new $k(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(r=this.view.buttonElement)===null||r===void 0||r.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Vl({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),W0(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=By(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!U0(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function Wk(n){return Gs.isObject(n)?new Gs(n.x,n.y):new Gs}function Kk(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function Xk(n,e){return new iv({assembly:M1,components:[Zr(Object.assign(Object.assign({},n),n.x),e.x),Zr(Object.assign(Object.assign({},n),n.y),e.y)]})}function Db(n,e){var t,i;if(!St(n.min)||!St(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const r=Ly(n);return Math.max(Math.abs(r)*10,Math.abs(e)*10)}function qk(n,e){var t,i;const r=Db(Ho(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),s=Db(Ho(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(r,s)}function Yk(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}const Zk=Kn({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Gs.isObject(n))return null;const t=$t(e,i=>Object.assign(Object.assign({},Hc(i)),{expanded:i.optional.boolean,picker:i.optional.custom(i1),readonly:i.optional.constant(!1),x:i.optional.custom(Os),y:i.optional.object(Object.assign(Object.assign({},Hc(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>Wk,constraint:n=>Xk(n.params,n.initialValue),equals:Gs.equals,writer:()=>Kk},controller:n=>{var e,t;const i=n.document,r=n.value,s=n.constraint,o=[n.params.x,n.params.y];return new jk(i,{axes:r.rawValue.getComponents().map((a,l)=>{var c;return V0({constraint:s.components[l],initialValue:a,params:Ho(n.params,(c=o[l])!==null&&c!==void 0?c:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:Yk(n.params),max:qk(n.params,r.rawValue),parser:as,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:r,viewProps:n.viewProps})}});let Qa=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(St(e))return!1;const t=e.x,i=e.y,r=e.z;return!(typeof t!="number"||typeof i!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const P1={toComponents:n=>n.getComponents(),fromComponents:n=>new Qa(...n)};function Jk(n){return Qa.isObject(n)?new Qa(n.x,n.y,n.z):new Qa}function Qk(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function eI(n,e){return new iv({assembly:P1,components:[Zr(Object.assign(Object.assign({},n),n.x),e.x),Zr(Object.assign(Object.assign({},n),n.y),e.y),Zr(Object.assign(Object.assign({},n),n.z),e.z)]})}const tI=Kn({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Qa.isObject(n))return null;const t=$t(e,i=>Object.assign(Object.assign({},Hc(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(Os),y:i.optional.custom(Os),z:i.optional.custom(Os)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Jk,constraint:n=>eI(n.params,n.initialValue),equals:Qa.equals,writer:n=>Qk},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new rv(n.document,{assembly:P1,axes:e.rawValue.getComponents().map((r,s)=>{var o;return V0({constraint:t.components[s],initialValue:r,params:Ho(n.params,(o=i[s])!==null&&o!==void 0?o:{})})}),parser:as,value:e,viewProps:n.viewProps})}});let el=class{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.z=i,this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(St(e))return!1;const t=e.x,i=e.y,r=e.z,s=e.w;return!(typeof t!="number"||typeof i!="number"||typeof r!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const T1={toComponents:n=>n.getComponents(),fromComponents:n=>new el(...n)};function nI(n){return el.isObject(n)?new el(n.x,n.y,n.z,n.w):new el}function iI(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function rI(n,e){return new iv({assembly:T1,components:[Zr(Object.assign(Object.assign({},n),n.x),e.x),Zr(Object.assign(Object.assign({},n),n.y),e.y),Zr(Object.assign(Object.assign({},n),n.z),e.z),Zr(Object.assign(Object.assign({},n),n.w),e.w)]})}const sI=Kn({id:"input-point4d",type:"input",accept:(n,e)=>{if(!el.isObject(n))return null;const t=$t(e,i=>Object.assign(Object.assign({},Hc(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(Os),x:i.optional.custom(Os),y:i.optional.custom(Os),z:i.optional.custom(Os)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>nI,constraint:n=>rI(n.params,n.initialValue),equals:el.equals,writer:n=>iI},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new rv(n.document,{assembly:T1,axes:e.rawValue.getComponents().map((r,s)=>{var o;return V0({constraint:t.components[s],initialValue:r,params:Ho(n.params,(o=i[s])!==null&&o!==void 0?o:{})})}),parser:as,value:e,viewProps:n.viewProps})}});function oI(n){const e=[],t=q0(n.options);return t&&e.push(t),new fh(e)}const aI=Kn({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=$t(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(vh)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Qy,constraint:n=>oI(n.params),writer:n=>gh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,r=i&&Gu(i,mh);return r?new Zs(e,{props:new Ze({options:r.values.value("options")}),value:t,viewProps:n.viewProps}):new zc(e,{parser:s=>s,props:Ze.fromObject({formatter:Dm}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Zs?new K0(n.controller):null}}),xh={monitor:{defaultInterval:200,defaultRows:3}},kb=st("mll");let lI=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(kb()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(kb("i")),i.style.height=`calc(var(${n1("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(r=>{r!==void 0&&i.push(this.formatter_(r))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},sv=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new lI(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const Ib=st("sgl");let cI=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Ib()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Ib("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},ov=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new cI(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};const hI=Kn({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=$t(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Jy},controller:n=>{var e;return n.value.rawValue.length===1?new ov(n.document,{formatter:Mb,value:n.value,viewProps:n.viewProps}):new sv(n.document,{formatter:Mb,rows:(e=n.params.rows)!==null&&e!==void 0?e:xh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let uI=class extends Bc{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const ys=st("grl");let dI=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ys()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(vr,"svg");i.classList.add(ys("g")),i.style.height=`calc(var(${n1("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const r=e.createElementNS(vr,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;const s=e.createElement("div");s.classList.add(ys("t"),st("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,r=this.props_.get("min"),s=this.props_.get("max"),o=[];this.value.rawValue.forEach((u,d)=>{if(u===void 0)return;const p=ht(d,0,i,0,e),_=ht(u,r,s,t,0);o.push([p,_].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const a=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){a.classList.remove(ys("t","a"));return}const c=ht(this.cursor_.rawValue,0,i,0,e),h=ht(l,r,s,t,0);a.style.left=`${c}px`,a.style.top=`${h}px`,a.textContent=`${this.formatter_(l)}`,a.classList.contains(ys("t","a"))||(a.classList.add(ys("t","a"),ys("t","in")),Hu(a),a.classList.remove(ys("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},A1=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=It(-1),this.view=new dI(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!U0(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new oa(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Si(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Mi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(ht(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(ht(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function km(n){return St(n.format)?ri(2):n.format}function pI(n){var e;return n.value.rawValue.length===1?new ov(n.document,{formatter:km(n.params),value:n.value,viewProps:n.viewProps}):new sv(n.document,{formatter:km(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:xh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function fI(n){var e,t,i;return new A1(n.document,{formatter:km(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:xh.monitor.defaultRows,props:Ze.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function Ob(n){return n.view==="graph"}const mI=Kn({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=$t(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>Ob(n)?64:1,reader:n=>Ay},controller:n=>Ob(n.params)?fI(n):pI(n),api:n=>n.controller.valueController instanceof A1?new uI(n.controller):null}),vI=Kn({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=$t(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Qy},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new sv(n.document,{formatter:Dm,rows:(e=n.params.rows)!==null&&e!==void 0?e:xh.monitor.defaultRows,value:t,viewProps:n.viewProps}):new ov(n.document,{formatter:Dm,value:t,viewProps:n.viewProps})}});class _I{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class gI{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function bI(n,e){var t;const i=n.accept(e.target.read(),e.params);if(St(i))return null;const r={target:e.target,initialValue:i.initialValue,params:i.params},s=$t(e.params,u=>({disabled:u.optional.boolean,hidden:u.optional.boolean,label:u.optional.string,tag:u.optional.string})),o=n.binding.reader(r),a=n.binding.constraint?n.binding.constraint(r):void 0,l=new gI({reader:o,target:e.target,writer:n.binding.writer(r)}),c=new nD(It(o(i.initialValue),{constraint:a,equals:n.binding.equals}),l),h=n.controller({constraint:a,document:e.document,initialValue:i.initialValue,params:i.params,value:c,viewProps:sa.create({disabled:s?.disabled,hidden:s?.hidden})});return new _D(e.document,{blade:Fl(),props:Ze.fromObject({label:"label"in e.params?(t=s?.label)!==null&&t!==void 0?t:null:e.target.key}),tag:s?.tag,value:c,valueController:h})}class xI{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function wI(n,e){return e===0?new QD:new e5(n,e??xh.monitor.defaultInterval)}function yI(n,e){var t,i,r;const s=n.accept(e.target.read(),e.params);if(St(s))return null;const o={target:e.target,initialValue:s.initialValue,params:s.params},a=$t(e.params,d=>({bufferSize:d.optional.number,disabled:d.optional.boolean,hidden:d.optional.boolean,interval:d.optional.number,label:d.optional.string})),l=n.binding.reader(o),c=(i=(t=a?.bufferSize)!==null&&t!==void 0?t:n.binding.defaultBufferSize&&n.binding.defaultBufferSize(s.params))!==null&&i!==void 0?i:1,h=new yD({binding:new xI({reader:l,target:e.target}),bufferSize:c,ticker:wI(e.document,a?.interval)}),u=n.controller({document:e.document,params:s.params,value:h,viewProps:sa.create({disabled:a?.disabled,hidden:a?.hidden})});return u.viewProps.bindDisabled(h.ticker),u.viewProps.handleDispose(()=>{h.ticker.dispose()}),new CD(e.document,{blade:Fl(),props:Ze.fromObject({label:"label"in e.params?(r=a?.label)!==null&&r!==void 0?r:null:e.target.key}),value:h,valueController:u})}class EI{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!p5(t.core))throw Ln.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,i){return this.pluginsMap_.inputs.reduce((r,s)=>r??bI(s,{document:e,target:t,params:i}),null)}createMonitor_(e,t,i){return this.pluginsMap_.monitors.reduce((r,s)=>r??yI(s,{document:e,params:i,target:t}),null)}createBinding(e,t,i){const r=t.read();if(St(r))throw new Ln({context:{key:t.key},type:"nomatchingcontroller"});const s=this.createInput_(e,t,i);if(s)return s;const o=this.createMonitor_(e,t,i);if(o)return o;throw new Ln({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const i=this.pluginsMap_.blades.reduce((r,s)=>r??JD(s,{document:e,params:t}),null);if(!i)throw new Ln({type:"nomatchingview",context:{params:t}});return i}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((i,r)=>{var s,o;return i||((o=(s=r.api)===null||s===void 0?void 0:s.call(r,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new Bc(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((i,r)=>{var s,o;return i||((o=(s=r.api)===null||s===void 0?void 0:s.call(r,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new Bc(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(gD(e))return this.createInputBindingApi_(e);if(SD(e))return this.createMonitorBindingApi_(e);throw Ln.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(vD(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((i,r)=>i??r.api({controller:e,pool:this}),null);if(!t)throw Ln.shouldNeverHappen();return this.apiCache_.add(e,t)}}const CI=new _I;function SI(){const n=new EI(CI);return[Zk,tI,sI,aI,zk,Nk,Ok,Rk,_5,hI,vI,mI,RD,HD,Yy].forEach(e=>{n.register("core",e)}),n}class MI extends ra{constructor(e){super(e),this.emitter_=new an,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new ph(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class PI extends ra{}class TI extends ra{constructor(e){super(e),this.emitter_=new an,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new ph(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class AI extends ra{constructor(e){super(e),this.emitter_=new an,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new ph(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const RI=(function(){return{id:"list",type:"blade",core:Nl,accept(n){const e=$t(n,t=>({options:t.required.custom(vh),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(n){const e=new mh(X0(n.params.options)),t=It(n.params.value,{constraint:e}),i=new Zs(n.document,{props:new Ze({options:e.values.value("options")}),value:t,viewProps:n.viewProps});return new Go(n.document,{blade:n.blade,props:Ze.fromObject({label:n.params.label}),value:t,valueController:i})},api(n){return!(n.controller instanceof Go)||!(n.controller.valueController instanceof Zs)?null:new MI(n.controller)}}})();class LI extends Ky{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class DI extends Rm{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const Nb=st("spr");class kI{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Nb()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("hr");i.classList.add(Nb("r")),this.element.appendChild(i)}}class Fb extends Ad{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new kI(e,{viewProps:t.viewProps})}))}}const II={id:"separator",type:"blade",core:Nl,accept(n){const e=$t(n,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(n){return new Fb(n.document,{blade:n.blade,viewProps:n.viewProps})},api(n){return n.controller instanceof Fb?new PI(n.controller):null}},OI={id:"slider",type:"blade",core:Nl,accept(n){const e=$t(n,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(n){var e,t;const i=(e=n.params.value)!==null&&e!==void 0?e:0,r=new dh({max:n.params.max,min:n.params.min}),s=It(i,{constraint:r}),o=new Wu(n.document,Object.assign(Object.assign({},t1({formatter:(t=n.params.format)!==null&&t!==void 0?t:ZL,keyScale:It(1),max:r.values.value("max"),min:r.values.value("min"),pointerScale:Dy(n.params,i)})),{parser:as,value:s,viewProps:n.viewProps}));return new Go(n.document,{blade:n.blade,props:Ze.fromObject({label:n.params.label}),value:s,valueController:o})},api(n){return!(n.controller instanceof Go)||!(n.controller.valueController instanceof Wu)?null:new TI(n.controller)}},NI=(function(){return{id:"text",type:"blade",core:Nl,accept(n){const e=$t(n,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(n){var e;const t=It(n.params.value),i=new zc(n.document,{parser:n.params.parse,props:Ze.fromObject({formatter:(e=n.params.format)!==null&&e!==void 0?e:(r=>String(r))}),value:t,viewProps:n.viewProps});return new Go(n.document,{blade:n.blade,props:Ze.fromObject({label:n.params.label}),value:t,valueController:i})},api(n){return!(n.controller instanceof Go)||!(n.controller.valueController instanceof zc)?null:new AI(n.controller)}}})();function FI(n){const e=n.createElement("div");return e.classList.add(st("dfw")()),n.body&&n.body.appendChild(e),e}function VI(n,e,t){if(n.querySelector(`style[data-tp-style=${e}]`))return;const i=n.createElement("style");i.dataset.tpStyle=e,i.textContent=t,n.head.appendChild(i)}class UI extends LI{constructor(e){var t,i;const r=e??{},s=(t=r.document)!==null&&t!==void 0?t:cD(),o=SI(),a=new DI(s,{expanded:r.expanded,blade:Fl(),props:Ze.fromObject({title:r.title}),viewProps:sa.create()});super(a,o),this.pool_=o,this.containerElem_=(i=r.container)!==null&&i!==void 0?i:FI(s),this.containerElem_.appendChild(this.element),this.doc_=s,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw Ln.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw Ln.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&VI(this.document,`plugin-${e.id}`,e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(i=>{this.pool_.register(e.id,i)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[RI,II,OI,Yy,NI]})}}new jy("4.0.5");function Xr(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function R1(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var wi={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},gl={duration:.5,overwrite:!1,delay:0},av,Cn,Dt,Fi=1e8,Et=1/Fi,Im=Math.PI*2,BI=Im/4,zI=0,L1=Math.sqrt,$I=Math.cos,HI=Math.sin,wn=function(e){return typeof e=="string"},Kt=function(e){return typeof e=="function"},cs=function(e){return typeof e=="number"},lv=function(e){return typeof e>"u"},Pr=function(e){return typeof e=="object"},ei=function(e){return e!==!1},cv=function(){return typeof window<"u"},su=function(e){return Kt(e)||wn(e)},D1=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},In=Array.isArray,Om=/(?:-?\.?\d|\.)+/gi,k1=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Wa=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Xp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,I1=/[+-]=-?[.\d]+/,O1=/[^,'"\[\]\s]+/gi,GI=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Vt,cr,Nm,hv,Ei={},Ku={},N1,F1=function(e){return(Ku=bl(e,Ei))&&si},uv=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Gc=function(e,t){return!t&&console.warn(e)},V1=function(e,t){return e&&(Ei[e]=t)&&Ku&&(Ku[e]=t)||Ei},jc=function(){return 0},jI={suppressEvents:!0,isStart:!0,kill:!1},Su={suppressEvents:!0,kill:!1},WI={suppressEvents:!0},dv={},js=[],Fm={},U1,ui={},qp={},Vb=30,Mu=[],pv="",fv=function(e){var t=e[0],i,r;if(Pr(t)||Kt(t)||(e=[e]),!(i=(t._gsap||{}).harness)){for(r=Mu.length;r--&&!Mu[r].targetTest(t););i=Mu[r]}for(r=e.length;r--;)e[r]&&(e[r]._gsap||(e[r]._gsap=new cE(e[r],i)))||e.splice(r,1);return e},No=function(e){return e._gsap||fv(Vi(e))[0]._gsap},B1=function(e,t,i){return(i=e[t])&&Kt(i)?e[t]():lv(i)&&e.getAttribute&&e.getAttribute(t)||i},ti=function(e,t){return(e=e.split(",")).forEach(t)||e},Jt=function(e){return Math.round(e*1e5)/1e5||0},on=function(e){return Math.round(e*1e7)/1e7||0},tl=function(e,t){var i=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),i==="+"?e+r:i==="-"?e-r:i==="*"?e*r:e/r},KI=function(e,t){for(var i=t.length,r=0;e.indexOf(t[r])<0&&++r<i;);return r<i},Xu=function(){var e=js.length,t=js.slice(0),i,r;for(Fm={},js.length=0,i=0;i<e;i++)r=t[i],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},mv=function(e){return!!(e._initted||e._startAt||e.add)},z1=function(e,t,i,r){js.length&&!Cn&&Xu(),e.render(t,i,!!(Cn&&t<0&&mv(e))),js.length&&!Cn&&Xu()},$1=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(O1).length<2?t:wn(e)?e.trim():e},H1=function(e){return e},Ci=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},XI=function(e){return function(t,i){for(var r in i)r in t||r==="duration"&&e||r==="ease"||(t[r]=i[r])}},bl=function(e,t){for(var i in t)e[i]=t[i];return e},Ub=function n(e,t){for(var i in t)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(e[i]=Pr(t[i])?n(e[i]||(e[i]={}),t[i]):t[i]);return e},qu=function(e,t){var i={},r;for(r in e)r in t||(i[r]=e[r]);return i},Cc=function(e){var t=e.parent||Vt,i=e.keyframes?XI(In(e.keyframes)):Ci;if(ei(e.inherit))for(;t;)i(e,t.vars.defaults),t=t.parent||t._dp;return e},qI=function(e,t){for(var i=e.length,r=i===t.length;r&&i--&&e[i]===t[i];);return i<0},G1=function(e,t,i,r,s){var o=e[r],a;if(s)for(a=t[s];o&&o[s]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[i],e[i]=t),t._next?t._next._prev=t:e[r]=t,t._prev=o,t.parent=t._dp=e,t},Ld=function(e,t,i,r){i===void 0&&(i="_first"),r===void 0&&(r="_last");var s=t._prev,o=t._next;s?s._next=o:e[i]===t&&(e[i]=o),o?o._prev=s:e[r]===t&&(e[r]=s),t._next=t._prev=t.parent=null},Js=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Fo=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var i=e;i;)i._dirty=1,i=i.parent;return e},YI=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Vm=function(e,t,i,r){return e._startAt&&(Cn?e._startAt.revert(Su):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},ZI=function n(e){return!e||e._ts&&n(e.parent)},Bb=function(e){return e._repeat?xl(e._tTime,e=e.duration()+e._rDelay)*e:0},xl=function(e,t){var i=Math.floor(e=on(e/t));return e&&i===e?i-1:i},Yu=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Dd=function(e){return e._end=on(e._start+(e._tDur/Math.abs(e._ts||e._rts||Et)||0))},kd=function(e,t){var i=e._dp;return i&&i.smoothChildTiming&&e._ts&&(e._start=on(i._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Dd(e),i._dirty||Fo(i,e)),e},j1=function(e,t){var i;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(i=Yu(e.rawTime(),t),(!t._dur||wh(0,t.totalDuration(),i)-t._tTime>Et)&&t.render(i,!0)),Fo(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(i=e;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;e._zTime=-Et}},ur=function(e,t,i,r){return t.parent&&Js(t),t._start=on((cs(i)?i:i||e!==Vt?Ii(e,i,t):e._time)+t._delay),t._end=on(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),G1(e,t,"_first","_last",e._sort?"_start":0),Um(t)||(e._recent=t),r||j1(e,t),e._ts<0&&kd(e,e._tTime),e},W1=function(e,t){return(Ei.ScrollTrigger||uv("scrollTrigger",t))&&Ei.ScrollTrigger.create(t,e)},K1=function(e,t,i,r,s){if(_v(e,t,s),!e._initted)return 1;if(!i&&e._pt&&!Cn&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&U1!==fi.frame)return js.push(e),e._lazy=[s,r],1},JI=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},Um=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},QI=function(e,t,i,r){var s=e.ratio,o=t<0||!t&&(!e._start&&JI(e)&&!(!e._initted&&Um(e))||(e._ts<0||e._dp._ts<0)&&!Um(e))?0:1,a=e._rDelay,l=0,c,h,u;if(a&&e._repeat&&(l=wh(0,e._tDur,t),h=xl(l,a),e._yoyo&&h&1&&(o=1-o),h!==xl(e._tTime,a)&&(s=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==s||Cn||r||e._zTime===Et||!t&&e._zTime){if(!e._initted&&K1(e,t,r,i,l))return;for(u=e._zTime,e._zTime=t||(i?Et:0),i||(i=t&&!u),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=l,c=e._pt;c;)c.r(o,c.d),c=c._next;t<0&&Vm(e,t,i,!0),e._onUpdate&&!i&&gi(e,"onUpdate"),l&&e._repeat&&!i&&e.parent&&gi(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Js(e,1),!i&&!Cn&&(gi(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},eO=function(e,t,i){var r;if(i>t)for(r=e._first;r&&r._start<=i;){if(r.data==="isPause"&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=i;){if(r.data==="isPause"&&r._start<t)return r;r=r._prev}},wl=function(e,t,i,r){var s=e._repeat,o=on(t)||0,a=e._tTime/e._tDur;return a&&!r&&(e._time*=o/e._dur),e._dur=o,e._tDur=s?s<0?1e10:on(o*(s+1)+e._rDelay*s):o,a>0&&!r&&kd(e,e._tTime=e._tDur*a),e.parent&&Dd(e),i||Fo(e.parent,e),e},zb=function(e){return e instanceof Bn?Fo(e):wl(e,e._dur)},tO={_start:0,endTime:jc,totalDuration:jc},Ii=function n(e,t,i){var r=e.labels,s=e._recent||tO,o=e.duration()>=Fi?s.endTime(!1):e._dur,a,l,c;return wn(t)&&(isNaN(t)||t in r)?(l=t.charAt(0),c=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(a<0?s:i).totalDuration()/100:1)):a<0?(t in r||(r[t]=o),r[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),c&&i&&(l=l/100*(In(i)?i[0]:i).totalDuration()),a>1?n(e,t.substr(0,a-1),i)+l:o+l)):t==null?o:+t},Sc=function(e,t,i){var r=cs(t[1]),s=(r?2:1)+(e<2?0:1),o=t[s],a,l;if(r&&(o.duration=t[1]),o.parent=i,e){for(a=o,l=i;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=ei(l.vars.inherit)&&l.parent;o.immediateRender=ei(a.immediateRender),e<2?o.runBackwards=1:o.startAt=t[s-1]}return new sn(t[0],o,t[s+1])},io=function(e,t){return e||e===0?t(e):t},wh=function(e,t,i){return i<e?e:i>t?t:i},Dn=function(e,t){return!wn(e)||!(t=GI.exec(e))?"":t[1]},nO=function(e,t,i){return io(i,function(r){return wh(e,t,r)})},Bm=[].slice,X1=function(e,t){return e&&Pr(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Pr(e[0]))&&!e.nodeType&&e!==cr},iO=function(e,t,i){return i===void 0&&(i=[]),e.forEach(function(r){var s;return wn(r)&&!t||X1(r,1)?(s=i).push.apply(s,Vi(r)):i.push(r)})||i},Vi=function(e,t,i){return Dt&&!t&&Dt.selector?Dt.selector(e):wn(e)&&!i&&(Nm||!yl())?Bm.call((t||hv).querySelectorAll(e),0):In(e)?iO(e,i):X1(e)?Bm.call(e,0):e?[e]:[]},zm=function(e){return e=Vi(e)[0]||Gc("Invalid scope")||{},function(t){var i=e.current||e.nativeElement||e;return Vi(t,i.querySelectorAll?i:i===e?Gc("Invalid scope")||hv.createElement("div"):e)}},q1=function(e){return e.sort(function(){return .5-Math.random()})},Y1=function(e){if(Kt(e))return e;var t=Pr(e)?e:{each:e},i=Vo(t.ease),r=t.from||0,s=parseFloat(t.base)||0,o={},a=r>0&&r<1,l=isNaN(r)||a,c=t.axis,h=r,u=r;return wn(r)?h=u={center:.5,edges:.5,end:1}[r]||0:!a&&l&&(h=r[0],u=r[1]),function(d,p,_){var v=(_||t).length,m=o[v],f,g,b,y,M,S,P,A,x;if(!m){if(x=t.grid==="auto"?0:(t.grid||[1,Fi])[1],!x){for(P=-Fi;P<(P=_[x++].getBoundingClientRect().left)&&x<v;);x<v&&x--}for(m=o[v]=[],f=l?Math.min(x,v)*h-.5:r%x,g=x===Fi?0:l?v*u/x-.5:r/x|0,P=0,A=Fi,S=0;S<v;S++)b=S%x-f,y=g-(S/x|0),m[S]=M=c?Math.abs(c==="y"?y:b):L1(b*b+y*y),M>P&&(P=M),M<A&&(A=M);r==="random"&&q1(m),m.max=P-A,m.min=A,m.v=v=(parseFloat(t.amount)||parseFloat(t.each)*(x>v?v-1:c?c==="y"?v/x:x:Math.max(x,v/x))||0)*(r==="edges"?-1:1),m.b=v<0?s-v:s,m.u=Dn(t.amount||t.each)||0,i=i&&v<0?oE(i):i}return v=(m[d]-m.min)/m.max||0,on(m.b+(i?i(v):v)*m.v)+m.u}},$m=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(i){var r=on(Math.round(parseFloat(i)/e)*e*t);return(r-r%1)/t+(cs(i)?0:Dn(i))}},Z1=function(e,t){var i=In(e),r,s;return!i&&Pr(e)&&(r=i=e.radius||Fi,e.values?(e=Vi(e.values),(s=!cs(e[0]))&&(r*=r)):e=$m(e.increment)),io(t,i?Kt(e)?function(o){return s=e(o),Math.abs(s-o)<=r?s:o}:function(o){for(var a=parseFloat(s?o.x:o),l=parseFloat(s?o.y:0),c=Fi,h=0,u=e.length,d,p;u--;)s?(d=e[u].x-a,p=e[u].y-l,d=d*d+p*p):d=Math.abs(e[u]-a),d<c&&(c=d,h=u);return h=!r||c<=r?e[h]:o,s||h===o||cs(o)?h:h+Dn(o)}:$m(e))},J1=function(e,t,i,r){return io(In(e)?!t:i===!0?!!(i=0):!r,function(){return In(e)?e[~~(Math.random()*e.length)]:(i=i||1e-5)&&(r=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((e-i/2+Math.random()*(t-e+i*.99))/i)*i*r)/r})},rO=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(r){return t.reduce(function(s,o){return o(s)},r)}},sO=function(e,t){return function(i){return e(parseFloat(i))+(t||Dn(i))}},oO=function(e,t,i){return eE(e,t,0,1,i)},Q1=function(e,t,i){return io(i,function(r){return e[~~t(r)]})},aO=function n(e,t,i){var r=t-e;return In(e)?Q1(e,n(0,e.length),t):io(i,function(s){return(r+(s-e)%r)%r+e})},lO=function n(e,t,i){var r=t-e,s=r*2;return In(e)?Q1(e,n(0,e.length-1),t):io(i,function(o){return o=(s+(o-e)%s)%s||0,e+(o>r?s-o:o)})},Wc=function(e){for(var t=0,i="",r,s,o,a;~(r=e.indexOf("random(",t));)o=e.indexOf(")",r),a=e.charAt(r+7)==="[",s=e.substr(r+7,o-r-7).match(a?O1:Om),i+=e.substr(t,r-t)+J1(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),t=o+1;return i+e.substr(t,e.length-t)},eE=function(e,t,i,r,s){var o=t-e,a=r-i;return io(s,function(l){return i+((l-e)/o*a||0)})},cO=function n(e,t,i,r){var s=isNaN(e+t)?0:function(p){return(1-p)*e+p*t};if(!s){var o=wn(e),a={},l,c,h,u,d;if(i===!0&&(r=1)&&(i=null),o)e={p:e},t={p:t};else if(In(e)&&!In(t)){for(h=[],u=e.length,d=u-2,c=1;c<u;c++)h.push(n(e[c-1],e[c]));u--,s=function(_){_*=u;var v=Math.min(d,~~_);return h[v](_-v)},i=t}else r||(e=bl(In(e)?[]:{},e));if(!h){for(l in t)vv.call(a,e,l,"get",t[l]);s=function(_){return xv(_,a)||(o?e.p:e)}}}return io(i,s)},$b=function(e,t,i){var r=e.labels,s=Fi,o,a,l;for(o in r)a=r[o]-t,a<0==!!i&&a&&s>(a=Math.abs(a))&&(l=o,s=a);return l},gi=function(e,t,i){var r=e.vars,s=r[t],o=Dt,a=e._ctx,l,c,h;if(s)return l=r[t+"Params"],c=r.callbackScope||e,i&&js.length&&Xu(),a&&(Dt=a),h=l?s.apply(c,l):s.call(c),Dt=o,h},wc=function(e){return Js(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Cn),e.progress()<1&&gi(e,"onInterrupt"),e},Ka,tE=[],nE=function(e){if(e)if(e=!e.name&&e.default||e,cv()||e.headless){var t=e.name,i=Kt(e),r=t&&!i&&e.init?function(){this._props=[]}:e,s={init:jc,render:xv,add:vv,kill:SO,modifier:CO,rawVars:0},o={targetTest:0,get:0,getSetter:bv,aliases:{},register:0};if(yl(),e!==r){if(ui[t])return;Ci(r,Ci(qu(e,s),o)),bl(r.prototype,bl(s,qu(e,o))),ui[r.prop=t]=r,e.targetTest&&(Mu.push(r),dv[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}V1(t,r),e.register&&e.register(si,r,ni)}else tE.push(e)},yt=255,yc={aqua:[0,yt,yt],lime:[0,yt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,yt],navy:[0,0,128],white:[yt,yt,yt],olive:[128,128,0],yellow:[yt,yt,0],orange:[yt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[yt,0,0],pink:[yt,192,203],cyan:[0,yt,yt],transparent:[yt,yt,yt,0]},Yp=function(e,t,i){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(i-t)*e*6:e<.5?i:e*3<2?t+(i-t)*(2/3-e)*6:t)*yt+.5|0},iE=function(e,t,i){var r=e?cs(e)?[e>>16,e>>8&yt,e&yt]:0:yc.black,s,o,a,l,c,h,u,d,p,_;if(!r){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),yc[e])r=yc[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),o=e.charAt(2),a=e.charAt(3),e="#"+s+s+o+o+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return r=parseInt(e.substr(1,6),16),[r>>16,r>>8&yt,r&yt,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),r=[e>>16,e>>8&yt,e&yt]}else if(e.substr(0,3)==="hsl"){if(r=_=e.match(Om),!t)l=+r[0]%360/360,c=+r[1]/100,h=+r[2]/100,o=h<=.5?h*(c+1):h+c-h*c,s=h*2-o,r.length>3&&(r[3]*=1),r[0]=Yp(l+1/3,s,o),r[1]=Yp(l,s,o),r[2]=Yp(l-1/3,s,o);else if(~e.indexOf("="))return r=e.match(k1),i&&r.length<4&&(r[3]=1),r}else r=e.match(Om)||yc.transparent;r=r.map(Number)}return t&&!_&&(s=r[0]/yt,o=r[1]/yt,a=r[2]/yt,u=Math.max(s,o,a),d=Math.min(s,o,a),h=(u+d)/2,u===d?l=c=0:(p=u-d,c=h>.5?p/(2-u-d):p/(u+d),l=u===s?(o-a)/p+(o<a?6:0):u===o?(a-s)/p+2:(s-o)/p+4,l*=60),r[0]=~~(l+.5),r[1]=~~(c*100+.5),r[2]=~~(h*100+.5)),i&&r.length<4&&(r[3]=1),r},rE=function(e){var t=[],i=[],r=-1;return e.split(Ws).forEach(function(s){var o=s.match(Wa)||[];t.push.apply(t,o),i.push(r+=o.length+1)}),t.c=i,t},Hb=function(e,t,i){var r="",s=(e+r).match(Ws),o=t?"hsla(":"rgba(",a=0,l,c,h,u;if(!s)return e;if(s=s.map(function(d){return(d=iE(d,t,1))&&o+(t?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),i&&(h=rE(e),l=i.c,l.join(r)!==h.c.join(r)))for(c=e.replace(Ws,"1").split(Wa),u=c.length-1;a<u;a++)r+=c[a]+(~l.indexOf(a)?s.shift()||o+"0,0,0,0)":(h.length?h:s.length?s:i).shift());if(!c)for(c=e.split(Ws),u=c.length-1;a<u;a++)r+=c[a]+s[a];return r+c[u]},Ws=(function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in yc)n+="|"+e+"\\b";return new RegExp(n+")","gi")})(),hO=/hsl[a]?\(/,sE=function(e){var t=e.join(" "),i;if(Ws.lastIndex=0,Ws.test(t))return i=hO.test(t),e[1]=Hb(e[1],i),e[0]=Hb(e[0],i,rE(e[1])),!0},Kc,fi=(function(){var n=Date.now,e=500,t=33,i=n(),r=i,s=1e3/240,o=s,a=[],l,c,h,u,d,p,_=function v(m){var f=n()-r,g=m===!0,b,y,M,S;if((f>e||f<0)&&(i+=f-t),r+=f,M=r-i,b=M-o,(b>0||g)&&(S=++u.frame,d=M-u.time*1e3,u.time=M=M/1e3,o+=b+(b>=s?4:s-b),y=1),g||(l=c(v)),y)for(p=0;p<a.length;p++)a[p](M,d,S,m)};return u={time:0,frame:0,tick:function(){_(!0)},deltaRatio:function(m){return d/(1e3/(m||60))},wake:function(){N1&&(!Nm&&cv()&&(cr=Nm=window,hv=cr.document||{},Ei.gsap=si,(cr.gsapVersions||(cr.gsapVersions=[])).push(si.version),F1(Ku||cr.GreenSockGlobals||!cr.gsap&&cr||{}),tE.forEach(nE)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&u.sleep(),c=h||function(m){return setTimeout(m,o-u.time*1e3+1|0)},Kc=1,_(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(l),Kc=0,c=jc},lagSmoothing:function(m,f){e=m||1/0,t=Math.min(f||33,e)},fps:function(m){s=1e3/(m||240),o=u.time*1e3+s},add:function(m,f,g){var b=f?function(y,M,S,P){m(y,M,S,P),u.remove(b)}:m;return u.remove(m),a[g?"unshift":"push"](b),yl(),b},remove:function(m,f){~(f=a.indexOf(m))&&a.splice(f,1)&&p>=f&&p--},_listeners:a},u})(),yl=function(){return!Kc&&fi.wake()},it={},uO=/^[\d.\-M][\d.\-,\s]/,dO=/["']/g,pO=function(e){for(var t={},i=e.substr(1,e.length-3).split(":"),r=i[0],s=1,o=i.length,a,l,c;s<o;s++)l=i[s],a=s!==o-1?l.lastIndexOf(","):l.length,c=l.substr(0,a),t[r]=isNaN(c)?c.replace(dO,"").trim():+c,r=l.substr(a+1).trim();return t},fO=function(e){var t=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",t);return e.substring(t,~r&&r<i?e.indexOf(")",i+1):i)},mO=function(e){var t=(e+"").split("("),i=it[t[0]];return i&&t.length>1&&i.config?i.config.apply(null,~e.indexOf("{")?[pO(t[1])]:fO(e).split(",").map($1)):it._CE&&uO.test(e)?it._CE("",e):i},oE=function(e){return function(t){return 1-e(1-t)}},aE=function n(e,t){for(var i=e._first,r;i;)i instanceof Bn?n(i,t):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==t&&(i.timeline?n(i.timeline,t):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=t)),i=i._next},Vo=function(e,t){return e&&(Kt(e)?e:it[e]||mO(e))||t},aa=function(e,t,i,r){i===void 0&&(i=function(l){return 1-t(1-l)}),r===void 0&&(r=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var s={easeIn:t,easeOut:i,easeInOut:r},o;return ti(e,function(a){it[a]=Ei[a]=s,it[o=a.toLowerCase()]=i;for(var l in s)it[o+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=it[a+"."+l]=s[l]}),s},lE=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},Zp=function n(e,t,i){var r=t>=1?t:1,s=(i||(e?.3:.45))/(t<1?t:1),o=s/Im*(Math.asin(1/r)||0),a=function(h){return h===1?1:r*Math.pow(2,-10*h)*HI((h-o)*s)+1},l=e==="out"?a:e==="in"?function(c){return 1-a(1-c)}:lE(a);return s=Im/s,l.config=function(c,h){return n(e,c,h)},l},Jp=function n(e,t){t===void 0&&(t=1.70158);var i=function(o){return o?--o*o*((t+1)*o+t)+1:0},r=e==="out"?i:e==="in"?function(s){return 1-i(1-s)}:lE(i);return r.config=function(s){return n(e,s)},r};ti("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;aa(n+",Power"+(t-1),e?function(i){return Math.pow(i,t)}:function(i){return i},function(i){return 1-Math.pow(1-i,t)},function(i){return i<.5?Math.pow(i*2,t)/2:1-Math.pow((1-i)*2,t)/2})});it.Linear.easeNone=it.none=it.Linear.easeIn;aa("Elastic",Zp("in"),Zp("out"),Zp());(function(n,e){var t=1/e,i=2*t,r=2.5*t,s=function(a){return a<t?n*a*a:a<i?n*Math.pow(a-1.5/e,2)+.75:a<r?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};aa("Bounce",function(o){return 1-s(1-o)},s)})(7.5625,2.75);aa("Expo",function(n){return Math.pow(2,10*(n-1))*n+n*n*n*n*n*n*(1-n)});aa("Circ",function(n){return-(L1(1-n*n)-1)});aa("Sine",function(n){return n===1?1:-$I(n*BI)+1});aa("Back",Jp("in"),Jp("out"),Jp());it.SteppedEase=it.steps=Ei.SteppedEase={config:function(e,t){e===void 0&&(e=1);var i=1/e,r=e+(t?0:1),s=t?1:0,o=1-Et;return function(a){return((r*wh(0,o,a)|0)+s)*i}}};gl.ease=it["quad.out"];ti("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return pv+=n+","+n+"Params,"});var cE=function(e,t){this.id=zI++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:B1,this.set=t?t.getSetter:bv},Xc=(function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,wl(this,+t.duration,1,1),this.data=t.data,Dt&&(this._ctx=Dt,Dt.data.push(this)),Kc||fi.wake()}var e=n.prototype;return e.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},e.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},e.totalDuration=function(i){return arguments.length?(this._dirty=0,wl(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(i,r){if(yl(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(kd(this,i),!s._dp||s.parent||j1(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&ur(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===Et||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),z1(this,i,r)),this},e.time=function(i,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+Bb(this))%(this._dur+this._rDelay)||(i?this._dur:0),r):this._time},e.totalProgress=function(i,r){return arguments.length?this.totalTime(this.totalDuration()*i,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(i,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+Bb(this),r):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(i,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*s,r):this._repeat?xl(this._tTime,s)+1:1},e.timeScale=function(i,r){if(!arguments.length)return this._rts===-Et?0:this._rts;if(this._rts===i)return this;var s=this.parent&&this._ts?Yu(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-Et?0:this._rts,this.totalTime(wh(-Math.abs(this._delay),this.totalDuration(),s),r!==!1),Dd(this),YI(this)},e.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(yl(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Et&&(this._tTime-=Et)))),this):this._ps},e.startTime=function(i){if(arguments.length){this._start=i;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&ur(r,this,i-this._delay),this}return this._start},e.endTime=function(i){return this._start+(ei(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(i){var r=this.parent||this._dp;return r?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Yu(r.rawTime(i),this):this._tTime:this._tTime},e.revert=function(i){i===void 0&&(i=WI);var r=Cn;return Cn=i,mv(this)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),Cn=r,this},e.globalTime=function(i){for(var r=this,s=arguments.length?i:r.rawTime();r;)s=r._start+s/(Math.abs(r._ts)||1),r=r._dp;return!this.parent&&this._sat?this._sat.globalTime(i):s},e.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,zb(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(i){if(arguments.length){var r=this._time;return this._rDelay=i,zb(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},e.seek=function(i,r){return this.totalTime(Ii(this,i),ei(r))},e.restart=function(i,r){return this.play().totalTime(i?-this._delay:0,ei(r)),this._dur||(this._zTime=-Et),this},e.play=function(i,r){return i!=null&&this.seek(i,r),this.reversed(!1).paused(!1)},e.reverse=function(i,r){return i!=null&&this.seek(i||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(i,r){return i!=null&&this.seek(i,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-Et:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Et,this},e.isActive=function(){var i=this.parent||this._dp,r=this._start,s;return!!(!i||this._ts&&this._initted&&i.isActive()&&(s=i.rawTime(!0))>=r&&s<this.endTime(!0)-Et)},e.eventCallback=function(i,r,s){var o=this.vars;return arguments.length>1?(r?(o[i]=r,s&&(o[i+"Params"]=s),i==="onUpdate"&&(this._onUpdate=r)):delete o[i],this):o[i]},e.then=function(i){var r=this;return new Promise(function(s){var o=Kt(i)?i:H1,a=function(){var c=r.then;r.then=null,Kt(o)&&(o=o(r))&&(o.then||o===r)&&(r.then=c),s(o),r.then=c};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?a():r._prom=a})},e.kill=function(){wc(this)},n})();Ci(Xc.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Et,_prom:0,_ps:!1,_rts:1});var Bn=(function(n){R1(e,n);function e(i,r){var s;return i===void 0&&(i={}),s=n.call(this,i)||this,s.labels={},s.smoothChildTiming=!!i.smoothChildTiming,s.autoRemoveChildren=!!i.autoRemoveChildren,s._sort=ei(i.sortChildren),Vt&&ur(i.parent||Vt,Xr(s),r),i.reversed&&s.reverse(),i.paused&&s.paused(!0),i.scrollTrigger&&W1(Xr(s),i.scrollTrigger),s}var t=e.prototype;return t.to=function(r,s,o){return Sc(0,arguments,this),this},t.from=function(r,s,o){return Sc(1,arguments,this),this},t.fromTo=function(r,s,o,a){return Sc(2,arguments,this),this},t.set=function(r,s,o){return s.duration=0,s.parent=this,Cc(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new sn(r,s,Ii(this,o),1),this},t.call=function(r,s,o){return ur(this,sn.delayedCall(0,r,s),o)},t.staggerTo=function(r,s,o,a,l,c,h){return o.duration=s,o.stagger=o.stagger||a,o.onComplete=c,o.onCompleteParams=h,o.parent=this,new sn(r,o,Ii(this,l)),this},t.staggerFrom=function(r,s,o,a,l,c,h){return o.runBackwards=1,Cc(o).immediateRender=ei(o.immediateRender),this.staggerTo(r,s,o,a,l,c,h)},t.staggerFromTo=function(r,s,o,a,l,c,h,u){return a.startAt=o,Cc(a).immediateRender=ei(a.immediateRender),this.staggerTo(r,s,a,l,c,h,u)},t.render=function(r,s,o){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,h=r<=0?0:on(r),u=this._zTime<0!=r<0&&(this._initted||!c),d,p,_,v,m,f,g,b,y,M,S,P;if(this!==Vt&&h>l&&r>=0&&(h=l),h!==this._tTime||o||u){if(a!==this._time&&c&&(h+=this._time-a,r+=this._time-a),d=h,y=this._start,b=this._ts,f=!b,u&&(c||(a=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(S=this._yoyo,m=c+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(m*100+r,s,o);if(d=on(h%m),h===l?(v=this._repeat,d=c):(M=on(h/m),v=~~M,v&&v===M&&(d=c,v--),d>c&&(d=c)),M=xl(this._tTime,m),!a&&this._tTime&&M!==v&&this._tTime-M*m-this._dur<=0&&(M=v),S&&v&1&&(d=c-d,P=1),v!==M&&!this._lock){var A=S&&M&1,x=A===(S&&v&1);if(v<M&&(A=!A),a=A?0:h%c?c:h,this._lock=1,this.render(a||(P?0:on(v*m)),s,!c)._lock=0,this._tTime=h,!s&&this.parent&&gi(this,"onRepeat"),this.vars.repeatRefresh&&!P&&(this.invalidate()._lock=1),a&&a!==this._time||f!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,x&&(this._lock=2,a=A?c:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!P&&this.invalidate()),this._lock=0,!this._ts&&!f)return this;aE(this,P)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(g=eO(this,on(a),on(d)),g&&(h-=d-(d=g._start))),this._tTime=h,this._time=d,this._act=!b,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,a=0),!a&&h&&!s&&!M&&(gi(this,"onStart"),this._tTime!==h))return this;if(d>=a&&r>=0)for(p=this._first;p;){if(_=p._next,(p._act||d>=p._start)&&p._ts&&g!==p){if(p.parent!==this)return this.render(r,s,o);if(p.render(p._ts>0?(d-p._start)*p._ts:(p._dirty?p.totalDuration():p._tDur)+(d-p._start)*p._ts,s,o),d!==this._time||!this._ts&&!f){g=0,_&&(h+=this._zTime=-Et);break}}p=_}else{p=this._last;for(var E=r<0?r:d;p;){if(_=p._prev,(p._act||E<=p._end)&&p._ts&&g!==p){if(p.parent!==this)return this.render(r,s,o);if(p.render(p._ts>0?(E-p._start)*p._ts:(p._dirty?p.totalDuration():p._tDur)+(E-p._start)*p._ts,s,o||Cn&&mv(p)),d!==this._time||!this._ts&&!f){g=0,_&&(h+=this._zTime=E?-Et:Et);break}}p=_}}if(g&&!s&&(this.pause(),g.render(d>=a?0:-Et)._zTime=d>=a?1:-1,this._ts))return this._start=y,Dd(this),this.render(r,s,o);this._onUpdate&&!s&&gi(this,"onUpdate",!0),(h===l&&this._tTime>=this.totalDuration()||!h&&a)&&(y===this._start||Math.abs(b)!==Math.abs(this._ts))&&(this._lock||((r||!c)&&(h===l&&this._ts>0||!h&&this._ts<0)&&Js(this,1),!s&&!(r<0&&!a)&&(h||a||!l)&&(gi(this,h===l&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var o=this;if(cs(s)||(s=Ii(this,s,r)),!(r instanceof Xc)){if(In(r))return r.forEach(function(a){return o.add(a,s)}),this;if(wn(r))return this.addLabel(r,s);if(Kt(r))r=sn.delayedCall(0,r);else return this}return this!==r?ur(this,r,s):this},t.getChildren=function(r,s,o,a){r===void 0&&(r=!0),s===void 0&&(s=!0),o===void 0&&(o=!0),a===void 0&&(a=-Fi);for(var l=[],c=this._first;c;)c._start>=a&&(c instanceof sn?s&&l.push(c):(o&&l.push(c),r&&l.push.apply(l,c.getChildren(!0,s,o)))),c=c._next;return l},t.getById=function(r){for(var s=this.getChildren(1,1,1),o=s.length;o--;)if(s[o].vars.id===r)return s[o]},t.remove=function(r){return wn(r)?this.removeLabel(r):Kt(r)?this.killTweensOf(r):(r.parent===this&&Ld(this,r),r===this._recent&&(this._recent=this._last),Fo(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=on(fi.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),n.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=Ii(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,o){var a=sn.delayedCall(0,s||jc,o);return a.data="isPause",this._hasPause=1,ur(this,a,Ii(this,r))},t.removePause=function(r){var s=this._first;for(r=Ii(this,r);s;)s._start===r&&s.data==="isPause"&&Js(s),s=s._next},t.killTweensOf=function(r,s,o){for(var a=this.getTweensOf(r,o),l=a.length;l--;)Ns!==a[l]&&a[l].kill(r,s);return this},t.getTweensOf=function(r,s){for(var o=[],a=Vi(r),l=this._first,c=cs(s),h;l;)l instanceof sn?KI(l._targets,a)&&(c?(!Ns||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&o.push(l):(h=l.getTweensOf(a,s)).length&&o.push.apply(o,h),l=l._next;return o},t.tweenTo=function(r,s){s=s||{};var o=this,a=Ii(o,r),l=s,c=l.startAt,h=l.onStart,u=l.onStartParams,d=l.immediateRender,p,_=sn.to(o,Ci({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale())||Et,onStart:function(){if(o.pause(),!p){var m=s.duration||Math.abs((a-(c&&"time"in c?c.time:o._time))/o.timeScale());_._dur!==m&&wl(_,m,0,1).render(_._time,!0,!0),p=1}h&&h.apply(_,u||[])}},s));return d?_.render(0):_},t.tweenFromTo=function(r,s,o){return this.tweenTo(s,Ci({startAt:{time:Ii(this,r)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),$b(this,Ii(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),$b(this,Ii(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+Et)},t.shiftChildren=function(r,s,o){o===void 0&&(o=0);for(var a=this._first,l=this.labels,c;a;)a._start>=o&&(a._start+=r,a._end+=r),a=a._next;if(s)for(c in l)l[c]>=o&&(l[c]+=r);return Fo(this)},t.invalidate=function(r){var s=this._first;for(this._lock=0;s;)s.invalidate(r),s=s._next;return n.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var s=this._first,o;s;)o=s._next,this.remove(s),s=o;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),Fo(this)},t.totalDuration=function(r){var s=0,o=this,a=o._last,l=Fi,c,h,u;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-r:r));if(o._dirty){for(u=o.parent;a;)c=a._prev,a._dirty&&a.totalDuration(),h=a._start,h>l&&o._sort&&a._ts&&!o._lock?(o._lock=1,ur(o,a,h-a._delay,1)._lock=0):l=h,h<0&&a._ts&&(s-=h,(!u&&!o._dp||u&&u.smoothChildTiming)&&(o._start+=h/o._ts,o._time-=h,o._tTime-=h),o.shiftChildren(-h,!1,-1/0),l=0),a._end>s&&a._ts&&(s=a._end),a=c;wl(o,o===Vt&&o._time>s?o._time:s,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(r){if(Vt._ts&&(z1(Vt,Yu(r,Vt)),U1=fi.frame),fi.frame>=Vb){Vb+=wi.autoSleep||120;var s=Vt._first;if((!s||!s._ts)&&wi.autoSleep&&fi._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||fi.sleep()}}},e})(Xc);Ci(Bn.prototype,{_lock:0,_hasPause:0,_forcing:0});var vO=function(e,t,i,r,s,o,a){var l=new ni(this._pt,e,t,0,1,mE,null,s),c=0,h=0,u,d,p,_,v,m,f,g;for(l.b=i,l.e=r,i+="",r+="",(f=~r.indexOf("random("))&&(r=Wc(r)),o&&(g=[i,r],o(g,e,t),i=g[0],r=g[1]),d=i.match(Xp)||[];u=Xp.exec(r);)_=u[0],v=r.substring(c,u.index),p?p=(p+1)%5:v.substr(-5)==="rgba("&&(p=1),_!==d[h++]&&(m=parseFloat(d[h-1])||0,l._pt={_next:l._pt,p:v||h===1?v:",",s:m,c:_.charAt(1)==="="?tl(m,_)-m:parseFloat(_)-m,m:p&&p<4?Math.round:0},c=Xp.lastIndex);return l.c=c<r.length?r.substring(c,r.length):"",l.fp=a,(I1.test(r)||f)&&(l.e=0),this._pt=l,l},vv=function(e,t,i,r,s,o,a,l,c,h){Kt(r)&&(r=r(s||0,e,o));var u=e[t],d=i!=="get"?i:Kt(u)?c?e[t.indexOf("set")||!Kt(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():u,p=Kt(u)?c?wO:pE:gv,_;if(wn(r)&&(~r.indexOf("random(")&&(r=Wc(r)),r.charAt(1)==="="&&(_=tl(d,r)+(Dn(d)||0),(_||_===0)&&(r=_))),!h||d!==r||Hm)return!isNaN(d*r)&&r!==""?(_=new ni(this._pt,e,t,+d||0,r-(d||0),typeof u=="boolean"?EO:fE,0,p),c&&(_.fp=c),a&&_.modifier(a,this,e),this._pt=_):(!u&&!(t in e)&&uv(t,r),vO.call(this,e,t,d,r,p,l||wi.stringFilter,c))},_O=function(e,t,i,r,s){if(Kt(e)&&(e=Mc(e,s,t,i,r)),!Pr(e)||e.style&&e.nodeType||In(e)||D1(e))return wn(e)?Mc(e,s,t,i,r):e;var o={},a;for(a in e)o[a]=Mc(e[a],s,t,i,r);return o},hE=function(e,t,i,r,s,o){var a,l,c,h;if(ui[e]&&(a=new ui[e]).init(s,a.rawVars?t[e]:_O(t[e],r,s,o,i),i,r,o)!==!1&&(i._pt=l=new ni(i._pt,s,e,0,1,a.render,a,0,a.priority),i!==Ka))for(c=i._ptLookup[i._targets.indexOf(s)],h=a._props.length;h--;)c[a._props[h]]=l;return a},Ns,Hm,_v=function n(e,t,i){var r=e.vars,s=r.ease,o=r.startAt,a=r.immediateRender,l=r.lazy,c=r.onUpdate,h=r.runBackwards,u=r.yoyoEase,d=r.keyframes,p=r.autoRevert,_=e._dur,v=e._startAt,m=e._targets,f=e.parent,g=f&&f.data==="nested"?f.vars.targets:m,b=e._overwrite==="auto"&&!av,y=e.timeline,M,S,P,A,x,E,R,O,F,G,H,B,W;if(y&&(!d||!s)&&(s="none"),e._ease=Vo(s,gl.ease),e._yEase=u?oE(Vo(u===!0?s:u,gl.ease)):0,u&&e._yoyo&&!e._repeat&&(u=e._yEase,e._yEase=e._ease,e._ease=u),e._from=!y&&!!r.runBackwards,!y||d&&!r.stagger){if(O=m[0]?No(m[0]).harness:0,B=O&&r[O.prop],M=qu(r,dv),v&&(v._zTime<0&&v.progress(1),t<0&&h&&a&&!p?v.render(-1,!0):v.revert(h&&_?Su:jI),v._lazy=0),o){if(Js(e._startAt=sn.set(m,Ci({data:"isStart",overwrite:!1,parent:f,immediateRender:!0,lazy:!v&&ei(l),startAt:null,delay:0,onUpdate:c&&function(){return gi(e,"onUpdate")},stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Cn||!a&&!p)&&e._startAt.revert(Su),a&&_&&t<=0&&i<=0){t&&(e._zTime=t);return}}else if(h&&_&&!v){if(t&&(a=!1),P=Ci({overwrite:!1,data:"isFromStart",lazy:a&&!v&&ei(l),immediateRender:a,stagger:0,parent:f},M),B&&(P[O.prop]=B),Js(e._startAt=sn.set(m,P)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Cn?e._startAt.revert(Su):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,Et,Et);else if(!t)return}for(e._pt=e._ptCache=0,l=_&&ei(l)||l&&!_,S=0;S<m.length;S++){if(x=m[S],R=x._gsap||fv(m)[S]._gsap,e._ptLookup[S]=G={},Fm[R.id]&&js.length&&Xu(),H=g===m?S:g.indexOf(x),O&&(F=new O).init(x,B||M,e,H,g)!==!1&&(e._pt=A=new ni(e._pt,x,F.name,0,1,F.render,F,0,F.priority),F._props.forEach(function($){G[$]=A}),F.priority&&(E=1)),!O||B)for(P in M)ui[P]&&(F=hE(P,M,e,H,x,g))?F.priority&&(E=1):G[P]=A=vv.call(e,x,P,"get",M[P],H,g,0,r.stringFilter);e._op&&e._op[S]&&e.kill(x,e._op[S]),b&&e._pt&&(Ns=e,Vt.killTweensOf(x,G,e.globalTime(t)),W=!e.parent,Ns=0),e._pt&&l&&(Fm[R.id]=1)}E&&vE(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!W,d&&t<=0&&y.render(Fi,!0,!0)},gO=function(e,t,i,r,s,o,a,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],h,u,d,p;if(!c)for(c=e._ptCache[t]=[],d=e._ptLookup,p=e._targets.length;p--;){if(h=d[p][t],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==t&&h.fp!==t;)h=h._next;if(!h)return Hm=1,e.vars[t]="+=0",_v(e,a),Hm=0,l?Gc(t+" not eligible for reset"):1;c.push(h)}for(p=c.length;p--;)u=c[p],h=u._pt||u,h.s=(r||r===0)&&!s?r:h.s+(r||0)+o*h.c,h.c=i-h.s,u.e&&(u.e=Jt(i)+Dn(u.e)),u.b&&(u.b=h.s+Dn(u.b))},bO=function(e,t){var i=e[0]?No(e[0]).harness:0,r=i&&i.aliases,s,o,a,l;if(!r)return t;s=bl({},t);for(o in r)if(o in s)for(l=r[o].split(","),a=l.length;a--;)s[l[a]]=s[o];return s},xO=function(e,t,i,r){var s=t.ease||r||"power1.inOut",o,a;if(In(t))a=i[e]||(i[e]=[]),t.forEach(function(l,c){return a.push({t:c/(t.length-1)*100,v:l,e:s})});else for(o in t)a=i[o]||(i[o]=[]),o==="ease"||a.push({t:parseFloat(e),v:t[o],e:s})},Mc=function(e,t,i,r,s){return Kt(e)?e.call(t,i,r,s):wn(e)&&~e.indexOf("random(")?Wc(e):e},uE=pv+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",dE={};ti(uE+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return dE[n]=1});var sn=(function(n){R1(e,n);function e(i,r,s,o){var a;typeof r=="number"&&(s.duration=r,r=s,s=null),a=n.call(this,o?r:Cc(r))||this;var l=a.vars,c=l.duration,h=l.delay,u=l.immediateRender,d=l.stagger,p=l.overwrite,_=l.keyframes,v=l.defaults,m=l.scrollTrigger,f=l.yoyoEase,g=r.parent||Vt,b=(In(i)||D1(i)?cs(i[0]):"length"in r)?[i]:Vi(i),y,M,S,P,A,x,E,R;if(a._targets=b.length?fv(b):Gc("GSAP target "+i+" not found. https://gsap.com",!wi.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=p,_||d||su(c)||su(h)){if(r=a.vars,y=a.timeline=new Bn({data:"nested",defaults:v||{},targets:g&&g.data==="nested"?g.vars.targets:b}),y.kill(),y.parent=y._dp=Xr(a),y._start=0,d||su(c)||su(h)){if(P=b.length,E=d&&Y1(d),Pr(d))for(A in d)~uE.indexOf(A)&&(R||(R={}),R[A]=d[A]);for(M=0;M<P;M++)S=qu(r,dE),S.stagger=0,f&&(S.yoyoEase=f),R&&bl(S,R),x=b[M],S.duration=+Mc(c,Xr(a),M,x,b),S.delay=(+Mc(h,Xr(a),M,x,b)||0)-a._delay,!d&&P===1&&S.delay&&(a._delay=h=S.delay,a._start+=h,S.delay=0),y.to(x,S,E?E(M,x,b):0),y._ease=it.none;y.duration()?c=h=0:a.timeline=0}else if(_){Cc(Ci(y.vars.defaults,{ease:"none"})),y._ease=Vo(_.ease||r.ease||"none");var O=0,F,G,H;if(In(_))_.forEach(function(B){return y.to(b,B,">")}),y.duration();else{S={};for(A in _)A==="ease"||A==="easeEach"||xO(A,_[A],S,_.easeEach);for(A in S)for(F=S[A].sort(function(B,W){return B.t-W.t}),O=0,M=0;M<F.length;M++)G=F[M],H={ease:G.e,duration:(G.t-(M?F[M-1].t:0))/100*c},H[A]=G.v,y.to(b,H,O),O+=H.duration;y.duration()<c&&y.to({},{duration:c-y.duration()})}}c||a.duration(c=y.duration())}else a.timeline=0;return p===!0&&!av&&(Ns=Xr(a),Vt.killTweensOf(b),Ns=0),ur(g,Xr(a),s),r.reversed&&a.reverse(),r.paused&&a.paused(!0),(u||!c&&!_&&a._start===on(g._time)&&ei(u)&&ZI(Xr(a))&&g.data!=="nested")&&(a._tTime=-Et,a.render(Math.max(0,-h)||0)),m&&W1(Xr(a),m),a}var t=e.prototype;return t.render=function(r,s,o){var a=this._time,l=this._tDur,c=this._dur,h=r<0,u=r>l-Et&&!h?l:r<Et?0:r,d,p,_,v,m,f,g,b,y;if(!c)QI(this,r,s,o);else if(u!==this._tTime||!r||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(d=u,b=this.timeline,this._repeat){if(v=c+this._rDelay,this._repeat<-1&&h)return this.totalTime(v*100+r,s,o);if(d=on(u%v),u===l?(_=this._repeat,d=c):(m=on(u/v),_=~~m,_&&_===m?(d=c,_--):d>c&&(d=c)),f=this._yoyo&&_&1,f&&(y=this._yEase,d=c-d),m=xl(this._tTime,v),d===a&&!o&&this._initted&&_===m)return this._tTime=u,this;_!==m&&(b&&this._yEase&&aE(b,f),this.vars.repeatRefresh&&!f&&!this._lock&&d!==v&&this._initted&&(this._lock=o=1,this.render(on(v*_),!0).invalidate()._lock=0))}if(!this._initted){if(K1(this,h?r:d,o,s,u))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&_!==m))return this;if(c!==this._dur)return this.render(r,s,o)}if(this._tTime=u,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=g=(y||this._ease)(d/c),this._from&&(this.ratio=g=1-g),!a&&u&&!s&&!m&&(gi(this,"onStart"),this._tTime!==u))return this;for(p=this._pt;p;)p.r(g,p.d),p=p._next;b&&b.render(r<0?r:b._dur*b._ease(d/this._dur),s,o)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(h&&Vm(this,r,s,o),gi(this,"onUpdate")),this._repeat&&_!==m&&this.vars.onRepeat&&!s&&this.parent&&gi(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(h&&!this._onUpdate&&Vm(this,r,!0,!0),(r||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&Js(this,1),!s&&!(h&&!a)&&(u||a||f)&&(gi(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),n.prototype.invalidate.call(this,r)},t.resetTo=function(r,s,o,a,l){Kc||fi.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||_v(this,c),h=this._ease(c/this._dur),gO(this,r,s,o,a,h,c,l)?this.resetTo(r,s,o,a,1):(kd(this,0),this.parent||G1(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!r&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?wc(this):this.scrollTrigger&&this.scrollTrigger.kill(!!Cn),this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,Ns&&Ns.vars.overwrite!==!0)._first||wc(this),this.parent&&o!==this.timeline.totalDuration()&&wl(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,l=r?Vi(r):a,c=this._ptLookup,h=this._pt,u,d,p,_,v,m,f;if((!s||s==="all")&&qI(a,l))return s==="all"&&(this._pt=0),wc(this);for(u=this._op=this._op||[],s!=="all"&&(wn(s)&&(v={},ti(s,function(g){return v[g]=1}),s=v),s=bO(a,s)),f=a.length;f--;)if(~l.indexOf(a[f])){d=c[f],s==="all"?(u[f]=s,_=d,p={}):(p=u[f]=u[f]||{},_=s);for(v in _)m=d&&d[v],m&&((!("kill"in m.d)||m.d.kill(v)===!0)&&Ld(this,m,"_pt"),delete d[v]),p!=="all"&&(p[v]=1)}return this._initted&&!this._pt&&h&&wc(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return Sc(1,arguments)},e.delayedCall=function(r,s,o,a){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},e.fromTo=function(r,s,o){return Sc(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,o){return Vt.killTweensOf(r,s,o)},e})(Xc);Ci(sn.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ti("staggerTo,staggerFrom,staggerFromTo",function(n){sn[n]=function(){var e=new Bn,t=Bm.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var gv=function(e,t,i){return e[t]=i},pE=function(e,t,i){return e[t](i)},wO=function(e,t,i,r){return e[t](r.fp,i)},yO=function(e,t,i){return e.setAttribute(t,i)},bv=function(e,t){return Kt(e[t])?pE:lv(e[t])&&e.setAttribute?yO:gv},fE=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},EO=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},mE=function(e,t){var i=t._pt,r="";if(!e&&t.b)r=t.b;else if(e===1&&t.e)r=t.e;else{for(;i;)r=i.p+(i.m?i.m(i.s+i.c*e):Math.round((i.s+i.c*e)*1e4)/1e4)+r,i=i._next;r+=t.c}t.set(t.t,t.p,r,t)},xv=function(e,t){for(var i=t._pt;i;)i.r(e,i.d),i=i._next},CO=function(e,t,i,r){for(var s=this._pt,o;s;)o=s._next,s.p===r&&s.modifier(e,t,i),s=o},SO=function(e){for(var t=this._pt,i,r;t;)r=t._next,t.p===e&&!t.op||t.op===e?Ld(this,t,"_pt"):t.dep||(i=1),t=r;return!i},MO=function(e,t,i,r){r.mSet(e,t,r.m.call(r.tween,i,r.mt),r)},vE=function(e){for(var t=e._pt,i,r,s,o;t;){for(i=t._next,r=s;r&&r.pr>t.pr;)r=r._next;(t._prev=r?r._prev:o)?t._prev._next=t:s=t,(t._next=r)?r._prev=t:o=t,t=i}e._pt=s},ni=(function(){function n(t,i,r,s,o,a,l,c,h){this.t=i,this.s=s,this.c=o,this.p=r,this.r=a||fE,this.d=l||this,this.set=c||gv,this.pr=h||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(i,r,s){this.mSet=this.mSet||this.set,this.set=MO,this.m=i,this.mt=s,this.tween=r},n})();ti(pv+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return dv[n]=1});Ei.TweenMax=Ei.TweenLite=sn;Ei.TimelineLite=Ei.TimelineMax=Bn;Vt=new Bn({sortChildren:!1,defaults:gl,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});wi.stringFilter=sE;var Uo=[],Pu={},PO=[],Gb=0,TO=0,Qp=function(e){return(Pu[e]||PO).map(function(t){return t()})},Gm=function(){var e=Date.now(),t=[];e-Gb>2&&(Qp("matchMediaInit"),Uo.forEach(function(i){var r=i.queries,s=i.conditions,o,a,l,c;for(a in r)o=cr.matchMedia(r[a]).matches,o&&(l=1),o!==s[a]&&(s[a]=o,c=1);c&&(i.revert(),l&&t.push(i))}),Qp("matchMediaRevert"),t.forEach(function(i){return i.onMatch(i,function(r){return i.add(null,r)})}),Gb=e,Qp("matchMedia"))},_E=(function(){function n(t,i){this.selector=i&&zm(i),this.data=[],this._r=[],this.isReverted=!1,this.id=TO++,t&&this.add(t)}var e=n.prototype;return e.add=function(i,r,s){Kt(i)&&(s=r,r=i,i=Kt);var o=this,a=function(){var c=Dt,h=o.selector,u;return c&&c!==o&&c.data.push(o),s&&(o.selector=zm(s)),Dt=o,u=r.apply(o,arguments),Kt(u)&&o._r.push(u),Dt=c,o.selector=h,o.isReverted=!1,u};return o.last=a,i===Kt?a(o,function(l){return o.add(null,l)}):i?o[i]=a:a},e.ignore=function(i){var r=Dt;Dt=null,i(this),Dt=r},e.getTweens=function(){var i=[];return this.data.forEach(function(r){return r instanceof n?i.push.apply(i,r.getTweens()):r instanceof sn&&!(r.parent&&r.parent.data==="nested")&&i.push(r)}),i},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(i,r){var s=this;if(i?(function(){for(var a=s.getTweens(),l=s.data.length,c;l--;)c=s.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(h){return a.splice(a.indexOf(h),1)}));for(a.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,u){return u.g-h.g||-1/0}).forEach(function(h){return h.t.revert(i)}),l=s.data.length;l--;)c=s.data[l],c instanceof Bn?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof sn)&&c.revert&&c.revert(i);s._r.forEach(function(h){return h(i,s)}),s.isReverted=!0})():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),r)for(var o=Uo.length;o--;)Uo[o].id===this.id&&Uo.splice(o,1)},e.revert=function(i){this.kill(i||{})},n})(),AO=(function(){function n(t){this.contexts=[],this.scope=t,Dt&&Dt.data.push(this)}var e=n.prototype;return e.add=function(i,r,s){Pr(i)||(i={matches:i});var o=new _E(0,s||this.scope),a=o.conditions={},l,c,h;Dt&&!o.selector&&(o.selector=Dt.selector),this.contexts.push(o),r=o.add("onMatch",r),o.queries=i;for(c in i)c==="all"?h=1:(l=cr.matchMedia(i[c]),l&&(Uo.indexOf(o)<0&&Uo.push(o),(a[c]=l.matches)&&(h=1),l.addListener?l.addListener(Gm):l.addEventListener("change",Gm)));return h&&r(o,function(u){return o.add(null,u)}),this},e.revert=function(i){this.kill(i||{})},e.kill=function(i){this.contexts.forEach(function(r){return r.kill(i,!0)})},n})(),Zu={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(function(r){return nE(r)})},timeline:function(e){return new Bn(e)},getTweensOf:function(e,t){return Vt.getTweensOf(e,t)},getProperty:function(e,t,i,r){wn(e)&&(e=Vi(e)[0]);var s=No(e||{}).get,o=i?H1:$1;return i==="native"&&(i=""),e&&(t?o((ui[t]&&ui[t].get||s)(e,t,i,r)):function(a,l,c){return o((ui[a]&&ui[a].get||s)(e,a,l,c))})},quickSetter:function(e,t,i){if(e=Vi(e),e.length>1){var r=e.map(function(h){return si.quickSetter(h,t,i)}),s=r.length;return function(h){for(var u=s;u--;)r[u](h)}}e=e[0]||{};var o=ui[t],a=No(e),l=a.harness&&(a.harness.aliases||{})[t]||t,c=o?function(h){var u=new o;Ka._pt=0,u.init(e,i?h+i:h,Ka,0,[e]),u.render(1,u),Ka._pt&&xv(1,Ka)}:a.set(e,l);return o?c:function(h){return c(e,l,i?h+i:h,a,1)}},quickTo:function(e,t,i){var r,s=si.to(e,Ci((r={},r[t]="+=0.1",r.paused=!0,r.stagger=0,r),i||{})),o=function(l,c,h){return s.resetTo(t,l,c,h)};return o.tween=s,o},isTweening:function(e){return Vt.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Vo(e.ease,gl.ease)),Ub(gl,e||{})},config:function(e){return Ub(wi,e||{})},registerEffect:function(e){var t=e.name,i=e.effect,r=e.plugins,s=e.defaults,o=e.extendTimeline;(r||"").split(",").forEach(function(a){return a&&!ui[a]&&!Ei[a]&&Gc(t+" effect requires "+a+" plugin.")}),qp[t]=function(a,l,c){return i(Vi(a),Ci(l||{},s),c)},o&&(Bn.prototype[t]=function(a,l,c){return this.add(qp[t](a,Pr(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){it[e]=Vo(t)},parseEase:function(e,t){return arguments.length?Vo(e,t):it},getById:function(e){return Vt.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var i=new Bn(e),r,s;for(i.smoothChildTiming=ei(e.smoothChildTiming),Vt.remove(i),i._dp=0,i._time=i._tTime=Vt._time,r=Vt._first;r;)s=r._next,(t||!(!r._dur&&r instanceof sn&&r.vars.onComplete===r._targets[0]))&&ur(i,r,r._start-r._delay),r=s;return ur(Vt,i,0),i},context:function(e,t){return e?new _E(e,t):Dt},matchMedia:function(e){return new AO(e)},matchMediaRefresh:function(){return Uo.forEach(function(e){var t=e.conditions,i,r;for(r in t)t[r]&&(t[r]=!1,i=1);i&&e.revert()})||Gm()},addEventListener:function(e,t){var i=Pu[e]||(Pu[e]=[]);~i.indexOf(t)||i.push(t)},removeEventListener:function(e,t){var i=Pu[e],r=i&&i.indexOf(t);r>=0&&i.splice(r,1)},utils:{wrap:aO,wrapYoyo:lO,distribute:Y1,random:J1,snap:Z1,normalize:oO,getUnit:Dn,clamp:nO,splitColor:iE,toArray:Vi,selector:zm,mapRange:eE,pipe:rO,unitize:sO,interpolate:cO,shuffle:q1},install:F1,effects:qp,ticker:fi,updateRoot:Bn.updateRoot,plugins:ui,globalTimeline:Vt,core:{PropTween:ni,globals:V1,Tween:sn,Timeline:Bn,Animation:Xc,getCache:No,_removeLinkedListItem:Ld,reverting:function(){return Cn},context:function(e){return e&&Dt&&(Dt.data.push(e),e._ctx=Dt),Dt},suppressOverwrites:function(e){return av=e}}};ti("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return Zu[n]=sn[n]});fi.add(Bn.updateRoot);Ka=Zu.to({},{duration:0});var RO=function(e,t){for(var i=e._pt;i&&i.p!==t&&i.op!==t&&i.fp!==t;)i=i._next;return i},LO=function(e,t){var i=e._targets,r,s,o;for(r in t)for(s=i.length;s--;)o=e._ptLookup[s][r],o&&(o=o.d)&&(o._pt&&(o=RO(o,r)),o&&o.modifier&&o.modifier(t[r],e,i[s],r))},ef=function(e,t){return{name:e,headless:1,rawVars:1,init:function(r,s,o){o._onInit=function(a){var l,c;if(wn(s)&&(l={},ti(s,function(h){return l[h]=1}),s=l),t){l={};for(c in s)l[c]=t(s[c]);s=l}LO(a,s)}}}},si=Zu.registerPlugin({name:"attr",init:function(e,t,i,r,s){var o,a,l;this.tween=i;for(o in t)l=e.getAttribute(o)||"",a=this.add(e,"setAttribute",(l||0)+"",t[o],r,s,0,0,o),a.op=o,a.b=l,this._props.push(o)},render:function(e,t){for(var i=t._pt;i;)Cn?i.set(i.t,i.p,i.b,i):i.r(e,i.d),i=i._next}},{name:"endArray",headless:1,init:function(e,t){for(var i=t.length;i--;)this.add(e,i,e[i]||0,t[i],0,0,0,0,0,1)}},ef("roundProps",$m),ef("modifiers"),ef("snap",Z1))||Zu;sn.version=Bn.version=si.version="3.13.0";N1=1;cv()&&yl();it.Power0;it.Power1;it.Power2;it.Power3;it.Power4;it.Linear;it.Quad;it.Cubic;it.Quart;it.Quint;it.Strong;it.Elastic;it.Back;it.SteppedEase;it.Bounce;it.Sine;it.Expo;it.Circ;var jb,Fs,nl,wv,Ro,Wb,yv,DO=function(){return typeof window<"u"},hs={},Co=180/Math.PI,il=Math.PI/180,Ia=Math.atan2,Kb=1e8,Ev=/([A-Z])/g,kO=/(left|right|width|margin|padding|x)/i,IO=/[\s,\(]\S/,_r={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},jm=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},OO=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},NO=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},FO=function(e,t){var i=t.s+t.c*e;t.set(t.t,t.p,~~(i+(i<0?-.5:.5))+t.u,t)},gE=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},bE=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},VO=function(e,t,i){return e.style[t]=i},UO=function(e,t,i){return e.style.setProperty(t,i)},BO=function(e,t,i){return e._gsap[t]=i},zO=function(e,t,i){return e._gsap.scaleX=e._gsap.scaleY=i},$O=function(e,t,i,r,s){var o=e._gsap;o.scaleX=o.scaleY=i,o.renderTransform(s,o)},HO=function(e,t,i,r,s){var o=e._gsap;o[t]=i,o.renderTransform(s,o)},Ut="transform",ii=Ut+"Origin",GO=function n(e,t){var i=this,r=this.target,s=r.style,o=r._gsap;if(e in hs&&s){if(this.tfm=this.tfm||{},e!=="transform")e=_r[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return i.tfm[a]=qr(r,a)}):this.tfm[e]=o.x?o[e]:qr(r,e),e===ii&&(this.tfm.zOrigin=o.zOrigin);else return _r.transform.split(",").forEach(function(a){return n.call(i,a,t)});if(this.props.indexOf(Ut)>=0)return;o.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(ii,t,"")),e=Ut}(s||t)&&this.props.push(e,t,s[e])},xE=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},jO=function(){var e=this.props,t=this.target,i=t.style,r=t._gsap,s,o;for(s=0;s<e.length;s+=3)e[s+1]?e[s+1]===2?t[e[s]](e[s+2]):t[e[s]]=e[s+2]:e[s+2]?i[e[s]]=e[s+2]:i.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(Ev,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)r[o]=this.tfm[o];r.svg&&(r.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=yv(),(!s||!s.isStart)&&!i[Ut]&&(xE(i),r.zOrigin&&i[ii]&&(i[ii]+=" "+r.zOrigin+"px",r.zOrigin=0,r.renderTransform()),r.uncache=1)}},wE=function(e,t){var i={target:e,props:[],revert:jO,save:GO};return e._gsap||si.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(r){return i.save(r)}),i},yE,Wm=function(e,t){var i=Fs.createElementNS?Fs.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Fs.createElement(e);return i&&i.style?i:Fs.createElement(e)},Ui=function n(e,t,i){var r=getComputedStyle(e);return r[t]||r.getPropertyValue(t.replace(Ev,"-$1").toLowerCase())||r.getPropertyValue(t)||!i&&n(e,El(t)||t,1)||""},Xb="O,Moz,ms,Ms,Webkit".split(","),El=function(e,t,i){var r=t||Ro,s=r.style,o=5;if(e in s&&!i)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(Xb[o]+e in s););return o<0?null:(o===3?"ms":o>=0?Xb[o]:"")+e},Km=function(){DO()&&window.document&&(jb=window,Fs=jb.document,nl=Fs.documentElement,Ro=Wm("div")||{style:{}},Wm("div"),Ut=El(Ut),ii=Ut+"Origin",Ro.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",yE=!!El("perspective"),yv=si.core.reverting,wv=1)},qb=function(e){var t=e.ownerSVGElement,i=Wm("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=e.cloneNode(!0),s;r.style.display="block",i.appendChild(r),nl.appendChild(i);try{s=r.getBBox()}catch{}return i.removeChild(r),nl.removeChild(i),s},Yb=function(e,t){for(var i=t.length;i--;)if(e.hasAttribute(t[i]))return e.getAttribute(t[i])},EE=function(e){var t,i;try{t=e.getBBox()}catch{t=qb(e),i=1}return t&&(t.width||t.height)||i||(t=qb(e)),t&&!t.width&&!t.x&&!t.y?{x:+Yb(e,["x","cx","x1"])||0,y:+Yb(e,["y","cy","y1"])||0,width:0,height:0}:t},CE=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&EE(e))},Wo=function(e,t){if(t){var i=e.style,r;t in hs&&t!==ii&&(t=Ut),i.removeProperty?(r=t.substr(0,2),(r==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),i.removeProperty(r==="--"?t:t.replace(Ev,"-$1").toLowerCase())):i.removeAttribute(t)}},Vs=function(e,t,i,r,s,o){var a=new ni(e._pt,t,i,0,1,o?bE:gE);return e._pt=a,a.b=r,a.e=s,e._props.push(i),a},Zb={deg:1,rad:1,turn:1},WO={grid:1,flex:1},Qs=function n(e,t,i,r){var s=parseFloat(i)||0,o=(i+"").trim().substr((s+"").length)||"px",a=Ro.style,l=kO.test(t),c=e.tagName.toLowerCase()==="svg",h=(c?"client":"offset")+(l?"Width":"Height"),u=100,d=r==="px",p=r==="%",_,v,m,f;if(r===o||!s||Zb[r]||Zb[o])return s;if(o!=="px"&&!d&&(s=n(e,t,i,"px")),f=e.getCTM&&CE(e),(p||o==="%")&&(hs[t]||~t.indexOf("adius")))return _=f?e.getBBox()[l?"width":"height"]:e[h],Jt(p?s/_*u:s/100*_);if(a[l?"width":"height"]=u+(d?o:r),v=r!=="rem"&&~t.indexOf("adius")||r==="em"&&e.appendChild&&!c?e:e.parentNode,f&&(v=(e.ownerSVGElement||{}).parentNode),(!v||v===Fs||!v.appendChild)&&(v=Fs.body),m=v._gsap,m&&p&&m.width&&l&&m.time===fi.time&&!m.uncache)return Jt(s/m.width*u);if(p&&(t==="height"||t==="width")){var g=e.style[t];e.style[t]=u+r,_=e[h],g?e.style[t]=g:Wo(e,t)}else(p||o==="%")&&!WO[Ui(v,"display")]&&(a.position=Ui(e,"position")),v===e&&(a.position="static"),v.appendChild(Ro),_=Ro[h],v.removeChild(Ro),a.position="absolute";return l&&p&&(m=No(v),m.time=fi.time,m.width=v[h]),Jt(d?_*s/u:_&&s?u/_*s:0)},qr=function(e,t,i,r){var s;return wv||Km(),t in _r&&t!=="transform"&&(t=_r[t],~t.indexOf(",")&&(t=t.split(",")[0])),hs[t]&&t!=="transform"?(s=Yc(e,r),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:Qu(Ui(e,ii))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=Ju[t]&&Ju[t](e,t,i)||Ui(e,t)||B1(e,t)||(t==="opacity"?1:0))),i&&!~(s+"").trim().indexOf(" ")?Qs(e,t,s,i)+i:s},KO=function(e,t,i,r){if(!i||i==="none"){var s=El(t,e,1),o=s&&Ui(e,s,1);o&&o!==i?(t=s,i=o):t==="borderColor"&&(i=Ui(e,"borderTopColor"))}var a=new ni(this._pt,e.style,t,0,1,mE),l=0,c=0,h,u,d,p,_,v,m,f,g,b,y,M;if(a.b=i,a.e=r,i+="",r+="",r.substring(0,6)==="var(--"&&(r=Ui(e,r.substring(4,r.indexOf(")")))),r==="auto"&&(v=e.style[t],e.style[t]=r,r=Ui(e,t)||r,v?e.style[t]=v:Wo(e,t)),h=[i,r],sE(h),i=h[0],r=h[1],d=i.match(Wa)||[],M=r.match(Wa)||[],M.length){for(;u=Wa.exec(r);)m=u[0],g=r.substring(l,u.index),_?_=(_+1)%5:(g.substr(-5)==="rgba("||g.substr(-5)==="hsla(")&&(_=1),m!==(v=d[c++]||"")&&(p=parseFloat(v)||0,y=v.substr((p+"").length),m.charAt(1)==="="&&(m=tl(p,m)+y),f=parseFloat(m),b=m.substr((f+"").length),l=Wa.lastIndex-b.length,b||(b=b||wi.units[t]||y,l===r.length&&(r+=b,a.e+=b)),y!==b&&(p=Qs(e,t,v,b)||0),a._pt={_next:a._pt,p:g||c===1?g:",",s:p,c:f-p,m:_&&_<4||t==="zIndex"?Math.round:0});a.c=l<r.length?r.substring(l,r.length):""}else a.r=t==="display"&&r==="none"?bE:gE;return I1.test(r)&&(a.e=0),this._pt=a,a},Jb={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},XO=function(e){var t=e.split(" "),i=t[0],r=t[1]||"50%";return(i==="top"||i==="bottom"||r==="left"||r==="right")&&(e=i,i=r,r=e),t[0]=Jb[i]||i,t[1]=Jb[r]||r,t.join(" ")},qO=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var i=t.t,r=i.style,s=t.u,o=i._gsap,a,l,c;if(s==="all"||s===!0)r.cssText="",l=1;else for(s=s.split(","),c=s.length;--c>-1;)a=s[c],hs[a]&&(l=1,a=a==="transformOrigin"?ii:Ut),Wo(i,a);l&&(Wo(i,Ut),o&&(o.svg&&i.removeAttribute("transform"),r.scale=r.rotate=r.translate="none",Yc(i,1),o.uncache=1,xE(r)))}},Ju={clearProps:function(e,t,i,r,s){if(s.data!=="isFromStart"){var o=e._pt=new ni(e._pt,t,i,0,0,qO);return o.u=r,o.pr=-10,o.tween=s,e._props.push(i),1}}},qc=[1,0,0,1,0,0],SE={},ME=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Qb=function(e){var t=Ui(e,Ut);return ME(t)?qc:t.substr(7).match(k1).map(Jt)},Cv=function(e,t){var i=e._gsap||No(e),r=e.style,s=Qb(e),o,a,l,c;return i.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,s=[l.a,l.b,l.c,l.d,l.e,l.f],s.join(",")==="1,0,0,1,0,0"?qc:s):(s===qc&&!e.offsetParent&&e!==nl&&!i.svg&&(l=r.display,r.display="block",o=e.parentNode,(!o||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,a=e.nextElementSibling,nl.appendChild(e)),s=Qb(e),l?r.display=l:Wo(e,"display"),c&&(a?o.insertBefore(e,a):o?o.appendChild(e):nl.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},Xm=function(e,t,i,r,s,o){var a=e._gsap,l=s||Cv(e,!0),c=a.xOrigin||0,h=a.yOrigin||0,u=a.xOffset||0,d=a.yOffset||0,p=l[0],_=l[1],v=l[2],m=l[3],f=l[4],g=l[5],b=t.split(" "),y=parseFloat(b[0])||0,M=parseFloat(b[1])||0,S,P,A,x;i?l!==qc&&(P=p*m-_*v)&&(A=y*(m/P)+M*(-v/P)+(v*g-m*f)/P,x=y*(-_/P)+M*(p/P)-(p*g-_*f)/P,y=A,M=x):(S=EE(e),y=S.x+(~b[0].indexOf("%")?y/100*S.width:y),M=S.y+(~(b[1]||b[0]).indexOf("%")?M/100*S.height:M)),r||r!==!1&&a.smooth?(f=y-c,g=M-h,a.xOffset=u+(f*p+g*v)-f,a.yOffset=d+(f*_+g*m)-g):a.xOffset=a.yOffset=0,a.xOrigin=y,a.yOrigin=M,a.smooth=!!r,a.origin=t,a.originIsAbsolute=!!i,e.style[ii]="0px 0px",o&&(Vs(o,a,"xOrigin",c,y),Vs(o,a,"yOrigin",h,M),Vs(o,a,"xOffset",u,a.xOffset),Vs(o,a,"yOffset",d,a.yOffset)),e.setAttribute("data-svg-origin",y+" "+M)},Yc=function(e,t){var i=e._gsap||new cE(e);if("x"in i&&!t&&!i.uncache)return i;var r=e.style,s=i.scaleX<0,o="px",a="deg",l=getComputedStyle(e),c=Ui(e,ii)||"0",h,u,d,p,_,v,m,f,g,b,y,M,S,P,A,x,E,R,O,F,G,H,B,W,$,Q,ee,me,De,Je,Be,ze;return h=u=d=v=m=f=g=b=y=0,p=_=1,i.svg=!!(e.getCTM&&CE(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(r[Ut]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[Ut]!=="none"?l[Ut]:"")),r.scale=r.rotate=r.translate="none"),P=Cv(e,i.svg),i.svg&&(i.uncache?($=e.getBBox(),c=i.xOrigin-$.x+"px "+(i.yOrigin-$.y)+"px",W=""):W=!t&&e.getAttribute("data-svg-origin"),Xm(e,W||c,!!W||i.originIsAbsolute,i.smooth!==!1,P)),M=i.xOrigin||0,S=i.yOrigin||0,P!==qc&&(R=P[0],O=P[1],F=P[2],G=P[3],h=H=P[4],u=B=P[5],P.length===6?(p=Math.sqrt(R*R+O*O),_=Math.sqrt(G*G+F*F),v=R||O?Ia(O,R)*Co:0,g=F||G?Ia(F,G)*Co+v:0,g&&(_*=Math.abs(Math.cos(g*il))),i.svg&&(h-=M-(M*R+S*F),u-=S-(M*O+S*G))):(ze=P[6],Je=P[7],ee=P[8],me=P[9],De=P[10],Be=P[11],h=P[12],u=P[13],d=P[14],A=Ia(ze,De),m=A*Co,A&&(x=Math.cos(-A),E=Math.sin(-A),W=H*x+ee*E,$=B*x+me*E,Q=ze*x+De*E,ee=H*-E+ee*x,me=B*-E+me*x,De=ze*-E+De*x,Be=Je*-E+Be*x,H=W,B=$,ze=Q),A=Ia(-F,De),f=A*Co,A&&(x=Math.cos(-A),E=Math.sin(-A),W=R*x-ee*E,$=O*x-me*E,Q=F*x-De*E,Be=G*E+Be*x,R=W,O=$,F=Q),A=Ia(O,R),v=A*Co,A&&(x=Math.cos(A),E=Math.sin(A),W=R*x+O*E,$=H*x+B*E,O=O*x-R*E,B=B*x-H*E,R=W,H=$),m&&Math.abs(m)+Math.abs(v)>359.9&&(m=v=0,f=180-f),p=Jt(Math.sqrt(R*R+O*O+F*F)),_=Jt(Math.sqrt(B*B+ze*ze)),A=Ia(H,B),g=Math.abs(A)>2e-4?A*Co:0,y=Be?1/(Be<0?-Be:Be):0),i.svg&&(W=e.getAttribute("transform"),i.forceCSS=e.setAttribute("transform","")||!ME(Ui(e,Ut)),W&&e.setAttribute("transform",W))),Math.abs(g)>90&&Math.abs(g)<270&&(s?(p*=-1,g+=v<=0?180:-180,v+=v<=0?180:-180):(_*=-1,g+=g<=0?180:-180)),t=t||i.uncache,i.x=h-((i.xPercent=h&&(!t&&i.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-h)?-50:0)))?e.offsetWidth*i.xPercent/100:0)+o,i.y=u-((i.yPercent=u&&(!t&&i.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-u)?-50:0)))?e.offsetHeight*i.yPercent/100:0)+o,i.z=d+o,i.scaleX=Jt(p),i.scaleY=Jt(_),i.rotation=Jt(v)+a,i.rotationX=Jt(m)+a,i.rotationY=Jt(f)+a,i.skewX=g+a,i.skewY=b+a,i.transformPerspective=y+o,(i.zOrigin=parseFloat(c.split(" ")[2])||!t&&i.zOrigin||0)&&(r[ii]=Qu(c)),i.xOffset=i.yOffset=0,i.force3D=wi.force3D,i.renderTransform=i.svg?ZO:yE?PE:YO,i.uncache=0,i},Qu=function(e){return(e=e.split(" "))[0]+" "+e[1]},tf=function(e,t,i){var r=Dn(t);return Jt(parseFloat(t)+parseFloat(Qs(e,"x",i+"px",r)))+r},YO=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,PE(e,t)},vo="0deg",sc="0px",_o=") ",PE=function(e,t){var i=t||this,r=i.xPercent,s=i.yPercent,o=i.x,a=i.y,l=i.z,c=i.rotation,h=i.rotationY,u=i.rotationX,d=i.skewX,p=i.skewY,_=i.scaleX,v=i.scaleY,m=i.transformPerspective,f=i.force3D,g=i.target,b=i.zOrigin,y="",M=f==="auto"&&e&&e!==1||f===!0;if(b&&(u!==vo||h!==vo)){var S=parseFloat(h)*il,P=Math.sin(S),A=Math.cos(S),x;S=parseFloat(u)*il,x=Math.cos(S),o=tf(g,o,P*x*-b),a=tf(g,a,-Math.sin(S)*-b),l=tf(g,l,A*x*-b+b)}m!==sc&&(y+="perspective("+m+_o),(r||s)&&(y+="translate("+r+"%, "+s+"%) "),(M||o!==sc||a!==sc||l!==sc)&&(y+=l!==sc||M?"translate3d("+o+", "+a+", "+l+") ":"translate("+o+", "+a+_o),c!==vo&&(y+="rotate("+c+_o),h!==vo&&(y+="rotateY("+h+_o),u!==vo&&(y+="rotateX("+u+_o),(d!==vo||p!==vo)&&(y+="skew("+d+", "+p+_o),(_!==1||v!==1)&&(y+="scale("+_+", "+v+_o),g.style[Ut]=y||"translate(0, 0)"},ZO=function(e,t){var i=t||this,r=i.xPercent,s=i.yPercent,o=i.x,a=i.y,l=i.rotation,c=i.skewX,h=i.skewY,u=i.scaleX,d=i.scaleY,p=i.target,_=i.xOrigin,v=i.yOrigin,m=i.xOffset,f=i.yOffset,g=i.forceCSS,b=parseFloat(o),y=parseFloat(a),M,S,P,A,x;l=parseFloat(l),c=parseFloat(c),h=parseFloat(h),h&&(h=parseFloat(h),c+=h,l+=h),l||c?(l*=il,c*=il,M=Math.cos(l)*u,S=Math.sin(l)*u,P=Math.sin(l-c)*-d,A=Math.cos(l-c)*d,c&&(h*=il,x=Math.tan(c-h),x=Math.sqrt(1+x*x),P*=x,A*=x,h&&(x=Math.tan(h),x=Math.sqrt(1+x*x),M*=x,S*=x)),M=Jt(M),S=Jt(S),P=Jt(P),A=Jt(A)):(M=u,A=d,S=P=0),(b&&!~(o+"").indexOf("px")||y&&!~(a+"").indexOf("px"))&&(b=Qs(p,"x",o,"px"),y=Qs(p,"y",a,"px")),(_||v||m||f)&&(b=Jt(b+_-(_*M+v*P)+m),y=Jt(y+v-(_*S+v*A)+f)),(r||s)&&(x=p.getBBox(),b=Jt(b+r/100*x.width),y=Jt(y+s/100*x.height)),x="matrix("+M+","+S+","+P+","+A+","+b+","+y+")",p.setAttribute("transform",x),g&&(p.style[Ut]=x)},JO=function(e,t,i,r,s){var o=360,a=wn(s),l=parseFloat(s)*(a&&~s.indexOf("rad")?Co:1),c=l-r,h=r+c+"deg",u,d;return a&&(u=s.split("_")[1],u==="short"&&(c%=o,c!==c%(o/2)&&(c+=c<0?o:-o)),u==="cw"&&c<0?c=(c+o*Kb)%o-~~(c/o)*o:u==="ccw"&&c>0&&(c=(c-o*Kb)%o-~~(c/o)*o)),e._pt=d=new ni(e._pt,t,i,r,c,OO),d.e=h,d.u="deg",e._props.push(i),d},ex=function(e,t){for(var i in t)e[i]=t[i];return e},QO=function(e,t,i){var r=ex({},i._gsap),s="perspective,force3D,transformOrigin,svgOrigin",o=i.style,a,l,c,h,u,d,p,_;r.svg?(c=i.getAttribute("transform"),i.setAttribute("transform",""),o[Ut]=t,a=Yc(i,1),Wo(i,Ut),i.setAttribute("transform",c)):(c=getComputedStyle(i)[Ut],o[Ut]=t,a=Yc(i,1),o[Ut]=c);for(l in hs)c=r[l],h=a[l],c!==h&&s.indexOf(l)<0&&(p=Dn(c),_=Dn(h),u=p!==_?Qs(i,l,c,_):parseFloat(c),d=parseFloat(h),e._pt=new ni(e._pt,a,l,u,d-u,jm),e._pt.u=_||0,e._props.push(l));ex(a,r)};ti("padding,margin,Width,Radius",function(n,e){var t="Top",i="Right",r="Bottom",s="Left",o=(e<3?[t,i,r,s]:[t+s,t+i,r+i,r+s]).map(function(a){return e<2?n+a:"border"+a+n});Ju[e>1?"border"+n:n]=function(a,l,c,h,u){var d,p;if(arguments.length<4)return d=o.map(function(_){return qr(a,_,c)}),p=d.join(" "),p.split(d[0]).length===5?d[0]:p;d=(h+"").split(" "),p={},o.forEach(function(_,v){return p[_]=d[v]=d[v]||d[(v-1)/2|0]}),a.init(l,p,u)}});var TE={name:"css",register:Km,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,i,r,s){var o=this._props,a=e.style,l=i.vars.startAt,c,h,u,d,p,_,v,m,f,g,b,y,M,S,P,A;wv||Km(),this.styles=this.styles||wE(e),A=this.styles.props,this.tween=i;for(v in t)if(v!=="autoRound"&&(h=t[v],!(ui[v]&&hE(v,t,i,r,e,s)))){if(p=typeof h,_=Ju[v],p==="function"&&(h=h.call(i,r,e,s),p=typeof h),p==="string"&&~h.indexOf("random(")&&(h=Wc(h)),_)_(this,e,v,h,i)&&(P=1);else if(v.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(v)+"").trim(),h+="",Ws.lastIndex=0,Ws.test(c)||(m=Dn(c),f=Dn(h)),f?m!==f&&(c=Qs(e,v,c,f)+f):m&&(h+=m),this.add(a,"setProperty",c,h,r,s,0,0,v),o.push(v),A.push(v,0,a[v]);else if(p!=="undefined"){if(l&&v in l?(c=typeof l[v]=="function"?l[v].call(i,r,e,s):l[v],wn(c)&&~c.indexOf("random(")&&(c=Wc(c)),Dn(c+"")||c==="auto"||(c+=wi.units[v]||Dn(qr(e,v))||""),(c+"").charAt(1)==="="&&(c=qr(e,v))):c=qr(e,v),d=parseFloat(c),g=p==="string"&&h.charAt(1)==="="&&h.substr(0,2),g&&(h=h.substr(2)),u=parseFloat(h),v in _r&&(v==="autoAlpha"&&(d===1&&qr(e,"visibility")==="hidden"&&u&&(d=0),A.push("visibility",0,a.visibility),Vs(this,a,"visibility",d?"inherit":"hidden",u?"inherit":"hidden",!u)),v!=="scale"&&v!=="transform"&&(v=_r[v],~v.indexOf(",")&&(v=v.split(",")[0]))),b=v in hs,b){if(this.styles.save(v),p==="string"&&h.substring(0,6)==="var(--"&&(h=Ui(e,h.substring(4,h.indexOf(")"))),u=parseFloat(h)),y||(M=e._gsap,M.renderTransform&&!t.parseTransform||Yc(e,t.parseTransform),S=t.smoothOrigin!==!1&&M.smooth,y=this._pt=new ni(this._pt,a,Ut,0,1,M.renderTransform,M,0,-1),y.dep=1),v==="scale")this._pt=new ni(this._pt,M,"scaleY",M.scaleY,(g?tl(M.scaleY,g+u):u)-M.scaleY||0,jm),this._pt.u=0,o.push("scaleY",v),v+="X";else if(v==="transformOrigin"){A.push(ii,0,a[ii]),h=XO(h),M.svg?Xm(e,h,0,S,0,this):(f=parseFloat(h.split(" ")[2])||0,f!==M.zOrigin&&Vs(this,M,"zOrigin",M.zOrigin,f),Vs(this,a,v,Qu(c),Qu(h)));continue}else if(v==="svgOrigin"){Xm(e,h,1,S,0,this);continue}else if(v in SE){JO(this,M,v,d,g?tl(d,g+h):h);continue}else if(v==="smoothOrigin"){Vs(this,M,"smooth",M.smooth,h);continue}else if(v==="force3D"){M[v]=h;continue}else if(v==="transform"){QO(this,h,e);continue}}else v in a||(v=El(v)||v);if(b||(u||u===0)&&(d||d===0)&&!IO.test(h)&&v in a)m=(c+"").substr((d+"").length),u||(u=0),f=Dn(h)||(v in wi.units?wi.units[v]:m),m!==f&&(d=Qs(e,v,c,f)),this._pt=new ni(this._pt,b?M:a,v,d,(g?tl(d,g+u):u)-d,!b&&(f==="px"||v==="zIndex")&&t.autoRound!==!1?FO:jm),this._pt.u=f||0,m!==f&&f!=="%"&&(this._pt.b=c,this._pt.r=NO);else if(v in a)KO.call(this,e,v,c,g?g+h:h);else if(v in e)this.add(e,v,c||e[v],g?g+h:h,r,s);else if(v!=="parseTransform"){uv(v,h);continue}b||(v in a?A.push(v,0,a[v]):typeof e[v]=="function"?A.push(v,2,e[v]()):A.push(v,1,c||e[v])),o.push(v)}}P&&vE(this)},render:function(e,t){if(t.tween._time||!yv())for(var i=t._pt;i;)i.r(e,i.d),i=i._next;else t.styles.revert()},get:qr,aliases:_r,getSetter:function(e,t,i){var r=_r[t];return r&&r.indexOf(",")<0&&(t=r),t in hs&&t!==ii&&(e._gsap.x||qr(e,"x"))?i&&Wb===i?t==="scale"?zO:BO:(Wb=i||{})&&(t==="scale"?$O:HO):e.style&&!lv(e.style[t])?VO:~t.indexOf("-")?UO:bv(e,t)},core:{_removeProperty:Wo,_getMatrix:Cv}};si.utils.checkPrefix=El;si.core.getStyleSaver=wE;(function(n,e,t,i){var r=ti(n+","+e+","+t,function(s){hs[s]=1});ti(e,function(s){wi.units[s]="deg",SE[s]=1}),_r[r[13]]=n+","+e,ti(i,function(s){var o=s.split(":");_r[o[1]]=r[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ti("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){wi.units[n]="px"});si.registerPlugin(TE);var Tu=si.registerPlugin(TE)||si;Tu.core.Tween;const eN=10,ou=30,tN=500,nN=1e3,iN=3e4,Us=5e3,Bs=4e3,tx=3e3,rN=5e3,mi=800,Cl=100,sN=3e3,oN=.05,AE=300,aN=100,Sv=75,lN="#000000",cN=100,Lo=Object.freeze({x:960,y:540}),Mv=1e4,Pv=1024*1024,nf=-250,Tv=600,hN=10,rf=50,rl=4096,Au=3,RE=Object.freeze([500,1500,3e3]),uN=150,dN=Object.freeze({min:.5,max:.8}),pN=Object.freeze({min:.05,max:.25}),An=Object.freeze({intensity:Math.PI*.4,position:Object.freeze({x:5,y:10,z:7}),shadow:Object.freeze({mapSize:4096,camera:Object.freeze({near:.5,far:500,left:-500,right:500,top:500,bottom:-500}),bias:-1e-4,normalBias:.05,radius:6,blurSamples:16})}),au=Object.freeze({intensity:Math.PI*.15,position:Object.freeze({x:-5,y:5,z:-5})}),sf=Object.freeze({skyColor:16777215,groundColor:4473924,intensity:.3}),Id=Object.freeze({backgroundChanged:"background:changed",stackUpdated:"stack:updated",cameraUpdated:"camera:updated"}),LE=Object.freeze({"flat-matte":{roughness:1,metalness:0,thickness:1,borderWidth:0},"glossy-photo":{roughness:.1,metalness:0,thickness:1,borderWidth:0},"plastic-card":{roughness:.4,metalness:.1,thickness:2,borderWidth:0},"thick-board":{roughness:.9,metalness:0,thickness:8,borderWidth:0},"metal-sheet":{roughness:.2,metalness:.8,thickness:1,borderWidth:0},"metallic-card":{roughness:.2,metalness:.8,thickness:2,borderWidth:0},"glass-slide":{roughness:.05,metalness:0,thickness:1,borderWidth:0},"matte-print":{roughness:.7,metalness:0,thickness:1,borderWidth:0},bordered:{roughness:.2,metalness:0,thickness:1,borderWidth:20},"3d-box":{roughness:.6,metalness:0,thickness:15,borderWidth:0}}),Av=Object.freeze({center:null,front:"fitToFrame",beauty:{x:-1280,y:-40,z:1400},top:{x:0,y:1200,z:200},isometric:{x:-900,y:900,z:900},"3d-stack":{x:-800,y:400,z:1e3},side:{x:-1400,y:0,z:200}});new $e(16777215);const fN={canvasSize:{...Lo},bgColor:"#000000",transparentBg:!1,ambience:!1,cameraMode:"perspective",cameraFOV:75,cameraZoom:1,zSpacing:100,materialPreset:"metallic-card",materialRoughness:.2,materialMetalness:.8,materialThickness:2,materialBorderWidth:0,materialBorderColor:"#ffffff",viewpointPreset:"front",animDuration:1.5,animEasing:"power2.inOut"};function mN(){return qm(fN)}function qm(n){if(Array.isArray(n))return n.map(e=>qm(e));if(n&&typeof n=="object"&&n.constructor===Object){const e={};return Object.entries(n).forEach(([t,i])=>{e[t]=qm(i)}),e}return n}const vN=1.1,_N=.35;class gN{constructor(e,t){this.camera=e,this.controls=t,this.isAnimating=!1,this.savedState=null,this.timeline=null,this.activeAnimation=null}saveState(){this.savedState={position:this.camera.position.clone(),target:this.controls.target.clone(),zoom:this.camera.zoom}}restoreState(){if(this.savedState)return{position:this.savedState.position.clone(),target:this.savedState.target.clone(),zoom:this.savedState.zoom}}calculateFrontViewpoint(e,t){if(!e?.mesh)throw new Error("calculateFrontViewpoint: slide mesh missing");const i=new Qn().setFromObject(e.mesh);if(i.isEmpty())throw new Error("calculateFrontViewpoint: slide bounds empty");const r=i.getCenter(new k),s=i.getSize(new k),o=s.x||1,a=s.y||1,l=t?.x??Lo.x,c=t?.y??Lo.y,h=l/c,u=(this.camera.fov??60)*(Math.PI/180),d=Math.max(Math.tan(u/2),1e-6),p=2*Math.atan(d*h),_=Math.max(Math.tan(p/2),1e-6),v=a/2/d,m=o/2/_,f=Math.max(v,m,Cl)*vN,g=new k(r.x,r.y,r.z+f),b=r.clone();return{position:g,target:b}}async playHeroShot({topSlide:e,canvasSize:t,duration:i=1.5,easing:r="power2.inOut",imageStack:s=[],holdTime:o}){return new Promise((a,l)=>{if(this.isAnimating){l(new Error("Animation already in progress"));return}if(!e?.mesh){l(new Error("No top slide provided"));return}let c;try{c=this.calculateFrontViewpoint(e,t)}catch(m){l(m);return}this.saveState();const h=this.restoreState(),u=Array.isArray(s)?s.map(m=>m?.mesh?{mesh:m.mesh,originalZ:m.mesh.position?.z??0}:null).filter(Boolean):[],d=c.target.z,p=typeof o=="number"&&o>=0?o:Math.min(Math.max(i*_N,.3),2),_=()=>{u.forEach(({mesh:m,originalZ:f})=>{m?.position&&(m.position.z=f)})},v=()=>{h&&(this.camera.position.copy(h.position),this.controls.target.copy(h.target),this.camera.zoom=h.zoom,typeof this.camera.updateProjectionMatrix=="function"&&this.camera.updateProjectionMatrix(),this.controls.update?.())};try{this.isAnimating=!0,this.controls.enabled=!1,this.activeAnimation={stackEntries:u,originalState:h};const m=Tu.timeline();this.timeline=m,m.to(this.camera.position,{x:c.position.x,y:c.position.y,z:c.position.z,duration:i,ease:r}),m.to(this.controls.target,{x:c.target.x,y:c.target.y,z:c.target.z,duration:i,ease:r},"<"),u.forEach(({mesh:f})=>{m.to(f.position,{z:d,duration:i,ease:r},"<")}),m.to({},{duration:p}),h&&(m.to(this.camera.position,{x:h.position.x,y:h.position.y,z:h.position.z,duration:i,ease:r}),m.to(this.controls.target,{x:h.target.x,y:h.target.y,z:h.target.z,duration:i,ease:r},"<")),u.forEach(({mesh:f,originalZ:g})=>{m.to(f.position,{z:g,duration:i,ease:r},"<")}),m.eventCallback("onUpdate",()=>{this.controls.update?.()}),m.eventCallback("onComplete",()=>{_(),v(),this.cleanup(),a()}),m.eventCallback("onInterrupt",()=>{_(),v(),this.cleanup(),l(new Error("Animation interrupted"))})}catch(m){_(),v(),this.cleanup(),l(m)}})}cleanup(){this.controls.enabled=!0,this.isAnimating=!1,this.timeline=null,this.activeAnimation=null}cancel(){if(this.isAnimating)try{this.timeline?.kill?(this.timeline.eventCallback?.("onComplete",null),this.timeline.eventCallback?.("onInterrupt",null),this.timeline.kill()):(Tu.killTweensOf(this.camera.position),Tu.killTweensOf(this.controls.target));const e=this.activeAnimation?.originalState??this.restoreState();e&&(this.camera.position.copy(e.position),this.controls.target.copy(e.target),this.camera.zoom=e.zoom,typeof this.camera.updateProjectionMatrix=="function"&&this.camera.updateProjectionMatrix()),this.activeAnimation?.stackEntries&&this.activeAnimation.stackEntries.forEach(({mesh:t,originalZ:i})=>{t?.position&&(t.position.z=i)}),this.controls.update?.()}catch(e){console.error("Error during animation cancellation:",e)}finally{this.cleanup()}}}const nx=30,bN=new k(500,500,500),xN=1.1,wN=1.35,yN=new k(-.82,-.18,1).normalize();function go(){}class EN{constructor(e){if(!e?.camera||!e?.controls||!e?.params)throw new Error("CameraController: missing required dependencies");this.camera=e.camera,this.orthoCamera=e.orthoCamera??e.camera,this.controls=e.controls,this.params=e.params,this.imageStack=e.imageStack??[],this.pane=e.pane??{refresh:go},this.logCamera=e.logCamera??{info:go,warn:go,error:go},this.emitCameraUpdated=e.emitCameraUpdated??go,this.onModeChange=e.onModeChange??go,typeof this.controls.target?.copy!="function"&&(this.controls.target=new k),this.#e()}attachPane(e){this.pane=e??{refresh:go}}#e(){const e=this.params.cameraMode??"perspective";this.params.cameraMode=e,this.controls.object=e==="orthographic"||e==="isometric"?this.orthoCamera:this.camera}getMode(){return this.params.cameraMode??"perspective"}getActiveCamera(){return this.getMode()==="orthographic"||this.getMode()==="isometric"?this.orthoCamera:this.camera}switchMode(e){const i=new Set(["perspective","orthographic","isometric","telephoto"]).has(e)?e:"perspective";this.params.cameraMode=i,this.onModeChange(i),this.logCamera?.info?.(`Switching to ${i} camera mode`),i==="orthographic"?this.#n({position:new k(0,0,mi)}):i==="isometric"?this.#n({position:bN}):i==="telephoto"?this.#i():this.#t(),this.controls.update?.(),this.emitCameraUpdated("mode-change")}#t(){this.camera.position.set(0,0,mi),this.camera.lookAt(0,0,0),this.camera.zoom=this.params.cameraZoom,this.camera.updateProjectionMatrix(),this.controls.object=this.camera}#n({position:e}){this.orthoCamera.position.copy(e),this.orthoCamera.lookAt(0,0,0),this.orthoCamera.zoom=this.params.cameraZoom,this.orthoCamera.updateProjectionMatrix(),this.controls.object=this.orthoCamera}#i(){this.params.cameraFOV=nx,this.camera.fov=nx,this.camera.position.set(0,0,1500),this.camera.lookAt(0,0,0),this.camera.zoom=this.params.cameraZoom,this.camera.updateProjectionMatrix(),this.controls.object=this.camera,this.pane?.refresh?.()}setZoom(e){this.params.cameraZoom=e,this.camera.zoom=e,this.camera.updateProjectionMatrix(),this.orthoCamera.zoom=e,this.orthoCamera.updateProjectionMatrix(),this.logCamera?.info?.(`Zoom updated to ${e.toFixed?.(1)??e}x`),this.emitCameraUpdated("zoom")}setFOV(e){this.params.cameraFOV=e;const t=this.getMode();(t==="perspective"||t==="telephoto")&&(this.camera.fov=e,this.camera.updateProjectionMatrix(),this.emitCameraUpdated("fov"))}setViewpoint(e,t,i){const r=new k(e,t,i);this.camera.position.copy(r),this.camera.lookAt(0,0,0),this.orthoCamera.position.copy(r),this.orthoCamera.lookAt(0,0,0),this.controls.update?.(),this.logCamera?.info?.(`Viewpoint set to (${e}, ${t}, ${i})`),this.emitCameraUpdated("viewpoint")}setViewpointFitToFrame(){if(!Array.isArray(this.imageStack)||this.imageStack.length===0){this.params.viewpointPreset="front",this.setViewpoint(0,0,mi);return}const t=this.imageStack[this.imageStack.length-1]?.mesh;if(!t){this.logCamera?.error?.("No front slide found despite non-empty image stack"),this.params.viewpointPreset="front",this.setViewpoint(0,0,mi);return}const i=new Qn().setFromObject(t);if(i.isEmpty()){this.logCamera?.warn?.("Front slide bounding box empty, falling back to default viewpoint"),this.params.viewpointPreset="front",this.setViewpoint(0,0,mi);return}const r=i.getCenter(new k),s=i.getSize(new k),o=s.x||1,a=s.y||1,l=(this.params.cameraFOV??60)*(Math.PI/180),c=this.camera.aspect||(this.params.canvasSize?.x??Lo.x)/(this.params.canvasSize?.y??Lo.y),h=Math.max(Math.tan(l/2),1e-6),u=2*Math.atan(h*c),d=Math.max(Math.tan(u/2),1e-6),p=a/2/h,_=o/2/d,v=Math.max(p,_),m=Math.max(v*xN,Cl),f=new k(r.x,r.y,r.z+m);this.camera.position.copy(f),this.camera.lookAt(r),this.controls.target.copy(r),this.controls.update?.(),this.params.viewpointPreset="front",this.logCamera?.info?.(`Front view centred at (${r.x.toFixed(1)}, ${r.y.toFixed(1)}, ${r.z.toFixed(1)}) with distance ${m.toFixed(1)} (width ${o.toFixed(1)}, height ${a.toFixed(1)}, aspect ${c.toFixed(2)})`),this.emitCameraUpdated("viewpoint")}setBeautyViewpoint(){if(!Array.isArray(this.imageStack)||this.imageStack.length===0){this.params.viewpointPreset="beauty",this.setViewpoint(-1280,-40,1400);return}const e=new Qn;if(this.imageStack.forEach(m=>{m?.mesh&&e.expandByObject(m.mesh)}),e.isEmpty()){this.params.viewpointPreset="beauty",this.setViewpoint(-1280,-40,1400);return}const t=e.getCenter(new k),i=new ia;e.getBoundingSphere(i);const r=Math.max(i.radius,1),s=(this.params.cameraFOV??60)*(Math.PI/180),o=this.camera.aspect||(this.params.canvasSize?.x??Lo.x)/(this.params.canvasSize?.y??Lo.y),a=Math.max(Math.tan(s/2),1e-6),l=2*Math.atan(a*o),c=Math.max(Math.tan(l/2),1e-6),h=r/a,u=r/c,d=Math.max(h,u),p=Math.max(d*wN,Cl*2),_=yN.clone().multiplyScalar(p),v=t.clone().add(_);this.camera.position.copy(v),this.camera.lookAt(t),this.orthoCamera.position.copy(v),this.orthoCamera.lookAt(t),this.controls.target.copy(t),this.controls.update?.(),this.params.viewpointPreset="beauty",this.logCamera?.info?.(`Beauty view centred at (${t.x.toFixed(1)}, ${t.y.toFixed(1)}, ${t.z.toFixed(1)}) radius ${r.toFixed(1)} using distance ${p.toFixed(1)}`),this.emitCameraUpdated("viewpoint")}centerOnContent(){if(!Array.isArray(this.imageStack)||this.imageStack.length===0){this.logCamera?.info?.("No content to center on");return}const e=new Qn;if(this.imageStack.forEach(s=>{s?.mesh&&e.expandByObject(s.mesh)}),e.isEmpty()){this.logCamera?.warn?.("Unable to compute bounding box for centering");return}const t=new k;e.getCenter(t);const i=this.getActiveCamera(),r=i.position.clone();i.position.copy(t).add(r),i.lookAt(t),this.controls.target.copy(t),this.controls.update?.(),this.logCamera?.info?.(`Centered view on content at (${t.x.toFixed(1)}, ${t.y.toFixed(1)}, ${t.z.toFixed(1)})`),this.emitCameraUpdated("center")}}class CN{constructor(e={}){this.renderCallback=null,this.animationId=null,this.isRunning=!1,this.showFPSEnabled=!1,this.frameCount=0,this.lastFrameTime=performance.now(),this.fpsValues=[],this.fpsDisplay=null,this.onFPSUpdate=e.onFPSUpdate||null,this._animate=this._animate.bind(this)}setRenderCallback(e){if(typeof e!="function")throw new TypeError("Render callback must be a function");this.renderCallback=e}start(){if(this.isRunning){console.warn("[RenderLoop] Already running");return}if(!this.renderCallback)throw new Error("[RenderLoop] No render callback set. Call setRenderCallback() first.");this.isRunning=!0,this.lastFrameTime=performance.now(),this.frameCount=0,this._animate(),console.log("[RenderLoop] Started")}stop(){this.isRunning&&(this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.isRunning=!1,console.log("[RenderLoop] Stopped"))}_animate(){this.isRunning&&(this.animationId=requestAnimationFrame(this._animate),this._updateFPS(),this.renderCallback&&this.renderCallback())}_updateFPS(){if(!this.showFPSEnabled)return;const e=performance.now();if(this.frameCount++,e>=this.lastFrameTime+1e3){const t=Math.round(this.frameCount*1e3/(e-this.lastFrameTime));this.fpsValues.push(t),this.fpsValues.length>5&&this.fpsValues.shift();const i=Math.round(this.fpsValues.reduce((r,s)=>r+s,0)/this.fpsValues.length);this._updateFPSDisplay(t,i),this.onFPSUpdate&&this.onFPSUpdate({current:t,average:i}),i<ou&&this.fpsValues.length>=3&&console.warn(`[RenderLoop] Performance warning: Average FPS ${i} below threshold ${ou}`),this.frameCount=0,this.lastFrameTime=e}}_updateFPSDisplay(e,t){if(!this.fpsDisplay)return;let i="#00ff00";t<ou?i="#ff0000":t<50&&(i="#ffaa00"),this.fpsDisplay.style.color=i,this.fpsDisplay.innerHTML=`FPS: ${e}<br>Avg: ${t}`}showFPS(e){this.showFPSEnabled=!!e,e&&!this.fpsDisplay&&this._createFPSDisplay(),this.fpsDisplay&&(this.fpsDisplay.style.display=e?"block":"none"),e&&(this.frameCount=0,this.lastFrameTime=performance.now(),this.fpsValues=[]),console.log(`[RenderLoop] FPS display ${e?"enabled":"disabled"}`)}_createFPSDisplay(){this.fpsDisplay||(this.fpsDisplay=document.createElement("div"),this.fpsDisplay.id="fps-display",this.fpsDisplay.style.cssText=`
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #00ff00;
      padding: 8px 12px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      z-index: 9999;
      display: none;
      min-width: 120px;
    `,document.body.appendChild(this.fpsDisplay))}getFPSStats(){if(this.fpsValues.length===0)return{current:0,average:0,isLow:!1};const e=this.fpsValues[this.fpsValues.length-1],t=Math.round(this.fpsValues.reduce((r,s)=>r+s,0)/this.fpsValues.length),i=t<ou;return{current:e,average:t,isLow:i}}dispose(){this.stop(),this.fpsDisplay&&this.fpsDisplay.parentNode&&(this.fpsDisplay.parentNode.removeChild(this.fpsDisplay),this.fpsDisplay=null),this.fpsValues=[],this.renderCallback=null,this.onFPSUpdate=null,console.log("[RenderLoop] Disposed")}}function SN(n,e,t){if(!Array.isArray(n))throw new TypeError("reorderList expects an array to reorder");if(!Number.isInteger(e)||!Number.isInteger(t))throw new TypeError("reorderList indices must be integers");if(e<0||e>=n.length||t<0||t>=n.length)throw new RangeError("reorderList indices must be within array bounds");if(e===t||n.length<=1)return n;const[i]=n.splice(e,1);return n.splice(t,0,i),n}class MN{constructor(e={}){this._initial=new Map,this._state=new Map,Object.entries(e).forEach(([t,i])=>{const r=Po(i);this._initial.set(t,r),this._state.set(t,Po(i))})}get(e){return this._state.get(e)}set(e,t){if(!e)throw new Error("AppState.set requires a key");return this._state.set(e,t),t}mergeInto(e,t){if(!t||typeof t!="object"||Array.isArray(t))throw new TypeError("AppState.mergeInto expects a plain object patch");const i=this._state.get(e)??{};if(typeof i!="object"||Array.isArray(i))throw new TypeError(`AppState.mergeInto target "${e}" is not an object`);const r={...i,...t};return this._state.set(e,r),r}pushTo(e,t){const i=this._state.get(e);if(i===void 0){const r=[t];return this._state.set(e,r),r}if(!Array.isArray(i))throw new TypeError(`AppState.pushTo target "${e}" is not an array`);return i.push(t),i}removeFrom(e,t){const i=this._state.get(e);if(i===void 0)return;if(!Array.isArray(i))throw new TypeError(`AppState.removeFrom target "${e}" is not an array`);const r=i.filter(s=>!t(s));return this._state.set(e,r),r}reset(e){if(typeof e=="string"){this._initial.has(e)?this._state.set(e,Po(this._initial.get(e))):this._state.delete(e);return}this._state=new Map;for(const[t,i]of this._initial.entries())this._state.set(t,Po(i))}snapshot(){const e={};for(const[t,i]of this._state.entries())e[t]=Po(i);return e}}function Po(n){if(Array.isArray(n))return n.map(e=>Po(e));if(n&&typeof n=="object"&&n.constructor===Object){const e={};return Object.entries(n).forEach(([t,i])=>{e[t]=Po(i)}),e}return n}const Do=new MN,Wt=Object.freeze({scene:"scene",renderer:"renderer",camera:"camera",orthoCamera:"orthoCamera",controls:"controls",cameraAnimator:"cameraAnimator",historyStack:"historyStack",historyIndex:"historyIndex",eventListeners:"eventListeners",imageStack:"imageStack",params:"params"});function Qt(n,e){return PN(n),Do.set(n,e),e}function PN(n){if(!Object.values(Wt).includes(n))throw new Error(`Shared state key "${n}" is not registered`)}const Oa=400;class TN{constructor(e){this.scene=e.scene,this.params=e.params,this.imageStack=e.imageStack,this.saveHistory=e.saveHistory,this.emitStackUpdated=e.emitStackUpdated,this.updateImageList=e.updateImageList,this.showToast=e.showToast,this.checkMemoryUsage=e.checkMemoryUsage,this.logImages=e.logImages??{info:()=>{},warn:()=>{}},this.logMemory=e.logMemory??{info:()=>{}},this.calculateLuminance=e.calculateLuminance??(()=>.5),this.getAdaptiveEmissiveIntensity=e.getAdaptiveEmissiveIntensity??(()=>.25)}addImage(e,t){this.saveHistory();const{mesh:i,planeWidth:r,planeHeight:s}=this.#e(e),a=this.imageStack.length*this.params.zSpacing;this.params.ambience&&(i.position.y=nf+s/2),i.position.z=a,this.scene.add(i);const l={mesh:i,texture:e,filename:t,width:r,height:s,originalWidth:e.image.width,originalHeight:e.image.height,id:Date.now()+Math.random(),thumbnailSrc:e.image?.currentSrc||e.image?.src||""};this.imageStack.push(l),Qt(Wt.imageStack,this.imageStack),this.updateImageList(),this.emitStackUpdated("added"),this.logImages.info(`Added ${t} to stack at Z=${a} (${this.imageStack.length} images total)`),typeof this.checkMemoryUsage=="function"&&this.checkMemoryUsage(!1)}clearAll(){this.imageStack.length!==0&&(this.saveHistory(),this.imageStack.forEach(e=>{this.scene.remove(e.mesh),e.mesh.geometry?.dispose(),e.mesh.material?.dispose(),e.mesh.material?.map&&e.mesh.material.map.dispose()}),this.imageStack.length=0,Qt(Wt.imageStack,this.imageStack),this.updateImageList(),this.emitStackUpdated("cleared"),this.logImages.info("All images cleared"),this.showToast(" All images cleared","info"),typeof this.checkMemoryUsage=="function"&&this.checkMemoryUsage(!1))}deleteAt(e){if(e<0||e>=this.imageStack.length)return;this.saveHistory();const[t]=this.imageStack.splice(e,1);this.scene.remove(t.mesh),t.mesh.geometry?.dispose(),t.mesh.material?.dispose(),t.mesh.material?.map&&t.mesh.material.map.dispose(),this.#t(),Qt(Wt.imageStack,this.imageStack),this.updateImageList(),this.emitStackUpdated("removed"),this.showToast(` Deleted ${t.filename}`,"info"),this.logImages.info(`Deleted image at index ${e}`),typeof this.checkMemoryUsage=="function"&&this.checkMemoryUsage(!1)}reorder(e,t){e<0||t<0||e>=this.imageStack.length||t>=this.imageStack.length||e===t||(this.saveHistory(),SN(this.imageStack,e,t),this.#t(),Qt(Wt.imageStack,this.imageStack),this.updateImageList(),this.emitStackUpdated("reordered"),this.logImages.info(`Reordered: moved ${e} to ${t}`))}applyMaterialPreset(e){this.params.materialRoughness=e.roughness,this.params.materialMetalness=e.metalness,this.params.materialThickness=e.thickness,this.params.materialBorderWidth=e.borderWidth,this.imageStack.forEach((t,i)=>{this.scene.remove(t.mesh),t.mesh.geometry?.dispose(),t.mesh.material?.dispose();const{mesh:r}=this.#e(t.texture,{width:t.originalWidth,height:t.originalHeight});if(r.position.z=i*this.params.zSpacing,this.params.ambience){const o=r.geometry.parameters.height??t.height;r.position.y=nf+o/2}const s=t.texture;if(this.params.ambience&&r.material instanceof Ja){const o=this.calculateLuminance(this.params.bgColor),a=this.getAdaptiveEmissiveIntensity(o);r.material.emissive=new $e(16777215),r.material.emissiveMap=s,r.material.emissiveIntensity=a,r.material.envMapIntensity=.55,r.material.needsUpdate=!0}t.mesh=r,t.width=r.geometry.parameters.width??t.width,t.height=r.geometry.parameters.height??t.height,this.scene.add(r)}),this.logImages.info(`Material applied to ${this.imageStack.length} images`)}getStack(){return this.imageStack}#e(e,t){const i=t?.width??e.image.width,r=t?.height??e.image.height;let s=i,o=r;i>=r&&i>Oa?(s=Oa,o=r/i*Oa):r>Oa&&(o=Oa,s=i/r*Oa);const a=this.params.materialThickness>1?new no(s,o,this.params.materialThickness):new os(s,o),l=this.params.ambience?new Ja({map:e,side:Ji,transparent:!0,roughness:this.params.materialRoughness,metalness:this.params.materialMetalness,envMapIntensity:.15}):new kl({map:e,side:Ji,transparent:!0}),c=new jt(a,l);if(this.params.ambience&&(c.castShadow=!0,c.receiveShadow=!0),this.params.materialBorderWidth>0){const h=s+this.params.materialBorderWidth*2,u=o+this.params.materialBorderWidth*2,d=new os(h,u),p=new Ja({color:this.params.materialBorderColor,side:Ji,roughness:this.params.materialRoughness,metalness:this.params.materialMetalness});p.envMapIntensity=.35;const _=new jt(d,p);_.position.z=-.5,this.params.ambience&&(_.castShadow=!0,_.receiveShadow=!0),c.add(_)}return{mesh:c,planeWidth:s,planeHeight:o}}#t(){this.imageStack.forEach((e,t)=>{if(e.mesh.position.z=t*this.params.zSpacing,this.params.ambience){const i=e.mesh.geometry.parameters.height??e.height;e.mesh.position.y=nf+i/2}})}}class AN{constructor(e={}){this.getImageStack=e.getImageStack??(()=>[]),this.logMemory=e.logMemory??{info:()=>{},warn:()=>{}},this.showToast=typeof e.showToast=="function"?e.showToast:()=>{},this.confirm=typeof e.confirm=="function"?e.confirm:()=>!0,this.now=typeof e.now=="function"?e.now:()=>Date.now(),this.thresholds={warningMB:e.thresholds?.warningMB??500,criticalMB:e.thresholds?.criticalMB??750,cooldownMs:e.thresholds?.cooldownMs??3e4},this.toastDurations={warningMs:e.toastDurations?.warningMs??3e3,errorMs:e.toastDurations?.errorMs??3e3},this.bytesPerMB=e.bytesPerMB??1024*1024,this.isFPSEnabled=typeof e.isFPSEnabled=="function"?e.isFPSEnabled:()=>!1,this.resolveOverlay=typeof e.resolveOverlay=="function"?e.resolveOverlay:()=>{if(typeof document>"u")return null;const t=e.fpsElementId??"fps-display";return document.getElementById(t)??null},this.isOverlayAttached=typeof e.isOverlayAttached=="function"?e.isOverlayAttached:t=>t?typeof t.isConnected=="boolean"?t.isConnected:typeof document<"u"&&document.body&&typeof document.body.contains=="function"?document.body.contains(t):!!t.parentNode:!1,this.formatMemory=typeof e.formatMemory=="function"?e.formatMemory:t=>t.toFixed(0),this.onWarningUpdate=typeof e.onWarningUpdate=="function"?e.onWarningUpdate:()=>{},this.overlayElement=null,this.lastWarning=e.initialWarningTimestamp??0,this.onWarningUpdate(this.lastWarning)}calculateUsageMB(){return(this.getImageStack()??[]).reduce((i,r)=>{const s=r?.texture?.image?.width,o=r?.texture?.image?.height;return typeof s=="number"&&typeof o=="number"?i+s*o*4:i},0)/this.bytesPerMB}getLastWarningTimestamp(){return this.lastWarning}updateOverlay(e){if(!this.isFPSEnabled())return;(!this.overlayElement||!this.isOverlayAttached(this.overlayElement))&&(this.overlayElement=this.resolveOverlay()??null);const t=this.overlayElement;if(!t||typeof t.innerHTML!="string")return;const i=`<br><small data-fps-memory="true" style="opacity: 0.7">${this.formatMemory(e)}MB</small>`,s=t.innerHTML.replace(/\s*<br><small\s+data-fps-memory="true"[^>]*>.*?<\/small>/,"");t.innerHTML=`${s}${i}`}invalidateOverlay(){this.overlayElement=null}checkMemoryUsage(e=!1){const t=this.calculateUsageMB(),i=(this.getImageStack()??[]).length;if(this.logMemory.info(` Current usage: ${t.toFixed(2)} MB (${i} images)`),t>=this.thresholds.criticalMB){const o=`Critical memory usage: ${t.toFixed(0)} MB!

Loading more images may cause browser slowdown or crash.

Continue anyway?`;return this.logMemory.warn(` CRITICAL: ${t.toFixed(2)} MB >= ${this.thresholds.criticalMB} MB`),e?this.confirm(o):(this.showToast(` Critical memory: ${t.toFixed(0)} MB`,"error",this.toastDurations.errorMs),this.updateOverlay(t),!0)}const r=this.now();return t>=this.thresholds.warningMB&&r-this.lastWarning>this.thresholds.cooldownMs&&(this.logMemory.warn(` Warning: ${t.toFixed(2)} MB >= ${this.thresholds.warningMB} MB`),this.showToast(` High memory usage: ${t.toFixed(0)} MB. Consider reducing image count.`,"warning",this.toastDurations.warningMs),this.lastWarning=r,this.onWarningUpdate(this.lastWarning)),this.updateOverlay(t),!0}}const lu="image/png",ix="application/json";function RN(n){return new Promise((e,t)=>{const i=new FileReader;i.onload=r=>{e(r.target.result)},i.onerror=r=>{t(r)},i.readAsText(n)})}class LN{constructor(e){if(this.renderer=e.renderer,this.scene=e.scene,this.imageStack=e.imageStack,this.params=e.params,this.camera=e.camera,this.orthoCamera=e.orthoCamera??e.camera,this.controls=e.controls,this.logExport=e.logExport,this.showToast=e.showToast??(()=>{}),this.clearAll=e.clearAll??(()=>{}),this.updateImageList=e.updateImageList??(()=>{}),this.emitStackUpdated=e.emitStackUpdated??(()=>{}),this.updateBackground=e.updateBackground??(()=>{}),this.pane=e.pane??{refresh:()=>{}},this.getActiveCamera=e.getActiveCamera??(()=>this.camera),this.document=e.document??globalThis.document,this.window=e.window??globalThis,this.navigator=e.navigator??globalThis.navigator,this.alert=e.alert??(t=>{typeof globalThis.alert=="function"&&globalThis.alert(t)}),this.createTextureLoader=e.createTextureLoader??(()=>new L0),this.createCanvas=e.createCanvas??(()=>this.document?.createElement?.("canvas")),this.createAnchor=e.createAnchor??(()=>this.document?.createElement?.("a")),this.readFileAsText=e.readFileAsText??RN,this.urlAPI=e.urlAPI??this.window?.URL??{},this.now=e.now??(()=>new Date),this.setTimeout=this.window?.setTimeout?.bind(this.window)??globalThis.setTimeout,!this.renderer||!this.scene||!this.imageStack||!this.params||!this.camera||!this.controls)throw new Error("ExportManager: missing required dependencies")}async exportPNG(e=1){if(!Array.isArray(this.imageStack)||this.imageStack.length===0){this.logExport?.warn?.(" No images loaded - cannot export empty scene"),this.showToast(" Load images first","warning");return}let t=Number(e);(!Number.isFinite(t)||t<1||t>4)&&(this.logExport?.warn?.(`Invalid scale parameter: ${e}. Using 1x instead.`),t=1),this.logExport?.info?.(`Exporting PNG at ${t}x resolution...`);const i=t>=2?this.#e(t):null;await new Promise(r=>{this.setTimeout?.(()=>{const s=this.renderer.getPixelRatio();let o=null,a=!1,l=!1;try{t>1&&(this.renderer.setPixelRatio(s*t),a=!0),o=this.getActiveCamera(),this.renderer.render(this.scene,o);const c=this.renderer.domElement.toDataURL(lu);if(!c||!c.startsWith(`data:${lu}`))throw new Error("exportPNG: failed to generate PNG data URL");const d=((c.length-`data:${lu};base64,`.length)*3/4/Pv).toFixed(2),p=this.createAnchor();if(!p)throw new Error("exportPNG: anchor element unavailable");const _=this.now().toISOString().replace(/[:.]/g,"-").slice(0,-5),v=`vexy-stax-${t}x-${_}.png`;p.download=v,p.href=c,this.document?.body&&this.document.body.appendChild(p);let m=!1;try{p.click(),m=!0}finally{this.document?.body?.removeChild&&this.document.body.removeChild(p)}const f=`${this.renderer.domElement.width}x${this.renderer.domElement.height}px`;this.logExport?.info?.(` PNG exported successfully: ${v} (${f}, ~${d} MB)`),m&&this.showToast(` Exported: ${v} (${d} MB)`,"success",tx),l=!0}catch(c){this.logExport?.error?.(" Export failed:",c),this.showToast(` Export failed: ${c.message}`,"error",Us)}finally{if(a&&(this.renderer.setPixelRatio(s),l&&o))try{this.renderer.render(this.scene,o)}catch(c){this.logExport?.warn?.(" Re-render after PNG export failed:",c)}i&&this.document?.body?.removeChild&&this.document.body.removeChild(i),r()}},aN)})}async exportJSON(){if(!Array.isArray(this.imageStack)||this.imageStack.length===0){this.logExport?.warn?.(" No images loaded - cannot export empty configuration"),this.showToast(" Load images first","warning");return}this.logExport?.info?.("Exporting JSON configuration...");const e=this.#t({includeExtendedParams:!1}),t=JSON.stringify(e,null,2),i=new Blob([t],{type:ix}),r=this.urlAPI?.createObjectURL?.(i)??`data:${ix};base64,${globalThis.btoa?.(t)??""}`,s=this.createAnchor();if(!s){this.logExport?.error?.(" Unable to create anchor element for JSON export");return}const o=this.now().toISOString().replace(/[:.]/g,"-").slice(0,-5);s.download=`vexy-stax-config-${o}.json`,s.href=r,this.document?.body&&this.document.body.appendChild(s);try{s.click(),this.logExport?.info?.(`JSON exported successfully as ${s.download}`)}finally{this.document?.body?.removeChild&&this.document.body.removeChild(s),r&&this.urlAPI?.revokeObjectURL&&this.urlAPI.revokeObjectURL(r)}}async copyJSON(){if(!Array.isArray(this.imageStack)||this.imageStack.length===0){this.logExport?.warn?.(" No images loaded - cannot copy empty configuration"),this.showToast(" Load images first","warning");return}if(!this.navigator?.clipboard?.writeText){this.showToast(" Clipboard API unavailable","warning",Bs);return}const e=this.#t({includeExtendedParams:!0}),t=JSON.stringify(e,null,2);try{await this.navigator.clipboard.writeText(t),this.logExport?.info?.("JSON configuration copied to clipboard"),this.showToast(" Configuration copied to clipboard!","success",tx)}catch(i){this.logExport?.error?.("Failed to copy to clipboard:",i),this.showToast(" Failed to copy to clipboard","warning",Bs)}}async importJSON(e){if(!e){this.logExport?.error?.("No file provided for import"),this.showToast(" Select a configuration file first","warning");return}this.logExport?.info?.(`Importing JSON configuration from ${e.name}...`);try{const t=await this.readFileAsText(e),i=JSON.parse(t);this.#i(i),this.logExport?.info?.("JSON configuration imported successfully")}catch(t){this.logExport?.error?.("Failed to import JSON:",t),this.showToast(` Failed to import configuration: ${t.message}`,"error",Us),this.alert(`Failed to import configuration: ${t.message}`)}}async pasteJSON(){if(!this.navigator?.clipboard?.readText){this.showToast(" Clipboard read not supported","warning",Bs);return}this.logExport?.info?.("Pasting JSON configuration from clipboard...");try{const e=await this.navigator.clipboard.readText(),t=JSON.parse(e);this.#i(t),this.logExport?.info?.("JSON configuration pasted successfully"),this.alert("Configuration pasted from clipboard!")}catch(e){this.logExport?.error?.("Failed to parse JSON from clipboard:",e),this.showToast(` Failed to paste configuration: ${e.message}`,"error",Us),this.alert(`Failed to paste configuration: ${e.message}`)}}#e(e){if(!this.document?.createElement)return null;const t=this.document.createElement("div");return t.style.cssText=["position: fixed","top: 0","left: 0","width: 100%","height: 100%","background: rgba(0, 0, 0, 0.8)","color: white","display: flex","flex-direction: column","align-items: center","justify-content: center","font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",`z-index: ${Mv}`].join(";"),t.innerHTML=`
            <div style="text-align: center;">
                <div style="font-size: 24px; margin-bottom: 10px;">Exporting...</div>
                <div style="font-size: 16px; opacity: 0.7;">Rendering at ${e}x resolution</div>
                <div style="margin-top: 20px; font-size: 14px; opacity: 0.5;">Please wait...</div>
            </div>
        `,this.document.body?.appendChild?.(t),t}#t({includeExtendedParams:e}){const t={version:"1.0",params:{zSpacing:this.params.zSpacing,bgColor:this.params.bgColor},camera:{position:{x:this.camera.position.x,y:this.camera.position.y,z:this.camera.position.z}},images:[]};return e&&(t.params.cameraMode=this.params.cameraMode,t.params.cameraFOV=this.params.cameraFOV,t.params.transparentBg=this.params.transparentBg),this.imageStack.forEach(i=>{const r=this.#n(i);r&&t.images.push(r)}),t}#n(e){const t=e?.mesh?.material?.map??e?.texture,i=t?.image;if(!t||!i||!this.createCanvas)return null;const r=this.createCanvas(),s=r?.getContext?.("2d");if(!r||!s)return null;r.width=i.width,r.height=i.height,s.drawImage(i,0,0);const o=r.toDataURL(lu);return{filename:e.filename,dataURL:o,width:e.width,height:e.height}}#i(e){if(!e||!e.version||!e.params||!Array.isArray(e.images))throw new Error("Invalid config format");this.clearAll(),this.params.zSpacing=e.params.zSpacing,this.params.bgColor=e.params.bgColor,e.params.cameraMode&&(this.params.cameraMode=e.params.cameraMode),e.params.cameraFOV&&(this.params.cameraFOV=e.params.cameraFOV),e.params.transparentBg!==void 0&&(this.params.transparentBg=e.params.transparentBg),this.scene&&(this.scene.background=new $e(this.params.transparentBg?0:this.params.bgColor),this.params.transparentBg&&(this.scene.background=null)),this.updateBackground(),e.camera?.position&&(this.camera.position.set(e.camera.position.x,e.camera.position.y,e.camera.position.z),this.camera.lookAt(0,0,0),this.controls.update()),e.images.forEach((t,i)=>{this.#r(t,i,0)}),this.pane?.refresh?.()}#r(e,t,i){this.createTextureLoader().load(e.dataURL,s=>{const o=s.image;(o.width>rl||o.height>rl)&&(this.logExport?.warn?.(`Warning: Image ${e.filename} has large dimensions (${o.width}x${o.height}). Max recommended: ${rl}px.`),this.showToast(` Large dimensions: ${e.filename} (${o.width}x${o.height}px). May render slowly`,"warning",Bs)),i>0&&this.logExport?.info?.(`Successfully loaded ${e.filename} on attempt ${i+1}`);const a=new os(e.width,e.height),l=new kl({map:s,side:pi,transparent:!0}),c=new jt(a,l);c.castShadow=!0,c.receiveShadow=!0,c.position.z=t*this.params.zSpacing;const h={mesh:c,texture:s,filename:e.filename,width:e.width,height:e.height,originalWidth:e.width,originalHeight:e.height,id:Date.now()+Math.random()};this.imageStack.push(h),this.scene.add(c),this.updateImageList(),this.emitStackUpdated("imported"),this.logExport?.info?.(`Loaded ${e.filename} from config`)},void 0,s=>{if(i<Au){const o=RE[i];this.logExport?.warn?.(`Failed to load ${e.filename} (attempt ${i+1}/${Au+1}). Retrying in ${o}ms...`,s),this.setTimeout?.(()=>{this.#r(e,t,i+1)},o)}else this.logExport?.error?.(`Failed to load ${e.filename} after ${Au+1} attempts:`,s),this.showToast(` Failed to load: ${e.filename}. Check file is valid`,"error",Us)})}}function mn(n){const e=`[${n}]`;return{log:(...t)=>console.log(e,...t),info:(...t)=>console.log(e,...t),warn:(...t)=>console.warn(e,...t),error:(...t)=>console.error(e,...t)}}const DN=["image/png","image/jpeg","image/jpg","image/gif","image/webp","image/svg+xml"],cu=1024*1024,kN=4e3,IN=" Image not added (memory limit)";class ON{constructor(e){const{elements:t,addTrackedEventListener:i,onFileAccepted:r,shouldProceedAfterMemoryCheck:s,showToast:o,loggers:a}=e;if(typeof r!="function")throw new Error("FileHandler requires an onFileAccepted callback");if(typeof s!="function")throw new Error("FileHandler requires shouldProceedAfterMemoryCheck callback");this.imageInput=t?.imageInput??null,this.browseButton=t?.browseButton??null,this.dropOverlay=t?.dropOverlay??null,this.slidesPanel=t?.slidesPanel??null,this.addTrackedEventListener=i??(()=>{}),this.onFileAccepted=r,this.shouldProceedAfterMemoryCheck=s,this.showToast=o??(()=>{}),this.logFile=a?.logFile??{info:()=>{},warn:()=>{},error:()=>{}},this.logValidation=a?.logValidation??{warn:()=>{},error:()=>{}},this.dragDepth=0,this.handleBrowseClick=this.handleBrowseClick.bind(this),this.handleFileSelect=this.handleFileSelect.bind(this),this.handleDragEnter=this.handleDragEnter.bind(this),this.handleDragLeave=this.handleDragLeave.bind(this),this.handleDragOver=this.handleDragOver.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this)}setup(){if(!this.imageInput){this.logFile.error("File input element not found");return}this.browseButton&&this.addTrackedEventListener(this.browseButton,"click",this.handleBrowseClick),this.addTrackedEventListener(this.imageInput,"change",this.handleFileSelect),!(typeof window>"u")&&(this.addTrackedEventListener(window,"dragenter",this.handleDragEnter),this.addTrackedEventListener(window,"dragleave",this.handleDragLeave),this.addTrackedEventListener(window,"dragover",this.handleDragOver),this.addTrackedEventListener(window,"drop",this.handleDrop),this.addTrackedEventListener(window,"dragend",this.handleDragEnd))}teardown(){this.hideOverlay()}processFiles(e){if(!e||e.length===0){this.logFile.warn("No files provided for processing");return}const t=Array.from(e);let i=0,r=0;this.logFile.info(`Loading ${t.length} file(s)...`);for(const s of t){if(!this.validateFileType(s)){i+=1;continue}if(!this.validateFileSize(s)){i+=1;continue}if(!this.shouldProceedAfterMemoryCheck()){i+=1,this.showToast(IN,"warning",Bs);continue}r+=1,this.onFileAccepted(s)}i>0&&this.logValidation.warn(`${i} file(s) rejected, ${r} accepted`)}handleFileSelect(e){const t=e.target;this.processFiles(t?.files??null)}handleBrowseClick(e){e.preventDefault(),this.imageInput?.click()}handleDragEnter(e){this.eventHasFiles(e)&&(this.dragDepth+=1,this.showOverlay())}handleDragLeave(e){this.eventHasFiles(e)&&(this.dragDepth=Math.max(0,this.dragDepth-1),this.dragDepth===0&&this.hideOverlay())}handleDragOver(e){this.eventHasFiles(e)&&(e.preventDefault(),this.showOverlay())}handleDrop(e){if(!this.eventHasFiles(e)){this.hideOverlay();return}e.preventDefault();const{files:t}=e.dataTransfer??{files:null};this.hideOverlay(),t&&t.length>0&&this.processFiles(t)}handleDragEnd(){this.hideOverlay()}validateFileType(e){if(DN.includes(e.type))return!0;const t=(e.name||"").split(".").pop()?.toLowerCase()??"unknown";return this.logValidation.error(`Unsupported file type: ${e.name} (${e.type||"unknown type"})`),this.showToast(` Unsupported file type: .${t} (only images supported)`,"error",kN),!1}validateFileSize(e){const t=hN*cu,i=rf*cu;if(e.size>i){const r=(e.size/cu).toFixed(1);return this.logValidation.error(`File ${e.name} is too large (${r}MB). Maximum size is ${rf}MB.`),this.showToast(` File too large: ${e.name} (${r}MB). Max: ${rf}MB`,"error",Us),!1}if(e.size>t){const r=(e.size/cu).toFixed(1);this.logValidation.warn(`Warning: File ${e.name} is large (${r}MB). This may affect performance.`),this.showToast(` Large file: ${e.name} (${r}MB). May affect performance`,"warning",Bs)}return!0}eventHasFiles(e){const{dataTransfer:t}=e;return t?t.files&&t.files.length>0?!0:Array.from(t.types||[]).includes("Files"):!1}showOverlay(){this.dropOverlay?.classList.add("visible"),this.slidesPanel?.classList.add("drag-active")}hideOverlay(){this.dropOverlay?.classList.remove("visible"),this.slidesPanel?.classList.remove("drag-active"),this.dragDepth=0}}class NN{constructor(e){if(typeof e?.createLoader!="function")throw new Error("[RetryingTextureLoader] createLoader must be provided");if(!Number.isInteger(e.maxRetries)||e.maxRetries<0)throw new Error("[RetryingTextureLoader] maxRetries must be a non-negative integer");this.createLoader=e.createLoader,this.maxRetries=e.maxRetries;const t=Array.isArray(e.retryDelays)?e.retryDelays.slice():[];if(t.find(r=>typeof r!="number"||!Number.isFinite(r)||r<0)!==void 0)throw new Error("[RetryingTextureLoader] retryDelays must contain non-negative numbers");if(this.retryDelays=t,e.scheduleRetry===void 0)this.scheduleRetry=(r,s)=>setTimeout(r,s);else if(typeof e.scheduleRetry=="function")this.scheduleRetry=e.scheduleRetry;else throw new Error("[RetryingTextureLoader] scheduleRetry must be a function");this.onTextureLoaded=e.onTextureLoaded??(()=>{}),this.logRetry=e.logRetry??{info:()=>{},warn:()=>{},error:()=>{}},this.showToast=typeof e.showToast=="function"?e.showToast:()=>{},this.toastDurationError=e.toastDurationError??3e3}load(e,t){this.#e(e,t,0)}#e(e,t,i){const r=this.createLoader();if(typeof r?.load!="function"){this.logRetry.error?.(`[RetryingTextureLoader] Loader missing load() for ${t}`,{filename:t}),this.showToast(` Failed to load: ${t}. Loader misconfigured.`,"error",this.toastDurationError);return}r.load(e,s=>{i>0&&this.logRetry.info?.(`Successfully loaded ${t} on attempt ${i+1}`),this.onTextureLoaded(s,{attempt:i})},void 0,s=>{if(i<this.maxRetries){const o=this.#t(i);this.logRetry.warn?.(`Failed to load ${t} (attempt ${i+1}/${this.maxRetries+1}). Retrying in ${o}ms...`,s),this.scheduleRetry(()=>{this.#e(e,t,i+1)},o);return}this.logRetry.error?.(`Failed to load ${t} after ${this.maxRetries+1} attempts:`,s),this.showToast(` Failed to load: ${t}. Check file is valid`,"error",this.toastDurationError)})}#t(e){return this.retryDelays.length===0?0:e<this.retryDelays.length?this.retryDelays[e]:this.retryDelays[this.retryDelays.length-1]}}function kt(n){return n==null}function Rv(n){return n!==null&&typeof n=="object"}function Ym(n){return n!==null&&typeof n=="object"}function FN(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ko(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,r)=>{const s=n[r],o=e[r];return Ym(s)&&Ym(o)?Object.assign(Object.assign({},i),{[r]:Ko(s,o)}):Object.assign(Object.assign({},i),{[r]:r in e?o:s})},{})}function VN(n){return Rv(n)?"target"in n:!1}const UN={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let us=class Ga{static alreadyDisposed(){return new Ga({type:"alreadydisposed"})}static notBindable(){return new Ga({type:"notbindable"})}static notCompatible(e,t){return new Ga({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Ga({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Ga({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=UN[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},rx=class DE{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!DE.isBindable(i))throw us.notBindable();if(!(e in i))throw us.propertyNotFound(e);i[e]=t}},Nn=class{constructor(){this.observers_={}}on(e,t,i){var r;let s=this.observers_[e];return s||(s=this.observers_[e]=[]),s.push({handler:t,key:(r=i?.key)!==null&&r!==void 0?r:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(r=>r.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(r=>{r.handler(t)})}},BN=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:((r,s)=>r===s),this.emitter=new Nn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(e):e,s=this.rawValue_;this.equals_(s,r)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:r,sender:this}))}},zN=class{constructor(e){this.emitter=new Nn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},r=this.value_;r===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:this.value_,sender:this}))}},$N=class{constructor(e){this.emitter=new Nn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function qt(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new zN(n):new BN(n,e)}function HN(n){return[new $N(n),(e,t)=>{n.setRawValue(e,t)}]}let We=class kE{constructor(e){this.emitter=new Nn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,r)=>Object.assign(i,{[r]:qt(e[r])}),{})}static fromObject(e){const t=this.createCore(e);return new kE(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},yh=class{constructor(e){this.values=We.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},Lv=class{constructor(e){this.values=We.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let r=e;return kt(i)||(r=Math.max(r,i)),kt(t)||(r=Math.min(r,t)),r}},GN=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},jN=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const WN={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let KN=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=WN[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const XN={"+":n=>n,"-":n=>-n,"~":n=>~n};let qN=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=XN[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function Dv(n){return(e,t)=>{for(let i=0;i<n.length;i++){const r=n[i](e,t);if(r!=="")return r}return""}}function Zc(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function YN(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Jc(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function ZN(n,e){const t=Jc(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const r=Jc(n,e);return r===""?"":i+r}function kv(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=ZN(n,e);return i===""?"":t+i}function IE(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=YN(n,e);return e+=i.length,i===""?"":i+Jc(n,e)}function JN(n,e){const t=IE(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const r=Jc(n,e);return e+=r.length,t+i+r+kv(n,e)}function QN(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Jc(n,e);return e+=i.length,i===""?"":t+i+kv(n,e)}function eF(n,e){const t=IE(n,e);return e+=t.length,t===""?"":t+kv(n,e)}const tF=Dv([JN,QN,eF]);function nF(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function iF(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=nF(n,e);return i===""?"":t+i}function rF(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function sF(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=rF(n,e);return i===""?"":t+i}function oF(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function aF(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=oF(n,e);return i===""?"":t+i}const lF=Dv([iF,sF,aF]),cF=Dv([lF,tF]);function hF(n,e){const t=cF(n,e);return e+=t.length,t===""?null:{evaluable:new jN(t),cursor:e}}function uF(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=NE(n,e);if(!i)return null;e=i.cursor,e+=Zc(n,e).length;const r=n.substr(e,1);return e+=r.length,r!==")"?null:{evaluable:i.evaluable,cursor:e}}function dF(n,e){var t;return(t=hF(n,e))!==null&&t!==void 0?t:uF(n,e)}function OE(n,e){const t=dF(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const r=OE(n,e);return r?(e=r.cursor,{cursor:e,evaluable:new qN(i,r.evaluable)}):null}function pF(n,e,t){t+=Zc(e,t).length;const i=n.filter(r=>e.startsWith(r,t))[0];return i?(t+=i.length,t+=Zc(e,t).length,{cursor:t,operator:i}):null}function fF(n,e){return(t,i)=>{const r=n(t,i);if(!r)return null;i=r.cursor;let s=r.evaluable;for(;;){const o=pF(e,t,i);if(!o)break;i=o.cursor;const a=n(t,i);if(!a)return null;i=a.cursor,s=new KN(o.operator,s,a.evaluable)}return s?{cursor:i,evaluable:s}:null}}const mF=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>fF(n,e),OE);function NE(n,e){return e+=Zc(n,e).length,mF(n,e)}function vF(n){const e=NE(n,0);return!e||e.cursor+Zc(n,e.cursor).length!==n.length?null:e.evaluable}function tr(n){var e;const t=vF(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function Iv(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=tr(n);if(!kt(e))return e}return 0}function Sn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function Ue(n,e,t,i,r){const s=(n-e)/(t-e);return i+s*(r-i)}function sx(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Bt(n,e,t){return Math.min(Math.max(n,e),t)}function FE(n,e){return(n%e+e)%e}function _F(n,e){return kt(n.step)?Math.max(sx(e),2):sx(n.step)}function VE(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function gF(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function Ov(n,e){return kt(n.step)?null:new GN(n.step,e)}function Nv(n){return!kt(n.max)&&!kt(n.min)?new yh({max:n.max,min:n.min}):!kt(n.max)||!kt(n.min)?new Lv({max:n.max,min:n.min}):null}function Fv(n,e){var t,i,r;return{formatter:(t=n.format)!==null&&t!==void 0?t:Sn(_F(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:VE(n),pointerScale:(r=n.pointerScale)!==null&&r!==void 0?r:gF(n,e)}}function Vv(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function Uv(n){return{constraint:n.constraint,textProps:We.fromObject(Fv(n.params,n.initialValue))}}let la=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},ca=class{constructor(e){this.target=e}},Od=class extends ca{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},bF=class extends ca{constructor(e,t){super(e),this.expanded=t}},xF=class extends ca{constructor(e,t){super(e),this.index=t}},wF=class extends ca{constructor(e,t){super(e),this.native=t}},Bv=class extends la{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Nn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new Od(this,t.binding.target.read(),e.options.last))}};function yF(n,e){const i=Object.keys(e).reduce((r,s)=>{if(r===void 0)return;const o=e[s],a=o(n[s]);return a.succeeded?Object.assign(Object.assign({},r),{[s]:a.value}):void 0},{});return i}function EF(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const r=e(i);if(!(!r.succeeded||r.value===void 0))return[...t,r.value]},[])}function CF(n){return n===null?!1:typeof n=="object"}function jr(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function ox(n){return{custom:e=>jr(e)(n),boolean:jr(e=>typeof e=="boolean"?e:void 0)(n),number:jr(e=>typeof e=="number"?e:void 0)(n),string:jr(e=>typeof e=="string"?e:void 0)(n),function:jr(e=>typeof e=="function"?e:void 0)(n),constant:e=>jr(t=>t===e?e:void 0)(n),raw:jr(e=>e)(n),object:e=>jr(t=>{if(CF(t))return yF(t,e)})(n),array:e=>jr(t=>{if(Array.isArray(t))return EF(t,e)})(n)}}const Zm={optional:ox(!0),required:ox(!1)};function Zt(n,e){const t=e(Zm),i=Zm.required.object(t)(n);return i.succeeded?i.value:void 0}function sr(n,e,t,i){if(e&&!e(n))return!1;const r=Zt(n,t);return r?i(r):!1}function or(n,e){var t;return Ko((t=n?.())!==null&&t!==void 0?t:{},e)}function Ru(n){return"value"in n}function SF(n){if(!Rv(n)||!("binding"in n))return!1;const e=n.binding;return VN(e)}const gn="http://www.w3.org/2000/svg";function ed(n){n.offsetHeight}function MF(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Nd(n){return n.ontouchstart!==void 0}function PF(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const TF={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Fd(n,e){const t=n.createElementNS(gn,"svg");return t.innerHTML=TF[e],t}function UE(n,e,t){n.insertBefore(e,n.children[t])}function zv(n){n.parentElement&&n.parentElement.removeChild(n)}function BE(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function AF(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function $v(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function $i(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Gi(n,e,t){$i(n.value(e),t)}const RF="tp";function Ke(n){return(t,i)=>[RF,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const oc=Ke("lbl");function LF(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(r=>n.createTextNode(r)).forEach((r,s)=>{s>0&&t.appendChild(n.createElement("br")),t.appendChild(r)}),t}let zE=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(oc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(oc("l")),Gi(t.props,"label",s=>{kt(s)?this.element.classList.add(oc(void 0,"nol")):(this.element.classList.remove(oc(void 0,"nol")),AF(i),i.appendChild(LF(e,s)))}),this.element.appendChild(i),this.labelElement=i;const r=e.createElement("div");r.classList.add(oc("v")),this.element.appendChild(r),this.valueElement=r}},Vd=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new zE(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return sr(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return or(null,{label:this.props.get("label")})}};function DF(){return["veryfirst","first","last","verylast"]}const ax=Ke(""),lx={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let Eh=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{DF().forEach(i=>{t.classList.remove(ax(void 0,lx[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(ax(void 0,lx[i]))})}),this.viewProps.handleDispose(()=>{zv(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return sr(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return or(null,Object.assign({},this.viewProps.exportState()))}};class td extends Eh{constructor(e,t){if(t.value!==t.valueController.value)throw us.shouldNeverHappen();const i=t.valueController.viewProps,r=new Vd(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new zE(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=r,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return sr(e,t=>{var i,r,s;return super.importState(t)&&this.labelController.importProps(t)&&((s=(r=(i=this.valueController).importProps)===null||r===void 0?void 0:r.call(i,e))!==null&&s!==void 0?s:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return or(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}}function $E(n,e){for(;n.length<e;)n.push(void 0)}function kF(n){const e=[];return $E(e,n),e}function IF(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function OF(n,e){const t=[...IF(n),e];return t.length>n.length?t.splice(0,t.length-n.length):$E(t,n.length),t}let NF=class extends la{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,s=>{i(new wF(this,s.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}};function FF(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function ro(n,e){return t=>{FF(n,e,t)}}function Hv(n,e){$i(n,t=>{e.textContent=t??""})}const of=Ke("btn");let VF=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(of()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(of("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const r=e.createElement("div");r.classList.add(of("t")),Hv(t.props.value("title"),r),this.buttonElement.appendChild(r)}},HE=class{constructor(e,t){this.emitter=new Nn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new VF(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return sr(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return or(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}},cx=class extends Eh{constructor(e,t){const i=new HE(e,{props:t.buttonProps,viewProps:t.viewProps}),r=new Vd(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:r.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=r}importState(e){return sr(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return or(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},UF=class{constructor(e){const[t,i]=e.split("-"),r=t.split(".");this.major=parseInt(r[0],10),this.minor=parseInt(r[1],10),this.patch=parseInt(r[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const BF=new UF("2.0.5");function nn(n){return Object.assign({core:BF},n)}nn({id:"button",type:"blade",accept(n){const e=Zt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new cx(n.document,{blade:n.blade,buttonProps:We.fromObject({title:n.params.title}),labelProps:We.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof cx?new NF(n.controller):null}});function zF(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function $F(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function HF(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function GF(n){return Rv(n)?"refresh"in n&&typeof n.refresh=="function":!1}function jF(n,e){if(!rx.isBindable(n))throw us.notBindable();return new rx(n,e)}let WF=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Nn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const r=i??{},s=this.controller_.element.ownerDocument,o=this.pool_.createBinding(s,jF(e,t),r),a=this.pool_.createBindingApi(o);return this.add(a,r.index)}addFolder(e){return $F(this,e)}addButton(e){return zF(this,e)}addTab(e){return HF(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),r=this.pool_.createApi(i);return this.add(r,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{GF(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),r=SF(t.value)?t.value.binding:null;this.emitter_.emit("change",new Od(i,r?r.target.read():t.value.rawValue,e.options.last))}},Gv=class extends la{constructor(e,t){super(e),this.rackApi_=new WF(e.rackController,t)}refresh(){this.rackApi_.refresh()}},jv=class extends Eh{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return sr(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,r)=>i.importState(t.children[r])))}exportState(){return or(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Jm(n){return"rackController"in n}let KF=class{constructor(e){this.emitter=new Nn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw us.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const r=this.extract_(e);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach(s=>{this.cache_.add(s)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(r=>{this.cache_.delete(r)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function XF(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Ru(i)&&i.value===e)return i}return null}function qF(n){return Jm(n)?n.rackController.rack.bcSet_:null}let YF=class{constructor(e){var t,i;this.emitter=new Nn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new KF(qF),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Ru(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Jm(i)){const r=i.rackController.rack;if(r){const s=r.emitter;s.on("layout",this.onRackLayout_),s.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Ru(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Jm(i)){const r=i.rackController.rack;if(r){const s=r.emitter;s.off("layout",this.onRackLayout_),s.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(r=>!r.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(r=>{const s=[];r===t&&(s.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&s.push("veryfirst")),r===i&&(s.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&s.push("verylast")),r.blade.set("positions",s)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=XF(this.find(Ru),e.sender);if(!t)throw us.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Wv=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new YF({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&UE(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&zv(e.bladeController.view.element)}};function GE(){return new We({positions:qt([],{equals:FN})})}let Ud=class jE extends We{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=We.createCore(t);return new jE(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!kt(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Gi(this,"expanded",i),Gi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function ZF(n,e){let t=0;return MF(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),ed(e),t=e.clientHeight,n.set("temporaryExpanded",null),ed(e)}),t}function hx(n,e){e.style.height=n.styleHeight}function Bd(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),kt(n.get("expandedHeight"))){const t=ZF(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),ed(e)}),n.emitter.on("change",()=>{hx(n,e)}),hx(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let JF=class extends Gv{constructor(e,t){super(e,t),this.emitter_=new Nn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new bF(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}};const WE=Ke("cnt");let QF=class{constructor(e,t){var i;this.className_=Ke((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),WE()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Gi(this.foldable_,"completed",ro(this.element,this.className_(void 0,"cpl")));const r=e.createElement("button");r.classList.add(this.className_("b")),Gi(t.props,"title",c=>{kt(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const o=e.createElement("div");o.classList.add(this.className_("t")),Hv(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const l=e.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}},ux=class extends jv{constructor(e,t){var i;const r=Ud.create((i=t.expanded)!==null&&i!==void 0?i:!0),s=new QF(e,{foldable:r,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Wv({blade:t.blade,element:s.containerElement,root:t.root,viewProps:t.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=r,Bd(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return sr(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return or(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};nn({id:"folder",type:"blade",accept(n){const e=Zt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new ux(n.document,{blade:n.blade,expanded:n.params.expanded,props:We.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof ux?new JF(n.controller,n.pool):null}});const eV=Ke("");function dx(n,e){return ro(n,eV(void 0,e))}let Xo=class KE extends We{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=HN(qt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,r;const s=e??{};return new KE(We.createCore({disabled:(t=s.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=s.hidden)!==null&&i!==void 0?i:!1,parent:(r=s.parent)!==null&&r!==void 0?r:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){$i(this.globalDisabled_,dx(e,"disabled")),Gi(this,"hidden",dx(e,"hidden"))}bindDisabled(e){$i(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){$i(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const px=Ke("tbp");let tV=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(px()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(px("c")),this.element.appendChild(i),this.containerElement=i}};const ac=Ke("tbi");let nV=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ac()),t.viewProps.bindClassModifiers(this.element),Gi(t.props,"selected",s=>{s?this.element.classList.add(ac(void 0,"sel")):this.element.classList.remove(ac(void 0,"sel"))});const i=e.createElement("button");i.classList.add(ac("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const r=e.createElement("div");r.classList.add(ac("t")),Hv(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r}},iV=class{constructor(e,t){this.emitter=new Nn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new nV(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Qm=class extends jv{constructor(e,t){const i=new tV(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Wv({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new iV(e,{props:t.itemProps,viewProps:Xo.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Gi(this.props,"selected",r=>{this.itemController.props.set("selected",r),this.viewProps.set("hidden",!r)})}get itemController(){return this.ic_}importState(e){return sr(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return or(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},rV=class extends Gv{constructor(e,t){super(e,t),this.emitter_=new Nn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Qm(t,{blade:GE(),itemProps:We.fromObject({selected:!1,title:e.title}),props:We.fromObject({selected:!1}),viewProps:Xo.create()}),r=this.pool_.createApi(i);return this.rackApi_.add(r,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new xF(this,e.rawValue))}},sV=class extends Gv{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const fx=-1;let oV=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=qt(!0),this.selectedIndex=qt(fx),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=fx,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,r)=>{i.rawValue=r===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const lc=Ke("tab");let aV=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(lc(),WE()),t.viewProps.bindClassModifiers(this.element),$i(t.empty,ro(this.element,lc(void 0,"nop")));const i=e.createElement("div");i.classList.add(lc("t")),this.element.appendChild(i),this.itemsElement=i;const r=e.createElement("div");r.classList.add(lc("i")),this.element.appendChild(r);const s=e.createElement("div");s.classList.add(lc("c")),this.element.appendChild(s),this.contentsElement=s}},mx=class extends jv{constructor(e,t){const i=new oV,r=new aV(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Wv({blade:t.blade,element:r.contentsElement,viewProps:t.viewProps}),view:r}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;UE(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;zv(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};nn({id:"tab",type:"blade",accept(n){const e=Zt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new mx(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Qm(n.document,{blade:GE(),itemProps:We.fromObject({selected:!1,title:t.title}),props:We.fromObject({selected:!1}),viewProps:Xo.create()});e.add(i)}),e},api(n){return n.controller instanceof mx?new rV(n.controller,n.pool):n.controller instanceof Qm?new sV(n.controller,n.pool):null}});let Kv=class extends Bv{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}};class lV{constructor(){this.disabled=!1,this.emitter=new Nn}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class cV{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Nn,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}let Ul=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function Qc(n,e){if(n instanceof e)return n;if(n instanceof Ul){const t=n.constraints.reduce((i,r)=>i||(r instanceof e?r:null),null);if(t)return t}return null}let zd=class{constructor(e){this.values=We.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(r=>r.value===e).length>0?e:t[0].value}};function $d(n){var e;const t=Zm;if(Array.isArray(n))return(e=Zt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function XE(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Xv(n){return kt(n)?null:new zd(XE(n))}const af=Ke("lst");let hV=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(af()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(af("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const r=e.createElement("div");r.classList.add(af("m")),r.appendChild(Fd(e,"dropdown")),this.element.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Gi(this.props_,"options",s=>{BE(this.selectElement),s.forEach(o=>{const a=e.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Sl=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new hV(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return sr(e,null,t=>({options:t.required.custom($d)}),t=>(this.props.set("options",XE(t.options)),!0))}exportProps(){return or(null,{options:this.props.get("options")})}};const vx=Ke("pop");let uV=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vx()),t.viewProps.bindClassModifiers(this.element),$i(t.shows,ro(this.element,vx(void 0,"v")))}},qv=class{constructor(e,t){this.shows=qt(!1),this.viewProps=t.viewProps,this.view=new uV(e,{shows:this.shows,viewProps:this.viewProps})}};const _x=Ke("txt");let dV=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(_x()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(_x("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},Hd=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new dV(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,r=this.parser_(i);kt(r)||(this.value.rawValue=r),this.view.refresh()}};function pV(n){return String(n)}function Yv(n){return n==="false"?!1:!!n}function gx(n){return pV(n)}function fV(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const mV=Sn(0);function nd(n){return mV(n)+"%"}function Zv(n){return String(n)}function e0(n){return n}function ha({primary:n,secondary:e,forward:t,backward:i}){let r=!1;function s(o){r||(r=!0,o(),r=!1)}n.emitter.on("change",o=>{s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{s(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function bn(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function qo(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function nr(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function vV(n){return n==="ArrowUp"||n==="ArrowDown"}function id(n){return vV(n)||n==="ArrowLeft"||n==="ArrowRight"}function lf(n,e){var t,i;const r=e.ownerDocument.defaultView,s=e.getBoundingClientRect();return{x:n.pageX-(((t=r&&r.scrollX)!==null&&t!==void 0?t:0)+s.left),y:n.pageY-(((i=r&&r.scrollY)!==null&&i!==void 0?i:0)+s.top)}}let ps=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Nn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(lf(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(lf(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(lf(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-r.left,y:i.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Li=Ke("txt");let _V=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Li(),Li(void 0,"num")),t.arrayPosition&&this.element.classList.add(Li(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Li("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Li()),this.inputElement.classList.add(Li("i"));const r=e.createElement("div");r.classList.add(Li("k")),this.element.appendChild(r),this.knobElement=r;const s=e.createElementNS(gn,"svg");s.classList.add(Li("g")),this.knobElement.appendChild(s);const o=e.createElementNS(gn,"path");o.classList.add(Li("gb")),s.appendChild(o),this.guideBodyElem_=o;const a=e.createElementNS(gn,"path");a.classList.add(Li("gh")),s.appendChild(a),this.guideHeadElem_=a;const l=e.createElement("div");l.classList.add(Ke("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Li(void 0,"drg"));return}this.element.classList.add(Li(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),r=Bt(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+r},0 L${i},4 L${i+r},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Ch=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=qt(null),this.view=new _V(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new ps(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const r=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),s=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return r!==void 0&&(o=Math.max(o,r)),s!==void 0&&(o=Math.min(o,s)),o}onInputChange_(e){const i=e.currentTarget.value,r=this.parser_(i);kt(r)||(this.value.rawValue=this.constrainValue_(r)),this.view.refresh()}onInputKeyDown_(e){const t=bn(this.props.get("keyScale"),qo(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){bn(this.props.get("keyScale"),qo(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const cf=Ke("sld");let gV=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(cf()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(cf("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const r=e.createElement("div");r.classList.add(cf("k")),this.trackElement.appendChild(r),this.knobElement=r,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Bt(Ue(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},bV=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new gV(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ps(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Ue(Bt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=bn(this.props.get("keyScale"),nr(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){bn(this.props.get("keyScale"),nr(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const hf=Ke("sldtxt");let xV=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(hf());const i=e.createElement("div");i.classList.add(hf("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(hf("t")),this.textView_=t.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}},bx=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new bV(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Ch(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new xV(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return sr(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return or(null,{max:e.get("max"),min:e.get("min")})}};function wV(n){return{sliderProps:new We({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new We({formatter:qt(n.formatter),keyScale:n.keyScale,pointerScale:qt(n.pointerScale)})}}const yV={containerUnitSize:"cnt-usz"};function qE(n){return`--${yV[n]}`}class YE{constructor(e,t){const i=Ke(t.viewName);this.element=e.createElement("div"),this.element.classList.add(i()),t.viewProps.bindClassModifiers(this.element)}}function eh(n){return Vv(n)}function zs(n){if(Ym(n))return Zt(n,eh)}function Jr(n,e){if(!n)return;const t=[],i=Ov(n,e);i&&t.push(i);const r=Nv(n);return r&&t.push(r),new Ul(t)}function ZE(n){if(n==="inline"||n==="popup")return n}function so(n,e){n.write(e)}const hu=Ke("ckb");let EV=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(hu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(hu("l")),this.element.appendChild(i),this.labelElement=i;const r=e.createElement("input");r.classList.add(hu("i")),r.type="checkbox",this.labelElement.appendChild(r),this.inputElement=r,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(hu("w")),this.labelElement.appendChild(s);const o=Fd(e,"check");s.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},CV=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new EV(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}};function SV(n){const e=[],t=Xv(n.options);return t&&e.push(t),new Ul(e)}nn({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Zt(e,i=>({options:i.optional.custom($d),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Yv,constraint:n=>SV(n.params),writer:n=>so},controller:n=>{const e=n.document,t=n.value,i=n.constraint,r=i&&Qc(i,zd);return r?new Sl(e,{props:new We({options:r.values.value("options")}),value:t,viewProps:n.viewProps}):new CV(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Sl?new Kv(n.controller):null}});const bo=Ke("col");class MV{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(bo()),t.foldable.bindExpandedClass(this.element,bo(void 0,"expanded")),Gi(t.foldable,"completed",ro(this.element,bo(void 0,"cpl")));const i=e.createElement("div");i.classList.add(bo("h")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(bo("s")),i.appendChild(r),this.swatchElement=r;const s=e.createElement("div");if(s.classList.add(bo("t")),i.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(bo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}function PV(n,e,t){const i=Bt(n/255,0,1),r=Bt(e/255,0,1),s=Bt(t/255,0,1),o=Math.max(i,r,s),a=Math.min(i,r,s),l=o-a;let c=0,h=0;const u=(a+o)/2;return l!==0&&(h=l/(1-Math.abs(o+a-1)),i===o?c=(r-s)/l:r===o?c=2+(s-i)/l:c=4+(i-r)/l,c=c/6+(c<0?1:0)),[c*360,h*100,u*100]}function TV(n,e,t){const i=(n%360+360)%360,r=Bt(e/100,0,1),s=Bt(t/100,0,1),o=(1-Math.abs(2*s-1))*r,a=o*(1-Math.abs(i/60%2-1)),l=s-o/2;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function AV(n,e,t){const i=Bt(n/255,0,1),r=Bt(e/255,0,1),s=Bt(t/255,0,1),o=Math.max(i,r,s),a=Math.min(i,r,s),l=o-a;let c;l===0?c=0:o===i?c=60*(((r-s)/l%6+6)%6):o===r?c=60*((s-i)/l+2):c=60*((i-r)/l+4);const h=o===0?0:l/o,u=o;return[c,h*100,u*100]}function JE(n,e,t){const i=FE(n,360),r=Bt(e/100,0,1),s=Bt(t/100,0,1),o=s*r,a=o*(1-Math.abs(i/60%2-1)),l=s-o;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function RV(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/200]}function LV(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/200]}function Tr(n){return[n[0],n[1],n[2]]}function Gd(n,e){return[n[0],n[1],n[2],e]}const DV={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:RV,rgb:TV},hsv:{hsl:LV,hsv:(n,e,t)=>[n,e,t],rgb:JE},rgb:{hsl:PV,hsv:AV,rgb:(n,e,t)=>[n,e,t]}};function Ml(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function kV(n,e){return n===e?e:FE(n,e)}function QE(n,e,t){var i;const r=Ml(e,t);return[e==="rgb"?Bt(n[0],0,r[0]):kV(n[0],r[0]),Bt(n[1],0,r[1]),Bt(n[2],0,r[2]),Bt((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function xx(n,e,t,i){const r=Ml(e,t),s=Ml(e,i);return n.map((o,a)=>o/r[a]*s[a])}function eC(n,e,t){const i=xx(n,e.mode,e.type,"int"),r=DV[e.mode][t.mode](...i);return xx(r,t.mode,"int",t.type)}let dt=class tC{static black(){return new tC([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=QE(e,t,this.type)}getComponents(e){return Gd(eC(Tr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Es=Ke("colp");class IV{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Es()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Es("hsv"));const r=e.createElement("div");r.classList.add(Es("sv")),this.svPaletteView_=t.svPaletteView,r.appendChild(this.svPaletteView_.element),i.appendChild(r);const s=e.createElement("div");s.classList.add(Es("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),i.appendChild(s),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Es("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(Es("a"));const l=e.createElement("div");l.classList.add(Es("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);const c=e.createElement("div");c.classList.add(Es("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function OV(n){return n==="int"?"int":n==="float"?"float":void 0}function Jv(n){return Zt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(OV)}),expanded:e.optional.boolean,picker:e.optional.custom(ZE),readonly:e.optional.constant(!1)}))}function Yo(n){return n?.1:1}function nC(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Qv=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=QE(e,t,this.type)}getComponents(e){return Gd(eC(Tr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const NV={int:(n,e)=>new dt(n,e),float:(n,e)=>new Qv(n,e)};function e_(n,e,t){return NV[t](n,e)}function FV(n){return n.type==="float"}function VV(n){return n.type==="int"}function UV(n){const e=n.getComponents(),t=Ml(n.mode,"int");return new dt([Math.round(Ue(e[0],0,1,0,t[0])),Math.round(Ue(e[1],0,1,0,t[1])),Math.round(Ue(e[2],0,1,0,t[2])),e[3]],n.mode)}function BV(n){const e=n.getComponents(),t=Ml(n.mode,"int");return new Qv([Ue(e[0],0,t[0],0,1),Ue(e[1],0,t[1],0,1),Ue(e[2],0,t[2],0,1),e[3]],n.mode)}function Gn(n,e){if(n.type===e)return n;if(VV(n)&&e==="float")return BV(n);if(FV(n)&&e==="int")return UV(n);throw us.shouldNeverHappen()}function zV(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Bi(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const $V={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function iC(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return $V[i](t)}function rC(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Bi(e[1],255),Bi(e[2],255),Bi(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function HV(n){const e=rC(n);return e?new dt(e,"rgb"):null}function sC(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Bi(e[1],255),Bi(e[2],255),Bi(e[3],255),Bi(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function GV(n){const e=sC(n);return e?new dt(e,"rgb"):null}function oC(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[iC(e[1]),Bi(e[2],100),Bi(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function jV(n){const e=oC(n);return e?new dt(e,"hsl"):null}function aC(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[iC(e[1]),Bi(e[2],100),Bi(e[3],100),Bi(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function WV(n){const e=aC(n);return e?new dt(e,"hsl"):null}function lC(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function KV(n){const e=lC(n);return e?new dt(e,"rgb"):null}function cC(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Ue(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),Ue(parseInt(t[4],16),0,255,0,1)]:null}function XV(n){const e=cC(n);return e?new dt(e,"rgb"):null}function hC(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function qV(n){return e=>{const t=hC(e);return t?e_(t,"rgb",n):null}}function uC(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function YV(n){return e=>{const t=uC(e);return t?e_(t,"rgb",n):null}}const ZV=[{parser:lC,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:cC,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:rC,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:sC,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:oC,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:aC,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:hC,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:uC,result:{alpha:!0,mode:"rgb",notation:"object"}}];function JV(n){return ZV.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function QV(n,e="int"){const t=JV(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Sh(n){const e=[KV,XV,HV,GV,jV,WV];e.push(qV("int"),YV("int"));const t=fV(e);return i=>{const r=t(i);return r?Gn(r,n):null}}function eU(n){const e=Sh("int");if(typeof n!="string")return dt.black();const t=e(n);return t??dt.black()}function dC(n){const e=Bt(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function t_(n,e="#"){const t=Tr(n.getComponents("rgb")).map(dC).join("");return`${e}${t}`}function n_(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(dC).join("");return`${e}${i}`}function pC(n){const e=Sn(0),t=Gn(n,"int");return`rgb(${Tr(t.getComponents("rgb")).map(r=>e(r)).join(", ")})`}function Lu(n){const e=Sn(2),t=Sn(0);return`rgba(${Gn(n,"int").getComponents("rgb").map((s,o)=>(o===3?e:t)(s)).join(", ")})`}function tU(n){const e=[Sn(0),nd,nd],t=Gn(n,"int");return`hsl(${Tr(t.getComponents("hsl")).map((r,s)=>e[s](r)).join(", ")})`}function nU(n){const e=[Sn(0),nd,nd,Sn(2)];return`hsla(${Gn(n,"int").getComponents("hsl").map((r,s)=>e[s](r)).join(", ")})`}function fC(n,e){const t=Sn(e==="float"?2:0),i=["r","g","b"],r=Gn(n,e);return`{${Tr(r.getComponents("rgb")).map((o,a)=>`${i[a]}: ${t(o)}`).join(", ")}}`}function iU(n){return e=>fC(e,n)}function mC(n,e){const t=Sn(2),i=Sn(e==="float"?2:0),r=["r","g","b","a"];return`{${Gn(n,e).getComponents("rgb").map((a,l)=>{const c=l===3?t:i;return`${r[l]}: ${c(a)}`}).join(", ")}}`}function rU(n){return e=>mC(e,n)}const sU=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:t_},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:n_},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:pC},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Lu},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:tU},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:nU},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:iU(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:rU(e)}],[])];function vC(n){return sU.reduce((e,t)=>e||(zV(t.format,n)?t.stringifier:null),null)}const cc=Ke("apl");class oU{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(cc()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(cc("b")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(cc("c")),i.appendChild(r),this.colorElem_=r;const s=e.createElement("div");s.classList.add(cc("m")),this.element.appendChild(s),this.markerElem_=s;const o=e.createElement("div");o.classList.add(cc("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new dt([t[0],t[1],t[2],0],"rgb"),r=new dt([t[0],t[1],t[2],255],"rgb"),s=["to right",Lu(i),Lu(r)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=Lu(e);const o=Ue(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class aU{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new oU(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ps(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,r=this.value.rawValue,[s,o,a]=r.getComponents("hsv");this.value.setRawValue(new dt([s,o,a,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=bn(Yo(!0),nr(e));if(t===0)return;const i=this.value.rawValue,[r,s,o,a]=i.getComponents("hsv");this.value.setRawValue(new dt([r,s,o,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){bn(Yo(!0),nr(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Na=Ke("coltxt");function lU(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,r)=>{const s=n.createElement("option");return s.textContent=r.text,s.value=r.value,i.appendChild(s),i},n.createDocumentFragment())),e}class cU{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Na()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Na("m")),this.modeElem_=lU(e),this.modeElem_.classList.add(Na("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const r=e.createElement("div");r.classList.add(Na("mm")),r.appendChild(Fd(e,"dropdown")),i.appendChild(r),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Na("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=t.inputViews,this.applyInputViews_(),$i(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){BE(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Na("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}}function hU(n){return Sn(n==="float"?2:0)}function uU(n,e,t){const i=Ml(n,e)[t];return new yh({min:0,max:i})}function dU(n,e,t){return new Ch(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:We.fromObject({formatter:hU(e.colorType),keyScale:Yo(!1),pointerScale:e.colorType==="float"?.01:1}),value:qt(0,{constraint:uU(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function pU(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:tr,viewProps:e.viewProps};return[0,1,2].map(i=>{const r=dU(n,t,i);return ha({primary:e.value,secondary:r.value,forward(s){return Gn(s,e.colorType).getComponents(e.colorMode)[i]},backward(s,o){const a=e.colorMode,c=Gn(s,e.colorType).getComponents(a);c[i]=o;const h=e_(Gd(Tr(c),c[3]),a,e.colorType);return Gn(h,"int")}}),r})}function fU(n,e){const t=new Hd(n,{parser:Sh("int"),props:We.fromObject({formatter:t_}),value:qt(dt.black()),viewProps:e.viewProps});return ha({primary:e.value,secondary:t.value,forward:i=>new dt(Tr(i.getComponents()),i.mode),backward:(i,r)=>new dt(Gd(Tr(r.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function mU(n){return n!=="hex"}class vU{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=qt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new cU(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return mU(t)?pU(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):fU(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}}const uf=Ke("hpl");class _U{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(uf()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(uf("c")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(uf("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=pC(new dt([t,100,100],"hsv"));const i=Ue(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class gU{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new _U(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ps(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=Ue(Bt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),r=this.value.rawValue,[,s,o,a]=r.getComponents("hsv");this.value.setRawValue(new dt([i,s,o,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=bn(Yo(!1),nr(e));if(t===0)return;const i=this.value.rawValue,[r,s,o,a]=i.getComponents("hsv");this.value.setRawValue(new dt([r+t,s,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){bn(Yo(!1),nr(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const df=Ke("svp"),wx=64;class bU{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(df()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=wx,i.width=wx,i.classList.add(df("c")),this.element.appendChild(i),this.canvasElement=i;const r=e.createElement("div");r.classList.add(df("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=PF(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),r=this.canvasElement.width,s=this.canvasElement.height,o=e.getImageData(0,0,r,s),a=o.data;for(let h=0;h<s;h++)for(let u=0;u<r;u++){const d=Ue(u,0,r,0,100),p=Ue(h,0,s,100,0),_=JE(i[0],d,p),v=(h*r+u)*4;a[v]=_[0],a[v+1]=_[1],a[v+2]=_[2],a[v+3]=255}e.putImageData(o,0,0);const l=Ue(i[1],0,100,0,100);this.markerElem_.style.left=`${l}%`;const c=Ue(i[2],0,100,100,0);this.markerElem_.style.top=`${c}%`}onValueChange_(){this.update_()}}class xU{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new bU(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ps(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=Ue(e.point.x,0,e.bounds.width,0,100),r=Ue(e.point.y,0,e.bounds.height,100,0),[s,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new dt([s,i,r,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){id(e.key)&&e.preventDefault();const[t,i,r,s]=this.value.rawValue.getComponents("hsv"),o=Yo(!1),a=bn(o,nr(e)),l=bn(o,qo(e));a===0&&l===0||this.value.setRawValue(new dt([t,i+a,r+l,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Yo(!1),i=bn(t,nr(e)),r=bn(t,qo(e));i===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class wU{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new gU(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new xU(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new aU(e,{value:this.value,viewProps:this.viewProps}),text:new Ch(e,{parser:tr,props:We.fromObject({pointerScale:.01,keyScale:.1,formatter:Sn(2)}),value:qt(0,{constraint:new yh({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ha({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,r)=>{const s=i.getComponents();return s[3]=r,new dt(s,i.mode)}}),this.textsC_=new vU(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new IV(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const pf=Ke("colsw");class yU{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(pf()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(pf("sw")),this.element.appendChild(i),this.swatchElem_=i;const r=e.createElement("button");r.classList.add(pf("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=n_(e)}onValueChange_(){this.update_()}}class EU{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new yU(e,{value:this.value,viewProps:this.viewProps})}}class i_{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Ud.create(t.expanded),this.swatchC_=new EU(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Hd(e,{parser:t.parser,props:We.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new MV(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new qv(e,{viewProps:this.viewProps}):null;const r=new wU(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(r.view.element),ha({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Bd(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=$v(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Nd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function CU(n){return Tr(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function SU(n){return n.getComponents("rgb").reduce((e,t,i)=>{const r=Math.floor(i===3?t*255:t)&255;return e<<8|r},0)>>>0}function MU(n){return new dt([n>>16&255,n>>8&255,n&255],"rgb")}function PU(n){return new dt([n>>24&255,n>>16&255,n>>8&255,Ue(n&255,0,255,0,1)],"rgb")}function TU(n){return typeof n!="number"?dt.black():MU(n)}function AU(n){return typeof n!="number"?dt.black():PU(n)}function Du(n,e){return typeof n!="object"||kt(n)?!1:e in n&&typeof n[e]=="number"}function _C(n){return Du(n,"r")&&Du(n,"g")&&Du(n,"b")}function gC(n){return _C(n)&&Du(n,"a")}function bC(n){return _C(n)}function r_(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let r=0;r<t.length;r++)if(t[r]!==i[r])return!1;return!0}function yx(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function RU(n){const e=vC(n);return e?(t,i)=>{so(t,e(i))}:null}function LU(n){const e=n?SU:CU;return(t,i)=>{so(t,e(i))}}function DU(n,e,t){const r=Gn(e,t).toRgbaObject();n.writeProperty("r",r.r),n.writeProperty("g",r.g),n.writeProperty("b",r.b),n.writeProperty("a",r.a)}function kU(n,e,t){const r=Gn(e,t).toRgbaObject();n.writeProperty("r",r.r),n.writeProperty("g",r.g),n.writeProperty("b",r.b)}function IU(n,e){return(t,i)=>{n?DU(t,i,e):kU(t,i,e)}}function OU(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function NU(n){return n?e=>n_(e,"0x"):e=>t_(e,"0x")}function FU(n){return"color"in n||n.view==="color"}nn({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!FU(e))return null;const t=Jv(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:OU(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?AU:TU,equals:r_,writer:n=>LU(n.params.supportsAlpha)},controller:n=>{var e,t;return new i_(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:NU(n.params.supportsAlpha),parser:Sh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function VU(n,e){if(!bC(n))return Gn(dt.black(),e);if(e==="int"){const t=yx(n);return new dt(t,"rgb")}if(e==="float"){const t=yx(n);return new Qv(t,"rgb")}return Gn(dt.black(),"int")}function UU(n){return gC(n)}function BU(n){return e=>{const t=VU(e,n);return Gn(t,"int")}}function zU(n,e){return t=>n?mC(t,e):fC(t,e)}nn({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!bC(n))return null;const i=Jv(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=nC(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>BU(n.params.colorType),equals:r_,writer:n=>IU(UU(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=gC(n.initialValue);return new i_(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:zU(i,n.params.colorType),parser:Sh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});nn({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=QV(n,nC(e));if(!t)return null;const i=vC(t);if(!i)return null;const r=Jv(e);return r?{initialValue:n,params:Object.assign(Object.assign({},r),{format:t,stringifier:i})}:null},binding:{reader:()=>eU,equals:r_,writer:n=>{const e=RU(n.params.format);if(!e)throw us.notBindable();return e}},controller:n=>{var e,t;return new i_(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Sh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let jd=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,r)=>{var s,o;return(o=(s=this.components[r])===null||s===void 0?void 0:s.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const Ex=Ke("pndtxt");let $U=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Ex()),this.textViews.forEach(i=>{const r=e.createElement("div");r.classList.add(Ex("a")),r.appendChild(i.element),this.element.appendChild(r)})}};function HU(n,e,t){return new Ch(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:qt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let Bl=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,r)=>HU(e,t,r)),this.acs_.forEach((i,r)=>{ha({primary:this.value,secondary:i.value,forward:s=>t.assembly.toComponents(s)[r],backward:(s,o)=>{const a=t.assembly.toComponents(s);return a[r]=o,t.assembly.fromComponents(a)}})}),this.view=new $U(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},GU=class extends Bv{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function jU(n,e){const t=[],i=Ov(n,e);i&&t.push(i);const r=Nv(n);r&&t.push(r);const s=Xv(n.options);return s&&t.push(s),new Ul(t)}nn({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Zt(e,i=>Object.assign(Object.assign({},Vv(i)),{options:i.optional.custom($d),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Iv,constraint:n=>jU(n.params,n.initialValue),writer:n=>so},controller:n=>{const e=n.value,t=n.constraint,i=t&&Qc(t,zd);if(i)return new Sl(n.document,{props:new We({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const r=Fv(n.params,e.rawValue),s=t&&Qc(t,yh);return s?new bx(n.document,Object.assign(Object.assign({},wV(Object.assign(Object.assign({},r),{keyScale:qt(r.keyScale),max:s.values.value("max"),min:s.values.value("min")}))),{parser:tr,value:e,viewProps:n.viewProps})):new Ch(n.document,{parser:tr,props:We.fromObject(r),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof bx?new GU(n.controller):n.controller.valueController instanceof Sl?new Kv(n.controller):null}});let Ks=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(kt(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const xC={toComponents:n=>n.getComponents(),fromComponents:n=>new Ks(...n)},Fa=Ke("p2d");let WU=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Fa()),t.viewProps.bindClassModifiers(this.element),$i(t.expanded,ro(this.element,Fa(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Fa("h")),this.element.appendChild(i);const r=e.createElement("button");r.classList.add(Fa("b")),r.appendChild(Fd(e,"p2dpad")),t.viewProps.bindDisabled(r),i.appendChild(r),this.buttonElement=r;const s=e.createElement("div");if(s.classList.add(Fa("t")),i.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Fa("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Cs=Ke("p2dp");let KU=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Cs()),t.layout==="popup"&&this.element.classList.add(Cs(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Cs("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const r=e.createElementNS(gn,"svg");r.classList.add(Cs("g")),this.padElement.appendChild(r),this.svgElem_=r;const s=e.createElementNS(gn,"line");s.classList.add(Cs("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const o=e.createElementNS(gn,"line");o.classList.add(Cs("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const a=e.createElementNS(gn,"line");a.classList.add(Cs("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const l=e.createElement("div");l.classList.add(Cs("m")),this.padElement.appendChild(l),this.markerElem_=l,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),r=Ue(e,-i,+i,0,100),s=Ue(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${r}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${r}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function Cx(n,e,t){return[bn(e[0],nr(n)),bn(e[1],qo(n))*(t?1:-1)]}let XU=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new KU(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ps(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),r=Ue(e.point.x,0,e.bounds.width,-i,+i),s=Ue(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Ks(r,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){id(e.key)&&e.preventDefault();const[t,i]=Cx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Ks(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=Cx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},qU=class{constructor(e,t){var i,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Ud.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new qv(e,{viewProps:this.viewProps}):null;const s=new XU(e,{layout:t.pickerLayout,props:new We({invertsY:qt(t.invertsY),max:qt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.textC_=new Bl(e,{assembly:xC,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new WU(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(r=this.view.buttonElement)===null||r===void 0||r.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ha({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Bd(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=$v(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Nd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function YU(n){return Ks.isObject(n)?new Ks(n.x,n.y):new Ks}function ZU(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function JU(n,e){return new jd({assembly:xC,components:[Jr(Object.assign(Object.assign({},n),n.x),e.x),Jr(Object.assign(Object.assign({},n),n.y),e.y)]})}function Sx(n,e){var t,i;if(!kt(n.min)||!kt(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const r=VE(n);return Math.max(Math.abs(r)*10,Math.abs(e)*10)}function QU(n,e){var t,i;const r=Sx(Ko(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),s=Sx(Ko(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(r,s)}function eB(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}nn({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Ks.isObject(n))return null;const t=Zt(e,i=>Object.assign(Object.assign({},eh(i)),{expanded:i.optional.boolean,picker:i.optional.custom(ZE),readonly:i.optional.constant(!1),x:i.optional.custom(zs),y:i.optional.object(Object.assign(Object.assign({},eh(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>YU,constraint:n=>JU(n.params,n.initialValue),equals:Ks.equals,writer:()=>ZU},controller:n=>{var e,t;const i=n.document,r=n.value,s=n.constraint,o=[n.params.x,n.params.y];return new qU(i,{axes:r.rawValue.getComponents().map((a,l)=>{var c;return Uv({constraint:s.components[l],initialValue:a,params:Ko(n.params,(c=o[l])!==null&&c!==void 0?c:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:eB(n.params),max:QU(n.params,r.rawValue),parser:tr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:r,viewProps:n.viewProps})}});let sl=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(kt(e))return!1;const t=e.x,i=e.y,r=e.z;return!(typeof t!="number"||typeof i!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const wC={toComponents:n=>n.getComponents(),fromComponents:n=>new sl(...n)};function tB(n){return sl.isObject(n)?new sl(n.x,n.y,n.z):new sl}function nB(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function iB(n,e){return new jd({assembly:wC,components:[Jr(Object.assign(Object.assign({},n),n.x),e.x),Jr(Object.assign(Object.assign({},n),n.y),e.y),Jr(Object.assign(Object.assign({},n),n.z),e.z)]})}nn({id:"input-point3d",type:"input",accept:(n,e)=>{if(!sl.isObject(n))return null;const t=Zt(e,i=>Object.assign(Object.assign({},eh(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(zs),y:i.optional.custom(zs),z:i.optional.custom(zs)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>tB,constraint:n=>iB(n.params,n.initialValue),equals:sl.equals,writer:n=>nB},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new Bl(n.document,{assembly:wC,axes:e.rawValue.getComponents().map((r,s)=>{var o;return Uv({constraint:t.components[s],initialValue:r,params:Ko(n.params,(o=i[s])!==null&&o!==void 0?o:{})})}),parser:tr,value:e,viewProps:n.viewProps})}});let ol=class{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.z=i,this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(kt(e))return!1;const t=e.x,i=e.y,r=e.z,s=e.w;return!(typeof t!="number"||typeof i!="number"||typeof r!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const yC={toComponents:n=>n.getComponents(),fromComponents:n=>new ol(...n)};function rB(n){return ol.isObject(n)?new ol(n.x,n.y,n.z,n.w):new ol}function sB(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function oB(n,e){return new jd({assembly:yC,components:[Jr(Object.assign(Object.assign({},n),n.x),e.x),Jr(Object.assign(Object.assign({},n),n.y),e.y),Jr(Object.assign(Object.assign({},n),n.z),e.z),Jr(Object.assign(Object.assign({},n),n.w),e.w)]})}nn({id:"input-point4d",type:"input",accept:(n,e)=>{if(!ol.isObject(n))return null;const t=Zt(e,i=>Object.assign(Object.assign({},eh(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(zs),x:i.optional.custom(zs),y:i.optional.custom(zs),z:i.optional.custom(zs)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>rB,constraint:n=>oB(n.params,n.initialValue),equals:ol.equals,writer:n=>sB},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new Bl(n.document,{assembly:yC,axes:e.rawValue.getComponents().map((r,s)=>{var o;return Uv({constraint:t.components[s],initialValue:r,params:Ko(n.params,(o=i[s])!==null&&o!==void 0?o:{})})}),parser:tr,value:e,viewProps:n.viewProps})}});function aB(n){const e=[],t=Xv(n.options);return t&&e.push(t),new Ul(e)}nn({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Zt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom($d)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Zv,constraint:n=>aB(n.params),writer:n=>so},controller:n=>{const e=n.document,t=n.value,i=n.constraint,r=i&&Qc(i,zd);return r?new Sl(e,{props:new We({options:r.values.value("options")}),value:t,viewProps:n.viewProps}):new Hd(e,{parser:s=>s,props:We.fromObject({formatter:e0}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Sl?new Kv(n.controller):null}});const Mh={monitor:{defaultInterval:200,defaultRows:3}},Mx=Ke("mll");let lB=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Mx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(Mx("i")),i.style.height=`calc(var(${qE("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(r=>{r!==void 0&&i.push(this.formatter_(r))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},s_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new lB(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const Px=Ke("sgl");let cB=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Px()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Px("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},o_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new cB(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};nn({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Zt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Yv},controller:n=>{var e;return n.value.rawValue.length===1?new o_(n.document,{formatter:gx,value:n.value,viewProps:n.viewProps}):new s_(n.document,{formatter:gx,rows:(e=n.params.rows)!==null&&e!==void 0?e:Mh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let hB=class extends Bv{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Ss=Ke("grl");let uB=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ss()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(gn,"svg");i.classList.add(Ss("g")),i.style.height=`calc(var(${qE("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const r=e.createElementNS(gn,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;const s=e.createElement("div");s.classList.add(Ss("t"),Ke("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,r=this.props_.get("min"),s=this.props_.get("max"),o=[];this.value.rawValue.forEach((u,d)=>{if(u===void 0)return;const p=Ue(d,0,i,0,e),_=Ue(u,r,s,t,0);o.push([p,_].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const a=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){a.classList.remove(Ss("t","a"));return}const c=Ue(this.cursor_.rawValue,0,i,0,e),h=Ue(l,r,s,t,0);a.style.left=`${c}px`,a.style.top=`${h}px`,a.textContent=`${this.formatter_(l)}`,a.classList.contains(Ss("t","a"))||(a.classList.add(Ss("t","a"),Ss("t","in")),ed(a),a.classList.remove(Ss("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},a_=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=qt(-1),this.view=new uB(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Nd(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new ps(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return sr(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return or(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(Ue(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Ue(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function t0(n){return kt(n.format)?Sn(2):n.format}function dB(n){var e;return n.value.rawValue.length===1?new o_(n.document,{formatter:t0(n.params),value:n.value,viewProps:n.viewProps}):new s_(n.document,{formatter:t0(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Mh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function pB(n){var e,t,i;return new a_(n.document,{formatter:t0(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Mh.monitor.defaultRows,props:We.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function Tx(n){return n.view==="graph"}nn({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Zt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>Tx(n)?64:1,reader:n=>Iv},controller:n=>Tx(n.params)?pB(n):dB(n),api:n=>n.controller.valueController instanceof a_?new hB(n.controller):null});nn({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Zt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Zv},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new s_(n.document,{formatter:e0,rows:(e=n.params.rows)!==null&&e!==void 0?e:Mh.monitor.defaultRows,value:t,viewProps:n.viewProps}):new o_(n.document,{formatter:e0,value:t,viewProps:n.viewProps})}});class EC{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return(e=this.controller_.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller_.emitter.on(e,()=>{i(new ca(this))}),this}}class fB extends ca{constructor(e,t,i){super(e),this.cell=t,this.index=i}}class CC extends la{constructor(e){super(e),this.cellToApiMap_=new Map,this.emitter_=new Nn;const t=this.controller.valueController;t.cellControllers.forEach((i,r)=>{const s=new EC(i);this.cellToApiMap_.set(i,s),i.emitter.on("click",()=>{const o=r%t.size[0],a=Math.floor(r/t.size[0]);this.emitter_.emit("click",{event:new fB(this,s,[o,a])})})})}cell(e,t){const i=this.controller.valueController,r=i.cellControllers[t*i.size[0]+e];return this.cellToApiMap_.get(r)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r.event)}),this}}class SC{constructor(e,t){this.size=t.size;const[i,r]=this.size,s=[];for(let o=0;o<r;o++)for(let a=0;a<i;a++){const l=new HE(e,{props:We.fromObject(Object.assign({},t.cellConfig(a,o))),viewProps:Xo.create()});s.push(l)}this.cellCs_=s,this.viewProps=Xo.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(o=>{o.viewProps.set("disposed",!0)})}),this.view=new YE(e,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(o=>{this.view.element.appendChild(o.view.element)})}get cellControllers(){return this.cellCs_}}class Ax extends Eh{constructor(e,t){const i=t.valueController,r=new Vd(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:r.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=r}}const mB=nn({id:"buttongrid",type:"blade",accept(n){const e=Zt(n,t=>({cells:t.required.function,size:t.required.array(t.required.number),view:t.required.constant("buttongrid"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new Ax(n.document,{blade:n.blade,labelProps:We.fromObject({label:n.params.label}),valueController:new SC(n.document,{cellConfig:n.params.cells,size:n.params.size})})},api(n){return n.controller instanceof Ax?new CC(n.controller):null}});class MC extends la{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get value(){return this.controller.valueController.value.rawValue}set value(e){this.controller.valueController.value.rawValue=e}on(e,t){const i=t.bind(this);return this.controller.valueController.value.emitter.on(e,r=>{i(new Od(this,r.rawValue,r.options.last))}),this}}function Di(n,e,t){return n*(1-t)+e*t}const vB=20,_B=.001,ff=100;function gB(n,e){let t=.25,i=.5,r=-1;for(let s=0;s<vB;s++){const[o,a]=n.curve(i);if(i+=t*(o<e?1:-1),r=a,t*=.5,Math.abs(e-o)<_B)break}return r}class eo{constructor(e=0,t=0,i=1,r=1){this.cache_=[],this.comps_=[e,t,i,r]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(e){return kt(e)||!Array.isArray(e)?!1:typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="number"&&typeof e[3]=="number"}static equals(e,t){return e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2}curve(e){const t=Di(0,this.x1,e),i=Di(0,this.y1,e),r=Di(this.x1,this.x2,e),s=Di(this.y1,this.y2,e),o=Di(this.x2,1,e),a=Di(this.y2,1,e),l=Di(t,r,e),c=Di(i,s,e),h=Di(r,o,e),u=Di(s,a,e);return[Di(l,h,e),Di(c,u,e)]}y(e){if(this.cache_.length===0){const t=[];for(let i=0;i<ff;i++)t.push(gB(this,Ue(i,0,ff-1,0,1)));this.cache_=t}return this.cache_[Math.round(Ue(Bt(e,0,1),0,1,0,ff-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const l_={toComponents:n=>n.toObject(),fromComponents:n=>new eo(...n)};function bB(n){const e=Sn(2);return`cubic-bezier(${n.toObject().map(i=>e(i)).join(", ")})`}const Rx=[0,.5,.5,1];function xB(n){const e=n.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!e)return new eo(...Rx);const t=[e[1],e[2],e[3],e[4]].reduce((i,r)=>{if(!i)return null;const s=Number(r);return isNaN(s)?null:[...i,s]},[]);return new eo(...t??Rx)}const xo=Ke("cbz");class PC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xo()),t.viewProps.bindClassModifiers(this.element),t.foldable.bindExpandedClass(this.element,xo(void 0,"expanded")),Gi(t.foldable,"completed",ro(this.element,xo(void 0,"cpl")));const i=e.createElement("div");i.classList.add(xo("h")),this.element.appendChild(i);const r=e.createElement("button");r.classList.add(xo("b")),t.viewProps.bindDisabled(r);const s=e.createElementNS(gn,"svg");s.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',r.appendChild(s),i.appendChild(r),this.buttonElement=r;const o=e.createElement("div");if(o.classList.add(xo("t")),i.appendChild(o),this.textElement=o,t.pickerLayout==="inline"){const a=e.createElement("div");a.classList.add(xo("p")),this.element.appendChild(a),this.pickerElement=a}else this.pickerElement=null}}const mf=Ke("cbzp");class TC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mf()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(mf("g")),this.element.appendChild(i),this.graphElement=i;const r=e.createElement("div");r.classList.add(mf("t")),this.element.appendChild(r),this.textElement=r}}function AC(n,e){const t=new MutationObserver(r=>{for(const s of r)s.type==="childList"&&s.addedNodes.forEach(o=>{o.contains(o)&&(e(),t.disconnect())})}),i=n.ownerDocument;t.observe(i.body,{attributes:!0,childList:!0,subtree:!0})}const Ms=Ke("cbzg");function wB(n,e){return t=>e(n(t))}class RC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ms()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Ms("p")),this.element.appendChild(i),this.previewElement=i;const r=e.createElementNS(gn,"svg");r.classList.add(Ms("g")),this.element.appendChild(r),this.svgElem_=r;const s=e.createElementNS(gn,"path");s.classList.add(Ms("u")),this.svgElem_.appendChild(s),this.guideElem_=s;const o=e.createElementNS(gn,"polyline");o.classList.add(Ms("l")),this.svgElem_.appendChild(o),this.lineElem_=o,this.handleElems_=[e.createElement("div"),e.createElement("div")],this.handleElems_.forEach(a=>{a.classList.add(Ms("h")),this.element.appendChild(a)}),this.vectorElems_=[e.createElementNS(gn,"line"),e.createElementNS(gn,"line")],this.vectorElems_.forEach(a=>{a.classList.add(Ms("v")),this.svgElem_.appendChild(a)}),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=t.selection,this.handleElems_.forEach((a,l)=>{$i(this.sel_,wB(c=>c===l,ro(a,Ms("h","sel"))))}),AC(this.element,()=>{this.refresh()})}getVertMargin_(e){return e*.25}valueToPosition(e,t){const{clientWidth:i,clientHeight:r}=this.element,s=this.getVertMargin_(r);return{x:Ue(e,0,1,0,i),y:Ue(t,0,1,r-s,s)}}positionToValue(e,t){const i=this.element.getBoundingClientRect(),r=i.width,s=i.height,o=this.getVertMargin_(s);return{x:Bt(Ue(e,0,r,0,1),0,1),y:Ue(t,s-o,o,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(s=>{const o=this.valueToPosition(0,s),a=this.valueToPosition(1,s);return[`M ${o.x},${o.y}`,`L ${a.x},${a.y}`].join(" ")}).join(" "));const e=this.value_.rawValue,t=[];let i=0;for(;;){const s=this.valueToPosition(...e.curve(i));if(t.push([s.x,s.y].join(",")),i>=1)break;i=Math.min(i+.05,1)}this.lineElem_.setAttributeNS(null,"points",t.join(" "));const r=e.toObject();[0,1].forEach(s=>{const o=this.valueToPosition(s,s),a=this.valueToPosition(r[s*2],r[s*2+1]),l=this.vectorElems_[s];l.setAttributeNS(null,"x1",String(o.x)),l.setAttributeNS(null,"y1",String(o.y)),l.setAttributeNS(null,"x2",String(a.x)),l.setAttributeNS(null,"y2",String(a.y));const c=this.handleElems_[s];c.style.left=`${a.x}px`,c.style.top=`${a.y}px`})}onValueChange_(){this.refresh()}}const Lx=24,Dx=400,kx=1e3,Va=Ke("cbzprv");class LC{constructor(e,t){this.stopped_=!0,this.startTime_=-1,this.requestId_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Va()),t.viewProps.bindClassModifiers(this.element);const i=e.createElementNS(gn,"svg");i.classList.add(Va("g")),this.element.appendChild(i),this.svgElem_=i;const r=e.createElementNS(gn,"path");r.classList.add(Va("t")),this.svgElem_.appendChild(r),this.ticksElem_=r;const s=e.createElement("div");s.classList.add(Va("m")),this.element.appendChild(s),this.markerElem_=s,this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.viewProps.handleDispose(this.onDispose_),AC(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(Va("m","a")),this.startTime_=new Date().getTime()+Dx,this.stopped_=!1,this.requestId_=requestAnimationFrame(this.onTimer_)}stop(){cancelAnimationFrame(this.requestId_),this.stopped_=!0,this.markerElem_.classList.remove(Va("m","a"))}onDispose_(){this.stop()}updateMarker_(e){const t=this.value_.rawValue.y(Bt(e,0,1));this.markerElem_.style.left=`${t*100}%`}refresh(){const{clientWidth:e,clientHeight:t}=this.svgElem_,i=[],r=this.value_.rawValue;for(let s=0;s<Lx;s++){const o=Ue(s,0,Lx-1,0,1),a=Ue(r.y(o),0,1,0,e);i.push(`M ${a},0 v${t}`)}this.ticksElem_.setAttributeNS(null,"d",i.join(" "))}onTimer_(){if(this.startTime_===null)return;const e=new Date().getTime()-this.startTime_,t=e/kx;this.updateMarker_(t),e>kx+Dx&&this.stop(),this.stopped_||(this.requestId_=requestAnimationFrame(this.onTimer_))}onValueChange_(){this.refresh(),this.play()}}function n0(n,e,t,i){const r=t-n,s=i-e;return Math.sqrt(r*r+s*s)}function yB(n,e,t,i){const r=n0(n,e,t,i),s=Math.atan2(i-e,t-n),o=Math.round(s/(Math.PI/4))*Math.PI/4;return{x:n+Math.cos(o)*r,y:e+Math.sin(o)*r}}class DC{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.keyScale_=t.keyScale,this.value=t.value,this.sel_=qt(0),this.viewProps=t.viewProps,this.view=new RC(e,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new LC(e,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",r=>{r.stopImmediatePropagation(),r.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const i=new ps(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(e,t,i){const r=this.sel_.rawValue,s=this.value.rawValue.toObject(),o=this.view.positionToValue(e.x,e.y),a=t?yB(r,r,o.x,o.y):o;s[r*2]=a.x,s[r*2+1]=a.y,this.value.setRawValue(new eo(...s),i)}onPointerDown_(e){const t=e.data;if(!t.point)return;const i=this.value.rawValue,r=this.view.valueToPosition(i.x1,i.y1),s=n0(t.point.x,t.point.y,r.x,r.y),o=this.view.valueToPosition(i.x2,i.y2),a=n0(t.point.x,t.point.y,o.x,o.y);this.sel_.rawValue=s<=a?0:1,this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(e){id(e.key)&&e.preventDefault();const t=this.sel_.rawValue,i=this.value.rawValue.toObject(),r=this.keyScale_.rawValue;i[t*2]+=bn(r,nr(e)),i[t*2+1]+=bn(r,qo(e)),this.value.setRawValue(new eo(...i),{forceEmit:!1,last:!1})}onKeyUp_(e){id(e.key)&&e.preventDefault();const t=this.keyScale_.rawValue,i=bn(t,nr(e)),r=bn(t,qo(e));i===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class kC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new TC(e,{viewProps:this.viewProps}),this.gc_=new DC(e,{keyScale:t.axis.textProps.value("keyScale"),value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const i=Object.assign(Object.assign({},t.axis),{constraint:new Lv({max:1,min:0})}),r=Object.assign(Object.assign({},t.axis),{constraint:void 0});this.tc_=new Bl(e,{assembly:l_,axes:[i,r,i,r],parser:tr,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(e=>e.inputElement)]}refresh(){this.gc_.refresh()}}class i0{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Ud.create(t.expanded),this.view=new PC(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new Hd(e,{parser:xB,props:We.fromObject({formatter:bB}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=t.pickerLayout==="popup"?new qv(e,{viewProps:this.viewProps}):null;const i=new kC(e,{axis:t.axis,value:this.value,viewProps:this.viewProps});i.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),$i(this.popC_.shows,r=>{r&&i.refresh()}),ha({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,s)=>s})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Bd(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=e.relatedTarget;(!t||!this.popC_.view.element.contains(t))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=$v(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Nd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_&&e.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function EB(){return new jd({assembly:l_,components:[0,1,2,3].map(n=>n%2===0?new Lv({min:0,max:1}):void 0)})}const CB=nn({id:"cubicbezier",type:"blade",accept(n){const e=Zt(n,t=>({value:t.required.array(t.required.number),view:t.required.constant("cubicbezier"),expanded:t.optional.boolean,label:t.optional.string,picker:t.optional.custom(i=>i==="inline"||i==="popup"?i:void 0)}));return e?{params:e}:null},controller(n){var e,t;const i=new eo(...n.params.value),r=qt(i,{constraint:EB(),equals:eo.equals}),s=new i0(n.document,{axis:{textProps:We.fromObject({keyScale:.1,pointerScale:.01,formatter:Sn(2)})},expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:r,viewProps:n.viewProps});return new td(n.document,{blade:n.blade,props:We.fromObject({label:n.params.label}),value:r,valueController:s})},api(n){return!(n.controller instanceof td)||!(n.controller.valueController instanceof i0)?null:new MC(n.controller)}});class IC extends la{get fps(){return this.controller.valueController.fps}get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}begin(){this.controller.valueController.begin()}end(){this.controller.valueController.end()}on(e,t){const i=t.bind(this);return this.controller.valueController.ticker.emitter.on(e,()=>{i(new ca(this))}),this}}const Ix=20;class OC{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(e){this.start_=e.getTime()}calculateFps_(e){if(this.timestamps_.length===0)return null;const t=this.timestamps_[0];return 1e3*(this.frameCount_-t.frameCount)/(e-t.time)}compactTimestamps_(){if(this.timestamps_.length<=Ix)return;const e=this.timestamps_.length-Ix;this.timestamps_.splice(0,e);const t=this.timestamps_[0].frameCount;this.timestamps_.forEach(i=>{i.frameCount-=t}),this.frameCount_-=t}end(e){if(this.start_===null)return;const t=e.getTime();this.duration_=t-this.start_,this.start_=null,this.fps_=this.calculateFps_(t),this.timestamps_.push({frameCount:this.frameCount_,time:t}),++this.frameCount_,this.compactTimestamps_()}}const hc=Ke("fps");class NC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(hc()),t.viewProps.bindClassModifiers(this.element),this.graphElement=e.createElement("div"),this.graphElement.classList.add(hc("g")),this.element.appendChild(this.graphElement);const i=e.createElement("div");i.classList.add(hc("l")),this.element.appendChild(i);const r=e.createElement("span");r.classList.add(hc("v")),r.textContent="--",i.appendChild(r),this.valueElement=r;const s=e.createElement("span");s.classList.add(hc("u")),s.textContent="FPS",i.appendChild(s)}}class FC{constructor(e,t){this.stopwatch_=new OC,this.onTick_=this.onTick_.bind(this),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.props=t.props,this.value_=t.value,this.viewProps=t.viewProps,this.view=new NC(e,{viewProps:this.viewProps}),this.graphC_=new a_(e,{formatter:Sn(0),props:this.props,rows:t.rows,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker.dispose()})}get fps(){return this.stopwatch_.fps}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const e=this.fps;if(e!==null){const t=this.value_.rawValue;this.value_.rawValue=OF(t,e),this.view.valueElement.textContent=e.toFixed(0)}}}class Ox extends Eh{constructor(e,t){const i=t.valueController,r=new Vd(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:r.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=r}}function SB(n,e){return e===0?new lV:new cV(n,e??Mh.monitor.defaultInterval)}const MB=nn({id:"fpsgraph",type:"blade",accept(n){const e=Zt(n,t=>({view:t.required.constant("fpsgraph"),interval:t.optional.number,label:t.optional.string,rows:t.optional.number,max:t.optional.number,min:t.optional.number}));return e?{params:e}:null},controller(n){var e,t,i,r;const s=(e=n.params.interval)!==null&&e!==void 0?e:500;return new Ox(n.document,{blade:n.blade,labelProps:We.fromObject({label:n.params.label}),valueController:new FC(n.document,{props:We.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:90,min:(i=n.params.min)!==null&&i!==void 0?i:0}),rows:(r=n.params.rows)!==null&&r!==void 0?r:2,ticker:SB(n.document,s),value:qt(kF(80)),viewProps:n.viewProps})})},api(n){return n.controller instanceof Ox?new IC(n.controller):null}});class yi{constructor(e,t){this.min=e,this.max=t}static isObject(e){if(typeof e!="object"||e===null)return!1;const t=e.min,i=e.max;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.min===t.min&&e.max===t.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const c_={fromComponents:n=>new yi(n[0],n[1]),toComponents:n=>[n.min,n.max]};class h_{constructor(e){this.edge=e}constrain(e){var t,i,r,s,o,a,l,c;if(e.min<=e.max)return new yi((i=(t=this.edge)===null||t===void 0?void 0:t.constrain(e.min))!==null&&i!==void 0?i:e.min,(s=(r=this.edge)===null||r===void 0?void 0:r.constrain(e.max))!==null&&s!==void 0?s:e.max);const h=(e.min+e.max)/2;return new yi((a=(o=this.edge)===null||o===void 0?void 0:o.constrain(h))!==null&&a!==void 0?a:h,(c=(l=this.edge)===null||l===void 0?void 0:l.constrain(h))!==null&&c!==void 0?c:h)}}const vf=Ke("rsltxt");class VC{constructor(e,t){this.sliderView_=t.sliderView,this.textView_=t.textView,this.element=e.createElement("div"),this.element.classList.add(vf());const i=e.createElement("div");i.classList.add(vf("s")),i.appendChild(this.sliderView_.element),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(vf("t")),r.appendChild(this.textView_.element),this.element.appendChild(r)}}const wo=Ke("rsl");class UC{constructor(e,t){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=t.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=e.createElement("div"),this.element.classList.add(wo()),t.viewProps.bindClassModifiers(this.element),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_);const i=e.createElement("div");i.classList.add(wo("t")),this.element.appendChild(i),this.trackElement=i;const r=e.createElement("div");r.classList.add(wo("b")),i.appendChild(r),this.barElement=r;const s=["min","max"].map(o=>{const a=e.createElement("div");return a.classList.add(wo("k"),wo("k",o)),i.appendChild(a),a});this.knobElements=[s[0],s[1]],this.update_()}valueToX_(e){const t=this.sliderProps_.get("min"),i=this.sliderProps_.get("max");return Bt(Ue(e,t,i,0,1),0,1)*100}update_(){const e=this.value_.rawValue;e.length===0?this.element.classList.add(wo(void 0,"zero")):this.element.classList.remove(wo(void 0,"zero"));const t=[this.valueToX_(e.min),this.valueToX_(e.max)];this.barElement.style.left=`${t[0]}%`,this.barElement.style.right=`${100-t[1]}%`,this.knobElements.forEach((i,r)=>{i.style.left=`${t[r]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class BC{constructor(e,t){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=t.sliderProps,this.viewProps=t.viewProps,this.value=t.value,this.view=new UC(e,{sliderProps:this.sliderProps,value:this.value,viewProps:t.viewProps});const i=new ps(this.view.trackElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(e){if(!e.point)return null;const t=(e.point.x+this.ofs_())/e.bounds.width,i=this.sliderProps.get("min"),r=this.sliderProps.get("max");return Ue(t,0,1,i,r)}onPointerDown_(e){if(!e.data.point)return;const t=e.data.point.x/e.data.bounds.width,i=this.value.rawValue,r=this.sliderProps.get("min"),s=this.sliderProps.get("max"),o=Ue(i.min,r,s,0,1),a=Ue(i.max,r,s,0,1);Math.abs(a-t)<=.025?this.grabbing_="max":Math.abs(o-t)<=.025?this.grabbing_="min":t>=o&&t<=a?(this.grabbing_="length",this.grabOffset_=Ue(t-o,0,1,0,s-r)):t<o?(this.grabbing_="min",this.onPointerMove_(e)):t>a&&(this.grabbing_="max",this.onPointerMove_(e))}applyPointToValue_(e,t){const i=this.valueFromData_(e);if(i===null)return;const r=this.sliderProps.get("min"),s=this.sliderProps.get("max");if(this.grabbing_==="min")this.value.setRawValue(new yi(i,this.value.rawValue.max),t);else if(this.grabbing_==="max")this.value.setRawValue(new yi(this.value.rawValue.min,i),t);else if(this.grabbing_==="length"){const o=this.value.rawValue.length;let a=i-this.grabOffset_,l=a+o;a<r?(a=r,l=r+o):l>s&&(a=s-o,l=s),this.value.setRawValue(new yi(a,l),t)}}onPointerMove_(e){this.applyPointToValue_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.applyPointToValue_(e.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class zC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sc_=new BC(e,t);const i={constraint:t.constraint,textProps:t.textProps};this.tc_=new Bl(e,{assembly:c_,axes:[i,i],parser:t.parser,value:this.value,viewProps:t.viewProps}),this.view=new VC(e,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function PB(n){return yi.isObject(n)?new yi(n.min,n.max):new yi(0,0)}function TB(n,e){n.writeProperty("max",e.max),n.writeProperty("min",e.min)}function AB(n){const e=[],t=Nv(n);t&&e.push(t);const i=Ov(n);return i&&e.push(i),new h_(new Ul(e))}const RB=nn({id:"input-interval",type:"input",accept:(n,e)=>{if(!yi.isObject(n))return null;const t=Zt(e,i=>Object.assign(Object.assign({},Vv(i)),{readonly:i.optional.constant(!1)}));return t?{initialValue:new yi(n.min,n.max),params:t}:null},binding:{reader:n=>PB,constraint:n=>AB(n.params),equals:yi.equals,writer:n=>TB},controller(n){const e=n.value,t=n.constraint;if(!(t instanceof h_))throw us.shouldNeverHappen();const i=(e.rawValue.min+e.rawValue.max)/2,r=We.fromObject(Fv(n.params,i)),s=t.edge&&Qc(t.edge,yh);if(s)return new zC(n.document,{constraint:t.edge,parser:tr,sliderProps:new We({keyScale:r.value("keyScale"),max:s.values.value("max"),min:s.values.value("min")}),textProps:r,value:e,viewProps:n.viewProps});const o={constraint:t.edge,textProps:r};return new Bl(n.document,{assembly:c_,axes:[o,o],parser:tr,value:e,viewProps:n.viewProps})}});class $C{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return(e=this.controller_.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.props.set("title",e)}}class HC extends Od{constructor(e,t,i,r,s){super(e,r,s),this.cell=t,this.index=i}}class GC extends la{constructor(e){super(e),this.cellToApiMap_=new Map,this.controller.valueController.cellControllers.forEach(i=>{const r=new $C(i);this.cellToApiMap_.set(i,r)})}get value(){return this.controller.value}cell(e,t){const i=this.controller.valueController,r=i.cellControllers[t*i.size[0]+e];return this.cellToApiMap_.get(r)}on(e,t){const i=t.bind(this);this.controller.value.emitter.on(e,r=>{const s=this.controller.valueController,o=s.findCellByValue(r.rawValue);if(!o)return;const a=this.cellToApiMap_.get(o);if(!a)return;const l=s.cellControllers.indexOf(o);i(new HC(this,a,[l%s.size[0],Math.floor(l/s.size[0])],r.rawValue))})}}const uc=Ke("rad");class jC{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(uc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(uc("l")),this.element.appendChild(i);const r=e.createElement("input");r.classList.add(uc("i")),r.name=t.name,r.type="radio",t.viewProps.bindDisabled(r),i.appendChild(r),this.inputElement=r;const s=e.createElement("div");s.classList.add(uc("b")),i.appendChild(s);const o=e.createElement("div");o.classList.add(uc("t")),s.appendChild(o),Gi(t.props,"title",a=>{o.textContent=a})}}class WC{constructor(e,t){this.props=t.props,this.viewProps=t.viewProps,this.view=new jC(e,{name:t.name,props:this.props,viewProps:this.viewProps})}}class rd{constructor(e,t){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=t.size;const[i,r]=this.size;for(let s=0;s<r;s++)for(let o=0;o<i;o++){const a=new WC(e,{name:t.groupName,props:We.fromObject(Object.assign({},t.cellConfig(o,s))),viewProps:Xo.create()});this.cellCs_.push(a),this.cellValues_.push(t.cellConfig(o,s).value)}this.value=t.value,$i(this.value,s=>{const o=this.findCellByValue(s);o&&(o.view.inputElement.checked=!0)}),this.viewProps=Xo.create(),this.view=new YE(e,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(s=>{s.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(s.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(e){const t=this.cellValues_.findIndex(i=>i===e);return t<0?null:this.cellCs_[t]}onCellInputChange_(e){const t=e.currentTarget,i=this.cellCs_.findIndex(r=>r.view.inputElement===t);i<0||(this.value.rawValue=this.cellValues_[i])}}const LB=(function(){return nn({id:"radiogrid",type:"blade",accept(n){const e=Zt(n,t=>({cells:t.required.function,groupName:t.required.string,size:t.required.array(t.required.number),value:t.required.raw,view:t.required.constant("radiogrid"),label:t.optional.string}));return e?{params:e}:null},controller(n){const e=qt(n.params.value);return new td(n.document,{blade:n.blade,props:We.fromObject({label:n.params.label}),value:e,valueController:new rd(n.document,{groupName:n.params.groupName,cellConfig:n.params.cells,size:n.params.size,value:e})})},api(n){return!(n.controller instanceof td)||!(n.controller.valueController instanceof rd)?null:new GC(n.controller)}})})();function u_(n){return nn({id:"input-radiogrid",type:"input",accept(e,t){if(!n.isType(e))return null;const i=Zt(t,r=>({cells:r.required.function,groupName:r.required.string,size:r.required.array(r.required.number),view:r.required.constant("radiogrid")}));return i?{initialValue:e,params:i}:null},binding:n.binding,controller:e=>new rd(e.document,{cellConfig:e.params.cells,groupName:e.params.groupName,size:e.params.size,value:e.value})})}const DB=u_({isType:n=>typeof n=="number",binding:{reader:n=>Iv,writer:n=>so}}),kB=u_({isType:n=>typeof n=="string",binding:{reader:n=>Zv,writer:n=>so}}),IB=u_({isType:n=>typeof n=="boolean",binding:{reader:n=>Yv,writer:n=>so}}),OB="essentials",NB='.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--cnt-usp);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-cbzpv_t{margin-top:var(--cnt-usp)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--cnt-usz)*5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--cnt-usz));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--cnt-usz) - 8px);margin-top:calc((var(--cnt-usz) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',FB=[mB,CB,MB,RB,LB,IB,DB,kB],VB=Object.freeze(Object.defineProperty({__proto__:null,ButtonCellApi:EC,ButtonGridApi:CC,ButtonGridController:SC,CubicBezier:eo,CubicBezierApi:MC,CubicBezierAssembly:l_,CubicBezierController:i0,CubicBezierGraphController:DC,CubicBezierGraphView:RC,CubicBezierPickerController:kC,CubicBezierPickerView:TC,CubicBezierPreviewView:LC,CubicBezierView:PC,FpsGraphBladeApi:IC,FpsGraphController:FC,FpsView:NC,Fpswatch:OC,Interval:yi,IntervalAssembly:c_,IntervalConstraint:h_,RadioCellApi:$C,RadioController:WC,RadioGridApi:GC,RadioGridController:rd,RadioView:jC,RangeSliderController:BC,RangeSliderTextController:zC,RangeSliderTextView:VC,RangeSliderView:UC,TpRadioGridChangeEvent:HC,css:NB,id:OB,plugins:FB},Symbol.toStringTag,{value:"Module"}));function zt(n){return n==null}function Wd(n){return n!==null&&typeof n=="object"}function r0(n){return n!==null&&typeof n=="object"}function UB(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Zo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,r)=>{const s=n[r],o=e[r];return r0(s)&&r0(o)?Object.assign(Object.assign({},i),{[r]:Zo(s,o)}):Object.assign(Object.assign({},i),{[r]:r in e?o:s})},{})}function BB(n){return Wd(n)?"target"in n:!1}const zB={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class vi{static alreadyDisposed(){return new vi({type:"alreadydisposed"})}static notBindable(){return new vi({type:"notbindable"})}static notCompatible(e,t){return new vi({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new vi({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new vi({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=zB[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class sd{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!sd.isBindable(i))throw vi.notBindable();if(!(e in i))throw vi.propertyNotFound(e);i[e]=t}}class Pi{constructor(){this.observers_={}}on(e,t,i){var r;let s=this.observers_[e];return s||(s=this.observers_[e]=[]),s.push({handler:t,key:(r=i?.key)!==null&&r!==void 0?r:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(r=>r.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(r=>{r.handler(t)})}}class $B{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:((r,s)=>r===s),this.emitter=new Pi,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},r=this.constraint_?this.constraint_.constrain(e):e,s=this.rawValue_;this.equals_(s,r)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=r,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:r,sender:this}))}}class HB{constructor(e){this.emitter=new Pi,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},r=this.value_;r===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:this.value_,sender:this}))}}class GB{constructor(e){this.emitter=new Pi,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function Yt(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new HB(n):new $B(n,e)}function jB(n){return[new GB(n),(e,t)=>{n.setRawValue(e,t)}]}class rt{constructor(e){this.emitter=new Pi,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,r)=>Object.assign(i,{[r]:Yt(e[r])}),{})}static fromObject(e){const t=this.createCore(e);return new rt(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class Jo{constructor(e){this.values=rt.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}}class WB{constructor(e){this.values=rt.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let r=e;return zt(i)||(r=Math.max(r,i)),zt(t)||(r=Math.min(r,t)),r}}class KB{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}}class XB{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const qB={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};class YB{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=qB[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ZB={"+":n=>n,"-":n=>-n,"~":n=>~n};class JB{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=ZB[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function d_(n){return(e,t)=>{for(let i=0;i<n.length;i++){const r=n[i](e,t);if(r!=="")return r}return""}}function th(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function QB(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function nh(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function e4(n,e){const t=nh(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const r=nh(n,e);return r===""?"":i+r}function p_(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=e4(n,e);return i===""?"":t+i}function KC(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=QB(n,e);return e+=i.length,i===""?"":i+nh(n,e)}function t4(n,e){const t=KC(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const r=nh(n,e);return e+=r.length,t+i+r+p_(n,e)}function n4(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=nh(n,e);return e+=i.length,i===""?"":t+i+p_(n,e)}function i4(n,e){const t=KC(n,e);return e+=t.length,t===""?"":t+p_(n,e)}const r4=d_([t4,n4,i4]);function s4(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function o4(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=s4(n,e);return i===""?"":t+i}function a4(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function l4(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=a4(n,e);return i===""?"":t+i}function c4(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function h4(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=c4(n,e);return i===""?"":t+i}const u4=d_([o4,l4,h4]),d4=d_([u4,r4]);function p4(n,e){const t=d4(n,e);return e+=t.length,t===""?null:{evaluable:new XB(t),cursor:e}}function f4(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=qC(n,e);if(!i)return null;e=i.cursor,e+=th(n,e).length;const r=n.substr(e,1);return e+=r.length,r!==")"?null:{evaluable:i.evaluable,cursor:e}}function m4(n,e){var t;return(t=p4(n,e))!==null&&t!==void 0?t:f4(n,e)}function XC(n,e){const t=m4(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const r=XC(n,e);return r?(e=r.cursor,{cursor:e,evaluable:new JB(i,r.evaluable)}):null}function v4(n,e,t){t+=th(e,t).length;const i=n.filter(r=>e.startsWith(r,t))[0];return i?(t+=i.length,t+=th(e,t).length,{cursor:t,operator:i}):null}function _4(n,e){return(t,i)=>{const r=n(t,i);if(!r)return null;i=r.cursor;let s=r.evaluable;for(;;){const o=v4(e,t,i);if(!o)break;i=o.cursor;const a=n(t,i);if(!a)return null;i=a.cursor,s=new YB(o.operator,s,a.evaluable)}return s?{cursor:i,evaluable:s}:null}}const g4=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>_4(n,e),XC);function qC(n,e){return e+=th(n,e).length,g4(n,e)}function b4(n){const e=qC(n,0);return!e||e.cursor+th(n,e.cursor).length!==n.length?null:e.evaluable}function Ar(n){var e;const t=b4(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function YC(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Ar(n);if(!zt(e))return e}return 0}function On(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function Le(n,e,t,i,r){const s=(n-e)/(t-e);return i+s*(r-i)}function Nx(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Tt(n,e,t){return Math.min(Math.max(n,e),t)}function ZC(n,e){return(n%e+e)%e}function x4(n,e){return zt(n.step)?Math.max(Nx(e),2):Nx(n.step)}function JC(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function w4(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function QC(n,e){return zt(n.step)?null:new KB(n.step,e)}function eS(n){return!zt(n.max)&&!zt(n.min)?new Jo({max:n.max,min:n.min}):!zt(n.max)||!zt(n.min)?new WB({max:n.max,min:n.min}):null}function tS(n,e){var t,i,r;return{formatter:(t=n.format)!==null&&t!==void 0?t:On(x4(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:JC(n),pointerScale:(r=n.pointerScale)!==null&&r!==void 0?r:w4(n,e)}}function nS(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function f_(n){return{constraint:n.constraint,textProps:rt.fromObject(tS(n.params,n.initialValue))}}class m_{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class Kd{constructor(e){this.target=e}}class iS extends Kd{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}}class y4 extends Kd{constructor(e,t){super(e),this.expanded=t}}class E4 extends Kd{constructor(e,t){super(e),this.index=t}}class C4 extends Kd{constructor(e,t){super(e),this.native=t}}class v_ extends m_{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Pi,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new iS(this,t.binding.target.read(),e.options.last))}}function S4(n,e){const i=Object.keys(e).reduce((r,s)=>{if(r===void 0)return;const o=e[s],a=o(n[s]);return a.succeeded?Object.assign(Object.assign({},r),{[s]:a.value}):void 0},{});return i}function M4(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const r=e(i);if(!(!r.succeeded||r.value===void 0))return[...t,r.value]},[])}function P4(n){return n===null?!1:typeof n=="object"}function Wr(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function Fx(n){return{custom:e=>Wr(e)(n),boolean:Wr(e=>typeof e=="boolean"?e:void 0)(n),number:Wr(e=>typeof e=="number"?e:void 0)(n),string:Wr(e=>typeof e=="string"?e:void 0)(n),function:Wr(e=>typeof e=="function"?e:void 0)(n),constant:e=>Wr(t=>t===e?e:void 0)(n),raw:Wr(e=>e)(n),object:e=>Wr(t=>{if(P4(t))return S4(t,e)})(n),array:e=>Wr(t=>{if(Array.isArray(t))return M4(t,e)})(n)}}const s0={optional:Fx(!0),required:Fx(!1)};function Mn(n,e){const t=e(s0),i=s0.required.object(t)(n);return i.succeeded?i.value:void 0}function Dr(n,e,t,i){if(e&&!e(n))return!1;const r=Mn(n,t);return r?i(r):!1}function kr(n,e){var t;return Zo((t=n?.())!==null&&t!==void 0?t:{},e)}function ku(n){return"value"in n}function T4(n){if(!Wd(n)||!("binding"in n))return!1;const e=n.binding;return BB(e)}const gr="http://www.w3.org/2000/svg";function od(n){n.offsetHeight}function A4(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Xd(n){return n.ontouchstart!==void 0}function rS(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const R4={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ph(n,e){const t=n.createElementNS(gr,"svg");return t.innerHTML=R4[e],t}function sS(n,e,t){n.insertBefore(e,n.children[t])}function __(n){n.parentElement&&n.parentElement.removeChild(n)}function g_(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function L4(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function b_(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function yr(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function ir(n,e,t){yr(n.value(e),t)}const D4="tp";function Xe(n){return(t,i)=>[D4,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const dc=Xe("lbl");function k4(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(r=>n.createTextNode(r)).forEach((r,s)=>{s>0&&t.appendChild(n.createElement("br")),t.appendChild(r)}),t}class I4{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(dc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(dc("l")),ir(t.props,"label",s=>{zt(s)?this.element.classList.add(dc(void 0,"nol")):(this.element.classList.remove(dc(void 0,"nol")),L4(i),i.appendChild(k4(e,s)))}),this.element.appendChild(i),this.labelElement=i;const r=e.createElement("div");r.classList.add(dc("v")),this.element.appendChild(r),this.valueElement=r}}class O4{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new I4(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Dr(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return kr(null,{label:this.props.get("label")})}}function N4(){return["veryfirst","first","last","verylast"]}const Vx=Xe(""),Ux={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class oS{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{N4().forEach(i=>{t.classList.remove(Vx(void 0,Ux[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(Vx(void 0,Ux[i]))})}),this.viewProps.handleDispose(()=>{__(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Dr(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return kr(null,Object.assign({},this.viewProps.exportState()))}}class F4 extends m_{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,s=>{i(new C4(this,s.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}}function V4(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function ua(n,e){return t=>{V4(n,e,t)}}function x_(n,e){yr(n,t=>{e.textContent=t??""})}const _f=Xe("btn");class U4{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(_f()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(_f("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const r=e.createElement("div");r.classList.add(_f("t")),x_(t.props.value("title"),r),this.buttonElement.appendChild(r)}}class B4{constructor(e,t){this.emitter=new Pi,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new U4(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Dr(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return kr(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}}class Bx extends oS{constructor(e,t){const i=new B4(e,{props:t.buttonProps,viewProps:t.viewProps}),r=new O4(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:r.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=r}importState(e){return Dr(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return kr(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class z4{constructor(e){const[t,i]=e.split("-"),r=t.split(".");this.major=parseInt(r[0],10),this.minor=parseInt(r[1],10),this.patch=parseInt(r[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const $4=new z4("2.0.5");function Fn(n){return Object.assign({core:$4},n)}Fn({id:"button",type:"blade",accept(n){const e=Mn(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new Bx(n.document,{blade:n.blade,buttonProps:rt.fromObject({title:n.params.title}),labelProps:rt.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof Bx?new F4(n.controller):null}});function H4(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function G4(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function j4(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function W4(n){return Wd(n)?"refresh"in n&&typeof n.refresh=="function":!1}function K4(n,e){if(!sd.isBindable(n))throw vi.notBindable();return new sd(n,e)}class X4{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Pi,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const r=i??{},s=this.controller_.element.ownerDocument,o=this.pool_.createBinding(s,K4(e,t),r),a=this.pool_.createBindingApi(o);return this.add(a,r.index)}addFolder(e){return G4(this,e)}addButton(e){return H4(this,e)}addTab(e){return j4(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),r=this.pool_.createApi(i);return this.add(r,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{W4(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),r=T4(t.value)?t.value.binding:null;this.emitter_.emit("change",new iS(i,r?r.target.read():t.value.rawValue,e.options.last))}}class w_ extends m_{constructor(e,t){super(e),this.rackApi_=new X4(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class y_ extends oS{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Dr(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,r)=>i.importState(t.children[r])))}exportState(){return kr(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function o0(n){return"rackController"in n}class q4{constructor(e){this.emitter=new Pi,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw vi.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const r=this.extract_(e);r&&(r.emitter.on("add",this.onSubListAdd_),r.emitter.on("remove",this.onSubListRemove_),r.allItems().forEach(s=>{this.cache_.add(s)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(r=>{this.cache_.delete(r)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function Y4(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(ku(i)&&i.value===e)return i}return null}function Z4(n){return o0(n)?n.rackController.rack.bcSet_:null}class J4{constructor(e){var t,i;this.emitter=new Pi,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new q4(Z4),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),ku(i))i.value.emitter.on("change",this.onChildValueChange_);else if(o0(i)){const r=i.rackController.rack;if(r){const s=r.emitter;s.on("layout",this.onRackLayout_),s.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(ku(i))i.value.emitter.off("change",this.onChildValueChange_);else if(o0(i)){const r=i.rackController.rack;if(r){const s=r.emitter;s.off("layout",this.onRackLayout_),s.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(r=>!r.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(r=>{const s=[];r===t&&(s.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&s.push("veryfirst")),r===i&&(s.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&s.push("verylast")),r.blade.set("positions",s)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=Y4(this.find(ku),e.sender);if(!t)throw vi.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class E_{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new J4({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&sS(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&__(e.bladeController.view.element)}}function aS(){return new rt({positions:Yt([],{equals:UB})})}class zl extends rt{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=rt.createCore(t);return new zl(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!zt(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};ir(this,"expanded",i),ir(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Q4(n,e){let t=0;return A4(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),od(e),t=e.clientHeight,n.set("temporaryExpanded",null),od(e)}),t}function zx(n,e){e.style.height=n.styleHeight}function qd(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),zt(n.get("expandedHeight"))){const t=Q4(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),od(e)}),n.emitter.on("change",()=>{zx(n,e)}),zx(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}class ez extends w_{constructor(e,t){super(e,t),this.emitter_=new Pi,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new y4(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const lS=Xe("cnt");class tz{constructor(e,t){var i;this.className_=Xe((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),lS()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ir(this.foldable_,"completed",ua(this.element,this.className_(void 0,"cpl")));const r=e.createElement("button");r.classList.add(this.className_("b")),ir(t.props,"title",c=>{zt(c)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const s=e.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const o=e.createElement("div");o.classList.add(this.className_("t")),x_(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const a=e.createElement("div");a.classList.add(this.className_("m")),this.buttonElement.appendChild(a);const l=e.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}}class $x extends y_{constructor(e,t){var i;const r=zl.create((i=t.expanded)!==null&&i!==void 0?i:!0),s=new tz(e,{foldable:r,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new E_({blade:t.blade,element:s.containerElement,root:t.root,viewProps:t.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=r,qd(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Dr(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return kr(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}Fn({id:"folder",type:"blade",accept(n){const e=Mn(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new $x(n.document,{blade:n.blade,expanded:n.params.expanded,props:rt.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof $x?new ez(n.controller,n.pool):null}});const nz=Xe("");function Hx(n,e){return ua(n,nz(void 0,e))}class Th extends rt{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=jB(Yt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,r;const s=e??{};return new Th(rt.createCore({disabled:(t=s.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=s.hidden)!==null&&i!==void 0?i:!1,parent:(r=s.parent)!==null&&r!==void 0?r:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){yr(this.globalDisabled_,Hx(e,"disabled")),ir(this,"hidden",Hx(e,"hidden"))}bindDisabled(e){yr(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){yr(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Gx=Xe("tbp");class iz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Gx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Gx("c")),this.element.appendChild(i),this.containerElement=i}}const pc=Xe("tbi");class rz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pc()),t.viewProps.bindClassModifiers(this.element),ir(t.props,"selected",s=>{s?this.element.classList.add(pc(void 0,"sel")):this.element.classList.remove(pc(void 0,"sel"))});const i=e.createElement("button");i.classList.add(pc("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const r=e.createElement("div");r.classList.add(pc("t")),x_(t.props.value("title"),r),this.buttonElement.appendChild(r),this.titleElement=r}}class sz{constructor(e,t){this.emitter=new Pi,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new rz(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class a0 extends y_{constructor(e,t){const i=new iz(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new E_({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new sz(e,{props:t.itemProps,viewProps:Th.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,ir(this.props,"selected",r=>{this.itemController.props.set("selected",r),this.viewProps.set("hidden",!r)})}get itemController(){return this.ic_}importState(e){return Dr(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return kr(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class oz extends w_{constructor(e,t){super(e,t),this.emitter_=new Pi,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new a0(t,{blade:aS(),itemProps:rt.fromObject({selected:!1,title:e.title}),props:rt.fromObject({selected:!1}),viewProps:Th.create()}),r=this.pool_.createApi(i);return this.rackApi_.add(r,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,r=>{i(r)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new E4(this,e.rawValue))}}class az extends w_{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}}const jx=-1;class lz{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Yt(!0),this.selectedIndex=Yt(jx),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=jx,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,r)=>{i.rawValue=r===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const fc=Xe("tab");class cz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(fc(),lS()),t.viewProps.bindClassModifiers(this.element),yr(t.empty,ua(this.element,fc(void 0,"nop")));const i=e.createElement("div");i.classList.add(fc("t")),this.element.appendChild(i),this.itemsElement=i;const r=e.createElement("div");r.classList.add(fc("i")),this.element.appendChild(r);const s=e.createElement("div");s.classList.add(fc("c")),this.element.appendChild(s),this.contentsElement=s}}class Wx extends y_{constructor(e,t){const i=new lz,r=new cz(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new E_({blade:t.blade,element:r.contentsElement,viewProps:t.viewProps}),view:r}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;sS(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;__(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}Fn({id:"tab",type:"blade",accept(n){const e=Mn(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new Wx(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new a0(n.document,{blade:aS(),itemProps:rt.fromObject({selected:!1,title:t.title}),props:rt.fromObject({selected:!1}),viewProps:Th.create()});e.add(i)}),e},api(n){return n.controller instanceof Wx?new oz(n.controller,n.pool):n.controller instanceof a0?new az(n.controller,n.pool):null}});class C_ extends v_{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class Ah{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}}function ad(n,e){if(n instanceof e)return n;if(n instanceof Ah){const t=n.constraints.reduce((i,r)=>i||(r instanceof e?r:null),null);if(t)return t}return null}class Yd{constructor(e){this.values=rt.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(r=>r.value===e).length>0?e:t[0].value}}function Zd(n){var e;const t=s0;if(Array.isArray(n))return(e=Mn({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function cS(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function S_(n){return zt(n)?null:new Yd(cS(n))}const gf=Xe("lst");class hz{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(gf()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(gf("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const r=e.createElement("div");r.classList.add(gf("m")),r.appendChild(Ph(e,"dropdown")),this.element.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,ir(this.props_,"options",s=>{g_(this.selectElement),s.forEach(o=>{const a=e.createElement("option");a.textContent=o.text,this.selectElement.appendChild(a)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Pl{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new hz(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Dr(e,null,t=>({options:t.required.custom(Zd)}),t=>(this.props.set("options",cS(t.options)),!0))}exportProps(){return kr(null,{options:this.props.get("options")})}}const Kx=Xe("pop");class uz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Kx()),t.viewProps.bindClassModifiers(this.element),yr(t.shows,ua(this.element,Kx(void 0,"v")))}}class M_{constructor(e,t){this.shows=Yt(!1),this.viewProps=t.viewProps,this.view=new uz(e,{shows:this.shows,viewProps:this.viewProps})}}const Xx=Xe("txt");class dz{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Xx()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(Xx("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class Rh{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new dz(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,r=this.parser_(i);zt(r)||(this.value.rawValue=r),this.view.refresh()}}function pz(n){return String(n)}function hS(n){return n==="false"?!1:!!n}function qx(n){return pz(n)}function fz(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const mz=On(0);function ld(n){return mz(n)+"%"}function uS(n){return String(n)}function l0(n){return n}function Ir({primary:n,secondary:e,forward:t,backward:i}){let r=!1;function s(o){r||(r=!0,o(),r=!1)}n.emitter.on("change",o=>{s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{s(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),s(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Xt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Qo(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Wn(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function vz(n){return n==="ArrowUp"||n==="ArrowDown"}function P_(n){return vz(n)||n==="ArrowLeft"||n==="ArrowRight"}function bf(n,e){var t,i;const r=e.ownerDocument.defaultView,s=e.getBoundingClientRect();return{x:n.pageX-(((t=r&&r.scrollX)!==null&&t!==void 0?t:0)+s.left),y:n.pageY-(((i=r&&r.scrollY)!==null&&i!==void 0?i:0)+s.top)}}class Or{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Pi,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(bf(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(bf(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(bf(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-r.left,y:i.clientY-r.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const ki=Xe("txt");class _z{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(ki(),ki(void 0,"num")),t.arrayPosition&&this.element.classList.add(ki(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(ki("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(ki()),this.inputElement.classList.add(ki("i"));const r=e.createElement("div");r.classList.add(ki("k")),this.element.appendChild(r),this.knobElement=r;const s=e.createElementNS(gr,"svg");s.classList.add(ki("g")),this.knobElement.appendChild(s);const o=e.createElementNS(gr,"path");o.classList.add(ki("gb")),s.appendChild(o),this.guideBodyElem_=o;const a=e.createElementNS(gr,"path");a.classList.add(ki("gh")),s.appendChild(a),this.guideHeadElem_=a;const l=e.createElement("div");l.classList.add(Xe("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(ki(void 0,"drg"));return}this.element.classList.add(ki(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),r=Tt(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+r},0 L${i},4 L${i+r},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class da{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=Yt(null),this.view=new _z(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new Or(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const r=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),s=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return r!==void 0&&(o=Math.max(o,r)),s!==void 0&&(o=Math.min(o,s)),o}onInputChange_(e){const i=e.currentTarget.value,r=this.parser_(i);zt(r)||(this.value.rawValue=this.constrainValue_(r)),this.view.refresh()}onInputKeyDown_(e){const t=Xt(this.props.get("keyScale"),Qo(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Xt(this.props.get("keyScale"),Qo(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const xf=Xe("sld");class gz{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(xf()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(xf("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const r=e.createElement("div");r.classList.add(xf("k")),this.trackElement.appendChild(r),this.knobElement=r,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Tt(Le(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class bz{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new gz(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Or(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(Le(Tt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Xt(this.props.get("keyScale"),Wn(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Xt(this.props.get("keyScale"),Wn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const wf=Xe("sldtxt");class xz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wf());const i=e.createElement("div");i.classList.add(wf("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(wf("t")),this.textView_=t.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}}class Yx{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new bz(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new da(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new xz(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Dr(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return kr(null,{max:e.get("max"),min:e.get("min")})}}function wz(n){return{sliderProps:new rt({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new rt({formatter:Yt(n.formatter),keyScale:n.keyScale,pointerScale:Yt(n.pointerScale)})}}const yz={containerUnitSize:"cnt-usz"};function dS(n){return`--${yz[n]}`}function ih(n){return nS(n)}function $s(n){if(r0(n))return Mn(n,ih)}function Qr(n,e){if(!n)return;const t=[],i=QC(n,e);i&&t.push(i);const r=eS(n);return r&&t.push(r),new Ah(t)}function T_(n){if(n==="inline"||n==="popup")return n}function $l(n,e){n.write(e)}const uu=Xe("ckb");class Ez{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(uu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(uu("l")),this.element.appendChild(i),this.labelElement=i;const r=e.createElement("input");r.classList.add(uu("i")),r.type="checkbox",this.labelElement.appendChild(r),this.inputElement=r,t.viewProps.bindDisabled(this.inputElement);const s=e.createElement("div");s.classList.add(uu("w")),this.labelElement.appendChild(s);const o=Ph(e,"check");s.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Cz{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Ez(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}}function Sz(n){const e=[],t=S_(n.options);return t&&e.push(t),new Ah(e)}Fn({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Mn(e,i=>({options:i.optional.custom(Zd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>hS,constraint:n=>Sz(n.params),writer:n=>$l},controller:n=>{const e=n.document,t=n.value,i=n.constraint,r=i&&ad(i,Yd);return r?new Pl(e,{props:new rt({options:r.values.value("options")}),value:t,viewProps:n.viewProps}):new Cz(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Pl?new C_(n.controller):null}});const yo=Xe("col");let Mz=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(yo()),t.foldable.bindExpandedClass(this.element,yo(void 0,"expanded")),ir(t.foldable,"completed",ua(this.element,yo(void 0,"cpl")));const i=e.createElement("div");i.classList.add(yo("h")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(yo("s")),i.appendChild(r),this.swatchElement=r;const s=e.createElement("div");if(s.classList.add(yo("t")),i.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(yo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function Pz(n,e,t){const i=Tt(n/255,0,1),r=Tt(e/255,0,1),s=Tt(t/255,0,1),o=Math.max(i,r,s),a=Math.min(i,r,s),l=o-a;let c=0,h=0;const u=(a+o)/2;return l!==0&&(h=l/(1-Math.abs(o+a-1)),i===o?c=(r-s)/l:r===o?c=2+(s-i)/l:c=4+(i-r)/l,c=c/6+(c<0?1:0)),[c*360,h*100,u*100]}function Tz(n,e,t){const i=(n%360+360)%360,r=Tt(e/100,0,1),s=Tt(t/100,0,1),o=(1-Math.abs(2*s-1))*r,a=o*(1-Math.abs(i/60%2-1)),l=s-o/2;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function Az(n,e,t){const i=Tt(n/255,0,1),r=Tt(e/255,0,1),s=Tt(t/255,0,1),o=Math.max(i,r,s),a=Math.min(i,r,s),l=o-a;let c;l===0?c=0:o===i?c=60*(((r-s)/l%6+6)%6):o===r?c=60*((s-i)/l+2):c=60*((i-r)/l+4);const h=o===0?0:l/o,u=o;return[c,h*100,u*100]}function pS(n,e,t){const i=ZC(n,360),r=Tt(e/100,0,1),s=Tt(t/100,0,1),o=s*r,a=o*(1-Math.abs(i/60%2-1)),l=s-o;let c,h,u;return i>=0&&i<60?[c,h,u]=[o,a,0]:i>=60&&i<120?[c,h,u]=[a,o,0]:i>=120&&i<180?[c,h,u]=[0,o,a]:i>=180&&i<240?[c,h,u]=[0,a,o]:i>=240&&i<300?[c,h,u]=[a,0,o]:[c,h,u]=[o,0,a],[(c+l)*255,(h+l)*255,(u+l)*255]}function Rz(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/200]}function Lz(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/200]}function Rr(n){return[n[0],n[1],n[2]]}function Jd(n,e){return[n[0],n[1],n[2],e]}const Dz={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:Rz,rgb:Tz},hsv:{hsl:Lz,hsv:(n,e,t)=>[n,e,t],rgb:pS},rgb:{hsl:Pz,hsv:Az,rgb:(n,e,t)=>[n,e,t]}};function Tl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function kz(n,e){return n===e?e:ZC(n,e)}function fS(n,e,t){var i;const r=Tl(e,t);return[e==="rgb"?Tt(n[0],0,r[0]):kz(n[0],r[0]),Tt(n[1],0,r[1]),Tt(n[2],0,r[2]),Tt((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function Zx(n,e,t,i){const r=Tl(e,t),s=Tl(e,i);return n.map((o,a)=>o/r[a]*s[a])}function mS(n,e,t){const i=Zx(n,e.mode,e.type,"int"),r=Dz[e.mode][t.mode](...i);return Zx(r,t.mode,"int",t.type)}class lt{static black(){return new lt([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=fS(e,t,this.type)}getComponents(e){return Jd(mS(Rr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const Ps=Xe("colp");let Iz=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Ps()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ps("hsv"));const r=e.createElement("div");r.classList.add(Ps("sv")),this.svPaletteView_=t.svPaletteView,r.appendChild(this.svPaletteView_.element),i.appendChild(r);const s=e.createElement("div");s.classList.add(Ps("h")),this.hPaletteView_=t.hPaletteView,s.appendChild(this.hPaletteView_.element),i.appendChild(s),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Ps("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(Ps("a"));const l=e.createElement("div");l.classList.add(Ps("ap")),l.appendChild(this.alphaViews_.palette.element),a.appendChild(l);const c=e.createElement("div");c.classList.add(Ps("at")),c.appendChild(this.alphaViews_.text.element),a.appendChild(c),this.element.appendChild(a)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function Oz(n){return n==="int"?"int":n==="float"?"float":void 0}function A_(n){return Mn(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Oz)}),expanded:e.optional.boolean,picker:e.optional.custom(T_),readonly:e.optional.constant(!1)}))}function ea(n){return n?.1:1}function vS(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}class R_{constructor(e,t){this.type="float",this.mode=t,this.comps_=fS(e,t,this.type)}getComponents(e){return Jd(mS(Rr(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const Nz={int:(n,e)=>new lt(n,e),float:(n,e)=>new R_(n,e)};function L_(n,e,t){return Nz[t](n,e)}function Fz(n){return n.type==="float"}function Vz(n){return n.type==="int"}function Uz(n){const e=n.getComponents(),t=Tl(n.mode,"int");return new lt([Math.round(Le(e[0],0,1,0,t[0])),Math.round(Le(e[1],0,1,0,t[1])),Math.round(Le(e[2],0,1,0,t[2])),e[3]],n.mode)}function Bz(n){const e=n.getComponents(),t=Tl(n.mode,"int");return new R_([Le(e[0],0,t[0],0,1),Le(e[1],0,t[1],0,1),Le(e[2],0,t[2],0,1),e[3]],n.mode)}function jn(n,e){if(n.type===e)return n;if(Vz(n)&&e==="float")return Bz(n);if(Fz(n)&&e==="int")return Uz(n);throw vi.shouldNeverHappen()}function zz(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function zi(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const $z={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function _S(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return $z[i](t)}function gS(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[zi(e[1],255),zi(e[2],255),zi(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Hz(n){const e=gS(n);return e?new lt(e,"rgb"):null}function bS(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[zi(e[1],255),zi(e[2],255),zi(e[3],255),zi(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Gz(n){const e=bS(n);return e?new lt(e,"rgb"):null}function xS(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[_S(e[1]),zi(e[2],100),zi(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function jz(n){const e=xS(n);return e?new lt(e,"hsl"):null}function wS(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[_S(e[1]),zi(e[2],100),zi(e[3],100),zi(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Wz(n){const e=wS(n);return e?new lt(e,"hsl"):null}function yS(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Kz(n){const e=yS(n);return e?new lt(e,"rgb"):null}function ES(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Le(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),Le(parseInt(t[4],16),0,255,0,1)]:null}function Xz(n){const e=ES(n);return e?new lt(e,"rgb"):null}function CS(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function qz(n){return e=>{const t=CS(e);return t?L_(t,"rgb",n):null}}function SS(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Yz(n){return e=>{const t=SS(e);return t?L_(t,"rgb",n):null}}const Zz=[{parser:yS,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ES,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:gS,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:bS,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:xS,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:wS,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:CS,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:SS,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Jz(n){return Zz.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function Qz(n,e="int"){const t=Jz(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Lh(n){const e=[Kz,Xz,Hz,Gz,jz,Wz];e.push(qz("int"),Yz("int"));const t=fz(e);return i=>{const r=t(i);return r?jn(r,n):null}}function e8(n){const e=Lh("int");if(typeof n!="string")return lt.black();const t=e(n);return t??lt.black()}function MS(n){const e=Tt(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function D_(n,e="#"){const t=Rr(n.getComponents("rgb")).map(MS).join("");return`${e}${t}`}function k_(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(MS).join("");return`${e}${i}`}function PS(n){const e=On(0),t=jn(n,"int");return`rgb(${Rr(t.getComponents("rgb")).map(r=>e(r)).join(", ")})`}function Iu(n){const e=On(2),t=On(0);return`rgba(${jn(n,"int").getComponents("rgb").map((s,o)=>(o===3?e:t)(s)).join(", ")})`}function t8(n){const e=[On(0),ld,ld],t=jn(n,"int");return`hsl(${Rr(t.getComponents("hsl")).map((r,s)=>e[s](r)).join(", ")})`}function n8(n){const e=[On(0),ld,ld,On(2)];return`hsla(${jn(n,"int").getComponents("hsl").map((r,s)=>e[s](r)).join(", ")})`}function TS(n,e){const t=On(e==="float"?2:0),i=["r","g","b"],r=jn(n,e);return`{${Rr(r.getComponents("rgb")).map((o,a)=>`${i[a]}: ${t(o)}`).join(", ")}}`}function i8(n){return e=>TS(e,n)}function AS(n,e){const t=On(2),i=On(e==="float"?2:0),r=["r","g","b","a"];return`{${jn(n,e).getComponents("rgb").map((a,l)=>{const c=l===3?t:i;return`${r[l]}: ${c(a)}`}).join(", ")}}`}function r8(n){return e=>AS(e,n)}const s8=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:D_},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:k_},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:PS},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Iu},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:t8},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:n8},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:i8(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:r8(e)}],[])];function RS(n){return s8.reduce((e,t)=>e||(zz(t.format,n)?t.stringifier:null),null)}const mc=Xe("apl");let o8=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(mc()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(mc("b")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(mc("c")),i.appendChild(r),this.colorElem_=r;const s=e.createElement("div");s.classList.add(mc("m")),this.element.appendChild(s),this.markerElem_=s;const o=e.createElement("div");o.classList.add(mc("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new lt([t[0],t[1],t[2],0],"rgb"),r=new lt([t[0],t[1],t[2],255],"rgb"),s=["to right",Iu(i),Iu(r)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=Iu(e);const o=Le(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},a8=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new o8(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Or(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,r=this.value.rawValue,[s,o,a]=r.getComponents("hsv");this.value.setRawValue(new lt([s,o,a,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Xt(ea(!0),Wn(e));if(t===0)return;const i=this.value.rawValue,[r,s,o,a]=i.getComponents("hsv");this.value.setRawValue(new lt([r,s,o,a+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Xt(ea(!0),Wn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Ua=Xe("coltxt");function l8(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,r)=>{const s=n.createElement("option");return s.textContent=r.text,s.value=r.value,i.appendChild(s),i},n.createDocumentFragment())),e}let c8=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ua()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ua("m")),this.modeElem_=l8(e),this.modeElem_.classList.add(Ua("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const r=e.createElement("div");r.classList.add(Ua("mm")),r.appendChild(Ph(e,"dropdown")),i.appendChild(r),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ua("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=t.inputViews,this.applyInputViews_(),yr(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){g_(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Ua("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function h8(n){return On(n==="float"?2:0)}function u8(n,e,t){const i=Tl(n,e)[t];return new Jo({min:0,max:i})}function d8(n,e,t){return new da(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:rt.fromObject({formatter:h8(e.colorType),keyScale:ea(!1),pointerScale:e.colorType==="float"?.01:1}),value:Yt(0,{constraint:u8(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function p8(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Ar,viewProps:e.viewProps};return[0,1,2].map(i=>{const r=d8(n,t,i);return Ir({primary:e.value,secondary:r.value,forward(s){return jn(s,e.colorType).getComponents(e.colorMode)[i]},backward(s,o){const a=e.colorMode,c=jn(s,e.colorType).getComponents(a);c[i]=o;const h=L_(Jd(Rr(c),c[3]),a,e.colorType);return jn(h,"int")}}),r})}function f8(n,e){const t=new Rh(n,{parser:Lh("int"),props:rt.fromObject({formatter:D_}),value:Yt(lt.black()),viewProps:e.viewProps});return Ir({primary:e.value,secondary:t.value,forward:i=>new lt(Rr(i.getComponents()),i.mode),backward:(i,r)=>new lt(Jd(Rr(r.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function m8(n){return n!=="hex"}let v8=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=Yt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new c8(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return m8(t)?p8(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):f8(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const yf=Xe("hpl");let _8=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(yf()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(yf("c")),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(yf("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=PS(new lt([t,100,100],"hsv"));const i=Le(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},g8=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new _8(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Or(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=Le(Tt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),r=this.value.rawValue,[,s,o,a]=r.getComponents("hsv");this.value.setRawValue(new lt([i,s,o,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Xt(ea(!1),Wn(e));if(t===0)return;const i=this.value.rawValue,[r,s,o,a]=i.getComponents("hsv");this.value.setRawValue(new lt([r+t,s,o,a],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Xt(ea(!1),Wn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Ef=Xe("svp"),Jx=64;let b8=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ef()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=Jx,i.width=Jx,i.classList.add(Ef("c")),this.element.appendChild(i),this.canvasElement=i;const r=e.createElement("div");r.classList.add(Ef("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}update_(){const e=rS(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),r=this.canvasElement.width,s=this.canvasElement.height,o=e.getImageData(0,0,r,s),a=o.data;for(let h=0;h<s;h++)for(let u=0;u<r;u++){const d=Le(u,0,r,0,100),p=Le(h,0,s,100,0),_=pS(i[0],d,p),v=(h*r+u)*4;a[v]=_[0],a[v+1]=_[1],a[v+2]=_[2],a[v+3]=255}e.putImageData(o,0,0);const l=Le(i[1],0,100,0,100);this.markerElem_.style.left=`${l}%`;const c=Le(i[2],0,100,100,0);this.markerElem_.style.top=`${c}%`}onValueChange_(){this.update_()}},x8=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new b8(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Or(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=Le(e.point.x,0,e.bounds.width,0,100),r=Le(e.point.y,0,e.bounds.height,100,0),[s,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new lt([s,i,r,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){P_(e.key)&&e.preventDefault();const[t,i,r,s]=this.value.rawValue.getComponents("hsv"),o=ea(!1),a=Xt(o,Wn(e)),l=Xt(o,Qo(e));a===0&&l===0||this.value.setRawValue(new lt([t,i+a,r+l,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=ea(!1),i=Xt(t,Wn(e)),r=Xt(t,Qo(e));i===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},w8=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new g8(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new x8(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new a8(e,{value:this.value,viewProps:this.viewProps}),text:new da(e,{parser:Ar,props:rt.fromObject({pointerScale:.01,keyScale:.1,formatter:On(2)}),value:Yt(0,{constraint:new Jo({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ir({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,r)=>{const s=i.getComponents();return s[3]=r,new lt(s,i.mode)}}),this.textsC_=new v8(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Iz(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Cf=Xe("colsw");let y8=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Cf()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Cf("sw")),this.element.appendChild(i),this.swatchElem_=i;const r=e.createElement("button");r.classList.add(Cf("b")),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=k_(e)}onValueChange_(){this.update_()}},E8=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new y8(e,{value:this.value,viewProps:this.viewProps})}},I_=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=zl.create(t.expanded),this.swatchC_=new E8(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Rh(e,{parser:t.parser,props:rt.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Mz(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new M_(e,{viewProps:this.viewProps}):null;const r=new w8(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(r.view.element),Ir({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),qd(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=b_(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Xd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function C8(n){return Rr(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function S8(n){return n.getComponents("rgb").reduce((e,t,i)=>{const r=Math.floor(i===3?t*255:t)&255;return e<<8|r},0)>>>0}function M8(n){return new lt([n>>16&255,n>>8&255,n&255],"rgb")}function P8(n){return new lt([n>>24&255,n>>16&255,n>>8&255,Le(n&255,0,255,0,1)],"rgb")}function T8(n){return typeof n!="number"?lt.black():M8(n)}function A8(n){return typeof n!="number"?lt.black():P8(n)}function Ou(n,e){return typeof n!="object"||zt(n)?!1:e in n&&typeof n[e]=="number"}function LS(n){return Ou(n,"r")&&Ou(n,"g")&&Ou(n,"b")}function DS(n){return LS(n)&&Ou(n,"a")}function kS(n){return LS(n)}function O_(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let r=0;r<t.length;r++)if(t[r]!==i[r])return!1;return!0}function Qx(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function R8(n){const e=RS(n);return e?(t,i)=>{$l(t,e(i))}:null}function L8(n){const e=n?S8:C8;return(t,i)=>{$l(t,e(i))}}function D8(n,e,t){const r=jn(e,t).toRgbaObject();n.writeProperty("r",r.r),n.writeProperty("g",r.g),n.writeProperty("b",r.b),n.writeProperty("a",r.a)}function k8(n,e,t){const r=jn(e,t).toRgbaObject();n.writeProperty("r",r.r),n.writeProperty("g",r.g),n.writeProperty("b",r.b)}function I8(n,e){return(t,i)=>{n?D8(t,i,e):k8(t,i,e)}}function O8(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function N8(n){return n?e=>k_(e,"0x"):e=>D_(e,"0x")}function F8(n){return"color"in n||n.view==="color"}Fn({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!F8(e))return null;const t=A_(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:O8(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?A8:T8,equals:O_,writer:n=>L8(n.params.supportsAlpha)},controller:n=>{var e,t;return new I_(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:N8(n.params.supportsAlpha),parser:Lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function V8(n,e){if(!kS(n))return jn(lt.black(),e);if(e==="int"){const t=Qx(n);return new lt(t,"rgb")}if(e==="float"){const t=Qx(n);return new R_(t,"rgb")}return jn(lt.black(),"int")}function U8(n){return DS(n)}function B8(n){return e=>{const t=V8(e,n);return jn(t,"int")}}function z8(n,e){return t=>n?AS(t,e):TS(t,e)}Fn({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!kS(n))return null;const i=A_(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=vS(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>B8(n.params.colorType),equals:O_,writer:n=>I8(U8(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=DS(n.initialValue);return new I_(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:z8(i,n.params.colorType),parser:Lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});Fn({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=Qz(n,vS(e));if(!t)return null;const i=RS(t);if(!i)return null;const r=A_(e);return r?{initialValue:n,params:Object.assign(Object.assign({},r),{format:t,stringifier:i})}:null},binding:{reader:()=>e8,equals:O_,writer:n=>{const e=R8(n.params.format);if(!e)throw vi.notBindable();return e}},controller:n=>{var e,t;return new I_(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});class N_{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,r)=>{var s,o;return(o=(s=this.components[r])===null||s===void 0?void 0:s.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}}const ew=Xe("pndtxt");class $8{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(ew()),this.textViews.forEach(i=>{const r=e.createElement("div");r.classList.add(ew("a")),r.appendChild(i.element),this.element.appendChild(r)})}}function H8(n,e,t){return new da(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:Yt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class F_{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,r)=>H8(e,t,r)),this.acs_.forEach((i,r)=>{Ir({primary:this.value,secondary:i.value,forward:s=>t.assembly.toComponents(s)[r],backward:(s,o)=>{const a=t.assembly.toComponents(s);return a[r]=o,t.assembly.fromComponents(a)}})}),this.view=new $8(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}}class G8 extends v_{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function j8(n,e){const t=[],i=QC(n,e);i&&t.push(i);const r=eS(n);r&&t.push(r);const s=S_(n.options);return s&&t.push(s),new Ah(t)}Fn({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Mn(e,i=>Object.assign(Object.assign({},nS(i)),{options:i.optional.custom(Zd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>YC,constraint:n=>j8(n.params,n.initialValue),writer:n=>$l},controller:n=>{const e=n.value,t=n.constraint,i=t&&ad(t,Yd);if(i)return new Pl(n.document,{props:new rt({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const r=tS(n.params,e.rawValue),s=t&&ad(t,Jo);return s?new Yx(n.document,Object.assign(Object.assign({},wz(Object.assign(Object.assign({},r),{keyScale:Yt(r.keyScale),max:s.values.value("max"),min:s.values.value("min")}))),{parser:Ar,value:e,viewProps:n.viewProps})):new da(n.document,{parser:Ar,props:rt.fromObject(r),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Yx?new G8(n.controller):n.controller.valueController instanceof Pl?new C_(n.controller):null}});class Xs{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(zt(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const IS={toComponents:n=>n.getComponents(),fromComponents:n=>new Xs(...n)},Ba=Xe("p2d");class W8{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ba()),t.viewProps.bindClassModifiers(this.element),yr(t.expanded,ua(this.element,Ba(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Ba("h")),this.element.appendChild(i);const r=e.createElement("button");r.classList.add(Ba("b")),r.appendChild(Ph(e,"p2dpad")),t.viewProps.bindDisabled(r),i.appendChild(r),this.buttonElement=r;const s=e.createElement("div");if(s.classList.add(Ba("t")),i.appendChild(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Ba("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}const Ts=Xe("p2dp");class K8{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Ts()),t.layout==="popup"&&this.element.classList.add(Ts(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ts("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const r=e.createElementNS(gr,"svg");r.classList.add(Ts("g")),this.padElement.appendChild(r),this.svgElem_=r;const s=e.createElementNS(gr,"line");s.classList.add(Ts("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const o=e.createElementNS(gr,"line");o.classList.add(Ts("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const a=e.createElementNS(gr,"line");a.classList.add(Ts("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;const l=e.createElement("div");l.classList.add(Ts("m")),this.padElement.appendChild(l),this.markerElem_=l,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),r=Le(e,-i,+i,0,100),s=Le(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${r}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${r}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function tw(n,e,t){return[Xt(e[0],Wn(n)),Xt(e[1],Qo(n))*(t?1:-1)]}class X8{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new K8(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Or(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),r=Le(e.point.x,0,e.bounds.width,-i,+i),s=Le(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Xs(r,s),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){P_(e.key)&&e.preventDefault();const[t,i]=tw(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Xs(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=tw(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class q8{constructor(e,t){var i,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=zl.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new M_(e,{viewProps:this.viewProps}):null;const s=new X8(e,{layout:t.pickerLayout,props:new rt({invertsY:Yt(t.invertsY),max:Yt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.textC_=new F_(e,{assembly:IS,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new W8(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(r=this.view.buttonElement)===null||r===void 0||r.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ir({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),qd(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=b_(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Xd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function Y8(n){return Xs.isObject(n)?new Xs(n.x,n.y):new Xs}function Z8(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function J8(n,e){return new N_({assembly:IS,components:[Qr(Object.assign(Object.assign({},n),n.x),e.x),Qr(Object.assign(Object.assign({},n),n.y),e.y)]})}function nw(n,e){var t,i;if(!zt(n.min)||!zt(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const r=JC(n);return Math.max(Math.abs(r)*10,Math.abs(e)*10)}function Q8(n,e){var t,i;const r=nw(Zo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),s=nw(Zo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(r,s)}function e9(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}Fn({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Xs.isObject(n))return null;const t=Mn(e,i=>Object.assign(Object.assign({},ih(i)),{expanded:i.optional.boolean,picker:i.optional.custom(T_),readonly:i.optional.constant(!1),x:i.optional.custom($s),y:i.optional.object(Object.assign(Object.assign({},ih(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>Y8,constraint:n=>J8(n.params,n.initialValue),equals:Xs.equals,writer:()=>Z8},controller:n=>{var e,t;const i=n.document,r=n.value,s=n.constraint,o=[n.params.x,n.params.y];return new q8(i,{axes:r.rawValue.getComponents().map((a,l)=>{var c;return f_({constraint:s.components[l],initialValue:a,params:Zo(n.params,(c=o[l])!==null&&c!==void 0?c:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:e9(n.params),max:Q8(n.params,r.rawValue),parser:Ar,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:r,viewProps:n.viewProps})}});class al{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(zt(e))return!1;const t=e.x,i=e.y,r=e.z;return!(typeof t!="number"||typeof i!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const OS={toComponents:n=>n.getComponents(),fromComponents:n=>new al(...n)};function t9(n){return al.isObject(n)?new al(n.x,n.y,n.z):new al}function n9(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function i9(n,e){return new N_({assembly:OS,components:[Qr(Object.assign(Object.assign({},n),n.x),e.x),Qr(Object.assign(Object.assign({},n),n.y),e.y),Qr(Object.assign(Object.assign({},n),n.z),e.z)]})}Fn({id:"input-point3d",type:"input",accept:(n,e)=>{if(!al.isObject(n))return null;const t=Mn(e,i=>Object.assign(Object.assign({},ih(i)),{readonly:i.optional.constant(!1),x:i.optional.custom($s),y:i.optional.custom($s),z:i.optional.custom($s)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>t9,constraint:n=>i9(n.params,n.initialValue),equals:al.equals,writer:n=>n9},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new F_(n.document,{assembly:OS,axes:e.rawValue.getComponents().map((r,s)=>{var o;return f_({constraint:t.components[s],initialValue:r,params:Zo(n.params,(o=i[s])!==null&&o!==void 0?o:{})})}),parser:Ar,value:e,viewProps:n.viewProps})}});class ll{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.z=i,this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(zt(e))return!1;const t=e.x,i=e.y,r=e.z,s=e.w;return!(typeof t!="number"||typeof i!="number"||typeof r!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const NS={toComponents:n=>n.getComponents(),fromComponents:n=>new ll(...n)};function r9(n){return ll.isObject(n)?new ll(n.x,n.y,n.z,n.w):new ll}function s9(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function o9(n,e){return new N_({assembly:NS,components:[Qr(Object.assign(Object.assign({},n),n.x),e.x),Qr(Object.assign(Object.assign({},n),n.y),e.y),Qr(Object.assign(Object.assign({},n),n.z),e.z),Qr(Object.assign(Object.assign({},n),n.w),e.w)]})}Fn({id:"input-point4d",type:"input",accept:(n,e)=>{if(!ll.isObject(n))return null;const t=Mn(e,i=>Object.assign(Object.assign({},ih(i)),{readonly:i.optional.constant(!1),w:i.optional.custom($s),x:i.optional.custom($s),y:i.optional.custom($s),z:i.optional.custom($s)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>r9,constraint:n=>o9(n.params,n.initialValue),equals:ll.equals,writer:n=>s9},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new F_(n.document,{assembly:NS,axes:e.rawValue.getComponents().map((r,s)=>{var o;return f_({constraint:t.components[s],initialValue:r,params:Zo(n.params,(o=i[s])!==null&&o!==void 0?o:{})})}),parser:Ar,value:e,viewProps:n.viewProps})}});function a9(n){const e=[],t=S_(n.options);return t&&e.push(t),new Ah(e)}Fn({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Mn(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Zd)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>uS,constraint:n=>a9(n.params),writer:n=>$l},controller:n=>{const e=n.document,t=n.value,i=n.constraint,r=i&&ad(i,Yd);return r?new Pl(e,{props:new rt({options:r.values.value("options")}),value:t,viewProps:n.viewProps}):new Rh(e,{parser:s=>s,props:rt.fromObject({formatter:l0}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Pl?new C_(n.controller):null}});const Qd={monitor:{defaultRows:3}},iw=Xe("mll");class l9{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(iw()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(iw("i")),i.style.height=`calc(var(${dS("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(r=>{r!==void 0&&i.push(this.formatter_(r))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class V_{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new l9(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const rw=Xe("sgl");class c9{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(rw()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(rw("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class U_{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new c9(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}Fn({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Mn(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>hS},controller:n=>{var e;return n.value.rawValue.length===1?new U_(n.document,{formatter:qx,value:n.value,viewProps:n.viewProps}):new V_(n.document,{formatter:qx,rows:(e=n.params.rows)!==null&&e!==void 0?e:Qd.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});class h9 extends v_{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const As=Xe("grl");class u9{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(As()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(gr,"svg");i.classList.add(As("g")),i.style.height=`calc(var(${dS("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const r=e.createElementNS(gr,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;const s=e.createElement("div");s.classList.add(As("t"),Xe("tt")()),this.element.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,r=this.props_.get("min"),s=this.props_.get("max"),o=[];this.value.rawValue.forEach((u,d)=>{if(u===void 0)return;const p=Le(d,0,i,0,e),_=Le(u,r,s,t,0);o.push([p,_].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const a=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){a.classList.remove(As("t","a"));return}const c=Le(this.cursor_.rawValue,0,i,0,e),h=Le(l,r,s,t,0);a.style.left=`${c}px`,a.style.top=`${h}px`,a.textContent=`${this.formatter_(l)}`,a.classList.contains(As("t","a"))||(a.classList.add(As("t","a"),As("t","in")),od(a),a.classList.remove(As("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class FS{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=Yt(-1),this.view=new u9(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Xd(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Or(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Dr(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return kr(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(Le(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Le(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function c0(n){return zt(n.format)?On(2):n.format}function d9(n){var e;return n.value.rawValue.length===1?new U_(n.document,{formatter:c0(n.params),value:n.value,viewProps:n.viewProps}):new V_(n.document,{formatter:c0(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Qd.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function p9(n){var e,t,i;return new FS(n.document,{formatter:c0(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Qd.monitor.defaultRows,props:rt.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function sw(n){return n.view==="graph"}Fn({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Mn(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>sw(n)?64:1,reader:n=>YC},controller:n=>sw(n.params)?p9(n):d9(n),api:n=>n.controller.valueController instanceof FS?new h9(n.controller):null});Fn({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Mn(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>uS},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new V_(n.document,{formatter:l0,rows:(e=n.params.rows)!==null&&e!==void 0?e:Qd.monitor.defaultRows,value:t,viewProps:n.viewProps}):new U_(n.document,{formatter:l0,value:t,viewProps:n.viewProps})}});const Eo=Xe("col");class f9{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Eo()),t.foldable.bindExpandedClass(this.element,Eo(void 0,"expanded")),ir(t.foldable,"completed",ua(this.element,Eo(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Eo("h")),this.element.append(i);const r=e.createElement("div");r.classList.add(Eo("s")),i.append(r),this.swatchElement=r;const s=e.createElement("div");if(s.classList.add(Eo("t")),i.append(s),this.textElement=s,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Eo("p")),this.element.append(o),this.pickerElement=o}else this.pickerElement=null}}const Rs=Xe("colp");class m9{get allFocusableElements(){const e=[this.svPaletteView.element,this.hPaletteView.element,this.textsView.modeSelectElement,...this.textsView.inputViews.map(t=>t.inputElement)];return this.alphaViews&&e.push(this.alphaViews.palette.element,this.alphaViews.text.inputElement),e}constructor(e,t){this.alphaViews=null,this.element=e.createElement("div"),this.element.classList.add(Rs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Rs("hsv"));const r=e.createElement("div");r.classList.add(Rs("sv")),this.svPaletteView=t.svPaletteView,r.append(this.svPaletteView.element),i.append(r);const s=e.createElement("div");s.classList.add(Rs("h")),this.hPaletteView=t.hPaletteView,s.append(this.hPaletteView.element),i.append(s),this.element.append(i);const o=e.createElement("div");if(o.classList.add(Rs("rgb")),this.textsView=t.textsView,o.append(this.textsView.element),this.element.append(o),t.alphaViews){this.alphaViews={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(Rs("a"));const l=e.createElement("div");l.classList.add(Rs("ap")),l.append(this.alphaViews.palette.element),a.append(l);const c=e.createElement("div");c.classList.add(Rs("at")),c.append(this.alphaViews.text.element),a.append(c),this.element.append(a)}}}const vc=Xe("apl");class v9{constructor(e,t){this.onValueChange=this.onValueChange.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange),this.element=e.createElement("div"),this.element.classList.add(vc()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(vc("b")),this.element.append(i),this.colorElement=e.createElement("div"),this.colorElement.classList.add(vc("c")),i.append(this.colorElement),this.markerElement=e.createElement("div"),this.markerElement.classList.add(vc("m")),this.element.append(this.markerElement),this.previewElement=e.createElement("div"),this.previewElement.classList.add(vc("p")),this.markerElement.append(this.previewElement),this.update()}onValueChange(){this.update()}update(){const e=this.value.rawValue.clone();e.convert("srgb");const t=e.clone();t.alpha=0;const i=t.clone();i.alpha=1;const r=["to right",t.serialize({alpha:!0,format:"rgba",space:"srgb",type:"string"}),i.serialize({alpha:!0,format:"rgba",space:"srgb",type:"string"})];this.colorElement.style.background=`linear-gradient(${r.join(",")})`,this.previewElement.style.backgroundColor=e.serialize({alpha:!0,format:"rgba",space:"srgb",type:"string"});const s=Le(e.alpha,0,1,0,100);this.markerElement.style.left=`${s}%`}}class _9{constructor(e,t){this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new v9(e,{value:this.value,viewProps:this.viewProps}),this.pointerHandler=new Or(this.view.element),this.pointerHandler.emitter.on("down",this.onPointerDown),this.pointerHandler.emitter.on("move",this.onPointerMove),this.pointerHandler.emitter.on("up",this.onPointerUp),this.view.element.addEventListener("keydown",this.onKeyDown),this.view.element.addEventListener("keyup",this.onKeyUp)}handlePointerEvent(e,t){if(!e.point)return;const i=this.value.rawValue.clone();i.alpha=e.point.x/e.bounds.width,this.value.setRawValue(i,t)}onKeyDown(e){const t=Xt(.1,Wn(e));if(t===0)return;const i=this.value.rawValue.clone();i.set("alpha",r=>r+t),this.value.setRawValue(i,{forceEmit:!1,last:!1})}onKeyUp(e){Xt(.1,Wn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown(e){this.handlePointerEvent(e.data,{forceEmit:!1,last:!1})}onPointerMove(e){this.handlePointerEvent(e.data,{forceEmit:!1,last:!1})}onPointerUp(e){this.handlePointerEvent(e.data,{forceEmit:!0,last:!0})}}function Sf(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function tn(n,e,t=[0,0,0]){const i=Sf(n,e[0]),r=Sf(n,e[1]),s=Sf(n,e[2]);return t[0]=i,t[1]=r,t[2]=s,t}function VS(n){return Pc(n)==="string"}function Pc(n){return(Object.prototype.toString.call(n).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase()}function US(n,{precision:e=16,unit:t}){return zn(n)?"none":(n=+BS(n,e),n+(t??""))}function zn(n){return n===null}function BS(n,e){if(n===0)return 0;let t=~~n,i=0;t&&e&&(i=~~Math.log10(Math.abs(t))+1);const r=10**(e-i);return Math.floor(n*r+.5)/r}function zS(n,e,t){return isNaN(n)?e:isNaN(e)?n:n+(e-n)*t}function g9(n,e,t){return(t-n)/(e-n)}function ow(n,e,t){return!n||!e||n===e||n[0]===e[0]&&n[1]===e[1]||isNaN(t)||t===null?t:zS(e[0],e[1],g9(n[0],n[1],t))}function $S(n,e,t){return Math.max(Math.min(t,e),n)}function B_(n,e){return Math.sign(n)===Math.sign(e)?n:-n}function _n(n,e){return B_(Math.abs(n)**e,n)}function HS(n,e){return e===0?0:n/e}function b9(n,e,t=0,i=n.length){for(;t<i;){const r=t+i>>1;n[r]<e?t=r+1:i=r}return t}function z_(n,e){if(n instanceof e)return!0;const t=e.name;for(;n;){const i=Object.getPrototypeOf(n),r=i?.constructor?.name;if(r===t)return!0;if(!r||r==="Object")return!1;n=i}return!1}class aw{type;coordMeta;coordRange;range;constructor(e,t){if(typeof e=="object"&&(this.coordMeta=e),t&&(this.coordMeta=t,this.coordRange=t.range??t.refRange),typeof e=="string"){let i=e.trim().match(/^(?<type><[a-z]+>)(\[(?<min>-?[.\d]+),\s*(?<max>-?[.\d]+)\])?$/);if(!i)throw new TypeError(`Cannot parse ${e} as a type definition.`);this.type=i.groups.type;let{min:r,max:s}=i.groups;(r||s)&&(this.range=[+r,+s])}}get computedRange(){return this.range?this.range:this.type==="<percentage>"?this.percentageRange():this.type==="<angle>"?[0,360]:null}get unit(){return this.type==="<percentage>"?"%":this.type==="<angle>"?"deg":""}resolve(e){if(this.type==="<angle>")return e;let t=this.computedRange,i=this.coordRange;return this.type==="<percentage>"&&(i??=this.percentageRange()),ow(t,i,e)}serialize(e,t){let i=this.type==="<percentage>"?this.percentageRange(100):this.computedRange,r=this.unit;return e=ow(this.coordRange,i,e),US(e,{unit:r,precision:t})}toString(){let e=this.type;if(this.range){let[t="",i=""]=this.range;e+=`[${t},${i}]`}return e}percentageRange(e=1){let t;return this.coordMeta&&this.coordMeta.range||this.coordRange&&this.coordRange[0]>=0?t=[0,1]:t=[-1,1],[t[0]*e,t[1]*e]}static get(e,t){return z_(e,this)?e:new this(e,t)}}const Mf=Symbol("instance");class cd{type;name;spaceCoords;coords;id;alpha;constructor(e,t=e.space){e[Mf]=this,this.type="function",this.name="color",Object.assign(this,e),this.space=t,this.type!=="custom"&&(this.spaceCoords=Object.values(t.coords),this.coords||(this.coords=this.spaceCoords.map(i=>{let r=["<number>","<percentage>"];return i.type==="angle"&&r.push("<angle>"),r})),this.coords=this.coords.map((i,r)=>{let s=this.spaceCoords[r];return typeof i=="string"&&(i=i.trim().split(/\s*\|\s*/)),i.map(o=>aw.get(o,s))}))}serializeCoords(e,t,i){return i=e.map((r,s)=>aw.get(i?.[s]??this.coords[s][0],this.spaceCoords[s])),e.map((r,s)=>i[s].serialize(r,t))}coerceCoords(e,t){return Object.entries(this.space.coords).map(([i,r],s)=>{let o=e[s];if(zn(o)||isNaN(o))return o;let a=t[s],l=this.coords[s].find(c=>c.type==a);if(!l){let c=r.name||i;throw new TypeError(`${a??o?.raw??o} not allowed for ${c} in ${this.name}()`)}return o=l.resolve(o),l.range&&(t[s]=l.toString()),o})}canSerialize(){return this.type==="function"||this.serialize}parse(e){return null}static get(e,...t){return!e||z_(e,this)?e:e[Mf]?e[Mf]:new cd(e,...t)}}class x9{add(e,t,i){if(typeof arguments[0]!="string"){for(var e in arguments[0])this.add(e,arguments[0][e],arguments[1]);return}(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}}const hd=new x9,br={D50:[.3457/.3585,1,(1-.3457-.3585)/.3585],D65:[.3127/.329,1,(1-.3127-.329)/.329]};function h0(n){return Array.isArray(n)?n:br[n]}function ud(n,e,t,i={}){if(n=h0(n),e=h0(e),!n||!e)throw new TypeError(`Missing white point to convert ${n?"":"from"}${!n&&!e?"/":""}${e?"":"to"}`);if(n===e)return t;let r={W1:n,W2:e,XYZ:t,options:i};if(hd.run("chromatic-adaptation-start",r),r.M||(r.W1===br.D65&&r.W2===br.D50?r.M=[[1.0479297925449969,.022946870601609652,-.05019226628920524],[.02962780877005599,.9904344267538799,-.017073799063418826],[-.009243040646204504,.015055191490298152,.7518742814281371]]:r.W1===br.D50&&r.W2===br.D65&&(r.M=[[.955473421488075,-.02309845494876471,.06325924320057072],[-.0283697093338637,1.0099953980813041,.021041441191917323],[.012314014864481998,-.020507649298898964,1.330365926242124]])),hd.run("chromatic-adaptation-end",r),r.M)return tn(r.XYZ,r.M);throw new TypeError("Only Bradford CAT with white points D50 and D65 supported for now.")}var rh={gamut_mapping:"css",precision:5,deltaE:"76",verbose:"production".toLowerCase()!=="test",warn:function(e){this.verbose&&globalThis?.console?.warn?.(e)}};function GS(n,e){let t={str:String(n)?.trim(),options:e};if(hd.run("parse-start",t),t.color)return t.color;t.parsed=y9(t.str);let i,r=t.options?t.options.parseMeta??t.options.meta:null;if(t.parsed){let s=t.parsed.name,o,a,l=t.parsed.args,c=l.map((d,p)=>t.parsed.argMeta[p]?.type);if(s==="color"){let d=l.shift();c.shift();let p=d.startsWith("--")?d.substring(2):`--${d}`,_=[d,p];if(o=ue.findFormat({name:s,id:_,type:"function"}),!o){let v,m=d in ue.registry?d:p;if(m in ue.registry){let f=ue.registry[m].formats?.color?.id;f&&(v=`Did you mean ${n.replace("color("+d,"color("+f)}?`)}throw new TypeError(`Cannot parse ${t.str}. `+(v??"Missing a plugin?"))}a=o.space,o.id.startsWith("--")&&!d.startsWith("--")&&rh.warn(`${a.name} is a non-standard space and not currently supported in the CSS spec. Use prefixed color(${o.id}) instead of color(${d}).`),d.startsWith("--")&&!o.id.startsWith("--")&&rh.warn(`${a.name} is a standard space and supported in the CSS spec. Use color(${o.id}) instead of prefixed color(${d}).`)}else o=ue.findFormat({name:s,type:"function"}),a=o.space;r&&Object.assign(r,{format:o,formatId:o.name,types:c,commas:t.parsed.commas});let h=1;t.parsed.lastAlpha&&(h=t.parsed.args.pop(),r&&(r.alphaType=c.pop()));let u=o.coords.length;if(l.length!==u)throw new TypeError(`Expected ${u} coordinates for ${a.id} in ${t.str}), got ${l.length}`);l=o.coerceCoords(l,c),i={spaceId:a.id,coords:l,alpha:h}}else e:for(let s of ue.all)for(let o in s.formats){let a=s.formats[o];if(a.type!=="custom"||a.test&&!a.test(t.str))continue;let l=s.getFormat(a),c=l.parse(t.str);if(c){r&&Object.assign(r,{format:l,formatId:o}),i=c;break e}}if(!i)throw new TypeError(`Could not parse ${n} as a color. Missing a plugin?`);return i.alpha=zn(i.alpha)?i.alpha:i.alpha===void 0?1:$S(0,i.alpha,1),i}const jS={"%":.01,deg:1,grad:.9,rad:180/Math.PI,turn:360},dd={function:/^([a-z]+)\(((?:calc\(NaN\)|.)+?)\)$/i,number:/^([-+]?(?:[0-9]*\.)?[0-9]+(e[-+]?[0-9]+)?)$/i,unitValue:RegExp(`(${Object.keys(jS).join("|")})$`),singleArgument:/\/?\s*(none|NaN|calc\(NaN\)|[-+\w.]+(?:%|deg|g?rad|turn)?)/g};function w9(n){let e={},t=n.match(dd.unitValue)?.[0],i=e.raw=n;return t?(e.type=t==="%"?"<percentage>":"<angle>",e.unit=t,e.unitless=Number(i.slice(0,-t.length)),i=e.unitless*jS[t]):dd.number.test(i)?(i=Number(i),e.type="<number>"):i==="none"?i=null:i==="NaN"||i==="calc(NaN)"?(i=NaN,e.type="<number>"):e.type="<ident>",{value:i,meta:e}}function y9(n){if(!n)return;n=n.trim();let e=n.match(dd.function);if(e){let t=[],i=[],r=!1,s=e[1].toLowerCase(),o=e[2].replace(dd.singleArgument,(a,l)=>{let{value:c,meta:h}=w9(l);return(a.startsWith("/")||s!=="color"&&t.length===3)&&(r=!0),t.push(c),i.push(h),""});return{name:s,args:t,argMeta:i,lastAlpha:r,commas:o.includes(","),rawName:e[1],rawArgs:e[2]}}}function fn(n,e){if(Array.isArray(n))return n.map(i=>fn(i,e));if(!n)throw new TypeError("Empty color reference");VS(n)&&(n=GS(n,e));let t=n.space||n.spaceId;return typeof t=="string"&&(n.space=ue.get(t)),n.alpha===void 0&&(n.alpha=1),n}const E9=75e-6;class ue{constructor(e){this.id=e.id,this.name=e.name,this.base=e.base?ue.get(e.base):null,this.aliases=e.aliases,this.base&&(this.fromBase=e.fromBase,this.toBase=e.toBase);let t=e.coords??this.base.coords;for(let r in t)"name"in t[r]||(t[r].name=r);this.coords=t;let i=e.white??this.base.white??"D65";this.white=h0(i),this.formats=e.formats??{};for(let r in this.formats){let s=this.formats[r];s.type||="function",s.name||=r}this.formats.color?.id||(this.formats.color={...this.formats.color??{},id:e.cssId||this.id}),e.gamutSpace?this.gamutSpace=e.gamutSpace==="self"?this:ue.get(e.gamutSpace):this.isPolar?this.gamutSpace=this.base:this.gamutSpace=this,this.gamutSpace.isUnbounded&&(this.inGamut=(r,s)=>!0),this.referred=e.referred,Object.defineProperty(this,"path",{value:C9(this).reverse(),writable:!1,enumerable:!0,configurable:!0}),hd.run("colorspace-init-end",this)}inGamut(e,{epsilon:t=E9}={}){if(!this.equals(this.gamutSpace))return e=this.to(this.gamutSpace,e),this.gamutSpace.inGamut(e,{epsilon:t});let i=Object.values(this.coords);return e.every((r,s)=>{let o=i[s];if(o.type!=="angle"&&o.range){if(zn(r))return!0;let[a,l]=o.range;return(a===void 0||r>=a-t)&&(l===void 0||r<=l+t)}return!0})}get isUnbounded(){return Object.values(this.coords).every(e=>!("range"in e))}get cssId(){return this.formats?.color?.id||this.id}get isPolar(){for(let e in this.coords)if(this.coords[e].type==="angle")return!0;return!1}getFormat(e){if(!e)return null;e==="default"?e=Object.values(this.formats)[0]:typeof e=="string"&&(e=this.formats[e]);let t=cd.get(e,this);return t!==e&&e.name in this.formats&&(this.formats[e.name]=t),t}equals(e){return e?this===e||this.id===e||this.id===e.id:!1}to(e,t){if(arguments.length===1){const a=fn(e);[e,t]=[a.space,a.coords]}if(e=ue.get(e),this.equals(e))return t;t=t.map(a=>zn(a)?0:a);let i=this.path,r=e.path,s,o;for(let a=0;a<i.length&&i[a].equals(r[a]);a++)s=i[a],o=a;if(!s)throw new Error(`Cannot convert between color spaces ${this} and ${e}: no connection space was found`);for(let a=i.length-1;a>o;a--)t=i[a].toBase(t);for(let a=o+1;a<r.length;a++)t=r[a].fromBase(t);return t}from(e,t){if(arguments.length===1){const i=fn(e);[e,t]=[i.space,i.coords]}return e=ue.get(e),e.to(this,t)}toString(){return`${this.name} (${this.id})`}getMinCoords(){let e=[];for(let t in this.coords){let i=this.coords[t],r=i.range||i.refRange;e.push(r?.min??0)}return e}static registry={};static get all(){return[...new Set(Object.values(ue.registry))]}static register(e,t){if(arguments.length===1&&(t=arguments[0],e=t.id),t=this.get(t),this.registry[e]&&this.registry[e]!==t)throw new Error(`Duplicate color space registration: '${e}'`);if(this.registry[e]=t,arguments.length===1&&t.aliases)for(let i of t.aliases)this.register(i,t);return t}static get(e,...t){if(!e||z_(e,this))return e;if(Pc(e)==="string"){let r=ue.registry[e.toLowerCase()];if(!r)throw new TypeError(`No color space found with id = "${e}"`);return r}if(t.length)return ue.get(...t);throw new TypeError(`${e} is not a valid color space`)}static findFormat(e,t=ue.all){if(!e)return null;typeof e=="string"&&(e={name:e});for(let i of t)for(let[r,s]of Object.entries(i.formats)){s.name??=r,s.type??="function";let o=(!e.name||s.name===e.name)&&(!e.type||s.type===e.type);if(e.id){let a=s.ids||[s.id],l=Array.isArray(e.id)?e.id:[e.id];o&&=l.some(c=>a.includes(c))}if(o){let a=cd.get(s,i);return a!==s&&(i.formats[s.name]=a),a}}return null}static resolveCoord(e,t){let i=Pc(e),r,s;if(i==="string"?e.includes(".")?[r,s]=e.split("."):[r,s]=[,e]:Array.isArray(e)?[r,s]=e:(r=e.space,s=e.coordId),r=ue.get(r),r||(r=t),!r)throw new TypeError(`Cannot resolve coordinate reference ${e}: No color space specified and relative references are not allowed here`);if(i=Pc(s),i==="number"||i==="string"&&s>=0){let l=Object.entries(r.coords)[s];if(l)return{space:r,id:l[0],index:s,...l[1]}}r=ue.get(r);let o=s.toLowerCase(),a=0;for(let l in r.coords){let c=r.coords[l];if(l.toLowerCase()===o||c.name?.toLowerCase()===o)return{space:r,id:l,index:a,...c};a++}throw new TypeError(`No "${s}" coordinate found in ${r.name}. Its coordinates are: ${Object.keys(r.coords).join(", ")}`)}static DEFAULT_FORMAT={type:"functions",name:"color"}}function C9(n){let e=[n];for(let t=n;t=t.base;)e.push(t);return e}var Er=new ue({id:"xyz-d65",name:"XYZ D65",coords:{x:{refRange:[0,1],name:"X"},y:{refRange:[0,1],name:"Y"},z:{refRange:[0,1],name:"Z"}},white:"D65",formats:{color:{ids:["xyz-d65","xyz"]}},aliases:["xyz"]});class Nr extends ue{constructor(e){e.coords||(e.coords={r:{range:[0,1],name:"Red"},g:{range:[0,1],name:"Green"},b:{range:[0,1],name:"Blue"}}),e.base||(e.base=Er),e.toXYZ_M&&e.fromXYZ_M&&(e.toBase??=t=>{let i=tn(t,e.toXYZ_M);return this.white!==this.base.white&&(i=ud(this.white,this.base.white,i)),i},e.fromBase??=t=>(t=ud(this.base.white,this.white,t),tn(t,e.fromXYZ_M))),e.referred??="display",super(e)}}function ep(n,e){n=fn(n);let t=ue.get(e,e?.space),i=e?.precision,r;return!t||n.space.equals(t)?r=n.coords.slice():r=t.from(n),i===void 0?r:r.map(s=>BS(s,i))}function Xa(n,e){if(n=fn(n),e==="alpha")return n.alpha??1;let{space:t,index:i}=ue.resolveCoord(e,n.space);return ep(n,t)[i]}function $_(n,e,t,i){return n=fn(n),Array.isArray(e)&&([e,t,i]=[n.space,e,t]),e=ue.get(e),n.coords=e===n.space?t.slice():e.to(n.space,t),i!==void 0&&(n.alpha=i),n}$_.returns="color";function Al(n,e,t){if(n=fn(n),arguments.length===2&&Pc(arguments[1])==="object"){let i=arguments[1];for(let r in i)Al(n,r,i[r])}else if(typeof t=="function"&&(t=t(Xa(n,e))),e==="alpha")n.alpha=t;else{let{space:i,index:r}=ue.resolveCoord(e,n.space),s=ep(n,i);s[r]=t,$_(n,i,s)}return n}Al.returns="color";var H_=new ue({id:"xyz-d50",name:"XYZ D50",white:"D50",base:Er,fromBase:n=>ud(Er.white,"D50",n),toBase:n=>ud("D50",Er.white,n)});const S9=216/24389,lw=24/116,du=24389/27;let Pf=br.D50;var xr=new ue({id:"lab",name:"Lab",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Pf,base:H_,fromBase(n){let t=n.map((o,a)=>o/Pf[a]).map(o=>o>S9?Math.cbrt(o):(du*o+16)/116),i=116*t[1]-16,r=500*(t[0]-t[1]),s=200*(t[1]-t[2]);return[i,r,s]},toBase(n){let[e,t,i]=n,r=[];return r[1]=(e+16)/116,r[0]=t/500+r[1],r[2]=r[1]-i/200,[r[0]>lw?Math.pow(r[0],3):(116*r[0]-16)/du,n[0]>8?Math.pow((n[0]+16)/116,3):n[0]/du,r[2]>lw?Math.pow(r[2],3):(116*r[2]-16)/du].map((o,a)=>o*Pf[a])},formats:{lab:{coords:["<percentage> | <number>","<number> | <percentage>","<number> | <percentage>"]}}});function Fr(n){return typeof n!="number"?n:(n%360+360)%360}var ds=new ue({id:"lch",name:"LCH",coords:{l:{refRange:[0,100],name:"Lightness"},c:{refRange:[0,150],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:xr,fromBase(n){if(this.===void 0){let a=Object.values(this.base.coords)[1].refRange,l=a[1]-a[0];this.=l/1e5}let[e,t,i]=n,r=Math.abs(t)<this.&&Math.abs(i)<this.,s=r?null:Fr(Math.atan2(i,t)*180/Math.PI),o=r?0:Math.sqrt(t**2+i**2);return[e,o,s]},toBase(n){let[e,t,i]=n,r=null,s=null;return zn(i)||(t=t<0?0:t,r=t*Math.cos(i*Math.PI/180),s=t*Math.sin(i*Math.PI/180)),[e,r,s]},formats:{lch:{coords:["<percentage> | <number>","<number> | <percentage>","<number> | <angle>"]}}});const cw=25**7,pd=Math.PI,hw=180/pd,za=pd/180;function uw(n){const e=n*n;return e*e*e*n}function WS(n,e,{kL:t=1,kC:i=1,kH:r=1}={}){[n,e]=fn([n,e]);let[s,o,a]=xr.from(n),l=ds.from(xr,[s,o,a])[1],[c,h,u]=xr.from(e),d=ds.from(xr,[c,h,u])[1];l<0&&(l=0),d<0&&(d=0);let p=(l+d)/2,_=uw(p),v=.5*(1-Math.sqrt(_/(_+cw))),m=(1+v)*o,f=(1+v)*h,g=Math.sqrt(m**2+a**2),b=Math.sqrt(f**2+u**2),y=m===0&&a===0?0:Math.atan2(a,m),M=f===0&&u===0?0:Math.atan2(u,f);y<0&&(y+=2*pd),M<0&&(M+=2*pd),y*=hw,M*=hw;let S=c-s,P=b-g,A=M-y,x=y+M,E=Math.abs(A),R;g*b===0?R=0:E<=180?R=A:A>180?R=A-360:A<-180?R=A+360:rh.warn("the unthinkable has happened");let O=2*Math.sqrt(b*g)*Math.sin(R*za/2),F=(s+c)/2,G=(g+b)/2,H=uw(G),B;g*b===0?B=x:E<=180?B=x/2:x<360?B=(x+360)/2:B=(x-360)/2;let W=(F-50)**2,$=1+.015*W/Math.sqrt(20+W),Q=1+.045*G,ee=1;ee-=.17*Math.cos((B-30)*za),ee+=.24*Math.cos(2*B*za),ee+=.32*Math.cos((3*B+6)*za),ee-=.2*Math.cos((4*B-63)*za);let me=1+.015*G*ee,De=30*Math.exp(-1*((B-275)/25)**2),Je=2*Math.sqrt(H/(H+cw)),Be=-1*Math.sin(2*De*za)*Je,ze=(S/(t*$))**2;return ze+=(P/(i*Q))**2,ze+=(O/(r*me))**2,ze+=Be*(P/(i*Q))*(O/(r*me)),Math.sqrt(ze)}const M9=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],P9=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],T9=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],qs=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]];var Lr=new ue({id:"oklab",name:"Oklab",coords:{l:{refRange:[0,1],name:"Lightness"},a:{refRange:[-.4,.4]},b:{refRange:[-.4,.4]}},white:"D65",base:Er,fromBase(n){let e=tn(n,M9);return e[0]=Math.cbrt(e[0]),e[1]=Math.cbrt(e[1]),e[2]=Math.cbrt(e[2]),tn(e,T9,e)},toBase(n){let e=tn(n,qs);return e[0]=e[0]**3,e[1]=e[1]**3,e[2]=e[2]**3,tn(e,P9,e)},formats:{oklab:{coords:["<percentage> | <number>","<number> | <percentage>","<number> | <percentage>"]}}});function u0(n,e){[n,e]=fn([n,e]);let[t,i,r]=Lr.from(n),[s,o,a]=Lr.from(e),l=t-s,c=i-o,h=r-a;return Math.sqrt(l**2+c**2+h**2)}const A9=75e-6;function cl(n,e,{epsilon:t=A9}={}){n=fn(n),e||(e=n.space),e=ue.get(e);let i=n.coords;return e!==n.space&&(i=e.from(n)),e.inGamut(i,{epsilon:t})}function G_(n){return{space:n.space,coords:n.coords.slice(),alpha:n.alpha}}function R9(n,e,t="lab"){t=ue.get(t);let i=t.from(n),r=t.from(e);return Math.sqrt(i.reduce((s,o,a)=>{let l=r[a];return zn(o)||zn(l)?s:s+(l-o)**2},0))}function L9(n,e){return R9(n,e,"lab")}const D9=Math.PI,dw=D9/180;function k9(n,e,{l:t=2,c:i=1}={}){[n,e]=fn([n,e]);let[r,s,o]=xr.from(n),[,a,l]=ds.from(xr,[r,s,o]),[c,h,u]=xr.from(e),d=ds.from(xr,[c,h,u])[1];a<0&&(a=0),d<0&&(d=0);let p=r-c,_=a-d,v=s-h,m=o-u,f=v**2+m**2-_**2,g=.511;r>=16&&(g=.040975*r/(1+.01765*r));let b=.0638*a/(1+.0131*a)+.638,y;zn(l)&&(l=0),l>=164&&l<=345?y=.56+Math.abs(.2*Math.cos((l+168)*dw)):y=.36+Math.abs(.4*Math.cos((l+35)*dw));let M=Math.pow(a,4),S=Math.sqrt(M/(M+1900)),P=b*(S*y+1-S),A=(p/(t*g))**2;return A+=(_/(i*b))**2,A+=f/P**2,Math.sqrt(A)}const pw=203;var KS=new ue({id:"xyz-abs-d65",cssId:"--xyz-abs-d65",name:"Absolute XYZ D65",coords:{x:{refRange:[0,9504.7],name:"Xa"},y:{refRange:[0,1e4],name:"Ya"},z:{refRange:[0,10888.3],name:"Za"}},base:Er,fromBase(n){return n.map(e=>e*pw)},toBase(n){return n.map(e=>e/pw)}});const pu=1.15,fu=.66,fw=2610/2**14,I9=2**14/2610,mw=3424/2**12,vw=2413/2**7,_w=2392/2**7,O9=1.7*2523/2**5,gw=2**5/(1.7*2523),mu=-.56,Tf=16295499532821565e-27,N9=[[.41478972,.579999,.014648],[-.20151,1.120649,.0531008],[-.0166008,.2648,.6684799]],F9=[[1.9242264357876067,-1.0047923125953657,.037651404030618],[.35031676209499907,.7264811939316552,-.06538442294808501],[-.09098281098284752,-.3127282905230739,1.5227665613052603]],V9=[[.5,.5,0],[3.524,-4.066708,.542708],[.199076,1.096799,-1.295875]],U9=[[1,.13860504327153927,.05804731615611883],[1,-.1386050432715393,-.058047316156118904],[1,-.09601924202631895,-.811891896056039]];var B9=new ue({id:"jzazbz",name:"Jzazbz",coords:{jz:{refRange:[0,1],name:"Jz"},az:{refRange:[-.21,.21]},bz:{refRange:[-.21,.21]}},base:KS,fromBase(n){let[e,t,i]=n,r=pu*e-(pu-1)*i,s=fu*t-(fu-1)*e,a=tn([r,s,i],N9).map(function(d){let p=mw+vw*_n(d/1e4,fw),_=1+_w*_n(d/1e4,fw);return _n(p/_,O9)}),[l,c,h]=tn(a,V9);return[(1+mu)*l/(1+mu*l)-Tf,c,h]},toBase(n){let[e,t,i]=n,r=(e+Tf)/(1+mu-mu*(e+Tf)),o=tn([r,t,i],U9).map(function(d){let p=mw-_n(d,gw),_=_w*_n(d,gw)-vw;return 1e4*_n(p/_,I9)}),[a,l,c]=tn(o,F9),h=(a+(pu-1)*c)/pu,u=(l+(fu-1)*h)/fu;return[h,u,c]},formats:{jzazbz:{coords:["<percentage> | <number>","<number> | <percentage>","<number> | <percentage>"]}}}),bw=new ue({id:"jzczhz",name:"JzCzHz",coords:{jz:{refRange:[0,1],name:"Jz"},cz:{refRange:[0,.26],name:"Chroma"},hz:{refRange:[0,360],type:"angle",name:"Hue"}},base:B9,fromBase:ds.fromBase,toBase:ds.toBase,formats:{jzczhz:{coords:["<percentage> | <number>","<number> | <percentage>","<number> | <angle>"]}}});function z9(n,e){[n,e]=fn([n,e]);let[t,i,r]=bw.from(n),[s,o,a]=bw.from(e),l=t-s,c=i-o;zn(r)&&zn(a)?(r=0,a=0):zn(r)?r=a:zn(a)&&(a=r);let h=r-a,u=2*Math.sqrt(i*o)*Math.sin(h/2*(Math.PI/180));return Math.sqrt(l**2+c**2+u**2)}const XS=3424/4096,qS=2413/128,YS=2392/128,xw=2610/16384,$9=2523/32,H9=16384/2610,ww=32/2523,G9=[[.3592832590121217,.6976051147779502,-.035891593232029],[-.1920808463704993,1.100476797037432,.0753748658519118],[.0070797844607479,.0748396662186362,.8433265453898765]],j9=[[2048/4096,2048/4096,0],[6610/4096,-13613/4096,7003/4096],[17933/4096,-17390/4096,-543/4096]],W9=[[.9999999999999998,.0086090370379328,.111029625003026],[.9999999999999998,-.0086090370379328,-.1110296250030259],[.9999999999999998,.5600313357106791,-.3206271749873188]],K9=[[2.0701522183894223,-1.3263473389671563,.2066510476294053],[.3647385209748072,.6805660249472273,-.0453045459220347],[-.0497472075358123,-.0492609666966131,1.1880659249923042]];var yw=new ue({id:"ictcp",name:"ICTCP",coords:{i:{refRange:[0,1],name:"I"},ct:{refRange:[-.5,.5],name:"CT"},cp:{refRange:[-.5,.5],name:"CP"}},base:KS,fromBase(n){let e=tn(n,G9);return X9(e)},toBase(n){let e=q9(n);return tn(e,K9)},formats:{ictcp:{coords:["<percentage> | <number>","<number> | <percentage>","<number> | <percentage>"]}}});function X9(n){let e=n.map(function(t){let i=XS+qS*(t/1e4)**xw,r=1+YS*(t/1e4)**xw;return(i/r)**$9});return tn(e,j9)}function q9(n){return tn(n,W9).map(function(i){let r=Math.max(i**ww-XS,0),s=qS-YS*i**ww;return 1e4*(r/s)**H9})}function Y9(n,e){[n,e]=fn([n,e]);let[t,i,r]=yw.from(n),[s,o,a]=yw.from(e);return 720*Math.sqrt((t-s)**2+.25*(i-o)**2+(r-a)**2)}function Z9(n,e){[n,e]=fn([n,e]);let t=2,[i,r,s]=Lr.from(n),[o,a,l]=Lr.from(e),c=i-o,h=t*(r-a),u=t*(s-l);return Math.sqrt(c**2+h**2+u**2)}const J9=br.D65,ZS=.42,Ew=1/ZS,Af=2*Math.PI,JS=[[.401288,.650173,-.051461],[-.250268,1.204414,.045854],[-.002079,.048952,.953127]],Q9=[[1.8620678550872327,-1.0112546305316843,.14918677544445175],[.38752654323613717,.6214474419314753,-.008973985167612518],[-.015841498849333856,-.03412293802851557,1.0499644368778496]],e6=[[460,451,288],[460,-891,-261],[460,-220,-6300]],t6={dark:[.8,.525,.8],dim:[.9,.59,.9],average:[1,.69,1]},To={h:[20.14,90,164.25,237.53,380.14],e:[.8,.7,1,1.2,.8],H:[0,100,200,300,400]},n6=180/Math.PI,Cw=Math.PI/180;function QS(n,e){return n.map(i=>{const r=_n(e*Math.abs(i)*.01,ZS);return 400*B_(r,i)/(r+27.13)})}function i6(n,e){const t=100/e*27.13**Ew;return n.map(i=>{const r=Math.abs(i);return B_(t*_n(r/(400-r),Ew),i)})}function r6(n){let e=Fr(n);e<=To.h[0]&&(e+=360);const t=b9(To.h,e)-1,[i,r]=To.h.slice(t,t+2),[s,o]=To.e.slice(t,t+2),a=To.H[t],l=(e-i)/s;return a+100*l/(l+(r-e)/o)}function s6(n){let e=(n%400+400)%400;const t=Math.floor(.01*e);e=e%100;const[i,r]=To.h.slice(t,t+2),[s,o]=To.e.slice(t,t+2);return Fr((e*(o*i-s*r)-100*i*o)/(e*(o-s)-100*o))}function eM(n,e,t,i,r){const s={};s.discounting=r,s.refWhite=n,s.surround=i;const o=n.map(m=>m*100);s.la=e,s.yb=t;const a=o[1],l=tn(o,JS);let c=t6[s.surround];const h=c[0];s.c=c[1],s.nc=c[2];const d=(1/(5*s.la+1))**4;s.fl=d*s.la+.1*(1-d)*(1-d)*Math.cbrt(5*s.la),s.flRoot=s.fl**.25,s.n=s.yb/a,s.z=1.48+Math.sqrt(s.n),s.nbb=.725*s.n**-.2,s.ncb=s.nbb;const p=Math.max(Math.min(h*(1-1/3.6*Math.exp((-s.la-42)/92)),1),0);s.dRgb=l.map(m=>zS(1,a/m,p)),s.dRgbInv=s.dRgb.map(m=>1/m);const _=l.map((m,f)=>m*s.dRgb[f]),v=QS(_,s.fl);return s.aW=s.nbb*(2*v[0]+v[1]+.05*v[2]),s}const Sw=eM(J9,64/Math.PI*.2,20,"average",!1);function d0(n,e){if(!(n.J!==void 0^n.Q!==void 0))throw new Error("Conversion requires one and only one: 'J' or 'Q'");if(!(n.C!==void 0^n.M!==void 0^n.s!==void 0))throw new Error("Conversion requires one and only one: 'C', 'M' or 's'");if(!(n.h!==void 0^n.H!==void 0))throw new Error("Conversion requires one and only one: 'h' or 'H'");if(n.J===0||n.Q===0)return[0,0,0];let t=0;n.h!==void 0?t=Fr(n.h)*Cw:t=s6(n.H)*Cw;const i=Math.cos(t),r=Math.sin(t);let s=0;n.J!==void 0?s=_n(n.J,1/2)*.1:n.Q!==void 0&&(s=.25*e.c*n.Q/((e.aW+4)*e.flRoot));let o=0;n.C!==void 0?o=n.C/s:n.M!==void 0?o=n.M/e.flRoot/s:n.s!==void 0&&(o=4e-4*n.s**2*(e.aW+4)/e.c);const a=_n(o*Math.pow(1.64-Math.pow(.29,e.n),-.73),10/9),l=.25*(Math.cos(t+2)+3.8),c=e.aW*_n(s,2/e.c/e.z),h=5e4/13*e.nc*e.ncb*l,u=c/e.nbb,d=23*(u+.305)*HS(a,23*h+a*(11*i+108*r)),p=d*i,_=d*r,v=i6(tn([u,p,_],e6).map(m=>m*1/1403),e.fl);return tn(v.map((m,f)=>m*e.dRgbInv[f]),Q9).map(m=>m/100)}function tM(n,e){const t=n.map(b=>b*100),i=QS(tn(t,JS).map((b,y)=>b*e.dRgb[y]),e.fl),r=i[0]+(-12*i[1]+i[2])/11,s=(i[0]+i[1]-2*i[2])/9,o=(Math.atan2(s,r)%Af+Af)%Af,a=.25*(Math.cos(o+2)+3.8),l=5e4/13*e.nc*e.ncb*HS(a*Math.sqrt(r**2+s**2),i[0]+i[1]+1.05*i[2]+.305),c=_n(l,.9)*Math.pow(1.64-Math.pow(.29,e.n),.73),h=e.nbb*(2*i[0]+i[1]+.05*i[2]),u=_n(h/e.aW,.5*e.c*e.z),d=100*_n(u,2),p=4/e.c*u*(e.aW+4)*e.flRoot,_=c*u,v=_*e.flRoot,m=Fr(o*n6),f=r6(m),g=50*_n(e.c*c/(e.aW+4),1/2);return{J:d,C:_,h:m,s:g,Q:p,M:v,H:f}}new ue({id:"cam16-jmh",cssId:"--cam16-jmh",name:"CAM16-JMh",coords:{j:{refRange:[0,100],name:"J"},m:{refRange:[0,105],name:"Colorfulness"},h:{refRange:[0,360],type:"angle",name:"Hue"}},base:Er,fromBase(n){this.===void 0&&(this.=Object.values(this.coords)[1].refRange[1]/1e5);const e=tM(n,Sw),t=Math.abs(e.M)<this.;return[e.J,t?0:e.M,t?null:e.h]},toBase(n){return d0({J:n[0],M:n[1],h:n[2]},Sw)}});const o6=br.D65,a6=216/24389,nM=24389/27;function l6(n){return 116*(n>a6?Math.cbrt(n):(nM*n+16)/116)-16}function p0(n){return n>8?Math.pow((n+16)/116,3):n/nM}function c6(n,e){let[t,i,r]=n,s=[],o=0;if(r===0)return[0,0,0];let a=p0(r);r>0?o=.00379058511492914*r**2+.608983189401032*r+.9155088574762233:o=9514440756550361e-21*r**2+.08693057439788597*r-21.928975842194614;const l=2e-12,c=15;let h=0,u=1/0;for(;h<=c;){s=d0({J:o,C:i,h:t},e);const d=Math.abs(s[1]-a);if(d<u){if(d<=l)return s;u=d}o=o-(s[1]-a)*o/(2*s[1]),h+=1}return d0({J:o,C:i,h:t},e)}function h6(n,e){const t=l6(n[1]);if(t===0)return[0,0,0];const i=tM(n,j_);return[Fr(i.h),i.C,t]}const j_=eM(o6,200/Math.PI*p0(50),p0(50)*100,"average",!1);var fd=new ue({id:"hct",name:"HCT",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},c:{refRange:[0,145],name:"Colorfulness"},t:{refRange:[0,100],name:"Tone"}},base:Er,fromBase(n){this.===void 0&&(this.=Object.values(this.coords)[1].refRange[1]/1e5);let e=h6(n);return e[1]<this.&&(e[1]=0,e[0]=null),e},toBase(n){return c6(n,j_)},formats:{color:{id:"--hct",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});const u6=Math.PI/180,Mw=[1,.007,.0228];function Pw(n){n[1]<0&&(n=fd.fromBase(fd.toBase(n)));const e=Math.log(Math.max(1+Mw[2]*n[1]*j_.flRoot,1))/Mw[2],t=n[0]*u6,i=e*Math.cos(t),r=e*Math.sin(t);return[n[2],i,r]}function d6(n,e){[n,e]=fn([n,e]);let[t,i,r]=Pw(fd.from(n)),[s,o,a]=Pw(fd.from(e));return Math.sqrt((t-s)**2+(i-o)**2+(r-a)**2)}var Tw={deltaE76:L9,deltaECMC:k9,deltaE2000:WS,deltaEJz:z9,deltaEITP:Y9,deltaEOK:u0,deltaEOK2:Z9,deltaEHCT:d6};function p6(n){const e=n?Math.floor(Math.log10(Math.abs(n))):0;return Math.max(parseFloat(`1e${e-2}`),1e-6)}const Aw={hct:{method:"hct.c",jnd:2,deltaEMethod:"hct",blackWhiteClamp:{}},"hct-tonal":{method:"hct.c",jnd:0,deltaEMethod:"hct",blackWhiteClamp:{channel:"hct.t",min:0,max:100}}};function sh(n,{method:e=rh.gamut_mapping,space:t=void 0,deltaEMethod:i="",jnd:r=2,blackWhiteClamp:s=void 0}={}){if(n=fn(n),VS(arguments[1])?t=arguments[1]:t||(t=n.space),t=ue.get(t),cl(n,t,{epsilon:0}))return n;let o;if(e==="css")o=iM(n,{space:t});else{if(e!=="clip"&&!cl(n,t)){Object.prototype.hasOwnProperty.call(Aw,e)&&({method:e,jnd:r,deltaEMethod:i,blackWhiteClamp:s}=Aw[e]);let a=WS;if(i!==""){for(let c in Tw)if("deltae"+i.toLowerCase()===c.toLowerCase()){a=Tw[c];break}}r===0&&(r=1e-16);let l=sh(cn(n,t),{method:"clip",space:t});if(a(n,l)>r){if(s&&Object.keys(s).length===3){let g=ue.resolveCoord(s.channel),b=Xa(cn(n,g.space),g.id);if(zn(b)&&(b=0),b>=s.max)return cn({space:"xyz-d65",coords:br.D65},n.space);if(b<=s.min)return cn({space:"xyz-d65",coords:[0,0,0]},n.space)}let c=ue.resolveCoord(e),h=c.space,u=c.id,d=cn(n,h);d.coords.forEach((g,b)=>{zn(g)&&(d.coords[b]=0)});let _=(c.range||c.refRange)[0],v=p6(r),m=_,f=Xa(d,u);for(;f-m>v;){let g=G_(d);g=sh(g,{space:t,method:"clip"}),a(d,g)-r<v?m=Xa(d,u):f=Xa(d,u),Al(d,u,(m+f)/2)}o=cn(d,t)}else o=l}else o=cn(n,t);if(e==="clip"||!cl(o,t,{epsilon:0})){let a=Object.values(t.coords).map(l=>l.range||[]);o.coords=o.coords.map((l,c)=>{let[h,u]=a[c];return h!==void 0&&(l=Math.max(h,l)),u!==void 0&&(l=Math.min(l,u)),l})}}return t!==n.space&&(o=cn(o,n.space)),n.coords=o.coords,n}sh.returns="color";const Rw={WHITE:{space:Lr,coords:[1,0,0],alpha:1},BLACK:{space:Lr,coords:[0,0,0],alpha:1}};function iM(n,{space:e}={}){n=fn(n),e||(e=n.space),e=ue.get(e);const r=ue.get("oklch");if(e.isUnbounded)return cn(n,e);const s=cn(n,r);let o=s.coords[0];if(o>=1){const _=cn(Rw.WHITE,e);return _.alpha=n.alpha,cn(_,e)}if(o<=0){const _=cn(Rw.BLACK,e);return _.alpha=n.alpha,cn(_,e)}if(cl(s,e,{epsilon:0}))return cn(s,e);function a(_){const v=cn(_,e),m=Object.values(e.coords);return v.coords=v.coords.map((f,g)=>{if("range"in m[g]){const[b,y]=m[g].range;return $S(b,f,y)}return f}),v}let l=0,c=s.coords[1],h=!0,u=G_(s),d=a(u),p=u0(d,u);if(p<.02)return d;for(;c-l>1e-4;){const _=(l+c)/2;if(u.coords[1]=_,h&&cl(u,e,{epsilon:0}))l=_;else if(d=a(u),p=u0(d,u),p<.02){if(.02-p<1e-4)break;h=!1,l=_}else c=_}return d}function cn(n,e,{inGamut:t}={}){n=fn(n),e=ue.get(e);let i=e.from(n),r={space:e,coords:i,alpha:n.alpha};return t&&(r=sh(r,t===!0?void 0:t)),r}cn.returns="color";function rM(n,e={}){let{precision:t=rh.precision,format:i,inGamut:r=!0,coords:s,alpha:o,commas:a}=e,l,c=fn(n),h=i,u=c.parseMeta;u&&!i&&(u.format.canSerialize()&&(i=u.format,h=u.formatId),s??=u.types,o??=u.alphaType,a??=u.commas),h&&(i=c.space.getFormat(i)??ue.findFormat(h)),i||(i=c.space.getFormat("default")??ue.DEFAULT_FORMAT,h=i.name),i&&i.space&&i.space!==c.space&&(c=cn(c,i.space));let d=c.coords.slice();if(r||=i.toGamut,r&&!cl(c)&&(d=sh(G_(c),r===!0?void 0:r).coords),i.type==="custom")if(i.serialize)l=i.serialize(d,c.alpha,e);else throw new TypeError(`format ${h} can only be used to parse colors, not for serialization`);else{let p=i.name||"color",_=i.serializeCoords(d,t,s);if(p==="color"){let b=i.id||i.ids?.[0]||c.space.cssId||c.space.id;_.unshift(b)}let v=c.alpha;o!==void 0&&typeof o!="object"&&(o=typeof o=="string"?{type:o}:{include:o});let m=o?.type??"<number>",f=o?.include===!0||i.alpha===!0||o?.include!==!1&&i.alpha!==!1&&v<1,g="";if(a??=i.commas,f){if(t!==null){let b;m==="<percentage>"&&(b="%",v*=100),v=US(v,{precision:t,unit:b})}g=`${a?",":" /"} ${v}`}l=`${p}(${_.join(a?", ":" ")}${g})`}return l}const f6=[[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],m6=[[1.716651187971268,-.355670783776392,-.25336628137366],[-.666684351832489,1.616481236634939,.0157685458139111],[.017639857445311,-.042770613257809,.942103121235474]];var v6=new Nr({id:"rec2020-linear",cssId:"--rec2020-linear",name:"Linear REC.2020",white:"D65",toXYZ_M:f6,fromXYZ_M:m6}),_6=new Nr({id:"rec2020",name:"REC.2020",base:v6,toBase(n){return n.map(function(e){let t=e<0?-1:1,i=e*t;return t*Math.pow(i,2.4)})},fromBase(n){return n.map(function(e){let t=e<0?-1:1,i=e*t;return t*Math.pow(i,1/2.4)})}});const g6=[[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],b6=[[2.493496911941425,-.9313836179191239,-.40271078445071684],[-.8294889695615747,1.7626640603183463,.023624685841943577],[.03584583024378447,-.07617238926804182,.9568845240076872]];var x6=new Nr({id:"p3-linear",cssId:"display-p3-linear",name:"Linear P3",white:"D65",toXYZ_M:g6,fromXYZ_M:b6});const w6=[[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],y6=[[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]];var sM=new Nr({id:"srgb-linear",name:"Linear sRGB",white:"D65",toXYZ_M:w6,fromXYZ_M:y6}),Lw={aliceblue:[240/255,248/255,1],antiquewhite:[250/255,235/255,215/255],aqua:[0,1,1],aquamarine:[127/255,1,212/255],azure:[240/255,1,1],beige:[245/255,245/255,220/255],bisque:[1,228/255,196/255],black:[0,0,0],blanchedalmond:[1,235/255,205/255],blue:[0,0,1],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,1,0],chocolate:[210/255,105/255,30/255],coral:[1,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[1,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0,1,1],darkblue:[0,0,139/255],darkcyan:[0,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0,100/255,0],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[1,140/255,0],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0,0],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0,206/255,209/255],darkviolet:[148/255,0,211/255],deeppink:[1,20/255,147/255],deepskyblue:[0,191/255,1],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,1],firebrick:[178/255,34/255,34/255],floralwhite:[1,250/255,240/255],forestgreen:[34/255,139/255,34/255],fuchsia:[1,0,1],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,1],gold:[1,215/255,0],goldenrod:[218/255,165/255,32/255],gray:[128/255,128/255,128/255],green:[0,128/255,0],greenyellow:[173/255,1,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,1,240/255],hotpink:[1,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0,130/255],ivory:[1,1,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[1,240/255,245/255],lawngreen:[124/255,252/255,0],lemonchiffon:[1,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,1,1],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[1,182/255,193/255],lightsalmon:[1,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[1,1,224/255],lime:[0,1,0],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[1,0,1],maroon:[128/255,0,0],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0,0,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,1,250/255],mistyrose:[1,228/255,225/255],moccasin:[1,228/255,181/255],navajowhite:[1,222/255,173/255],navy:[0,0,128/255],oldlace:[253/255,245/255,230/255],olive:[128/255,128/255,0],olivedrab:[107/255,142/255,35/255],orange:[1,165/255,0],orangered:[1,69/255,0],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[1,239/255,213/255],peachpuff:[1,218/255,185/255],peru:[205/255,133/255,63/255],pink:[1,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],purple:[128/255,0,128/255],rebeccapurple:[102/255,51/255,153/255],red:[1,0,0],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[1,245/255,238/255],sienna:[160/255,82/255,45/255],silver:[192/255,192/255,192/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[1,250/255,250/255],springgreen:[0,1,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],teal:[0,128/255,128/255],thistle:[216/255,191/255,216/255],tomato:[1,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],white:[1,1,1],whitesmoke:[245/255,245/255,245/255],yellow:[1,1,0],yellowgreen:[154/255,205/255,50/255]};let Dw=Array(3).fill("<percentage> | <number>[0, 255]"),kw=Array(3).fill("<number>[0, 255]");var oh=new Nr({id:"srgb",name:"sRGB",base:sM,fromBase:n=>n.map(e=>{let t=e<0?-1:1,i=e*t;return i>.0031308?t*(1.055*i**(1/2.4)-.055):12.92*e}),toBase:n=>n.map(e=>{let t=e<0?-1:1,i=e*t;return i<=.04045?e/12.92:t*((i+.055)/1.055)**2.4}),formats:{rgb:{coords:Dw},rgb_number:{name:"rgb",commas:!0,coords:kw,alpha:!1},color:{},rgba:{coords:Dw,commas:!0,alpha:!0},rgba_number:{name:"rgba",commas:!0,coords:kw},hex:{type:"custom",toGamut:!0,test:n=>/^#(([a-f0-9]{2}){3,4}|[a-f0-9]{3,4})$/i.test(n),parse(n){n.length<=5&&(n=n.replace(/[a-f0-9]/gi,"$&$&"));let e=[];return n.replace(/[a-f0-9]{2}/gi,t=>{e.push(parseInt(t,16)/255)}),{spaceId:"srgb",coords:e.slice(0,3),alpha:e.slice(3)[0]}},serialize:(n,e,{collapse:t=!0,alpha:i}={})=>{(i!==!1&&e<1||i===!0)&&n.push(e),n=n.map(o=>Math.round(o*255));let r=t&&n.every(o=>o%17===0);return"#"+n.map(o=>r?(o/17).toString(16):o.toString(16).padStart(2,"0")).join("")}},keyword:{type:"custom",test:n=>/^[a-z]+$/i.test(n),parse(n){n=n.toLowerCase();let e={spaceId:"srgb",coords:null,alpha:1};if(n==="transparent"?(e.coords=Lw.black,e.alpha=0):e.coords=Lw[n],e.coords)return e}}}}),E6=new Nr({id:"p3",cssId:"display-p3",name:"P3",base:x6,fromBase:oh.fromBase,toBase:oh.toBase});const C6=216/24389,Iw=24/116,vu=24389/27;let Rf=br.D65;var S6=new ue({id:"lab-d65",name:"Lab D65",coords:{l:{refRange:[0,100],name:"Lightness"},a:{refRange:[-125,125]},b:{refRange:[-125,125]}},white:Rf,base:Er,fromBase(n){let t=n.map((i,r)=>i/Rf[r]).map(i=>i>C6?Math.cbrt(i):(vu*i+16)/116);return[116*t[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])]},toBase(n){let e=[];return e[1]=(n[0]+16)/116,e[0]=n[1]/500+e[1],e[2]=e[1]-n[2]/200,[e[0]>Iw?Math.pow(e[0],3):(116*e[0]-16)/vu,n[0]>8?Math.pow((n[0]+16)/116,3):n[0]/vu,e[2]>Iw?Math.pow(e[2],3):(116*e[2]-16)/vu].map((i,r)=>i*Rf[r])},formats:{"lab-d65":{coords:["<number> | <percentage>","<number> | <percentage>","<number> | <percentage>"]}}}),M6=new ue({id:"hsl",name:"HSL",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},l:{range:[0,100],name:"Lightness"}},base:oh,fromBase:n=>{let e=Math.max(...n),t=Math.min(...n),[i,r,s]=n,[o,a,l]=[null,0,(t+e)/2],c=e-t;if(c!==0){switch(a=l===0||l===1?0:(e-l)/Math.min(l,1-l),e){case i:o=(r-s)/c+(r<s?6:0);break;case r:o=(s-i)/c+2;break;case s:o=(i-r)/c+4}o=o*60}return a<0&&(o+=180,a=Math.abs(a)),o>=360&&(o-=360),[o,a*100,l*100]},toBase:n=>{let[e,t,i]=n;e=e%360,e<0&&(e+=360),t/=100,i/=100;function r(s){let o=(s+e/30)%12,a=t*Math.min(i,1-i);return i-a*Math.max(-1,Math.min(o-3,9-o,1))}return[r(0),r(8),r(4)]},formats:{hsl:{coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]},hsla:{coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"],commas:!0,alpha:!0}}}),oM=new ue({id:"hsv",name:"HSV",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,100],name:"Saturation"},v:{range:[0,100],name:"Value"}},base:oh,fromBase(n){let e=Math.max(...n),t=Math.min(...n),[i,r,s]=n,[o,a,l]=[null,0,e],c=e-t;if(c!==0){switch(e){case i:o=(r-s)/c+(r<s?6:0);break;case r:o=(s-i)/c+2;break;case s:o=(i-r)/c+4}o=o*60}return l&&(a=c/l),o>=360&&(o-=360),[o,a*100,l*100]},toBase(n){let[e,t,i]=n;e=e%360,e<0&&(e+=360),t/=100,i/=100;function r(s){let o=(s+e/60)%6;return i-i*t*Math.max(0,Math.min(o,4-o,1))}return[r(5),r(3),r(1)]},formats:{color:{id:"--hsv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}}),P6=new ue({id:"hwb",name:"HWB",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},w:{range:[0,100],name:"Whiteness"},b:{range:[0,100],name:"Blackness"}},base:oM,fromBase(n){let[e,t,i]=n;return[e,i*(100-t)/100,100-i]},toBase(n){let[e,t,i]=n;t/=100,i/=100;let r=t+i;if(r>=1){let a=t/r;return[e,0,a*100]}let s=1-i,o=s===0?0:1-t/s;return[e,o*100,s*100]},formats:{hwb:{coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});const T6=[[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],A6=[[2.0415879038107465,-.5650069742788596,-.34473135077832956],[-.9692436362808795,1.8759675015077202,.04155505740717557],[.013444280632031142,-.11836239223101838,1.0151749943912054]];var R6=new Nr({id:"a98rgb-linear",cssId:"--a98-rgb-linear",name:"Linear Adobe 98 RGB compatible",white:"D65",toXYZ_M:T6,fromXYZ_M:A6}),L6=new Nr({id:"a98rgb",cssId:"a98-rgb",name:"Adobe 98 RGB compatible",base:R6,toBase:n=>n.map(e=>Math.pow(Math.abs(e),563/256)*Math.sign(e)),fromBase:n=>n.map(e=>Math.pow(Math.abs(e),256/563)*Math.sign(e))});const D6=[[.7977666449006423,.13518129740053308,.0313477341283922],[.2880748288194013,.711835234241873,8993693872564e-17],[0,0,.8251046025104602]],k6=[[1.3457868816471583,-.25557208737979464,-.05110186497554526],[-.5446307051249019,1.5082477428451468,.02052744743642139],[0,0,1.2119675456389452]];var I6=new Nr({id:"prophoto-linear",cssId:"--prophoto-rgb-linear",name:"Linear ProPhoto",white:"D50",base:H_,toXYZ_M:D6,fromXYZ_M:k6});const O6=1/512,N6=16/512;var F6=new Nr({id:"prophoto",cssId:"prophoto-rgb",name:"ProPhoto",base:I6,toBase(n){return n.map(e=>{let t=e<0?-1:1,i=e*t;return i<N6?e/16:t*i**1.8})},fromBase(n){return n.map(e=>{let t=e<0?-1:1,i=e*t;return i>=O6?t*i**(1/1.8):16*e})}}),V6=new ue({id:"oklch",name:"OkLCh",coords:{l:{refRange:[0,1],name:"Lightness"},c:{refRange:[0,.4],name:"Chroma"},h:{refRange:[0,360],type:"angle",name:"Hue"}},white:"D65",base:Lr,fromBase:ds.fromBase,toBase:ds.toBase,formats:{oklch:{coords:["<percentage> | <number>","<number> | <percentage>","<number> | <angle>"]}}});const Rl=2*Math.PI,md=[[4.076741636075958,-3.307711539258063,.2309699031821043],[-1.2684379732850315,2.609757349287688,-.341319376002657],[-.0041960761386756,-.7034186179359362,1.7076146940746117]],vd=[[[-1.8817031,-.80936501],[1.19086277,1.76576728,.59662641,.75515197,.56771245]],[[1.8144408,-1.19445267],[.73956515,-.45954404,.08285427,.12541073,-.14503204]],[[.13110758,1.81333971],[1.35733652,-.00915799,-1.1513021,-.50559606,.00692167]]],Lf=Number.MAX_VALUE,Tc=.206,W_=.03,Ec=(1+Tc)/(1+W_);function En(n,e){let t=n.length;if(t!==e.length)throw new Error(`Vectors of size ${t} and ${e.length} are not aligned`);let i=0;return n.forEach((r,s)=>{i+=r*e[s]}),i}function Nu(n){return .5*(Ec*n-Tc+Math.sqrt((Ec*n-Tc)*(Ec*n-Tc)+4*W_*Ec*n))}function Ac(n){return(n**2+Tc*n)/(Ec*(n+W_))}function K_(n){let[e,t]=n;return[t/e,t/(1-e)]}function U6(n,e){let t=.11516993+1/(7.4477897+4.1590124*e+n*(-2.19557347+1.75198401*e+n*(-2.13704948-10.02301043*e+n*(-4.24894561+5.38770819*e+4.69891013*n)))),i=.11239642+1/(1.6132032-.68124379*e+n*(.40370612+.90148123*e+n*(-.27087943+.6122399*e+n*(.00299215-.45399568*e-.14661872*n))));return[t,i]}function X_(n,e){let t=tn(n,qs);return t[0]=t[0]**3,t[1]=t[1]**3,t[2]=t[2]**3,tn(t,e,t)}function tp(n,e,t,i){let r=z6(n,e,t,i),s=X_([1,r*n,r*e],t),o=_n(1/Math.max(...s),1/3),a=o*r;return[o,a]}function B6(n,e,t,i,r,s,o,a){let l;if(a===void 0&&(a=tp(n,e,s,o)),(t-r)*a[1]-(a[0]-r)*i<=0)l=a[1]*r/(i*a[0]+a[1]*(r-t));else{l=a[1]*(r-1)/(i*(a[0]-1)+a[1]*(r-t));let c=t-r,h=i,u=En(qs[0].slice(1),[n,e]),d=En(qs[1].slice(1),[n,e]),p=En(qs[2].slice(1),[n,e]),_=c+h*u,v=c+h*d,m=c+h*p,f=r*(1-l)+l*t,g=l*i,b=f+g*u,y=f+g*d,M=f+g*p,S=b**3,P=y**3,A=M**3,x=3*_*b**2,E=3*v*y**2,R=3*m*M**2,O=6*_**2*b,F=6*v**2*y,G=6*m**2*M,H=En(s[0],[S,P,A])-1,B=En(s[0],[x,E,R]),W=En(s[0],[O,F,G]),$=B/(B*B-.5*H*W),Q=-H*$,ee=En(s[1],[S,P,A])-1,me=En(s[1],[x,E,R]),De=En(s[1],[O,F,G]),Je=me/(me*me-.5*ee*De),Be=-ee*Je,ze=En(s[2],[S,P,A])-1,K=En(s[2],[x,E,R]),Y=En(s[2],[O,F,G]),pe=K/(K*K-.5*ze*Y),ke=-ze*pe;Q=$>=0?Q:Lf,Be=Je>=0?Be:Lf,ke=pe>=0?ke:Lf,l+=Math.min(Q,Math.min(Be,ke))}return l}function aM(n,e,t){let[i,r,s]=n,o=tp(r,s,e,t),a=B6(r,s,i,1,i,e,t,o),l=K_(o),c=a/Math.min(i*l[0],(1-i)*l[1]),h=U6(r,s),u=i*h[0],d=(1-i)*h[1],p=.9*c*Math.sqrt(Math.sqrt(1/(1/u**4+1/d**4)));return u=i*.4,d=(1-i)*.8,[Math.sqrt(1/(1/u**2+1/d**2)),p,a]}function z6(n,e,t,i){let r,s,o,a,l,c,h,u;En(i[0][0],[n,e])>1?([r,s,o,a,l]=i[0][1],[c,h,u]=t[0]):En(i[1][0],[n,e])>1?([r,s,o,a,l]=i[1][1],[c,h,u]=t[1]):([r,s,o,a,l]=i[2][1],[c,h,u]=t[2]);let d=r+s*n+o*e+a*n**2+l*n*e,p=En(qs[0].slice(1),[n,e]),_=En(qs[1].slice(1),[n,e]),v=En(qs[2].slice(1),[n,e]),m=1+d*p,f=1+d*_,g=1+d*v,b=m**3,y=f**3,M=g**3,S=3*p*m**2,P=3*_*f**2,A=3*v*g**2,x=6*p**2*m,E=6*_**2*f,R=6*v**2*g,O=c*b+h*y+u*M,F=c*S+h*P+u*A,G=c*x+h*E+u*R;return d=d-O*F/(F**2-.5*O*G),d}function $6(n,e,t){let[i,r,s]=n,o=Ac(s),a=null,l=null;if(i=Fr(i)/360,o!==0&&o!==1&&r!==0){let c=Math.cos(Rl*i),h=Math.sin(Rl*i),[u,d,p]=aM([o,c,h],e,t),_=.8,v=1.25,m,f,g,b;r<_?(m=v*r,f=0,g=_*u,b=1-g/d):(m=5*(r-.8),f=d,g=.2*d**2*1.25**2/u,b=1-g/(p-d));let y=f+m*g/(1-b*m);a=y*c,l=y*h}return[o,a,l]}function H6(n,e,t){let i=1e-7,r=1e-4,s=n[0],o=0,a=Nu(s),l=Math.sqrt(n[1]**2+n[2]**2),c=.5+Math.atan2(-n[2],-n[1])/Rl;if(a!==0&&a!==1&&l!==0){let u=n[1]/l,d=n[2]/l,[p,_,v]=aM([s,u,d],e,t),m=.8,f=1.25,g,b,y,M;l<_?(b=m*p,y=1-b/_,M=l/(b+y*l),o=M*m):(g=_,b=.2*_**2*f**2/p,y=1-b/(v-_),M=(l-g)/(b+y*(l-g)),o=m+.2*M)}const h=Math.abs(o)<r;return h||a===0||Math.abs(1-a)<i?(c=null,h||(o=0)):c=Fr(c*360),[c,o,a]}new ue({id:"okhsl",name:"Okhsl",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,1],name:"Saturation"},l:{range:[0,1],name:"Lightness"}},base:Lr,gamutSpace:"self",fromBase(n){return H6(n,md,vd)},toBase(n){return $6(n,md,vd)},formats:{color:{id:"--okhsl",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});function G6(n,e,t){let[i,r,s]=n;i=Fr(i)/360;let o=Ac(s),a=null,l=null;if(o!==0&&r!==0){let c=Math.cos(Rl*i),h=Math.sin(Rl*i),u=tp(c,h,e,t),[d,p]=K_(u),_=.5,v=1-_/d,m=1-r*_/(_+p-p*v*r),f=r*p*_/(_+p-p*v*r);o=s*m;let g=s*f,b=Ac(m),y=f*b/m,M=Ac(o);g=g*M/o,o=M;let[S,P,A]=X_([b,c*y,h*y],e),x=_n(1/Math.max(Math.max(S,P),Math.max(A,0)),1/3);o=o*x,g=g*x,a=g*c,l=g*h}return[o,a,l]}function j6(n,e,t){let i=1e-4,r=n[0],s=0,o=Nu(r),a=Math.sqrt(n[1]**2+n[2]**2),l=.5+Math.atan2(-n[2],-n[1])/Rl;if(r!==0&&r!==1&&a!==0){let c=n[1]/a,h=n[2]/a,u=tp(c,h,e,t),[d,p]=K_(u),_=.5,v=1-_/d,m=p/(a+r*p),f=m*r,g=m*a,b=Ac(f),y=g*b/f,[M,S,P]=X_([b,c*y,h*y],e),A=_n(1/Math.max(Math.max(M,S),Math.max(P,0)),1/3);r=r/A,a=a/A,a=a*Nu(r)/r,r=Nu(r),o=r/f,s=(_+p)*g/(p*_+p*v*g)}return Math.abs(s)<i||o===0?l=null:l=Fr(l*360),[l,s,o]}var W6=new ue({id:"okhsv",name:"Okhsv",coords:{h:{refRange:[0,360],type:"angle",name:"Hue"},s:{range:[0,1],name:"Saturation"},v:{range:[0,1],name:"Value"}},base:Lr,gamutSpace:"self",fromBase(n){return j6(n,md,vd)},toBase(n){return G6(n,md,vd)},formats:{color:{id:"--okhsv",coords:["<number> | <angle>","<percentage> | <number>","<percentage> | <number>"]}}});ue.register(L6);ue.register(M6);ue.register(oM);ue.register(P6);ue.register(S6);ue.register(xr);ue.register(ds);ue.register(Lr);ue.register(V6);ue.register(W6);ue.register(E6);ue.register(F6);ue.register(_6);ue.register(sM);ue.register(oh);ue.register(H_);ue.register(Er);function dr(n,e,t=0){if(n.spaceId===e)return;const i=cn(n,e);return(e==="hsl"||e==="hsv")&&(i.coords[1]!==null&&Math.abs(i.coords[1])<1e-8&&(i.coords[0]=t,i.coords[1]=0),i.coords[2]!==null&&Math.abs(i.coords[2])<1e-8&&(i.coords[0]=t,i.coords[2]=0)),_d(i)}function Ow(n,e){n.spaceId=e.spaceId,n.coords[0]=e.coords[0],n.coords[1]=e.coords[1],n.coords[2]=e.coords[2],n.alpha=e.alpha}function _d(n){var e;return{alpha:(e=n.alpha)!==null&&e!==void 0?e:1,coords:[...n.coords],spaceId:"spaceId"in n?n.spaceId:n.space.id}}function Fu(n){return{alpha:n.alpha,coords:[...n.coords],spaceId:n.spaceId}}function K6(n){return n.length===5||n.length===9}function lM(n){const e=n.length;if(e===4||e===5){let t="#";for(let i=1;i<e;i++)t+=n[i]+n[i];return t}return n}function X6(n,e,t){var i;if(typeof e.format!="string"){console.warn("Invalid format type");return}const r=(i=dr(n,e.space))!==null&&i!==void 0?i:n,s=rM(r,{alpha:t??e.alpha,format:e.format});return e.format==="hex"?lM(s):s}function q6(n){try{return ue.get(n)}catch{console.warn(`Unknown color space: ${n}`);return}}function Dh(n,e){var t,i;const r=q6(n);if(r===void 0)throw new Error(`Unknown color space: ${n}`);const s=Object.values(r.coords).at(e),o=(i=(t=s?.range)!==null&&t!==void 0?t:s?.refRange)!==null&&i!==void 0?i:void 0;if(o===void 0)throw new Error(`Unknown range for channel: ${e}`);return o}function Vu(n,e){if(e==null||e<0||!Number.isInteger(e)||!Number.isFinite(n))return n;if(e===0)return Math.round(n);const t=Math.pow(10,e);return Math.round(n*t)/t}function cM(n,e){return e===void 0?n.toString():n.toFixed(Math.max(Math.min(e,20),0))}function hM(n){return typeof n=="object"&&n!==null&&"formatId"in n&&"format"in n&&typeof n.format=="object"&&n.format!==null&&"type"in n.format&&typeof n.format.type=="string"}function Y6(n){return hM(n.format)?n.format.format.type==="function"||"serialize"in n.format.format:!0}function Z6(n,e){return n.spaceId===e.spaceId&&n.alpha===e.alpha&&n.coords[0]===e.coords[0]&&n.coords[1]===e.coords[1]&&n.coords[2]===e.coords[2]}function J6(n,e,t){if(t===null)return null;const i=Dh(n,e);return Le(t,i[0],i[1],0,1)}function Q6(n,e,t){if(t===null)return null;const i=Dh(n,e);return Le(t,0,1,i[0],i[1])}function uM(n){if(typeof n!="string")return;const e=i$(n),t={};let i;try{i=GS(e,{parseMeta:t})}catch{return}const r=t.formatId===void 0?void 0:t;if(r===void 0){console.warn("Could not parse meta");return}if(r.format.alpha!==void 0&&typeof r.format.alpha!="boolean"){console.warn("Alpha metadata is not boolean?");return}const s=r.format.alpha===!0||r.alphaType!==void 0||r.formatId==="hex"&&K6(e),o=_d(i);return{color:o,format:{alpha:s,format:r,space:o.spaceId,type:"string"}}}function Nw(n,e,t){var i;if(!hM(e.format)){console.warn("Invalid format type");return}const r=e.format,s=e$((i=dr(n,e.space))!==null&&i!==void 0?i:n,r,{number:0,percentage:1,unit:2}),o=rM(s,{alpha:t===!1?!1:r.formatId==="hex"?t??e.alpha:{include:t??e.alpha,type:r.alphaType},commas:r.commas,coords:r.types,format:r.format,precision:3});return r.formatId==="hex"?lM(o):o}function e$(n,e,t){if(!((e.formatId==="rgb"||e.formatId==="rgba")&&e.types.every(r=>r==="<number>[0,255]")))return n;const i=Fu(n);if(e.types!==void 0)for(let r=0;r<i.coords.length;r++)i.coords[r]=n$(i.coords[r],e,r,t);return i}function t$(n,e){if(!Array.isArray(n.format.coords[e]))return n.format.coords[e];const t=n.types[e].split("[")[0];return n.format.coords[e].find(i=>i.type===t)}function n$(n,e,t,i){if(n===null)return n;const r=t$(e,t);if(r===void 0)return console.error("coordFormat undefined"),n;const{coordRange:s,range:o}=r;if(o===void 0&&s===void 0)return Vu(n,i.unit);const a=e.types[t]==="<percentage>";if(o===void 0&&s!==void 0)return Vu(n,a?i.percentage:s[1]>1?i.number:i.unit);if(o!==void 0&&s!==void 0){const l=Le(n,s[0],s[1],o[0],o[1]),c=Vu(l,a?i.percentage:o[1]>1?i.number:i.unit);return Le(c,o[0],o[1],s[0],s[1])}return console.warn("Unreachable reached?"),n}function i$(n){const e=n.trim();if(e.startsWith("0x"))return e.replace("0x","#");if(e.startsWith("hsl")){let t=0;return e.replaceAll(/([\d.]+%?)/g,i=>t===0||i.includes("%")||t>2?(t+=1,i):(t+=1,`${i}%`))}return e}function r$(n,e){if(typeof n!="number"||!Number.isFinite(n))return;if(n<0||n>4294967295){console.warn(`Invalid number value: ${n}`);return}const t="#"+n.toString(16),i=uM(t);if(i===void 0)return;const{color:r,format:s}=i;return{color:r,format:{alpha:e===!0||s.alpha,format:{},space:"srgb",type:"number"}}}function dM(n,e,t){var i;if(e.type!=="number"){console.warn(`Invalid format type: ${e.type}`);return}const r=(i=dr(n,"srgb"))!==null&&i!==void 0?i:n,[s,o,a]=r.coords,l=Math.round((s??0)*255),c=Math.round((o??0)*255),h=Math.round((a??0)*255);if(t??e.alpha){const d=Math.round(r.alpha*255);return(l<<24|c<<16|h<<8|d)>>>0}return(l<<16|c<<8|h)>>>0}function s$(n,e,t){const i=dM(n,e,t);if(i===void 0)return;const r=t??e.alpha;return"0x"+i.toString(16).padStart(r?8:6,"0")}const pM=[{channels:[{externalKeys:["h","hue"],internalKey:"h"},{externalKeys:["s","sat","saturation"],internalKey:"s"},{externalKeys:["l","light","lightness"],internalKey:"l"},{externalKeys:["a","alpha","opacity"],internalKey:"alpha"}],spaceId:"hsl"},{channels:[{externalKeys:["h","hue"],internalKey:"h"},{externalKeys:["s","sat","saturation"],internalKey:"s"},{externalKeys:["b","bright","brightness","v","val","value"],internalKey:"v"},{externalKeys:["a","alpha","opacity"],internalKey:"alpha"}],spaceId:"hsv"},{channels:[{externalKeys:["h","hue"],internalKey:"h"},{externalKeys:["w","white","whiteness"],internalKey:"w"},{externalKeys:["b","black","blackness"],internalKey:"b"},{externalKeys:["a","alpha","opacity"],internalKey:"alpha"}],spaceId:"hwb"},{channels:[{externalKeys:["l","light","lightness"],internalKey:"l"},{externalKeys:["a","green-red","greenred","gr"],internalKey:"a"},{externalKeys:["b","blue-yellow","blueyellow","by"],internalKey:"b"},{externalKeys:["alpha","opacity"],internalKey:"alpha"}],spaceId:"lab"},{channels:[{externalKeys:["l","light","lightness"],internalKey:"l"},{externalKeys:["c","chroma"],internalKey:"c"},{externalKeys:["h","hue"],internalKey:"h"},{externalKeys:["a","alpha","opacity"],internalKey:"alpha"}],spaceId:"lch"},{channels:[{externalKeys:["r","red"],internalKey:"r"},{externalKeys:["g","green"],internalKey:"g"},{externalKeys:["b","blue"],internalKey:"b"},{externalKeys:["a","alpha","opacity"],internalKey:"alpha"}],spaceId:"srgb"}];function o$(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function a$(n){return o$(n)?Object.values(n).every(e=>e===null||typeof e=="number"):!1}function l$(n,e){var t;const i=typeof n=="string"&&(t=u$(n))!==null&&t!==void 0?t:n;if(!a$(i))return;const r=Object.fromEntries(Object.entries(i).map(([o,a])=>[o.toLowerCase(),a])),s=new Set(Object.keys(r).map(o=>o.toLowerCase()));for(const o of pM){const{channels:a,spaceId:l}=o,c=a.filter(p=>p.internalKey!=="alpha"),h=a.find(p=>p.internalKey==="alpha"),u=c.every(p=>p.externalKeys.some(_=>s.has(_.toLowerCase()))),d=[...s].every(p=>a.some(_=>_.externalKeys.some(v=>v.toLowerCase()===p)));if(u&&d){const p={alpha:!1,format:{alphaKey:void 0,colorType:e,coordKeys:["","",""]},space:l,type:"object"},_={alpha:1,coords:[0,0,0],spaceId:l};for(const[v,m]of c.entries()){const f=m.externalKeys.find(g=>s.has(g.toLowerCase()));if(f){const g=r[f.toLowerCase()];p.format.coordKeys[v]=f,_.coords[v]=g}}if(h){const v=h.externalKeys.find(m=>s.has(m.toLowerCase()));v&&(p.format.alphaKey=v,p.alpha=!0,_.alpha=r[v.toLowerCase()])}for(const[v,m]of _.coords.entries()){if(m===null)continue;const[f,g]=Dh(_.spaceId,v);_.spaceId==="srgb"?_.coords[v]=p.format.colorType==="int"?Le(m,0,255,f,g):m:p.format.colorType==="float"?_.coords[v]=Le(m,0,1,f,g):_.coords[v]=m}return{color:_,format:p}}}}function fM(n,e,t){var i;const r=e.format;if(e.type!=="object"){console.warn(`Invalid format type: ${e.type}`);return}if(!pM.some(a=>a.spaceId===e.space)){console.warn(`Invalid color space for object conversion: ${e.space}`);return}const s={},o=(i=dr(n,e.space))!==null&&i!==void 0?i:n;for(const[a,l]of o.coords.entries())if(l!==null){const[c,h]=Dh(e.space,a);e.space==="srgb"?s[r.coordKeys[a]]=r.colorType==="int"?Le(l,c,h,0,255):l:r.colorType==="float"?s[r.coordKeys[a]]=Le(l,c,h,0,1):s[r.coordKeys[a]]=l}return(t??e.alpha)&&r.alphaKey!==void 0&&(s[r.alphaKey]=o.alpha),s}function c$(n,e,t){const i=fM(n,e,t);if(i===void 0)return;const r=e.format.colorType==="int"?0:3;return h$(i,r,3)}function h$(n,e,t){const i=[];let r=0;for(const[s,o]of Object.entries(n))i.push(`${s}: ${o===null?"null":cM(o,r===3?t:e)}`),r++;return`{${i.join(", ")}}`}function u$(n){try{return JSON.parse(n)}catch{const t=n.replaceAll(/["%',:{}]/g,"").split(" ").map(r=>r.trim()).filter(r=>r!=="");if(t.length%2!==0)return;const i={};for(let r=0;r<t.length-1;r+=2){const s=t[r];if(typeof s!="string")return;const o=t[r+1];if(o==="null")i[s]=null;else{const a=Number.parseFloat(o);if(Number.isNaN(a))return;i[s]=a}}return i}}function d$(n){return Array.isArray(n)?n.length!==3&&n.length!==4?(console.warn(`Invalid tuple length: ${n.length}`),!1):n.slice(0,3).every(t=>t===null||typeof t=="number")?n.length===4?typeof n[3]=="number":!0:!1:!1}function p$(n,e){var t;const i=typeof n=="string"&&(t=v$(n))!==null&&t!==void 0?t:n;if(!d$(i)){console.warn("Invalid tuple values");return}return{color:{alpha:i.length===4?i[3]:1,coords:[i[0]===null?null:e==="int"?i[0]/255:i[0],i[1]===null?null:e==="int"?i[1]/255:i[1],i[2]===null?null:e==="int"?i[2]/255:i[2]],spaceId:"srgb"},format:{alpha:i.length===4,format:{colorType:e},space:"srgb",type:"tuple"}}}function mM(n,e,t){var i;if(e.type!=="tuple"){console.warn(`Invalid format type: ${e.type}`);return}const{colorType:r}=e.format,s=(i=dr(n,e.space))!==null&&i!==void 0?i:n,o=[s.coords[0]===null?null:s.coords[0]*(r==="int"?255:1),s.coords[1]===null?null:s.coords[1]*(r==="int"?255:1),s.coords[2]===null?null:s.coords[2]*(r==="int"?255:1)];return t??e.alpha?[...o,s.alpha]:o}function f$(n,e,t){const i=mM(n,e,t);if(i===void 0)return;const r=e.format.colorType==="int"?0:3;return m$(i,r,3)}function m$(n,e,t){return`[${n.map((i,r)=>i===null?"null":cM(i,r===3?t:e)).join(", ")}]`}function v$(n){try{const{valueKey:e}=JSON.parse(`{"valueKey": ${n}}`);return e}catch{return}}class pr{get alpha(){return this.color.alpha}set alpha(e){this.color.alpha=Tt(e,0,1)}get space(){return this.color.spaceId}constructor(e){this.color=e}static create(e,t,i){const r=Fw(e,t,i);if(r===void 0){console.warn("Could not parse color");return}return new pr(r.color)}static getFormat(e,t,i){var r;return(r=Fw(e,t,i))===null||r===void 0?void 0:r.format}clone(){return new pr(Fu(this.color))}convert(e){var t;this.color=(t=dr(this.color,e))!==null&&t!==void 0?t:this.color}equals(e){return Z6(this.color,e.color)}get(e,t){var i;return Xa((i=dr(this.color,t??this.color.spaceId))!==null&&i!==void 0?i:this.color,e)}getAll(e){var t;return ep((t=dr(this.color,e??this.color.spaceId))!==null&&t!==void 0?t:this.color)}serialize(e,t){if(typeof e.format=="string")return X6(this.color,e,t);switch(e.type){case"number":return s$(this.color,e,t);case"object":return c$(this.color,e,t);case"string":return Nw(this.color,e,t);case"tuple":return f$(this.color,e,t)}}set(e,t,i){var r,s;if(e==="alpha")this.alpha=Tt(typeof t=="number"?t:t(this.alpha),0,1);else{let o=(r=dr(this.color,i??this.color.spaceId))!==null&&r!==void 0?r:Fu(this.color);Al(o,e,t),o=(s=dr(o,this.color.spaceId))!==null&&s!==void 0?s:o,Ow(this.color,o)}}setAll(e,t){const i=Fu(this.color);$_(i,t??this.color.spaceId,e),Ow(this.color,_d(i))}toGamut(e){const t=this.color.spaceId,i=e??t;this.color=_d(iM(this.color,{space:i})),i!==t&&this.convert(t)}toJSON(){return this.color}toString(){return`ColorPlus(${this.color.spaceId}, [${this.color.coords.map(e=>e===null?"none":Vu(e,4)).join(",")}], ${this.color.alpha})`}toValue(e,t){switch(e.type){case"number":return dM(this.color,e,t);case"object":return fM(this.color,e,t);case"string":return Nw(this.color,e,t);case"tuple":return mM(this.color,e,t)}}}function Fw(n,e=!1,t="int"){var i,r,s;return(s=(r=(i=uM(n))!==null&&i!==void 0?i:r$(n,e))!==null&&r!==void 0?r:l$(n,t))!==null&&s!==void 0?s:p$(n,t)}const $a=Xe("coltxt");function _$(n){const e=n.createElement("select"),t=[{text:"RGB",value:"srgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.append(t.reduce((i,r)=>{const s=n.createElement("option");return s.textContent=r.text,s.value=r.value,i.append(s),i},n.createDocumentFragment())),e}class g${get inputViews(){return this.inputViewsInternal}set inputViews(e){this.inputViewsInternal=e,this.applyInputViewsInternal()}get modeSelectElement(){return this.modeElement}constructor(e,t){this.element=e.createElement("div"),this.element.classList.add($a()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add($a("m")),this.modeElement=_$(e),this.modeElement.classList.add($a("ms")),i.append(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElement);const r=e.createElement("div");r.classList.add($a("mm")),r.append(Ph(e,"dropdown")),i.append(r),this.element.append(i);const s=e.createElement("div");s.classList.add($a("w")),this.element.append(s),this.inputsElement=s,this.inputViewsInternal=t.inputViews,this.applyInputViewsInternal(),yr(t.mode,o=>{this.modeElement.value=o})}applyInputViewsInternal(){g_(this.inputsElement);const e=this.element.ownerDocument;for(const t of this.inputViewsInternal){const i=e.createElement("div");i.classList.add($a("c")),i.append(t.element),this.inputsElement.append(i)}}}function b$(n){return On(n==="float"?3:0)}function x$(n,e,t){if(e==="float")return new Jo({min:0,max:1});const[i,r]=Dh(n,t),s=e==="int"&&n==="srgb"?255:1;return new Jo({min:i*s,max:r*s})}function w$(n,e,t){return new da(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:rt.fromObject({formatter:b$(e.colorType),keyScale:e.colorType==="float"?.01:1,pointerScale:e.colorType==="float"?.01:1}),value:Yt(0,{constraint:x$(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function y$(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Ar,viewProps:e.viewProps};return[0,1,2].map(i=>{const r=w$(n,t,i);return Ir({backward(s,o){const a=s.clone(),l=a.getAll(e.colorMode);return l[i]=e.colorType==="float"?Q6(e.colorMode,i,o??0):(o??0)/(e.colorMode==="srgb"?255:1),a.setAll(l,e.colorMode),i===0&&e.colorMode==="hsl"&&(e.colorType==="int"&&o===360||e.colorType==="float"&&o===1)&&(console.log("edge"),a.set("h",360)),a},forward(s){var o,a,l;let c=(o=s.getAll(e.colorMode)[i])!==null&&o!==void 0?o:0;return i===0&&e.colorMode==="hsl"&&((a=s.get("h","hsv"))!==null&&a!==void 0?a:0)===360&&(c=360),e.colorType==="float"?(l=J6(e.colorMode,i,c))!==null&&l!==void 0?l:0:c*(e.colorMode==="srgb"?255:1)},primary:e.value,secondary:r.value}),r})}function E$(n,e){const t=new Rh(n,{parser(i){const r=pr.create(i);return r===void 0?null:(r.convert("hsv"),r.alpha=e.value.rawValue.alpha,r)},props:rt.fromObject({formatter(i){return i.serialize({alpha:!1,format:"hex",space:"srgb",type:"string"})}}),value:Yt(e.value.rawValue.clone()),viewProps:e.viewProps});return Ir({backward(i,r){return r},forward(i){return i.clone()},primary:e.value,secondary:t.value}),[t]}function C$(n){return n!=="hex"}class S${constructor(e,t){this.onModeSelectChange=this.onModeSelectChange.bind(this),this.colorType=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=Yt("srgb"),this.ccs=this.createComponentControllers(e),this.view=new g$(e,{inputViews:[this.ccs[0].view,this.ccs[1].view,this.ccs[2].view],mode:this.colorMode,viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange)}createComponentControllers(e){const t=this.colorMode.rawValue;return C$(t)?y$(e,{colorMode:t,colorType:this.colorType,value:this.value,viewProps:this.viewProps}):E$(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs=this.createComponentControllers(this.view.element.ownerDocument),this.view.inputViews=this.ccs.map(i=>i.view)}}const Df=Xe("hpl");class M${constructor(e,t){this.onValueChange=this.onValueChange.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange),this.element=e.createElement("div"),this.element.classList.add(Df()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Df("c")),this.element.append(i);const r=e.createElement("div");r.classList.add(Df("m")),this.element.append(r),this.markerElement=r,this.update()}onValueChange(){this.update()}update(){const e=this.value.rawValue.clone(),t=e.get("h","hsv");e.setAll([t,100,100],"hsv"),e.alpha=1,this.markerElement.style.backgroundColor=e.serialize({alpha:!1,format:"rgba",space:"srgb",type:"string"});const i=Le(t,0,360,0,100);this.markerElement.style.left=`${i}%`}}class P${constructor(e,t){this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new M$(e,{value:this.value,viewProps:this.viewProps}),this.pointerHandler=new Or(this.view.element),this.pointerHandler.emitter.on("down",this.onPointerDown),this.pointerHandler.emitter.on("move",this.onPointerMove),this.pointerHandler.emitter.on("up",this.onPointerUp),this.view.element.addEventListener("keydown",this.onKeyDown),this.view.element.addEventListener("keyup",this.onKeyUp)}handlePointerEvent(e,t){if(!e.point)return;const i=Le(Tt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),r=this.value.rawValue.clone();r.set("h",i,"hsv"),this.value.setRawValue(r,t)}onKeyDown(e){const t=Xt(1,Wn(e));if(t===0)return;const i=this.value.rawValue.clone();i.set("h",r=>Tt(r+t,0,360),"hsv"),this.value.setRawValue(i,{forceEmit:!1,last:!1})}onKeyUp(e){Xt(1,Wn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown(e){this.handlePointerEvent(e.data,{forceEmit:!1,last:!1})}onPointerMove(e){this.handlePointerEvent(e.data,{forceEmit:!1,last:!1})}onPointerUp(e){this.handlePointerEvent(e.data,{forceEmit:!0,last:!0})}}const kf=Xe("svp"),Vw=64;class T${constructor(e,t){this.lastHue=-1,this.onValueChange=this.onValueChange.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange),this.element=e.createElement("div"),this.element.classList.add(kf()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=Vw,i.width=Vw,i.classList.add(kf("c")),this.element.append(i),this.canvasElement=i;const r=e.createElement("div");r.classList.add(kf("m")),this.element.append(r),this.markerElement=r,this.update()}onValueChange(){this.update()}update(){const[e,t,i]=this.value.rawValue.getAll("hsv"),r=Le(t??0,0,100,0,100);this.markerElement.style.left=`${r}%`;const s=Le(i??0,0,100,100,0);if(this.markerElement.style.top=`${s}%`,e!==this.lastHue){const o=rS(this.canvasElement);if(!o)return;this.lastHue=e??0;const a={alpha:void 0,coords:[this.lastHue,t,i],spaceId:"hsv"},{width:l,height:c}=this.canvasElement,h=o.getImageData(0,0,l,c),{data:u}=h;for(let d=0;d<c;d++){Al(a,"v",Le(d,0,c,100,0));for(let p=0;p<l;p++){Al(a,"s",Le(p,0,l,0,100));const[_,v,m]=ep(a,"srgb"),f=(d*l+p)*4;u[f]=(_??0)*255,u[f+1]=(v??0)*255,u[f+2]=(m??0)*255,u[f+3]=255}}o.putImageData(h,0,0)}}}class A${constructor(e,t){this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new T$(e,{value:this.value,viewProps:this.viewProps}),this.pointerHandler=new Or(this.view.element),this.pointerHandler.emitter.on("down",this.onPointerDown),this.pointerHandler.emitter.on("move",this.onPointerMove),this.pointerHandler.emitter.on("up",this.onPointerUp),this.view.element.addEventListener("keydown",this.onKeyDown),this.view.element.addEventListener("keyup",this.onKeyUp)}handlePointerEvent(e,t){if(!e.point)return;const i=Tt(Le(e.point.x,0,e.bounds.width,0,100),0,100),r=Tt(Le(e.point.y,0,e.bounds.height,100,0),0,100),s=this.value.rawValue.clone(),o=s.get("h","hsv");s.setAll([o,i,r],"hsv"),this.value.setRawValue(s.clone(),t)}onKeyDown(e){P_(e.key)&&e.preventDefault();const t=1,i=Xt(t,Wn(e)),r=Xt(t,Qo(e));if(i===0&&r===0)return;const s=this.value.rawValue,[o,a,l]=s.getAll("hsv");s.setAll([o,a===null?null:a+i,l===null?null:l+r],"hsv"),this.value.setRawValue(s.clone(),{forceEmit:!1,last:!1})}onKeyUp(e){const i=Xt(1,Wn(e)),r=Xt(1,Qo(e));i===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown(e){this.handlePointerEvent(e.data,{forceEmit:!1,last:!1})}onPointerMove(e){this.handlePointerEvent(e.data,{forceEmit:!1,last:!1})}onPointerUp(e){this.handlePointerEvent(e.data,{forceEmit:!0,last:!0})}}class R${get textsController(){return this.textsC}constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC=new P$(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC=new A$(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs=t.supportsAlpha?{palette:new _9(e,{value:this.value,viewProps:this.viewProps}),text:new da(e,{parser:Ar,props:rt.fromObject({formatter:On(3),keyScale:.1,pointerScale:.01}),value:Yt(0,{constraint:new Jo({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs&&Ir({backward(i,r){return i.alpha=r,i.clone()},forward:i=>i.alpha,primary:this.value,secondary:this.alphaIcs.text.value}),this.textsC=new S$(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new m9(e,{alphaViews:this.alphaIcs?{palette:this.alphaIcs.palette.view,text:this.alphaIcs.text.view}:null,hPaletteView:this.hPaletteC.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC.view,textsView:this.textsC.view,viewProps:this.viewProps})}}const If=Xe("colsw");class L${constructor(e,t){this.onValueChange=this.onValueChange.bind(this),t.value.emitter.on("change",this.onValueChange),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(If()),t.viewProps.bindClassModifiers(this.element),this.swatchRealElement=e.createElement("div"),this.swatchRealElement.classList.add(If("sw")),this.element.append(this.swatchRealElement),this.swatchFallbackElement=e.createElement("div"),this.swatchFallbackElement.style.width="100%",this.swatchFallbackElement.style.height="100%",this.swatchFallbackElement.style.clipPath="polygon(100% 0%, 0% 100%, 100% 100%)",this.swatchRealElement.append(this.swatchFallbackElement);const i=e.createElement("button");i.classList.add(If("b")),t.viewProps.bindDisabled(i),this.element.append(i),this.buttonElement=i,this.update()}onValueChange(){this.update()}update(){const e=this.value.rawValue;this.swatchRealElement.style.opacity=e.alpha.toString(),this.swatchRealElement.style.backgroundColor=e.serialize({alpha:!1,format:"oklch",space:"oklch",type:"string"});const t=e.clone();t.toGamut("srgb"),this.swatchFallbackElement.style.backgroundColor=t.serialize({alpha:!1,format:"oklch",space:"oklch",type:"string"})}}class D${constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new L$(e,{value:this.value,viewProps:this.viewProps})}}class k${get textController(){return this.textC}constructor(e,t){this.onButtonBlur=this.onButtonBlur.bind(this),this.onButtonClick=this.onButtonClick.bind(this),this.onPopupChildBlur=this.onPopupChildBlur.bind(this),this.onPopupChildKeydown=this.onPopupChildKeydown.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable=zl.create(t.expanded),this.swatchC=new D$(e,{value:this.value,viewProps:this.viewProps});const{buttonElement:i}=this.swatchC.view;i.addEventListener("blur",this.onButtonBlur),i.addEventListener("click",this.onButtonClick),this.textC=new Rh(e,{parser:t.parser,props:rt.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new f9(e,{foldable:this.foldable,pickerLayout:t.pickerLayout}),this.view.swatchElement.append(this.swatchC.view.element),this.view.textElement.append(this.textC.view.element),this.popC=t.pickerLayout==="popup"?new M_(e,{viewProps:this.viewProps}):null;const r=new R$(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});for(const s of r.view.allFocusableElements)s.addEventListener("blur",this.onPopupChildBlur),s.addEventListener("keydown",this.onPopupChildKeydown);this.pickerC=r,this.popC?(this.view.element.append(this.popC.view.element),this.popC.view.element.append(r.view.element),Ir({backward:(s,o)=>o,forward:s=>s,primary:this.foldable.value("expanded"),secondary:this.popC.shows})):this.view.pickerElement&&(this.view.pickerElement.append(this.pickerC.view.element),qd(this.foldable,this.view.pickerElement))}onButtonBlur(e){if(!this.popC)return;const{element:t}=this.view,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC.shows.rawValue=!1)}onButtonClick(){this.foldable.set("expanded",!this.foldable.get("expanded")),this.foldable.get("expanded")&&this.pickerC.view.allFocusableElements[0].focus()}onPopupChildBlur(e){if(!this.popC)return;const{element:t}=this.popC.view,i=b_(e);i&&t.contains(i)||i&&i===this.swatchC.view.buttonElement&&!Xd(t.ownerDocument)||(this.popC.shows.rawValue=!1)}onPopupChildKeydown(e){this.popC?e.key==="Escape"&&(this.popC.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC.view.buttonElement.focus()}}function I$(n){return Mn(n,e=>({color:e.optional.object({alpha:e.optional.boolean,formatLocked:e.optional.boolean,type:e.optional.custom(O$)}),expanded:e.optional.boolean,picker:e.optional.custom(T_),readonly:e.optional.constant(!1)}))}function O$(n){return n==="int"?"int":n==="float"?"float":void 0}function N$(n,e){var t,i;return((t=n.color)===null||t===void 0?void 0:t.alpha)!==void 0&&typeof e!="number"&&(console.warn("ColorPlus: alpha mode is only supported for number values... ignoring"),n.color.alpha=void 0),((i=n.color)===null||i===void 0?void 0:i.type)==="float"&&!(Wd(e)||Array.isArray(e))&&(console.warn("ColorPlus: float mode is only supported for object or array values... ignoring"),n.color.type="int"),n}const F$=Fn({accept(n,e){var t,i,r,s,o,a,l,c,h,u;if(e.view!=="color-plus")return null;const d=I$(e);if(!d)return null;const p=N$(e,n),_=pr.getFormat(n,(t=p.color)===null||t===void 0?void 0:t.alpha,(i=d.color)===null||i===void 0?void 0:i.type);if(_===void 0)return console.warn("ColorPlusInputPlugin could not parse and get format"),null;if(!Y6(_))return console.warn("ColorPlusInputPlugin format not serializable"),null;const v=pr.create(n,(r=p.color)===null||r===void 0?void 0:r.alpha,(s=d.color)===null||s===void 0?void 0:s.type);if(v===void 0)return console.warn("ColorPlusInputPlugin could not parse"),null;v.convert("hsv");const m=v.toValue(_,(o=p.color)===null||o===void 0?void 0:o.alpha);return{initialValue:m,params:{color:{alpha:(a=d.color)===null||a===void 0?void 0:a.alpha,formatLocked:(c=(l=d.color)===null||l===void 0?void 0:l.formatLocked)!==null&&c!==void 0?c:!0,type:(u=(h=d.color)===null||h===void 0?void 0:h.type)!==null&&u!==void 0?u:"int"},expanded:d.expanded,format:_,lastExternalValue:m,lastInternalValue:v,picker:d.picker,readonly:d.readonly}}},binding:{equals(n,e){return n.equals(e)&&n===e},reader(n){return e=>{var t,i;if(V$(e,n.params.lastExternalValue))return n.params.lastInternalValue;const r=pr.create(e,(t=n.params.color)===null||t===void 0?void 0:t.alpha,(i=n.params.color)===null||i===void 0?void 0:i.type);return r===void 0?(console.log("ColorPlusInputPlugin could not parse, using last value"),n.params.lastInternalValue):(r.convert("hsv"),r)}},writer(n){return(e,t)=>{var i;if(n.params.lastInternalValue=t,n.params.lastExternalValue=t.toValue(n.params.format,(i=n.params.color)===null||i===void 0?void 0:i.alpha),typeof n.params.lastExternalValue=="number"||typeof n.params.lastExternalValue=="string")$l(e,n.params.lastExternalValue);else if(!Array.isArray(n.params.lastExternalValue))for(const r of Object.keys(n.params.lastExternalValue))e.writeProperty(r,n.params.lastExternalValue[r])}}},controller(n){var e,t,i,r,s;return new k$(n.document,{colorType:(t=(e=n.params.color)===null||e===void 0?void 0:e.type)!==null&&t!==void 0?t:"int",expanded:(i=n.params.expanded)!==null&&i!==void 0?i:!1,formatter:o=>{var a;return o.serialize(n.params.format,(a=n.params.color)===null||a===void 0?void 0:a.alpha)},parser(o){var a,l,c,h,u,d;const p=pr.create(o,(a=n.params.color)===null||a===void 0?void 0:a.alpha,(l=n.params.color)===null||l===void 0?void 0:l.type);if(p===void 0)return null;if(((c=n.params.color)===null||c===void 0?void 0:c.formatLocked)===!1){const _=pr.getFormat(o,(h=n.params.color)===null||h===void 0?void 0:h.alpha,(u=n.params.color)===null||u===void 0?void 0:u.type);if(_===void 0)return null;n.params.format=_}return p.convert("hsv"),n.params.format.alpha||((d=n.params.color)===null||d===void 0?void 0:d.alpha)===!0||(p.alpha=1),p},pickerLayout:(r=n.params.picker)!==null&&r!==void 0?r:"popup",supportsAlpha:n.params.format.alpha||((s=n.params.color)===null||s===void 0?void 0:s.alpha)===!0,value:n.value,viewProps:n.viewProps})},id:"input-color-plus",type:"input"});function V$(n,e){if(n===e)return!0;if(Array.isArray(n)&&Array.isArray(e))return n.length===e.length&&n.every((t,i)=>t===e[i]);if(typeof n=="object"&&n!==null&&typeof e=="object"&&e!==null){const t=Object.keys(n);return t.length===Object.keys(e).length&&t.every(i=>n[i]===e[i])}return!1}const U$="color-plus",B$="",z$=[F$],$$=Object.freeze(Object.defineProperty({__proto__:null,ColorPlusModel:pr,css:B$,id:U$,plugins:z$},Symbol.toStringTag,{value:"Module"})),wt=()=>{};function Of(n,e,...t){if(typeof n=="function")return n.apply(e,t)}class H${constructor({Pane:e=UI,plugins:t={},params:i,materialPresets:r=LE,viewpointPresets:s=Av,callbacks:o={},dependencies:a={}}){this.Pane=e,this.plugins={essentials:t.essentials??VB,colorPlus:t.colorPlus??$$},this.params=i??{},this.materialPresets=r,this.viewpointPresets=s,this.callbacks={updateCanvasSize:o.updateCanvasSize??wt,updateBackground:o.updateBackground??wt,toggleAmbience:o.toggleAmbience??wt,centerViewOnContent:o.centerViewOnContent??wt,setViewpoint:o.setViewpoint??wt,setBeautyViewpoint:o.setBeautyViewpoint??wt,setViewpointFitToFrame:o.setViewpointFitToFrame??wt,switchCameraMode:o.switchCameraMode??wt,updateZoom:o.updateZoom??wt,setCameraFOV:o.setCameraFOV??wt,applyMaterialPreset:o.applyMaterialPreset??wt,updateZSpacing:o.updateZSpacing??wt,exportPNG:o.exportPNG??wt,exportJSON:o.exportJSON??wt,importJSON:o.importJSON??wt,copyJSON:o.copyJSON??wt,pasteJSON:o.pasteJSON??wt,resetSettings:o.resetSettings??wt,clearAll:o.clearAll??wt,undo:o.undo??wt,redo:o.redo??wt,loadImage:o.loadImage??wt,showToast:o.showToast??wt,saveSettings:o.saveSettings??wt,playHeroShot:o.playHeroShot??(async()=>{})},this.cameraAnimator=a.cameraAnimator??{playHeroShot:async()=>{}},this.logUI=a.logUI??{info:wt,error:wt},this.logCamera=a.logCamera??{error:wt},this.confirm=a.confirm??(l=>typeof globalThis.confirm=="function"?globalThis.confirm(l):!0),this.document=a.document??globalThis.document,this.imageStack=a.imageStack??[],this.pane=null}setup(){if(this.pane)return this.pane;const e=this.document?.getElementById?.("controls");if(!e)return this.logUI?.error?.("Controls container not found!"),null;const t=new this.Pane({title:"Vexy-Stax Controls",container:e,expanded:!0});return this.plugins.essentials&&Of(t.registerPlugin,t,this.plugins.essentials),this.plugins.colorPlus&&Of(t.registerPlugin,t,this.plugins.colorPlus),this.logUI?.info?.("Tweakpane created successfully"),this.#e(t),this.#t(t),this.#n(t),this.#i(t),this.pane=t,t}teardown(){this.pane?.dispose&&this.pane.dispose(),this.pane=null}#e(e){const t=e.addFolder({title:"Studio",expanded:!0});t.addBinding(this.params,"canvasSize",{label:"Size",x:{min:640,max:3840,step:1},y:{min:480,max:2160,step:1}}).on("change",i=>{this.callbacks.updateCanvasSize(i.value),this.callbacks.saveSettings()}),t.addBinding(this.params,"bgColor",{label:"Color",view:"color",picker:"inline",expanded:!1}).on("change",()=>{this.callbacks.updateBackground(),this.callbacks.saveSettings()}),t.addBinding(this.params,"transparentBg",{label:"Transparent"}).on("change",()=>{this.callbacks.updateBackground(),this.callbacks.saveSettings()}),t.addBinding(this.params,"ambience",{label:"Ambience"}).on("change",i=>{this.callbacks.toggleAmbience(i.value),this.callbacks.saveSettings()})}#t(e){const t=e.addFolder({title:"Camera",expanded:!0});t.addBinding(this.params,"viewpointPreset",{label:"Viewpoint",options:{Beauty:"beauty",Center:"center",Front:"front",Top:"top",Isometric:"isometric","3D Stack":"3d-stack",Side:"side"}}).on("change",i=>{const r=i.value,s=this.viewpointPresets[r];r==="beauty"?this.callbacks.setBeautyViewpoint():s===null||r==="center"?this.callbacks.centerViewOnContent():s==="fitToFrame"||r==="front"?this.callbacks.setViewpointFitToFrame():s&&this.callbacks.setViewpoint(s.x,s.y,s.z),this.callbacks.saveSettings()}),t.addBinding(this.params,"cameraMode",{label:"Mode",options:{Perspective:"perspective",Orthographic:"orthographic",Isometric:"isometric",Telephoto:"telephoto"}}).on("change",i=>{this.callbacks.switchCameraMode(i.value),this.callbacks.saveSettings()}),t.addBinding(this.params,"cameraZoom",{label:"Zoom",min:.1,max:3,step:.1}).on("change",i=>{this.callbacks.updateZoom(i.value),this.callbacks.saveSettings()}),t.addBinding(this.params,"cameraFOV",{label:"FOV",min:15,max:120,step:5}).on("change",i=>{this.params.cameraFOV=i.value,this.callbacks.setCameraFOV(i.value),this.callbacks.saveSettings()})}#n(e){const t=e.addFolder({title:"Slides",expanded:!0});t.addBinding(this.params,"materialPreset",{label:"Material",options:{"Metallic Card":"metallic-card","Flat Matte":"flat-matte","Glossy Photo":"glossy-photo","Plastic Card":"plastic-card","Thick Board":"thick-board","Metal Sheet":"metal-sheet","Glass Slide":"glass-slide","Matte Print":"matte-print",Bordered:"bordered","3D Box":"3d-box"}}).on("change",i=>{const r=this.materialPresets[i.value];r&&this.callbacks.applyMaterialPreset(r),this.callbacks.saveSettings()}),t.addBinding(this.params,"zSpacing",{label:"Distance",min:0,max:500,step:10}).on("change",i=>{this.callbacks.updateZSpacing(i.value),this.callbacks.saveSettings()})}#i(e){const t=e.addTab({pages:[{title:"File"},{title:"Image"},{title:"Video"}]});this.#r(t.pages[0]),this.#s(t.pages[1]),this.#o(t.pages[2])}#r(e){e.addBlade({view:"buttongrid",size:[2,2],cells:(t,i)=>({title:[["Open","Paste"],["Save","Copy"]][i][t]}),label:"JSON"}).on("click",t=>{const[i,r]=t.index;if(r===0&&i===0){const s=this.document?.createElement?.("input");s&&(s.type="file",s.accept=".json",s.onchange=o=>{const a=o?.target?.files?.[0];a&&this.callbacks.importJSON(a)},Of(s.click,s))}else r===0&&i===1?this.callbacks.pasteJSON():r===1&&i===0?this.callbacks.exportJSON():r===1&&i===1&&this.callbacks.copyJSON()}),e.addBlade({view:"buttongrid",size:[2,1],cells:(t,i)=>({title:[["Defaults","Clear"]][i][t]}),label:"Tools"}).on("click",t=>{t.index[0]===0?this.confirm("Reset all settings to defaults? This will clear saved preferences.")&&this.callbacks.resetSettings():this.callbacks.clearAll()})}#s(e){e.addBlade({view:"buttongrid",size:[3,1],cells:(t,i)=>({title:[["1x","2x","4x"]][i][t]}),label:"PNG"}).on("click",t=>{const i=t.index[0]===0?1:t.index[0]===1?2:4;this.callbacks.exportPNG(i)})}#o(e){e.addButton({title:"Play Hero Shot"}).on("click",async()=>{if(!Array.isArray(this.imageStack)||this.imageStack.length===0){this.callbacks.showToast("No images loaded","error");return}const t=this.imageStack[this.imageStack.length-1];if(!t){this.callbacks.showToast("No top slide found","error");return}this.callbacks.showToast("Animating to Front view...","info");try{await this.cameraAnimator.playHeroShot({topSlide:t,canvasSize:this.params.canvasSize,duration:this.params.animDuration,easing:this.params.animEasing}),this.callbacks.showToast("Animation complete","success")}catch(i){this.logCamera?.error?.("Animation error:",i),this.callbacks.showToast("Animation failed","error")}}),e.addBinding(this.params,"animDuration",{label:"Duration",min:.5,max:5,step:.1}).on("change",()=>{this.callbacks.saveSettings()}),e.addBinding(this.params,"animEasing",{label:"Easing",options:{"Power In/Out":"power2.inOut","Power In":"power2.in","Power Out":"power2.out","Elastic Out":"elastic.out","Back In/Out":"back.inOut","Circ In/Out":"circ.inOut"}}).on("change",()=>{this.callbacks.saveSettings()})}}const Kr=()=>{},G$="Clear all images? This cannot be undone.";function j$(n){const e=n?.createElement?.("div");return e?(e.id="keyboard-help",e.style=e.style??{},e.style.display=e.style.display??"none",e.innerHTML=`
        <h2 style="margin-top: 0;">Keyboard Shortcuts</h2>
        <table style="width: 100%; border-collapse: collapse;">
            <tr><td style="padding: 8px;"><kbd>Ctrl/Cmd + E</kbd></td><td>Export PNG</td></tr>
            <tr><td style="padding: 8px;"><kbd>Ctrl/Cmd + Z</kbd></td><td>Undo</td></tr>
            <tr><td style="padding: 8px;"><kbd>Ctrl/Cmd + Shift + Z</kbd></td><td>Redo</td></tr>
            <tr><td style="padding: 8px;"><kbd>Ctrl/Cmd + Delete</kbd></td><td>Clear all images</td></tr>
            <tr><td style="padding: 8px;"><kbd>?</kbd></td><td>Show this help</td></tr>
            <tr><td style="padding: 8px;"><kbd>Esc</kbd></td><td>Close help</td></tr>
        </table>
        <p style="margin-bottom: 0; margin-top: 20px; text-align: center; font-size: 0.9em; opacity: 0.7;">Press Esc or ? to close</p>
    `,n?.body?.appendChild?.(e),e):null}function W$(n={}){const e=n.addTrackedEventListener??((y,M,S,P)=>y?.addEventListener?.(M,S,P)),t=n.windowRef??globalThis,i=n.document??globalThis.document,r=n.cameraAnimator??{},s=n.showToast??Kr,o=n.logUI??{info:Kr,error:Kr},a=n.logCamera??{info:Kr,error:Kr},l=n.exportPNG??Kr,c=n.undo??Kr,h=n.redo??Kr,u=n.clearAll??Kr,d=n.imageStack??[],p=n.confirm??(y=>typeof globalThis.confirm=="function"?globalThis.confirm(y):!0);let _=null,v=null;const m=()=>{if(_||(_=j$(i)),!_){o.error?.("Unable to render keyboard help overlay");return}const y=_.style.display==="none"||!_.style.display;_.style.display=y?"block":"none",o.info?.(y?"Keyboard shortcuts help shown":"Keyboard shortcuts help hidden")},f=()=>{_&&_.style.display==="block"&&(_.style.display="none",o.info?.("Help closed"))},g=()=>{if(_){if(typeof _.remove=="function")_.remove();else if(i?.body?.removeChild)try{i.body.removeChild(_)}catch(y){o.error?.("Failed to remove keyboard overlay:",y)}_=null}},b=y=>{if(!y)return;if(y.key==="?"||y.key==="/"){y.preventDefault?.(),m();return}if(y.key==="Escape"){if(r?.isAnimating){r.cancel?.(),s("Animation cancelled","info"),a.info?.("Animation cancelled via ESC");return}f();return}const M=y.ctrlKey||y.metaKey;if(M&&y.key==="e"&&!y.shiftKey){y.preventDefault?.(),o.info?.("Keyboard shortcut: Export PNG (Ctrl/Cmd+E)"),l(1);return}if(M&&y.key==="z"&&!y.shiftKey){y.preventDefault?.(),o.info?.("Keyboard shortcut: Undo (Ctrl/Cmd+Z)"),c();return}if(M&&y.key==="z"&&y.shiftKey){y.preventDefault?.(),o.info?.("Keyboard shortcut: Redo (Ctrl/Cmd+Shift+Z)"),h();return}M&&(y.key==="Delete"||y.key==="Backspace")&&(y.preventDefault?.(),Array.isArray(d)&&d.length>0&&p(G$)&&(o.info?.("Keyboard shortcut: Clear all (Ctrl/Cmd+Delete)"),u()))};return e(t,"keydown",b),v=()=>{t?.removeEventListener?.("keydown",b)},o.info?.("Keyboard shortcuts enabled (Ctrl/Cmd+E, Ctrl/Cmd+Z, Ctrl/Cmd+Shift+Z, Ctrl/Cmd+Delete, ?)"),{toggleHelp:m,teardown:()=>{v?.(),v=null,f(),g()}}}const K$=3e3,Uw={success:{bg:"rgba(40, 167, 69, 0.95)",text:"white"},error:{bg:"rgba(220, 53, 69, 0.95)",text:"white"},warning:{bg:"rgba(255, 193, 7, 0.95)",text:"black"},info:{bg:"rgba(23, 162, 184, 0.95)",text:"white"}};function X$(){return typeof document<"u"?document:null}function q$(){return typeof setTimeout=="function"?setTimeout.bind(typeof window<"u"?window:globalThis):()=>{}}function Y$(n={}){const e=n.documentRef??X$(),t=n.setTimeoutFn??q$(),i=n.fadeDuration??AE,r=n.zIndex??Mv,s=n.defaultDuration??K$;return!e||!e.body||typeof e.createElement!="function"?()=>{}:(o,a="info",l=s)=>{const c=e.createElement("div");c.style.cssText=`
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 6px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            z-index: ${r};
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        `;const h=Uw[a]??Uw.info;c.style.background=h.bg,c.style.color=h.text,c.textContent=o,e.body.appendChild(c),t(()=>{c.style.animation="slideOut 0.3s ease-in",t(()=>{typeof c.remove=="function"?c.remove():c.parentNode&&typeof c.parentNode.removeChild=="function"&&c.parentNode.removeChild(c)},i)},l)}}const _c="vexy-stax-settings";function Z$(n){const e=()=>{};return{info:n?.info??e,warn:n?.warn??e,error:n?.error??e}}function Ls(n,e){return typeof n=="function"?n:e}function J$(n={}){const e=n.params??{},t=n.storage,i=Z$(n.logger),r=Ls(n.confirm,()=>!0),s=Ls(n.alert,()=>{}),o=Ls(n.refreshPane,()=>{}),a=Ls(n.switchCameraMode,()=>{}),l=Ls(n.updateZoom,()=>{}),c=Ls(n.updateBackground,()=>{}),h=Ls(n.updateZSpacing,()=>{}),u=Ls(n.updateReflectionSettings,()=>{}),d=n.defaults??{},p=!!(t&&typeof t.getItem=="function"&&typeof t.setItem=="function"),_=(f={})=>{f.cameraMode!==void 0&&(e.cameraMode=f.cameraMode),f.cameraFOV!==void 0&&(e.cameraFOV=f.cameraFOV),f.cameraZoom!==void 0&&(e.cameraZoom=f.cameraZoom),f.bgColor!==void 0&&(e.bgColor=f.bgColor),f.transparentBg!==void 0&&(e.transparentBg=f.transparentBg),f.zSpacing!==void 0&&(e.zSpacing=f.zSpacing)},v=()=>({cameraMode:e.cameraMode,cameraFOV:e.cameraFOV,cameraZoom:e.cameraZoom,bgColor:e.bgColor,transparentBg:e.transparentBg,zSpacing:e.zSpacing}),m=()=>{if(!p){i.warn("localStorage not available");return}const f=v();try{t.setItem(_c,JSON.stringify(f)),i.info("Settings saved to localStorage")}catch(g){if(g&&(g.name==="QuotaExceededError"||g.code===22)){if(i.error("localStorage quota exceeded"),r(`Storage quota full!

Cannot save settings because browser storage is full.

Click OK to clear Vexy Stax storage and try again, or Cancel to continue without saving.`))try{typeof t.removeItem=="function"&&t.removeItem(_c),i.info("Cleared storage, retrying save..."),t.setItem(_c,JSON.stringify(f)),i.info("Settings saved successfully after clearing storage"),s("Storage cleared and settings saved!")}catch(y){i.error("Failed to save even after clearing:",y),s("Still unable to save settings. Try closing other tabs or clearing browser data.")}else i.warn("User declined to clear storage - settings not saved");return}i.error("Failed to save settings:",g?.name??"UnknownError",g?.message??g)}};return{loadSettings(){if(!p)return i.warn("localStorage not available"),!1;try{const f=t.getItem(_c);if(!f)return i.info("No saved settings found"),!1;const g=JSON.parse(f);return _(g),i.info("Settings loaded from localStorage:",g),!0}catch(f){return i.error("Failed to load settings:",f),!1}},saveSettings(){m()},resetSettings(){if(_(d),o(),a(e.cameraMode),l(e.cameraZoom),c(),h(e.zSpacing),u(),p&&typeof t.removeItem=="function")try{t.removeItem(_c),i.info("Settings reset to defaults and cleared from localStorage")}catch(f){i.error("Failed to clear settings:",f)}else i.info("Settings reset to defaults")}}}class Q${constructor({maxSize:e,captureState:t,applyState:i,onStackChange:r,logger:s,showToast:o}){if(!Number.isInteger(e)||e<=0)throw new Error("[HistoryManager] maxSize must be a positive integer");if(typeof t!="function")throw new Error("[HistoryManager] captureState callback is required");if(typeof i!="function")throw new Error("[HistoryManager] applyState callback is required");this.maxSize=e,this.captureState=t,this.applyState=i,this.onStackChange=typeof r=="function"?r:()=>{},this.logger=s??{info:()=>{},warn:()=>{},error:()=>{}},this.showToast=typeof o=="function"?o:()=>{},this.stack=[],this.index=-1,this._notify()}capture(){let e;try{e=this.captureState()}catch(t){return this.logger.error?.("[HistoryManager] Failed to capture snapshot",{error:t}),this.showToast(" Failed to capture history snapshot","error"),null}return this.index<this.stack.length-1&&(this.stack=this.stack.slice(0,this.index+1)),this.stack.push(e),this.index=this.stack.length-1,this.stack.length>this.maxSize&&(this.stack.shift(),this.index=this.stack.length-1),this.logger.info?.("[HistoryManager] Captured snapshot",{size:this.stack.length,index:this.index}),this._notify(),e}undo(){if(this.index<=0)return this.logger.info?.("[HistoryManager] Nothing to undo",{size:this.stack.length,index:this.index}),this.showToast(" Nothing to undo","warning"),!1;const e=this.index;this.index-=1;const t=this.stack[this.index];try{this.applyState(t,{action:"undo",index:this.index})}catch(i){return this.index=e,this.logger.error?.("[HistoryManager] Undo failed",{size:this.stack.length,index:e,error:i}),this.showToast(" Undo failed. Check logs for details.","error"),!1}return this.logger.info?.("[HistoryManager] Undo applied",{size:this.stack.length,index:this.index}),this.showToast(" Undo applied","success"),this._notify(),!0}redo(){if(this.index>=this.stack.length-1)return this.logger.info?.("[HistoryManager] Nothing to redo",{size:this.stack.length,index:this.index}),this.showToast(" Nothing to redo","warning"),!1;const e=this.index;this.index+=1;const t=this.stack[this.index];try{this.applyState(t,{action:"redo",index:this.index})}catch(i){return this.index=e,this.logger.error?.("[HistoryManager] Redo failed",{size:this.stack.length,index:e,error:i}),this.showToast(" Redo failed. Check logs for details.","error"),!1}return this.logger.info?.("[HistoryManager] Redo applied",{size:this.stack.length,index:this.index}),this.showToast(" Redo applied","success"),this._notify(),!0}clear(){this.stack=[],this.index=-1,this.logger.info?.("[HistoryManager] History cleared"),this._notify()}size(){return this.stack.length}getIndex(){return this.index}peekStack(){return this.stack.slice()}getCurrent(){return this.index<0||this.index>=this.stack.length?null:this.stack[this.index]}_notify(){const e=this.stack.slice();try{this.onStackChange(this.index,e)}catch(t){this.logger.error?.("[HistoryManager] onStackChange failed",{error:t}),this.showToast(" History sync failed. Check logs.","error")}}}class eH{constructor(){this._listeners=new Map}on(e,t){if(typeof t!="function")throw new TypeError("EventBus.on requires a function handler");const i=this._listeners.get(e)??[];return i.push(t),this._listeners.set(e,i),()=>this.off(e,t)}once(e,t){const i=this.on(e,r=>{i(),t(r)});return i}off(e,t){const i=this._listeners.get(e);if(!i)return;const r=i.indexOf(t);r>=0&&i.splice(r,1),i.length===0&&this._listeners.delete(e)}emit(e,t){const i=this._listeners.get(e);!i||i.length===0||[...i].forEach(r=>r(t))}clear(){this._listeners.clear()}}const np=new eH,Bw=1,tH=4;function nH(n,e){if(!n||typeof n!="object")throw new Error("Studio size must be an object with x and y properties");if(typeof n.x!="number")throw new Error("Studio width must be a numeric value");if(typeof n.y!="number")throw new Error("Studio height must be a numeric value");if(n.x<=0||n.y<=0)throw new Error("Studio size must be positive in both dimensions");const t=iH(typeof e=="number"?e:typeof window<"u"&&typeof window.devicePixelRatio=="number"?window.devicePixelRatio:1),i=zw(Math.round(n.x*t)),r=zw(Math.round(n.y*t));return{cssWidth:n.x,cssHeight:n.y,renderWidth:i,renderHeight:r,pixelRatio:t}}function iH(n){return!Number.isFinite(n)||n<=0?Bw:Math.min(Math.max(n,Bw),tH)}function zw(n){return Math.max(1,n)}let Pt,je,ct,vt,_t,Rc,bi="perspective",wr,un,$w,es,Hl,Lc=null,rr=null,Uu=null;const rH=1.1,sH=1.35,oH=new k(-.82,-.18,1).normalize();let gd,Rn,Nf,ko=null,Re=[],hl=[],ah=[],bd=-1,Zi=null,Bu=!1,lh=null;const ce=mN(),xd=mn("Init"),vM=mn("Lighting"),aH=mn("Floor"),ip=mn("Images"),_M=mn("File"),Hi=mn("Camera"),Gl=mn("Export"),gM=mn("UI"),Lt=mn("API"),gc=mn("Cleanup"),bc=mn("WebGL"),Hw=mn("Memory"),Ys=mn("History"),wd=mn("Resize"),lH=mn("Retry"),bM=mn("Validation"),cH=mn("Keyboard"),hH=mn("Debug API"),uH=mn("Settings"),_i=Y$({documentRef:typeof document<"u"?document:null,setTimeoutFn:typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout.bind(window):typeof setTimeout=="function"?setTimeout:()=>{},fadeDuration:AE,zIndex:Mv}),q_=J$({params:ce,storage:typeof window<"u"?window.localStorage:null,logger:uH,confirm:typeof window<"u"&&typeof window.confirm=="function"?n=>window.confirm(n):()=>!0,alert:typeof window<"u"&&typeof window.alert=="function"?n=>window.alert(n):()=>{},refreshPane:()=>{ta&&ta.refresh()},switchCameraMode:n=>PM(n),updateZoom:n=>SM(n),updateBackground:()=>eg(),updateZSpacing:n=>TM(n),updateReflectionSettings:()=>void 0,defaults:{cameraMode:"perspective",cameraFOV:Sv,cameraZoom:1,bgColor:lN,transparentBg:!1,zSpacing:cN}});bi=ce.cameraMode;Qt(Wt.params,ce);Qt(Wt.imageStack,Re);Qt(Wt.eventListeners,hl);Qt(Wt.historyStack,ah);Qt(Wt.historyIndex,bd);Do.set("cameraMode",bi);Do.set("memoryState",{lastMemoryWarning:0});Zi=new Q$({maxSize:eN,captureState:CH,applyState:PH,onStackChange:pH,logger:Ys,showToast:_i});let ta;function dH(n){np.emit(Id.backgroundChanged,{reason:n,color:ce.bgColor,transparent:ce.transparentBg,ambience:ce.ambience})}function yd(n){np.emit(Id.stackUpdated,{reason:n,count:Re.length,filenames:Re.map(e=>e.filename)})}function pH(n,e){bd=typeof n=="number"?n:-1,ah=Array.isArray(e)?e.slice():[],Qt(Wt.historyIndex,bd),Qt(Wt.historyStack,ah)}function pa(n){const e=_t&&_t.object?_t.object:je;if(!e)return;const t={reason:n,mode:bi,position:{x:e.position.x,y:e.position.y,z:e.position.z},zoom:e.zoom};typeof e.fov=="number"&&(t.fov=e.fov),np.emit(Id.cameraUpdated,t)}function fH(){const n=[],e=document.createElement("canvas");if(e.getContext("webgl")||e.getContext("experimental-webgl")||n.push("WebGL is not supported by your browser"),window.FileReader||n.push("FileReader API is not supported by your browser"),e.toDataURL||n.push("Canvas export is not supported by your browser"),n.length>0){const i=document.createElement("div");return i.style.cssText=`
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            z-index: ' + Z_INDEX_MODAL + ';
        `,i.innerHTML=`
            <h2 style="margin-top: 0;">Browser Not Supported</h2>
            <p>Vexy Stax requires the following features:</p>
            <ul style="text-align: left;">
                ${n.map(r=>`<li>${r}</li>`).join("")}
            </ul>
            <p>Please use a modern browser like Chrome, Firefox, or Safari.</p>
        `,document.body.appendChild(i),xd.error("Capability check failed:",n),!1}return xd.info(" All required browser capabilities detected"),!0}function mH(){if(!fH())return;yM(),Rc=document.getElementById("canvas"),Pt=new py,Qt(Wt.scene,Pt),Pt.background=new $e(ce.bgColor);const n=window.innerWidth/window.innerHeight;je=new di(ce.cameraFOV,n,.1,rN),Qt(Wt.camera,je),je.position.set(0,0,mi),je.lookAt(0,0,0),je.zoom=ce.cameraZoom;const e=Tv;ct=new D0(e*n/-2,e*n/2,e/2,e/-2,.1,5e3),Qt(Wt.orthoCamera,ct),ct.position.set(0,0,mi),ct.lookAt(0,0,0),ct.zoom=ce.cameraZoom,vt=new tL({canvas:Rc,antialias:!0,alpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),Qt(Wt.renderer,vt),Q_(ce.canvasSize,window.devicePixelRatio),vt.shadowMap.enabled=!0,vt.shadowMap.type=lr,vt.shadowMap.autoUpdate=!0,vt.physicallyCorrectLights=!0,vt.toneMapping=Xw,vt.toneMappingExposure=1.2,vt.outputColorSpace=hi;const t=new Sm(vt);t.compileEquirectangularShader(),ko&&ko.dispose(),ko=t.fromScene(new vL,.04).texture,Pt.environment=ko,t.dispose(),vt.setClearColor(0,1),vH(),_t=new iL(je,vt.domElement),Qt(Wt.controls,_t),_t.enableDamping=!0,_t.dampingFactor=oN,_t.minDistance=Cl,_t.maxDistance=sN,wr=new gN(je,_t),Qt(Wt.cameraAnimator,wr),un=new EN({camera:je,orthoCamera:ct,controls:_t,params:ce,imageStack:Re,pane:{refresh:()=>{}},logCamera:Hi,emitCameraUpdated:pa,onModeChange:i=>{bi=i,Do.set("cameraMode",i)}}),bi=un.getMode(),Do.set("cameraMode",bi),lh=new AN({getImageStack:()=>Re,logMemory:Hw,showToast:_i,confirm:i=>confirm(i),now:()=>Date.now(),thresholds:{warningMB:tN,criticalMB:nN,cooldownMs:iN},toastDurations:{warningMs:Bs,errorMs:Us},bytesPerMB:Pv,isFPSEnabled:()=>Bu,resolveOverlay:()=>typeof document>"u"?null:document.getElementById("fps-display")??null,isOverlayAttached:i=>{if(!i)return!1;if(typeof i.isConnected=="boolean")return i.isConnected;if(typeof document<"u"){const{body:r}=document;if(r&&typeof r.contains=="function")return r.contains(i)}return!!i.parentNode},onWarningUpdate:i=>{Do.set("memoryState",{lastMemoryWarning:i})},initialWarningTimestamp:Do.get("memoryState")?.lastMemoryWarning??0}),Hl=new TN({scene:Pt,params:ce,imageStack:Re,saveHistory:TH,emitStackUpdated:yd,updateImageList:v0,showToast:_i,checkMemoryUsage:jw,logImages:ip,logMemory:Hw,calculateLuminance:rp,getAdaptiveEmissiveIntensity:wM}),Lc=new ON({elements:{imageInput:document.getElementById("image-input"),browseButton:document.getElementById("browse-button"),dropOverlay:document.getElementById("drop-overlay"),slidesPanel:document.getElementById("slides-panel")},addTrackedEventListener:ch,onFileAccepted:i=>{RM(i)},shouldProceedAfterMemoryCheck:()=>jw(!0),showToast:_i,loggers:{logFile:_M,logValidation:bM}}),Lc.setup(),AH(),un.attachPane(ta),rr=new LN({renderer:vt,scene:Pt,imageStack:Re,params:ce,camera:je,orthoCamera:ct,controls:_t,logExport:Gl,showToast:_i,clearAll:hh,updateImageList:v0,emitStackUpdated:yd,updateBackground:eg,pane:ta,getActiveCamera:()=>f0(),document,window,navigator,alert:i=>alert(i)}),xd.info("Initialization complete - UI should be visible"),yH(),Uu=W$({addTrackedEventListener:ch,windowRef:window,document,cameraAnimator:wr,showToast:_i,logUI:gM,logCamera:Hi,exportPNG:i=>J_(i),undo:Y_,redo:Z_,clearAll:hh,imageStack:Re,confirm:i=>confirm(i)}),xH(),wH(),EH(),es=new CN,es.setRenderCallback(()=>{_t.update();const i=f0();vt.render(Pt,i)}),es.start(),xd.info("Vexy Stax initialized")}function rp(n){const e=new $e(n),t=e.r,i=e.g,r=e.b,s=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),o=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),a=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4);return .2126*s+.7152*o+.0722*a}function xM(n){const{min:e,max:t}=dN;return t-n*(t-e)}function wM(n){const{min:e,max:t}=pN;return t-n*(t-e)}function vH(){const n=rp(ce.bgColor),e=xM(n);gd=new dP(16777215,e),Pt.add(gd),Rn=new Ug(16777215,An.intensity),Rn.position.set(An.position.x,An.position.y,An.position.z),Rn.castShadow=!0,Rn.shadow.mapSize.width=An.shadow.mapSize,Rn.shadow.mapSize.height=An.shadow.mapSize,Rn.shadow.camera.near=An.shadow.camera.near,Rn.shadow.camera.far=An.shadow.camera.far,Rn.shadow.camera.left=An.shadow.camera.left,Rn.shadow.camera.right=An.shadow.camera.right,Rn.shadow.camera.top=An.shadow.camera.top,Rn.shadow.camera.bottom=An.shadow.camera.bottom,Rn.shadow.bias=An.shadow.bias,Rn.shadow.normalBias=An.shadow.normalBias,Rn.shadow.radius=An.shadow.radius,Rn.shadow.blurSamples=An.shadow.blurSamples,Pt.add(Rn),Nf=new Ug(16777215,au.intensity),Nf.position.set(au.position.x,au.position.y,au.position.z),Pt.add(Nf);const t=new lP(sf.skyColor,sf.groundColor,sf.intensity);Pt.add(t),vM.info(`Lighting setup complete (bg luminance: ${n.toFixed(2)}, ambient: ${e.toFixed(2)})`)}function _H(){if(!gd)return;const n=rp(ce.bgColor),e=xM(n);gd.intensity=e,vM.info(`Lighting updated (bg luminance: ${n.toFixed(2)}, ambient: ${e.toFixed(2)})`)}function gH(n){return new $e(n)}function Gw(n){Re.forEach((e,t)=>{const i=e.mesh.material.map,r=e.width,s=e.height;Pt.remove(e.mesh),e.mesh.geometry.dispose(),e.mesh.material.dispose();let o;ce.materialThickness>1?o=new no(r,s,ce.materialThickness):o=new os(r,s);let a;n?(a=new Ja({map:i,side:pi,transparent:!0,roughness:ce.materialRoughness,metalness:ce.materialMetalness}),a.envMapIntensity=0,a.needsUpdate=!0):a=new kl({map:i,side:pi,transparent:!0});const l=new jt(o,a);n?(l.castShadow=!0,l.receiveShadow=!0,l.rotation.y=0,l.position.y=0,l.position.z=t*ce.zSpacing):(l.position.z=t*ce.zSpacing,l.position.y=0),e.mesh=l,Pt.add(l)}),ip.info(`Images updated for ambience mode: ${n?"enabled":"disabled"}`)}function bH(n){ce.ambience=n,n?(Gw(!0),_i(" Ambience enabled: Realistic lighting","success")):(Gw(!1),_i("Ambience disabled: Flat rendering","info"))}function ch(n,e,t,i={}){n.addEventListener(e,t,i),hl.push({target:n,event:e,handler:t,options:i}),Qt(Wt.eventListeners,hl)}function xH(){window.vexyStax={exportPNG:(n=1)=>{Lt.info(` Exporting PNG at ${n}x`),J_(n)},clearAll:()=>{Lt.info(" Clearing all images"),hh()},getImageStack:()=>{const n=Re.map((e,t)=>({index:t,filename:e.filename,width:e.texture.image.width,height:e.texture.image.height,position:{x:e.mesh.position.x,y:e.mesh.position.y,z:e.mesh.position.z}}));return Lt.info(" Image stack:",n),n},loadSettings:()=>(Lt.info(" Loading settings"),yM()),saveSettings:()=>{Lt.info(" Saving settings"),EM()},resetSettings:()=>{Lt.info(" Resetting settings to defaults"),CM()},undo:()=>{Lt.info(" Undo"),Y_()},redo:()=>{Lt.info(" Redo"),Z_()},showFPS:n=>{Lt.info(` FPS display: ${n?"enabled":"disabled"}`),Bu=!!n,lh&&lh.invalidateOverlay(),es&&es.showFPS(Bu)},getStats:()=>{const e=(es?es.getFPSStats():{average:null}).average,t={imageCount:Re.length,totalPixels:Re.reduce((i,r)=>{const s=r.texture.image;return i+s.width*s.height},0),estimatedMemoryMB:Re.reduce((i,r)=>{const s=r.texture.image;return i+s.width*s.height*4/Pv},0).toFixed(2),cameraMode:ce.cameraMode,currentSettings:{cameraMode:ce.cameraMode,cameraFOV:ce.cameraFOV,cameraZoom:ce.cameraZoom,bgColor:ce.bgColor,transparentBg:ce.transparentBg,zSpacing:ce.zSpacing},performance:{fpsMonitorEnabled:Bu,currentFPS:e,historySize:`${bd+1}/${ah.length}`}};return Lt.info(" Stats:",t),t},playAnimation:async(n={})=>{if(!wr){Lt.error(" Camera animator not initialized");return}if(Re.length===0){Lt.error(" No images loaded");return}const e=Re[Re.length-1];if(!e){Lt.error(" No top slide found");return}const t=n.duration||ce.animDuration,i=n.easing||ce.animEasing;Lt.info(` Playing hero shot animation (duration: ${t}s, easing: ${i})`);try{await wr.playHeroShot({topSlide:e,canvasSize:ce.canvasSize,duration:t,easing:i,imageStack:Re,holdTime:n.holdTime}),Lt.info(" Animation complete")}catch(r){Lt.error(" Animation failed:",r)}},cancelAnimation:()=>{if(!wr){Lt.error(" Camera animator not initialized");return}Lt.info(" Cancelling animation"),wr.cancel()},loadConfig:n=>(Lt.info(" Loading configuration from object"),new Promise((e,t)=>{try{if(!n.version||!n.params||!n.images)throw new Error("importJSON: invalid config format, missing version, params, or images");hh(),ce.zSpacing=n.params.zSpacing,ce.bgColor=n.params.bgColor,n.params.cameraMode&&(ce.cameraMode=n.params.cameraMode),n.params.cameraFOV&&(ce.cameraFOV=n.params.cameraFOV),Pt.background=new $e(ce.bgColor),n.camera&&n.camera.position&&(je.position.set(n.camera.position.x,n.camera.position.y,n.camera.position.z),je.lookAt(0,0,0),_t.update());const i=new L0,r=n.images.map((s,o)=>new Promise((a,l)=>{i.load(s.dataURL,c=>{const h=new os(s.width,s.height),u=new kl({map:c,side:pi,transparent:!0}),d=new jt(h,u);d.position.z=o*ce.zSpacing,Re.push({mesh:d,texture:c,filename:s.filename,width:s.width,height:s.height}),Pt.add(d),Lt.info(` Loaded ${s.filename} from config`),a()},void 0,c=>{Lt.error(` Failed to load ${s.filename}:`,c),l(c)})}));Promise.all(r).then(()=>{ta.refresh(),Lt.info(" Configuration loaded successfully"),e()}).catch(s=>{Lt.error(" Failed to load one or more images:",s),t(s)})}catch(i){Lt.error(" Failed to load configuration:",i),t(i)}})),help:()=>{console.log(`
%cVexy Stax Debug API
%c
Available commands:
  vexyStax.exportPNG(scale)  - Export PNG at 1x, 2x, 3x, or 4x resolution
  vexyStax.clearAll()        - Remove all images
  vexyStax.getImageStack()   - Get info about loaded images
  vexyStax.undo()            - Undo last change
  vexyStax.redo()            - Redo last undone change
  vexyStax.showFPS(enabled)  - Toggle FPS counter (true/false)
  vexyStax.loadSettings()    - Load settings from localStorage
  vexyStax.saveSettings()    - Save current settings
  vexyStax.resetSettings()   - Reset to default settings
  vexyStax.getStats()        - Get memory and image statistics
  vexyStax.loadConfig(config) - Load JSON configuration object
  vexyStax.playAnimation(config) - Play hero shot animation (config: { duration, holdTime, easing })
  vexyStax.cancelAnimation() - Cancel current animation
  vexyStax.help()            - Show this help

Example usage:
  vexyStax.exportPNG(2)      // Export at 2x resolution
  vexyStax.showFPS(true)     // Enable FPS counter
  vexyStax.undo()            // Undo last action
  vexyStax.getStats()        // Check current state
  vexyStax.loadConfig(config) // Load config from JSON object
  vexyStax.playAnimation({ duration: 2, holdTime: 1.5 }) // Custom animation
  vexyStax.cancelAnimation() // Stop current animation
            `,"color: #00ff00; font-size: 16px; font-weight: bold","color: #ccc")}},hH.log("%c Type vexyStax.help() for available commands","color: #00ff00")}function wH(){window.addEventListener("beforeunload",()=>{gc.info(" Disposing Three.js resources...");try{Re.forEach(n=>{n.mesh&&(n.mesh.geometry&&n.mesh.geometry.dispose(),n.mesh.material&&(n.mesh.material.map&&n.mesh.material.map.dispose(),n.mesh.material.dispose()),Pt.remove(n.mesh))}),Re.length=0,Qt(Wt.imageStack,Re),yd("disposed"),es&&es.dispose(),_t&&_t.dispose(),vt&&(vt.dispose(),vt.forceContextLoss()),Pt&&(Pt.environment=null,Pt.clear()),ko&&(ko.dispose(),ko=null),Lc&&(Lc.teardown(),Lc=null),Uu&&(Uu.teardown?.(),Uu=null),hl.forEach(({target:n,event:e,handler:t,options:i})=>{n.removeEventListener(e,t,i)}),hl=[],Qt(Wt.eventListeners,hl),gc.info(" Removed all event listeners"),gc.info(" All resources disposed successfully")}catch(n){gc.error(" Error during cleanup:",n)}}),gc.info(" Resource cleanup handler registered")}function yH(){let n=null;const e=uN;ch(window,"resize",()=>{n&&clearTimeout(n),n=setTimeout(()=>{VH(),wd.info(" Debounced resize executed"),n=null},e)}),wd.info(` Debounced resize handler registered (${e}ms delay)`)}function EH(){const n=vt.domElement,e=i=>{i.preventDefault(),bc.warn(" Context lost - GPU reset detected");const r=document.createElement("div");r.id="webgl-context-lost-message",r.style.cssText=`
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 165, 0, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            z-index: ' + Z_INDEX_MODAL + ';
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `,r.textContent=" Graphics context lost - recovering...",document.body.appendChild(r)},t=()=>{bc.info(" Context restored - reinitializing renderer");const i=document.getElementById("webgl-context-lost-message");i&&i.remove(),vt.setSize(window.innerWidth,window.innerHeight),vt.setPixelRatio(window.devicePixelRatio),vt.shadowMap.enabled=!0,vt.shadowMap.type=Kw,vt.setClearColor(ce.bgColor,ce.transparentBg?0:1),Re.forEach((s,o)=>{bc.info(` Reloading texture ${o+1}/${Re.length}: ${s.filename}`),s.texture&&s.texture.image&&(s.texture.needsUpdate=!0)}),bc.info(" Context restoration complete");const r=document.createElement("div");r.style.cssText=`
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(40, 167, 69, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            z-index: ' + Z_INDEX_MODAL + ';
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `,r.textContent=" Graphics recovered successfully",document.body.appendChild(r),setTimeout(()=>{r.remove()},3e3)};ch(n,"webglcontextlost",e),ch(n,"webglcontextrestored",t),bc.info(" Context loss/restore handlers registered")}function jw(n=!1){return lh?lh.checkMemoryUsage(n):!0}function CH(){return{timestamp:Date.now(),images:Re.map(n=>({filename:n.filename,width:n.width,height:n.height,originalWidth:n.originalWidth,originalHeight:n.originalHeight,thumbnailSrc:n.thumbnailSrc,position:{...n.mesh.position},texture:n.texture,mesh:n.mesh}))}}function SH(){Pt&&(Re.forEach(n=>{Pt.remove(n.mesh),n.mesh.geometry.dispose(),n.mesh.material.dispose(),n.mesh.material.map&&n.mesh.material.map.dispose()}),Re.length=0,Qt(Wt.imageStack,Re))}function MH(n){!Pt||!Array.isArray(n)||n.forEach(e=>{Re.push({filename:e.filename,width:e.width,height:e.height,originalWidth:e.originalWidth,originalHeight:e.originalHeight,thumbnailSrc:e.thumbnailSrc,texture:e.texture,mesh:e.mesh}),Pt.add(e.mesh),e.position&&e.mesh.position.copy(e.position)})}function PH(n,e={}){if(!n||!Array.isArray(n.images)){Ys.warn(" History snapshot missing images; skipping apply");return}SH(),MH(n.images),v0();const t=Zi?Zi.size():ah.length;e.action==="undo"?Ys.info(` Undo to state ${e.index+1}/${t}`):e.action==="redo"&&Ys.info(` Redo to state ${e.index+1}/${t}`),e.action&&yd(e.action)}function TH(){if(!Zi){Ys.warn(" HistoryManager not initialised; skipping capture");return}if(Zi.capture()===null)return;const e=Zi.getIndex(),t=Zi.size();Ys.info(` Saved state (${e+1}/${t})`)}function Y_(){if(!Zi){Ys.warn(" HistoryManager not initialised; cannot undo");return}Zi.undo()}function Z_(){if(!Zi){Ys.warn(" HistoryManager not initialised; cannot redo");return}Zi.redo()}function yM(){return q_.loadSettings()}function EM(){q_.saveSettings()}function CM(){q_.resetSettings()}function AH(){$w=new H$({params:ce,materialPresets:LE,viewpointPresets:Av,callbacks:{updateCanvasSize:RH,updateBackground:eg,toggleAmbience:bH,centerViewOnContent:MM,setViewpoint:rs,setBeautyViewpoint:AM,setViewpointFitToFrame:m0,switchCameraMode:PM,updateZoom:SM,setCameraFOV:e=>{un?un.setFOV(e):(je.fov=e,je.updateProjectionMatrix())},applyMaterialPreset:DH,updateZSpacing:TM,exportPNG:J_,exportJSON:UH,importJSON:BH,copyJSON:zH,pasteJSON:$H,resetSettings:CM,clearAll:hh,undo:Y_,redo:Z_,showToast:_i,saveSettings:EM},dependencies:{cameraAnimator:wr,logUI:gM,logCamera:Hi,confirm:e=>confirm(e),document,imageStack:Re}});const n=$w.setup();n&&(ta=n)}function J_(n=1){if(!rr){Gl.warn("Export manager not initialized");return}return rr.exportPNG(n)}function f0(){return un?un.getActiveCamera():bi==="orthographic"||bi==="isometric"?ct:je}function SM(n){if(un){un.setZoom(n);return}ce.cameraZoom=n,je.zoom=n,je.updateProjectionMatrix(),ct.zoom=n,ct.updateProjectionMatrix(),Hi.info(`Zoom updated to ${n.toFixed(1)}x`),pa("zoom")}function Q_(n,e){if(!vt||!Rc)return;const t=nH(n,e);return vt.setPixelRatio(t.pixelRatio),vt.setSize(t.cssWidth,t.cssHeight,!1),Rc.style.width=`${t.cssWidth}px`,Rc.style.height=`${t.cssHeight}px`,t}function RH(n){ce.canvasSize=n;const e=Q_(n,window.devicePixelRatio),t=n.x/n.y;if(bi==="perspective"||bi==="telephoto")je.aspect=t,je.updateProjectionMatrix();else if(bi==="orthographic"||bi==="isometric"){const i=Tv;ct.left=i*t/-2,ct.right=i*t/2,ct.top=i/2,ct.bottom=i/-2,ct.updateProjectionMatrix()}ce.ambience,e?wd.info(`Canvas resized to ${e.cssWidth}x${e.cssHeight} (pixel ratio ${e.pixelRatio})`):wd.info(`Canvas resized to ${n.x}x${n.y}`)}function MM(){if(un){un.centerOnContent();return}if(Re.length===0){Hi.info("No content to center on");return}const n=new Qn;Re.forEach(r=>{n.expandByObject(r.mesh)});const e=new k;n.getCenter(e),_t.target.copy(e);const t=f0(),i=new k().subVectors(t.position,new k(0,0,0));t.position.copy(e).add(i),t.lookAt(e),_t.update(),Hi.info(`Centered view on content at (${e.x.toFixed(1)}, ${e.y.toFixed(1)}, ${e.z.toFixed(1)})`),pa("center")}function PM(n){if(un){un.switchMode(n);return}bi=n,ce.cameraMode=n,Hi.info(`Switching to ${n} camera mode`),n==="orthographic"?(ct.position.set(0,0,mi),ct.lookAt(0,0,0),ct.zoom=ce.cameraZoom,ct.updateProjectionMatrix(),_t.object=ct):n==="isometric"?(ct.position.set(500,500,500),ct.lookAt(0,0,0),ct.zoom=ce.cameraZoom,ct.updateProjectionMatrix(),_t.object=ct):n==="telephoto"?(ce.cameraFOV=30,je.fov=30,je.position.set(0,0,1500),je.lookAt(0,0,0),je.zoom=ce.cameraZoom,je.updateProjectionMatrix(),_t.object=je,ta?.refresh?.()):(je.position.set(0,0,mi),je.lookAt(0,0,0),je.zoom=ce.cameraZoom,je.updateProjectionMatrix(),_t.object=je),_t.update(),pa("mode-change")}function eg(){if(ce.transparentBg?(Pt.background=null,vt.setClearColor(0,0)):(Pt.background=new $e(ce.bgColor),vt.setClearColor(ce.bgColor,1)),_H(),ce.ambience&&(gH(ce.bgColor),aH.info(`Floor color updated to ${ce.bgColor}`)),ce.ambience){const n=rp(ce.bgColor),e=wM(n);Re.forEach(t=>{t.mesh.material.emissiveIntensity!==void 0&&(t.mesh.material.emissiveIntensity=e,t.mesh.material.needsUpdate=!0)}),ip.info(`Slides emissive updated (luminance: ${n.toFixed(2)}, emissive: ${e.toFixed(2)})`)}dH("update")}function TM(n){Re.forEach((e,t)=>{e.mesh.position.z=t*n}),ip.info(`Z-spacing updated to ${n}px`)}function rs(n,e,t){if(un){un.setViewpoint(n,e,t);return}je.position.set(n,e,t),je.lookAt(0,0,0),_t.update(),Hi.info(`Viewpoint set to (${n}, ${e}, ${t})`),pa("viewpoint")}function m0(){if(un){un.setViewpointFitToFrame();return}if(ce.viewpointPreset="front",Re.length===0){rs(0,0,mi);return}const e=Re[Re.length-1]?.mesh;if(!e){Hi.error("No front slide found despite non-empty imageStack"),rs(0,0,mi);return}const t=new Qn().setFromObject(e);if(t.isEmpty()){Hi.warn("Front slide bounding box empty, falling back to default viewpoint"),rs(0,0,mi);return}const i=t.getCenter(new k),r=t.getSize(new k),s=r.x||1,o=r.y||1,a=(ce.cameraFOV??Sv)*(Math.PI/180),l=je.aspect||ce.canvasSize.x/ce.canvasSize.y,c=Math.max(Math.tan(a/2),1e-6),h=2*Math.atan(c*l),u=Math.max(Math.tan(h/2),1e-6),d=o/2/c,p=s/2/u,_=Math.max(d,p),v=Math.max(_*rH,Cl),m=new k(i.x,i.y,i.z+v);je.position.copy(m),je.lookAt(i),_t.target.copy(i),_t.update(),Hi.info(`Front view: centred at (${i.x.toFixed(1)}, ${i.y.toFixed(1)}, ${i.z.toFixed(1)}) with width ${s.toFixed(1)}, height ${o.toFixed(1)}, distance ${v.toFixed(1)}`),pa("viewpoint")}function AM(){if(un){un.setBeautyViewpoint();return}if(ce.viewpointPreset="beauty",Re.length===0){rs(-1280,-40,1400);return}const n=new Qn;if(Re.forEach(v=>{v?.mesh&&n.expandByObject(v.mesh)}),n.isEmpty()){rs(-1280,-40,1400);return}const e=n.getCenter(new k),t=new ia;n.getBoundingSphere(t);const i=Math.max(t.radius,1),r=(ce.cameraFOV??Sv)*(Math.PI/180),s=je.aspect||ce.canvasSize.x/ce.canvasSize.y,o=Math.max(Math.tan(r/2),1e-6),a=2*Math.atan(o*s),l=Math.max(Math.tan(a/2),1e-6),c=i/o,h=i/l,u=Math.max(c,h),d=Math.max(u*sH,Cl*2),p=oH.clone().multiplyScalar(d),_=e.clone().add(p);je.position.copy(_),je.lookAt(e),_t.target.copy(e),_t.update(),Hi.info(`Beauty view: centred at (${e.x.toFixed(1)}, ${e.y.toFixed(1)}, ${e.z.toFixed(1)}) radius ${i.toFixed(1)}, distance ${d.toFixed(1)}`),pa("viewpoint")}function LH(){if(typeof window>"u")return;const n={async addSlideFromDataURL(e,t="playwright-slide.png"){if(typeof e!="string"||e.length===0)throw new Error("addSlideFromDataURL requires a base64 data URL string");const i=await fetch(e);if(!i.ok)throw new Error(`Failed to fetch slide data (status ${i.status})`);const r=await i.blob(),s=r.type||"image/png",o=new File([r],t,{type:s}),a=Re.length;await new Promise((l,c)=>{const h=np.once(Id.stackUpdated,()=>{Re.length>a,l()});try{RM(o)}catch(u){h(),c(u)}})},async addSlides(e=[]){for(const t of e)await n.addSlideFromDataURL(t?.dataURL,t?.filename)},async setViewpointPreset(e){const t=e;if(t==="beauty"){AM();return}if(t==="front"){m0();return}if(t==="center"||e===null){MM();return}const i=Av[t];if(i==="fitToFrame"){m0();return}if(i&&typeof i=="object"){rs(i.x,i.y,i.z);return}if(Array.isArray(e)&&e.length===3){rs(e[0],e[1],e[2]);return}if(typeof e=="object"&&e){const{x:r=0,y:s=0,z:o=mi}=e;rs(r,s,o);return}throw new Error(`Unknown viewpoint preset: ${e}`)},async playHeroShot(e={}){if(!wr)throw new Error("Camera animator not initialized");const t=Re[Re.length-1];if(!t)throw new Error("No slides available for hero shot");await wr.playHeroShot({topSlide:t,canvasSize:ce.canvasSize,duration:e.duration??ce.animDuration,easing:e.easing??ce.animEasing,imageStack:Re,holdTime:e.holdTime})}};window.__vexyStaxAutomation=n}function hh(){Hl?.clearAll()}function DH(n){Hl?.applyMaterialPreset(n)}function RM(n){const e=new FileReader;e.onload=function(t){const i=t.target.result;new NN({createLoader:()=>new L0,maxRetries:Au,retryDelays:RE,logRetry:lH,scheduleRetry:(s,o)=>setTimeout(s,o),showToast:_i,toastDurationError:Us,onTextureLoaded:s=>{const o=s.image;(o?.width>rl||o?.height>rl)&&(bM.warn(`Warning: Image ${n.name} has large dimensions (${o?.width}x${o?.height}). Max recommended: ${rl}px.`),_i(` Large dimensions: ${n.name} (${o?.width}x${o?.height}px). May render slowly`,"warning",Bs)),Hl?.addImage(s,n.name)}}).load(i,n.name)},e.onerror=function(t){_M.error(`Failed to read file ${n.name}:`,t),_i(` Failed to read file: ${n.name}`,"error",Us)},e.readAsDataURL(n)}function v0(){const n=document.getElementById("image-list"),e=document.getElementById("slides-empty-message"),t=document.getElementById("slides-panel");if(!n)return;n.setAttribute("role","list"),n.innerHTML="";const i=Re.length>0;t?.classList.toggle("is-empty",!i),e&&e.classList.toggle("hidden",i),Re.forEach((r,s)=>{const o=document.createElement("div");o.className="slide-thumb",o.draggable=!0,o.dataset.index=s,o.dataset.id=r.id,o.tabIndex=0,o.setAttribute("role","listitem"),o.setAttribute("aria-label",`Slide ${s+1}: ${r.filename}, ${r.originalWidth} by ${r.originalHeight} pixels`),o.title=`${r.filename}  ${r.originalWidth}${r.originalHeight}px`;const a=document.createElement("img");a.src=r.thumbnailSrc||r.texture?.image?.currentSrc||r.texture?.image?.src||"",a.alt="",a.draggable=!1,o.appendChild(a);const l=document.createElement("span");l.className="slide-thumb-index",l.textContent=s+1,o.appendChild(l);const c=document.createElement("button");c.type="button",c.className="slide-thumb-delete",c.setAttribute("aria-label",`Delete ${r.filename}`),c.textContent="",c.addEventListener("click",h=>{h.stopPropagation(),deleteImage(s)}),o.appendChild(c),o.addEventListener("click",()=>{o.focus()}),o.addEventListener("dragstart",IH),o.addEventListener("dragover",OH),o.addEventListener("drop",NH),o.addEventListener("dragend",FH),o.addEventListener("keydown",kH),o.addEventListener("focus",()=>{o.classList.add("focused")}),o.addEventListener("blur",()=>{o.classList.remove("focused")}),n.appendChild(o)})}function kH(n){const e=n.currentTarget,t=parseInt(e.dataset.index),i=document.getElementById("image-list"),r=Array.from(i.children);switch(n.key){case"ArrowUp":n.preventDefault(),t>0&&r[t-1].focus();break;case"ArrowDown":n.preventDefault(),t<r.length-1&&r[t+1].focus();break;case"Delete":case"Backspace":n.preventDefault();const s=Re[t];confirm(`Delete "${s.filename}"?`)&&(deleteImage(t),setTimeout(()=>{const a=Array.from(i.children);if(a.length>0){const l=Math.min(t,a.length-1);a[l]?.focus()}},100));break;case"Enter":n.preventDefault();const o=Re[t].mesh;if(o){const a=o.material.emissive.getHex();o.material.emissive.setHex(4521796),setTimeout(()=>{o.material.emissive.setHex(a)},500),cH.info(`Highlighted image ${t+1}: ${s.filename}`),_i(` Image ${t+1}: ${s.filename}`,"info",2e3)}break}}let ul=null;function IH(n){const e=n.currentTarget;ul=parseInt(e.dataset.index,10),e.classList.add("dragging"),n.dataTransfer&&(n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",String(ul)))}function OH(n){return n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect="move"),!1}function NH(n){n.preventDefault();const e=parseInt(n.currentTarget.dataset.index,10);return ul!==null&&ul!==e&&Hl?.reorder(ul,e),!1}function FH(n){n.currentTarget.classList.remove("dragging"),ul=null}window.deleteImage=function(n){Hl?.deleteAt(n)};function VH(){const n=ce.canvasSize.x/ce.canvasSize.y;je.aspect=n,je.updateProjectionMatrix();const e=Tv;ct.left=e*n/-2,ct.right=e*n/2,ct.top=e/2,ct.bottom=e/-2,ct.updateProjectionMatrix(),Q_(ce.canvasSize,window.devicePixelRatio)}function UH(){if(!rr){Gl.warn("Export manager not initialized");return}return rr.exportJSON()}function BH(n){if(!rr){Gl.warn("Export manager not initialized");return}return rr.importJSON(n)}function zH(){if(!rr){Gl.warn("Export manager not initialized");return}return rr.copyJSON()}function $H(){if(!rr){Gl.warn("Export manager not initialized");return}return rr.pasteJSON()}mH();LH();
