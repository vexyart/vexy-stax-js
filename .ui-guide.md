# <!-- this_file: .ui-guide.md -->
# UI Guide: Keyboard Shortcuts & Interactions

Complete reference for all UI controls, keyboard shortcuts, and user interactions in Vexy Stax JS.

---

## Keyboard Shortcuts

All keyboard shortcuts are implemented in main.js (`keydownHandler` function) and accessible via `window.vexyStax.help()`.

**Note**: As of v0.2.0, only 6 keyboard shortcuts are implemented. Future releases may add more shortcuts.

### Help & Navigation

| Key | Action | Description |
|-----|--------|-------------|
| `?` or `/` | Show Help | Display keyboard shortcut reference overlay |
| `Esc` | Close/Cancel | Cancel animation if playing, or close help overlay |

### Export Operations

| Key | Action | Description |
|-----|--------|-------------|
| `Ctrl+E` / `Cmd+E` | Export PNG | Export current view as PNG (1x resolution) |

### Edit Operations

| Key | Action | Description |
|-----|--------|-------------|
| `Ctrl+Z` / `Cmd+Z` | Undo | Undo last change (up to 10 history states) |
| `Ctrl+Shift+Z` / `Cmd+Shift+Z` | Redo | Redo last undone change |
| `Ctrl+Delete` / `Cmd+Delete` | Clear All | Remove all images (requires confirmation) |
| `Ctrl+Backspace` / `Cmd+Backspace` | Clear All | Remove all images (requires confirmation) |

### Future Shortcuts (Planned but Not Implemented)

These shortcuts are documented for future reference but are not currently active:

- Number keys (1-7) for viewpoint presets
- Arrow keys for Z-spacing adjustment
- Bracket keys ([, ]) for FOV control
- Single-letter keys (P, O, I, T) for camera mode switching
- Export variants (E, Shift+E for different resolutions)
- Settings shortcuts (S, Shift+S, Shift+R)

**To Use UI Controls**: Most functionality is available through the Tweakpane control panel on the right side of the screen. Camera controls, export options, material settings, and all other features can be accessed through the UI.

---

## UI Controls

### Main Interface Layout

```
┌─────────────────────────────────────────────────────────────┐
│                       Top Bar (Hidden)                       │
├──────────┬──────────────────────────────────┬───────────────┤
│          │                                  │               │
│  Image   │         3D Viewport             │   Control     │
│  Thumbs  │       (WebGL Canvas)             │   Panel       │
│  (Left)  │                                  │  (Tweakpane)  │
│          │                                  │   (Right)     │
└──────────┴──────────────────────────────────┴───────────────┘
```

### Left Panel: Image Thumbnails

**Purpose**: Visual stack representation with drag-and-drop reordering

**Interactions**:
- **Click**: Select image (highlights thumbnail, focuses in 3D view)
- **Drag**: Reorder images in stack (updates Z-positions)
- **Hover**: Show image filename tooltip
- **Right-click**: Context menu (delete, export single)

**Visual Feedback**:
- Selected thumbnail: Blue border
- Hovered thumbnail: Gray background
- Dragging thumbnail: Semi-transparent, shows drop target

### Center Panel: 3D Viewport

**Purpose**: Real-time 3D visualization of image stack

**Mouse Controls**:
- **Left-click + Drag**: Orbit camera around target
- **Right-click + Drag**: Pan camera (translate)
- **Scroll Wheel**: Zoom in/out
- **Middle-click + Drag**: Pan camera (alternative)
- **Double-click**: Center camera on clicked image

**Touch Controls** (mobile/tablet):
- **1 finger**: Orbit camera
- **2 fingers pinch**: Zoom
- **2 fingers drag**: Pan camera
- **Double-tap**: Center camera on tapped point

**Visual Indicators**:
- **Axes Helper**: RGB arrows showing X/Y/Z directions
- **Grid Floor**: Reference plane for spatial orientation
- **Shadows**: VSM soft shadows for depth perception
- **Selection Highlight**: Selected image has subtle outline

### Right Panel: Control Panel (Tweakpane)

**Organization**: Tabbed interface with 5 categories

#### Tab 1: File
- **Browse Button**: Open file picker (PNG, JPG, GIF, WebP, SVG)
- **Drag & Drop Zone**: Shows when dragging files over window
- **Clear All Button**: Remove all images with confirmation
- **Memory Usage**: Shows current/max memory (500MB warning, 1000MB critical)

#### Tab 2: Image
- **Material Presets**: 10 buttons for quick material application
  - Flat Matte, Glossy Photo, Plastic Card, Thick Board
  - Metal Sheet, Glass Slide, 3D Box, Metallic Card
  - Custom 1, Custom 2
- **Custom Material Controls**:
  - Roughness: 0.0 (glossy) to 1.0 (matte)
  - Metalness: 0.0 (dielectric) to 1.0 (metal)
  - Thickness: 1-50 (for 3D box mode)
  - Border Width: 0-20 (for 3D box mode)
  - Emissive: 0.0-5.0 (self-illumination)
- **Z-Spacing Slider**: 0-500px (distance between images)

#### Tab 3: Video (Future)
- Placeholder for video export features
- MP4/WebM export controls (planned)

#### Tab 4: Studio
- **Background Color**: Color picker for scene background
- **Background Alpha**: 0.0 (transparent) to 1.0 (opaque)
- **Floor Visibility**: Toggle floor grid on/off
- **Floor Opacity**: 0.0 (invisible) to 1.0 (solid)
- **Ambient Mode**: Toggle ambient lighting (removes floor)
- **Light Intensity**: Global lighting brightness control

#### Tab 5: Camera
- **Mode Dropdown**: Perspective, Orthographic, Isometric, Telephoto
- **FOV Slider**: 15-120° (perspective mode only)
- **Zoom Slider**: 0.1x-3.0x (all modes)
- **Viewpoint Presets**: 7 buttons for quick camera positions
  - Front, Top, Beauty, Side, 3D Stack, Center, Isometric
- **Animation Duration**: 0.5-2.0s (camera transition speed)

---

## Drag & Drop Zones

### File Drop Zone

**Where**: Anywhere on window (except control panel)
**Accepts**: Image files (PNG, JPG, GIF, WebP, SVG)
**Max Size**: 50 MB per file
**Validation**: Shows error toast for invalid files

**Visual Feedback**:
- On drag enter: Overlay with "Drop images here"
- On drag over: Highlight drop zone
- On drop: Processing indicator, then thumbnails appear

### Thumbnail Reordering

**Where**: Left panel thumbnail list
**Accepts**: Thumbnails only (internal drag)
**Effect**: Reorders Z-position in 3D stack

**Visual Feedback**:
- On drag start: Thumbnail becomes semi-transparent
- On drag over: Shows insertion point (line between thumbnails)
- On drop: Smooth Z-position animation in 3D view

---

## Context Menus

### Image Thumbnail Context Menu

**Trigger**: Right-click on thumbnail

**Options**:
- **Delete**: Remove this image
- **Export Single**: Export only this image as PNG
- **Move to Top**: Place image at top of stack
- **Move to Bottom**: Place image at bottom of stack
- **Duplicate**: Create copy of this image (future)

---

## Toast Notifications

**Purpose**: Non-blocking feedback for user actions

**Types**:
- **Success** (green, 3s): "Image loaded", "Export successful"
- **Warning** (yellow, 4s): "Memory usage high", "File size large"
- **Error** (red, 5s): "File type not supported", "Export failed"
- **Info** (blue, 3s): "Settings saved", "Undo performed"

**Location**: Top-right corner of viewport
**Behavior**: Auto-dismiss after timeout, click to dismiss immediately

---

## Loading States

### Initial Load
- Show spinner overlay on viewport
- Load Three.js, Tweakpane, GSAP asynchronously
- Initialize WebGL context
- Create scene, camera, lighting

### Image Loading
- Show progress indicator on thumbnail
- Retry up to 3 times on texture load failure
- Display error icon if load fails after retries

### Export Loading
- Show progress modal with cancel button
- Render at target resolution (1x/2x/4x)
- Generate PNG blob
- Trigger download or clipboard copy

---

## Error Handling UI

### WebGL Context Lost
**Display**: Modal overlay with red warning icon
**Message**: "GPU reset detected. Attempting to recover..."
**Actions**: Automatic recovery attempt, reload button if recovery fails

### Memory Warnings
**Display**: Yellow toast notification
**Message**: "Memory usage: 500 MB / 1000 MB. Consider removing images."
**Actions**: None (informational), cooldown 5 minutes between warnings

### File Validation Errors
**Display**: Red toast notification
**Messages**:
- "File type not supported: .txt"
- "File too large: 75 MB (max 50 MB)"
- "Invalid image file"
**Actions**: File rejected, no changes to stack

---

## Accessibility Features

### Keyboard Navigation
- All controls accessible via Tab key
- Focus indicators on all interactive elements
- Escape key closes modals/dialogs

### Screen Reader Support
- ARIA labels on all buttons/controls
- Live region announcements for toast notifications
- Alt text on thumbnail images

### High Contrast Mode
- Control panel respects OS high contrast settings
- Sufficient color contrast ratios (WCAG AA)

---

## Performance Indicators

### FPS Counter (Debug Mode)
**Toggle**: Press `D` or call `vexyStax.showFPS(true)`
**Location**: Top-left corner of viewport
**Display**: "FPS: 60 (avg: 59.8)"
**Color**: Green (≥30fps), Yellow (<30fps), Red (<15fps)

### Memory Monitor
**Location**: File tab in control panel
**Display**: "Memory: 250 MB / 1000 MB (25%)"
**Warnings**: Yellow at 500MB, Red at 750MB

---

## Developer Console API

All UI actions can be triggered programmatically:

```javascript
// Export
window.vexyStax.exportPNG(1);  // 1x resolution
window.vexyStax.exportPNG(2);  // 2x resolution
window.vexyStax.exportPNG(4);  // 4x resolution
window.vexyStax.exportJSON();

// Image management
window.vexyStax.clearAll();
window.vexyStax.getImageStack();  // Array of loaded images

// Settings
window.vexyStax.saveSettings();
window.vexyStax.loadSettings();
window.vexyStax.resetSettings();

// History
window.vexyStax.undo();
window.vexyStax.redo();

// Performance
window.vexyStax.showFPS(true);
window.vexyStax.getStats();  // { fps, memory, imageCount }

// Help
window.vexyStax.help();  // Print keyboard shortcuts
```

See [API.md](API.md) for complete API reference.

---

## UI Customization (Future)

Planned features for UI customization:

- **Theme Switching**: Light/dark mode toggle
- **Panel Layout**: Collapsible panels, movable controls
- **Hotkey Remapping**: Custom keyboard shortcut configuration
- **Preset Workspaces**: Save/load UI layouts
- **Plugin System**: Third-party UI extensions

---

## Troubleshooting UI Issues

### Control Panel Not Responding
**Fix**: Refresh page (Ctrl+R / Cmd+R)

### Keyboard Shortcuts Not Working
**Causes**:
- Focus on input field (click viewport to refocus)
- Browser extensions intercepting keys
**Fix**: Click on viewport, disable conflicting extensions

### 3D Viewport Not Rendering
**Causes**:
- WebGL not supported/enabled
- GPU driver issues
- Browser hardware acceleration disabled
**Fix**: See `.troubleshooting.md` for detailed steps

### Drag & Drop Not Working
**Causes**:
- File type not supported
- Browser permissions blocked
- Conflicting browser extension
**Fix**: Check file type, enable file access, disable extensions

---

## UI Testing

When testing UI changes:

1. **Keyboard Shortcuts**: Test all keys in shortcut table
2. **Mouse Interactions**: Click, drag, scroll in all UI zones
3. **Touch Interactions**: Test on tablet/mobile if available
4. **Drag & Drop**: Test with valid/invalid files
5. **Responsive Behavior**: Test at different window sizes
6. **Error States**: Trigger validation errors intentionally
7. **Loading States**: Test with slow network, large files
8. **Performance**: Monitor FPS with 10+ images loaded

---

**For more information**:
- [README.md](README.md) - Project overview
- [API.md](API.md) - JavaScript API reference
- [CONTRIBUTING.md](CONTRIBUTING.md) - Development guidelines
- [.troubleshooting.md](.troubleshooting.md) - Common issues and fixes
